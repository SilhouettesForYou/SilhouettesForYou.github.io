<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Silhouettes For You</title>
  
  
  <link href="https://silhouettesforyou.github.io/atom.xml" rel="self"/>
  
  <link href="https://silhouettesforyou.github.io/"/>
  <updated>2024-06-10T13:32:57.559Z</updated>
  <id>https://silhouettesforyou.github.io/</id>
  
  <author>
    <name>Xiaoming</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Unreal åŸºç¡€</title>
    <link href="https://silhouettesforyou.github.io/2024/06/10/56/"/>
    <id>https://silhouettesforyou.github.io/2024/06/10/56/</id>
    <published>2024-06-10T01:50:20.000Z</published>
    <updated>2024-06-10T13:32:57.559Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h3 id="UPROPERTY- å’Œ UFUNCTION"><code>UPROPERTY()</code>å’Œ<code>UFUNCTION()</code></h3><h4 id="UPROPERTY"><code>UPROPERTY()</code></h4><ul><li><code>BlueprintCallable</code>ï¼šå¯ä»¥åœ¨è“å›¾ä¸­è¢«è°ƒç”¨</li><li><code>BlueprintReadOnly</code>ï¼šå¯ä»¥è¢«è“å›¾è¯»å–ï¼Œä½†æ˜¯ä¸å¯è¢«ä¿®æ”¹</li><li><code>BlueprintReadWrite</code>ï¼šå¯ä»¥è¢«è“å›¾è¯»å–å’Œä¿®æ”¹</li><li><code>Category</code>ï¼šä¸ºå±æ€§æ·»åŠ åˆ†ç±»æ ‡ç­¾</li><li><code>EditAnywhere</code>ï¼šè¯¥å±æ€§å¯ä»¥åœ¨å±æ€§çª—å£ä¸­ä¿®æ”¹</li><li><code>EditDefaultOnly</code>ï¼šå¯ä»¥åœ¨å±æ€§çª—å£ä¸­ä¿®æ”¹ï¼Œä½†æ˜¯åªèƒ½åœ¨åŸºç±»çš„å±æ€§çª—å£ä¿®æ”¹</li><li><code>VisibleAnywhere</code>ï¼šå¯ä»¥åœ¨å±æ€§çª—å£çœ‹è§ï¼Œä½†æ˜¯ä¸å¯ä¿®æ”¹</li><li><code>VisibleDefaultsOnly</code>ï¼šè¯¥å±æ€§åªå¯åœ¨åŸºç±»çš„å±æ€§çª—å£ä¸­çœ‹è§è€Œä¸”ä¸å¯ä¿®æ”¹</li><li><code>Meta</code>ï¼šå¯ä»¥ç”¨æ¥è®¾ç½®ä¸€äº›å…ƒæ•°æ®ï¼Œå¦‚æ–‡æ¡£ã€å…³é”®å­—ç­‰ï¼Œ<code>meta=(AllowPrivateAccess=&quot;true&quot;)</code> å…è®¸ç§æœ‰å±æ€§åœ¨ç¼–è¾‘å™¨ä¸­è¿›è¡Œç¼–è¾‘</li><li><code>Transient</code>ï¼šè¯¥å±æ€§ä¸ä¼šè¢«åºåˆ—åŒ–ä¿å­˜ï¼Œé€šå¸¸ç”¨äºä¸´æ—¶æ•°æ®æˆ–ä¸å¸Œæœ›è¢«ä¿å­˜çš„æ•°æ®</li><li><code>Replicated</code>ï¼šå±æ€§åœ¨ç½‘ç»œä¸­è¿›è¡Œå¤åˆ¶</li></ul><h4 id="UFUNCTION"><code>UFUNCTION</code></h4><p><code>UFUNCTION</code>æ˜¯ Unreal Engine ä¸­ç¥åŠŸå‡½æ•°çš„å®ï¼Œå®ƒç”¨äºæ ‡è®°æŸä¸ªå‡½æ•°æ˜¯ä¸€ä¸ª Unreal Engine æ‰˜ç®¡çš„å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç¼–è¾‘å™¨ä¸­æƒŠé†’è®¿é—®å’Œæ“ä½œ</p><p><code>UFUNCTION</code>å®æä¾›äº†ä¸€ç³»åˆ—å‚æ•°ï¼Œç”¨äºå®šä¹‰å‡½æ•°çš„å±æ€§å’Œè¡Œä¸ºï¼Œä¾‹å¦‚æ˜¯å¦æ˜¯é˜‘å…¥å¯è°ƒç”¨çš„ï¼Œæ˜¯å¦å¯åœ¨ç½‘ç»œä¸­å¤åˆ¶ç­‰</p><ul><li><code>BlueprintCallable</code>ï¼šå¯ä»¥åœ¨è“å›¾æˆ–è€…å…³å¡è“å›¾ä¸­è°ƒç”¨</li><li><code>BlueprintPure</code>ï¼šç”Ÿå‘½è¯¥å‡½æ•°ä¸ºçº¯å‡½æ•°ï¼Œå³ä¸ä¼šä¿®æ”¹å¯¹è±¡çš„çŠ¶æ€</li><li><code>BlueprintImplementableEvent</code>ï¼šè¿™ä¸ªå‡½æ•°åœ¨å¤´æ–‡ä»¶å£°æ˜ä½†æ˜¯åº”è¯¥åœ¨ç±»è“å›¾æˆ–å…³å¡è“å›¾ä¸­é‡å†™ï¼Œåº”è¯¥å’Œ <code>BlueprintCallable</code> ä¸€èµ·ä½¿ç”¨ï¼Œè¿™æ ·è“å›¾å°±å¯ä»¥è°ƒç”¨å®ƒã€‚</li><li><code>Category</code>ï¼šæŒ‡å®šåœ¨ç¼–è¾‘å™¨ä¸­ç°å®çš„è¯¥å‡½æ•°æ‰€å±çš„åˆ†ç±»</li><li><code>Meta</code>ï¼šå¯ä»¥ç”¨æ¥è®¾ç½®ä¸€äº›å…ƒæ•°æ®ï¼Œå¦‚æ–‡æ¡£ã€å…³é”®å­—ç­‰</li><li><code>Server**</code>ã€<code>Client</code>ã€<code>Reliable</code>ï¼šç”¨äºç½‘ç»œåŠŸèƒ½ï¼ŒæŒ‡å®šè¯¥å‡½æ•°åœ¨æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯æ‰§è¡Œï¼Œä»¥åŠæŒ‡å®šè¯¥å‡½æ•°æ˜¯å¦å¯é ä¼ è¾“</li><li><code>BlueprintNativeEvent</code>ï¼šè¿™ä¸ªå‡½æ•°å¯ä»¥åœ¨è“å›¾ç±»ä¸­é‡å†™ï¼ŒåŒæ—¶æ‹¥æœ‰ C++ å®ç°ï¼Œå‡½æ•°åä¸º<code>FuncName_Implementtation</code></li></ul><h3 id="include å¼•å…¥å¤´æ–‡ä»¶ä¸ä¸å®Œå…¨å£°æ˜"><code>#include</code>å¼•å…¥å¤´æ–‡ä»¶ä¸ä¸å®Œå…¨å£°æ˜</h3><p>å»ºè®®åœ¨æºæ–‡ä»¶ä¸­å¼•å…¥å…¶ä»–å¤´æ–‡ä»¶ï¼Œè€Œä¸æ˜¯åœ¨å¤´æ–‡ä»¶ä¸­å¼•å…¥å…¶ä»–å¤´æ–‡ä»¶</p><ul><li>å‡å°‘ç¼–è¯‘æ—¶é—´</li><li>æ¯”ç§’å¾ªç¯ä¾èµ–</li><li>å¢å¼ºå¯ç»´æŠ¤æ€§</li></ul><h3 id="æ‰“å° -LOG">æ‰“å° LOG</h3><ul><li><p><code>UE_LOG</code></p><ul><li><code>UE_Log</code>å®æ˜¯ Unreal Engine é‡ç”¨æ—¥å¿—è®°å½•çš„æ ‡å‡†æ–¹å¼ã€‚å®ƒå¯ä»¥è¾“å‡ºæ—¥å¿—ä¿¡æ¯åˆ°æ§åˆ¶å°å’Œæ—¥å¿—æ–‡ä»¶ï¼Œæ”¯æŒå¤šç§æ—¥å¿—çº§åˆ«ï¼ˆå¦‚<code>Log</code>ï¼Œ<code>Warning</code>ï¼Œ<code>Error</code>ï¼‰</li><li><code>UE_LOG(LogCategory, LogVerbosity, Format, ...)</code></li></ul></li><li><p><code>GEngine-&gt;AddOnScreenDebugMessage</code></p><ul><li><code>GEngine-&gt;AddOnScreenDebugMessage</code>å¯ä»¥åœ¨æ¸¸æˆå±å¹•ä¸Šç°å®è°ƒè¯•ä¿¡æ¯ï¼Œé€šå¸¸ç”¨äºå¿«é€ŸæŸ¥çœ‹å’Œè°ƒè¯•</li><li><code>GEngine-&gt;AddOnScreenDebugMessage(Key TimeToDisplay, Color, Message)</code></li></ul></li></ul><h3 id="æ§åˆ¶è¾“å…¥">æ§åˆ¶è¾“å…¥</h3><ul><li>Input Mapping Context<ul><li>å®šä¹‰äº†é‚£äº›è¾“å…¥é”®è§¦å‘é‚£äº›è¾“å…¥åŠ¨ä½œçš„è§„åˆ™é›†åˆ</li></ul></li><li>Input Action<ul><li>ä»£è¡¨äº†ç©å®¶å¯ä»¥æ‰§è¡Œçš„æŸç§åŠ¨ä½œ</li></ul></li><li><code>EnhancedInputComponent</code><ul><li>æ›´çµæ´»</li><li>è¾“å…¥ç»‘å®šä¼˜åŒ–</li><li>è¾“å…¥å¤„ç†æµç¨‹çš„æ”¹è¿›</li></ul></li></ul><h3 id="Anim-Instnce- ä¸åŠ¨ç”»">Anim Instnce ä¸åŠ¨ç”»</h3><h3 id="AActorã€APawn å’Œ ACharactor"><code>AActor</code>ã€<code>APawn</code>å’Œ<code>ACharactor</code></h3><ul><li><code>UObject</code>ï¼šåŸºç¡€ç±» <code>UObject</code> æ˜¯æ‰€æœ‰é Actor ç±»çš„åŸºç±»ï¼Œå‡ ä¹æ‰€æœ‰çš„ Unreal Engine å¯¹è±¡éƒ½ç»§æ‰¿è‡ª<code>UObject</code></li><li><code>AActor</code>ï¼šç»§æ‰¿è‡ª<code>UObject</code>ï¼Œå¹¶ä¸”æ˜¯æ‰€æœ‰åœºæ™¯ä¸­å¯¹è±¡ï¼ˆè§’è‰²ã€é“å…·ã€ç¯å…‰ç­‰ï¼‰çš„åŸºç±»</li><li><code>APawn</code>ï¼šå¯ä»¥è¢«ç©å®¶æˆ– AI æ§åˆ¶çš„å¯¹è±¡ï¼Œä¸¹æ–¯ä¸éœ€è¦å¤æ‚çš„è¿åŠ¨å’ŒåŠ¨ç”»ç³»ç»Ÿ<ul><li>å¯æ§åˆ¶æ€§</li><li>æ§åˆ¶å™¨ï¼š<code>APawn</code>é€šå¸¸ä¸ <code>AController</code> æˆ–<code>APlayerController</code>å…³è”ï¼Œä»¥å®ç°ç§»åŠ¨å’Œäº¤äº’</li><li>ä¸åŒ…å«éª¨éª¼ç½‘æ ¼å’ŒåŠ¨ç”»</li></ul></li><li><code>ACharacter</code>æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„<code>APawn</code>ï¼Œå®ƒåŒ…å«ç”¨äºè¡Œèµ°ã€è·³è·ƒã€æ¸¸æ³³ç­‰è¿åŠ¨åŠŸèƒ½ã€‚å®ƒæ˜¯å¸¦æœ‰éª¨éª¼åŠ¨ç”»å’ŒåŠ¨ç”»ç³»ç»Ÿçš„é«˜çº§è§’è‰²ç±»<ul><li>éª¨éª¼ç½‘æ ¼å’ŒåŠ¨ç”»ï¼š<code>ACharacter</code>åŒ…å« ``USkeletallMeshComponent å’ŒåŠ¨ç”»è“å›¾ï¼Œç”¨äºè§’è‰²çš„å¤–è§‚å’ŒåŠ¨ç”»</li><li>è§’è‰²è¿åŠ¨ï¼šåŒ…å«<code>UCharacterMovementComponent</code>ï¼Œæ”¯æŒå¤æ‚çš„è§’è‰²è¿åŠ¨</li><li>ç¢°æ’å’Œèƒ¶å›Šä½“ï¼šé»˜è®¤åŒ…å«ä¸€ä¸ªèƒ¶å›Šç¢°æ’ä½“ï¼Œç”¨äºè§’è‰²çš„ç¢°æ’æ£€æµ‹</li></ul></li></ul><h3 id="æ¸¸æˆæ˜¯æ€æ ·è¿è¡Œçš„">æ¸¸æˆæ˜¯æ€æ ·è¿è¡Œçš„</h3><ul><li><code>AGameModeBase</code><ul><li>è¿™æ˜¯æ¸¸æˆæ¨¡å¼çš„åŸºç±»ï¼Œå®ƒå®šä¹‰äº†æ¸¸æˆçš„è§„åˆ™ã€é€»è¾‘å’Œè¡Œä¸º</li><li>å¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå®šä¹‰çš„æ¸¸æˆæ¨¡å¼ç±»æ¥æ‰©å±•å®ƒï¼Œå¹¶é‡å†™å…¶ä¸­çš„æ–¹æ³•æ¥å®ç°ç‰¹å®šçš„æ¸¸æˆçš„é€»è¾‘</li></ul></li><li><code>AGameMode</code><ul><li><code>AGameMode</code>ç±»æ˜¯ <code>AGameModeBase</code> çš„ä¸€ä¸ªå­ç±»ï¼Œå®ƒæä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œæ§åˆ¶æƒï¼Œä¾‹å¦‚ç©å®¶æ§åˆ¶ã€å›¢é˜Ÿç®¡ç†ã€ç§¯åˆ†ç³»ç»Ÿç­‰</li><li>å¯ä»¥ä½¿ç”¨ <code>AGameMode</code> ç±»æ¥å®ç°æ›´å¤æ‚çš„æ¸¸æˆé€»è¾‘å’Œè§„åˆ™</li></ul></li><li>Game Session</li><li>Game State</li><li>Player State</li><li>Default Pawn Class</li><li>APlayerController</li><li>AHUD</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="é¢è¯•" scheme="https://silhouettesforyou.github.io/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
    <category term="Unreal" scheme="https://silhouettesforyou.github.io/tags/Unreal/"/>
    
    <category term="è“å›¾" scheme="https://silhouettesforyou.github.io/tags/%E8%93%9D%E5%9B%BE/"/>
    
  </entry>
  
  <entry>
    <title>XLua å¦‚ä½•ä¸ C# è¿›è¡Œäº¤äº’</title>
    <link href="https://silhouettesforyou.github.io/2024/06/04/55/"/>
    <id>https://silhouettesforyou.github.io/2024/06/04/55/</id>
    <published>2024-06-04T06:50:00.000Z</published>
    <updated>2024-06-04T13:30:50.451Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>ğŸ”— <a class="link" href="https://www.cnblogs.com/iwiniwin/p/15307368.html">æ·±å…¥ xLua å®ç°åŸç†ä¹‹ Lua å¦‚ä½•è°ƒç”¨ C#<i class="fas fa-external-link-alt"></i></a></p></blockquote><p><a class="link" href="https://github.com/Tencent/xLua">xLua<i class="fas fa-external-link-alt"></i></a> æ˜¯è…¾è®¯çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œä¸º Unityã€ .Netã€ Mono ç­‰ C# ç¯å¢ƒå¢åŠ  Lua è„šæœ¬ç¼–ç¨‹çš„èƒ½åŠ›ã€‚æœ¬æ–‡ä¸»è¦æ˜¯æ¢è®¨ xLua ä¸‹ Lua è°ƒç”¨ C# çš„å®ç°åŸç†</p><h3 id="Lua- ä¸ -C- æ•°æ®é€šä¿¡æœºåˆ¶">Lua ä¸ C# æ•°æ®é€šä¿¡æœºåˆ¶</h3><p>æ— è®ºæ˜¯ Lua è°ƒç”¨ C#ï¼Œè¿˜æ˜¯ C# è°ƒç”¨ Luaï¼Œéƒ½éœ€è¦ä¸€ä¸ªé€šä¿¡æœºåˆ¶ï¼Œæ¥å®Œæˆæ•°æ®çš„ä¼ é€’ã€‚è€Œ Lua æœ¬èº«å°±æ˜¯ç”± C è¯­è¨€ç¼–å†™çš„ï¼Œæ‰€ä»¥å®ƒå‡ºç”Ÿè‡ªå¸¦ä¸€ä¸ªå’Œ C/C++ çš„é€šä¿¡æœºåˆ¶</p><p>Lua å’Œ C/C++ çš„æ•°æ®äº¤äº’é€šè¿‡æ ˆè¿›è¡Œï¼Œæ“ä½œæ•°æ®æ—¶ï¼Œé¦–å…ˆå°†æ•°æ®æ‹·è´åˆ° &quot; æ ˆ &quot; ä¸Šï¼Œç„¶åè·å–æ•°æ®ï¼Œæ ˆä¸­çš„æ¯ä¸ªæ•°æ®é€šè¿‡ç´¢å¼•å€¼è¿›è¡Œå®šä½ï¼Œç´¢å¼•å€¼ä¸ºæ­£æ—¶è¡¨ç¤ºç›¸å¯¹äºæ ˆåº•çš„åç§»ç´¢å¼•ï¼Œç´¢å¼•å€¼ä¸ºè´Ÿæ—¶è¡¨ç¤ºç›¸å¯¹äºæ ˆé¡¶çš„åç§»ç´¢å¼•ï¼Œç´¢å¼•å€¼ä»¥ 1 æˆ– -1 ä¸ºèµ·å§‹å€¼ï¼Œå› æ­¤æ ˆé¡¶ç´¢å¼•å€¼æ°¸è¿œä¸º -1ï¼Œ æ ˆåº•ç´¢å¼•å€¼æ°¸è¿œä¸º 1 ã€‚ â€œæ ˆ &quot; ç›¸å½“äºæ•°æ®åœ¨ Lua å’Œ C/C++ ä¹‹é—´çš„ä¸­è½¬åœ°ã€‚æ¯ç§æ•°æ®éƒ½æœ‰ç›¸åº”çš„å­˜å–æ¥å£</p><p>è€Œ C# å¯ä»¥é€šè¿‡ P/Invoke æ–¹å¼è°ƒç”¨ Lua çš„ dllï¼Œé€šè¿‡è¿™ä¸ª dll æ‰§è¡Œ Lua çš„ C APIã€‚æ¢è¨€ä¹‹ C# å¯ä»¥å€ŸåŠ© C/C++ æ¥ä¸ Lua è¿›è¡Œæ•°æ®é€šä¿¡ã€‚åœ¨ xLua çš„ LuaDLL.cs æ–‡ä»¶ä¸­å¯ä»¥æ‰¾åˆ°è®¸å¤š DllImport ä¿®é¥°çš„æ•°æ®å…¥æ ˆä¸è·å–çš„æ¥å£</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LuaDLL.cs</span></span><br><span class="line">[<span class="meta">DllImport(LUADLL,CallingConvention=CallingConvention.Cdecl)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">lua_pushnumber</span>(<span class="params">IntPtr L, <span class="built_in">double</span> number</span>)</span>;</span><br><span class="line"></span><br><span class="line">[<span class="meta">DllImport(LUADLL,CallingConvention=CallingConvention.Cdecl)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">lua_pushboolean</span>(<span class="params">IntPtr L, <span class="built_in">bool</span> <span class="keyword">value</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">[<span class="meta">DllImport(LUADLL, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">xlua_pushinteger</span>(<span class="params">IntPtr L, <span class="built_in">int</span> <span class="keyword">value</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">[<span class="meta">DllImport(LUADLL, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">double</span> <span class="title">lua_tonumber</span>(<span class="params">IntPtr L, <span class="built_in">int</span> index</span>)</span>;</span><br><span class="line"></span><br><span class="line">[<span class="meta">DllImport(LUADLL, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">int</span> <span class="title">xlua_tointeger</span>(<span class="params">IntPtr L, <span class="built_in">int</span> index</span>)</span>;</span><br><span class="line"></span><br><span class="line">[<span class="meta">DllImport(LUADLL, CallingConvention = CallingConvention.Cdecl)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">uint</span> <span class="title">xlua_touint</span>(<span class="params">IntPtr L, <span class="built_in">int</span> index</span>)</span>;</span><br><span class="line"></span><br><span class="line">[<span class="meta">DllImport(LUADLL,CallingConvention=CallingConvention.Cdecl)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> <span class="title">lua_toboolean</span>(<span class="params">IntPtr L, <span class="built_in">int</span> index</span>)</span>;</span><br></pre></td></tr></table></figure><h3 id="ä¼ é€’ -C- å¯¹è±¡åˆ° -Lua">ä¼ é€’ C# å¯¹è±¡åˆ° Lua</h3><p>å¯¹äº <code>bool</code>ï¼Œ<code>int</code> è¿™æ ·ç®€å•çš„å€¼ç±»å‹å¯ä»¥ç›´æ¥é€šè¿‡ C API ä¼ é€’ã€‚ä½†å¯¹äº C# å¯¹è±¡å°±ä¸åŒäº†ï¼ŒLua è¿™è¾¹æ²¡æœ‰èƒ½ä¸ä¹‹å¯¹åº”çš„ç±»å‹ï¼Œå› æ­¤ä¼ é€’åˆ° Lua çš„åªæ˜¯ C# å¯¹è±¡çš„ä¸€ä¸ªç´¢å¼•ï¼Œå…·ä½“å®ç°è¯·çœ‹ä¸‹é¢çš„ä»£ç </p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ObjectTranslator.cs</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Push</span>(<span class="params">RealStatePtr L, <span class="built_in">object</span> o</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="built_in">int</span> index = <span class="number">-1</span>;</span><br><span class="line">    Type type = o.GetType();</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> !UNITY_WSA || UNITY_EDITOR</span></span><br><span class="line">    <span class="built_in">bool</span> is_enum = type.IsEnum;</span><br><span class="line">    <span class="built_in">bool</span> is_valuetype = type.IsValueType;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="built_in">bool</span> is_enum = type.GetTypeInfo().IsEnum;</span><br><span class="line">    <span class="built_in">bool</span> is_valuetype = type.GetTypeInfo().IsValueType;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="built_in">bool</span> needcache = !is_valuetype || is_enum;  <span class="comment">// å¦‚æœæ˜¯å¼•ç”¨æˆ–æšä¸¾ï¼Œä¼šè¿›è¡Œç¼“å­˜</span></span><br><span class="line">    <span class="keyword">if</span> (needcache &amp;&amp; (is_enum ? enumMap.TryGetValue(o, <span class="keyword">out</span> index) : reverseMap.TryGetValue(o, <span class="keyword">out</span> index)))  <span class="comment">// å¦‚æœæœ‰ç¼“å­˜</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (LuaAPI.xlua_tryget_cachedud(L, index, cacheRef) == <span class="number">1</span>)  </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¿™é‡Œå®åœ¨å¤ªç»å…¸äº†ï¼Œweaktable å…ˆåˆ é™¤ï¼Œç„¶å GC ä¼šå»¶è¿Ÿè°ƒç”¨ï¼Œå½“ index ä¼šå¾ªç¯åˆ©ç”¨çš„æ—¶å€™ï¼Œä¸æ³¨é‡Šè¿™è¡Œå°†ä¼šå¯¼è‡´é‡å¤é‡Šæ”¾</span></span><br><span class="line">        <span class="comment">//collectObject(index);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">bool</span> is_first;</span><br><span class="line">    <span class="built_in">int</span> type_id = getTypeId(L, type, <span class="keyword">out</span> is_first);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœä¸€ä¸ª type çš„å®šä¹‰å«æœ¬èº«é™æ€ readonly å®ä¾‹æ—¶ï¼ŒgetTypeId ä¼š push ä¸€ä¸ªå®ä¾‹ï¼Œè¿™æ—¶å€™åº”è¯¥ç”¨è¿™ä¸ªå®ä¾‹</span></span><br><span class="line">    <span class="keyword">if</span> (is_first &amp;&amp; needcache &amp;&amp; (is_enum ? enumMap.TryGetValue(o, <span class="keyword">out</span> index) : reverseMap.TryGetValue(o, <span class="keyword">out</span> index))) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (LuaAPI.xlua_tryget_cachedud(L, index, cacheRef) == <span class="number">1</span>)   </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// C# ä¾§è¿›è¡Œç¼“å­˜</span></span><br><span class="line">    index = addObject(o, is_valuetype, is_enum);</span><br><span class="line">    <span class="comment">// å°†ä»£è¡¨å¯¹è±¡çš„ç´¢å¼• push åˆ° lua</span></span><br><span class="line">    LuaAPI.xlua_pushcsobj(L, index, type_id, needcache, cacheRef);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç ä¸­çš„ä¸¤ä¸ª <code>if</code> è¯­å¥ä¸»è¦æ˜¯å¯¹ç¼“å­˜çš„åˆ¤æ–­ï¼Œå¦‚æœè¦ä¼ é€’çš„å¯¹è±¡å·²ç»è¢«ç¼“å­˜è¿‡äº†å°±ç›´æ¥ä½¿ç”¨ç¼“å­˜çš„ã€‚å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯è¢«ç¬¬ä¸€æ¬¡ä¼ é€’ï¼Œåˆ™è¿›è¡Œä»¥ä¸‹ä¸¤æ­¥æ“ä½œ</p><ol><li>é€šè¿‡ <code>addObject</code> å°†å¯¹è±¡ç¼“å­˜åœ¨ <code>objects</code> å¯¹è±¡æ± ä¸­ï¼Œå¹¶å¾—åˆ°ä¸€ä¸ªç´¢å¼•ï¼ˆé€šè¿‡è¿™ä¸ªç´¢å¼•å¯ä»¥è·å–åˆ°è¯¥å¯¹è±¡ï¼‰</li></ol><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ObjectTranslator.cs</span></span><br><span class="line"><span class="function"><span class="built_in">int</span> <span class="title">addObject</span>(<span class="params"><span class="built_in">object</span> obj, <span class="built_in">bool</span> is_valuetype, <span class="built_in">bool</span> is_enum</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> index = objects.Add(obj);</span><br><span class="line">    <span class="keyword">if</span> (is_enum)</span><br><span class="line">    &#123;</span><br><span class="line">        enumMap[obj] = index;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!is_valuetype)</span><br><span class="line">    &#123;</span><br><span class="line">        reverseMap[obj] = index;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>é€šè¿‡ <code>xlua_pushcsobj</code> å°†ä»£è¡¨å¯¹è±¡çš„ç´¢å¼•ä¼ é€’åˆ° Lua</li></ol><p>å‚æ•° <code>key</code> è¡¨ç¤ºä»£è¡¨å¯¹è±¡çš„ç´¢å¼•ï¼Œå‚æ•° <code>meta_ref</code> è¡¨ç¤ºä»£è¡¨å¯¹è±¡ç±»å‹çš„è¡¨çš„ç´¢å¼•ï¼Œå®ƒçš„å€¼æ˜¯é€šè¿‡ <code>getTypeId</code> å‡½æ•°è·å¾—çš„ï¼Œåé¢ä¼šè¯¦ç»†è®²åˆ°ã€‚å‚æ•° <code>need_cache</code> è¡¨ç¤ºæ˜¯å¦éœ€è¦åœ¨ Lua ä¾§è¿›è¡Œç¼“å­˜ï¼Œå‚æ•° <code>cache_ref</code> è¡¨ç¤º Lua ä¾§ç¼“å­˜è¡¨çš„ç´¢å¼•</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xlua.c</span></span><br><span class="line">LUA_API <span class="type">void</span> <span class="title function_">xlua_pushcsobj</span><span class="params">(lua_State *L, <span class="type">int</span> key, <span class="type">int</span> meta_ref, <span class="type">int</span> need_cache, <span class="type">int</span> cache_ref)</span> &#123;</span><br><span class="line">    <span class="type">int</span>* pointer = (<span class="type">int</span>*)lua_newuserdata(L, <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    *pointer = key;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (need_cache) cacheud(L, key, cache_ref);  <span class="comment">// Lua ä¾§ç¼“å­˜</span></span><br><span class="line"></span><br><span class="line">    lua_rawgeti(L, LUA_REGISTRYINDEX, meta_ref);</span><br><span class="line"></span><br><span class="line">    lua_setmetatable(L, <span class="number">-2</span>);  <span class="comment">// ä¸º userdata è®¾ç½®å…ƒè¡¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°† key = userdata å­˜å…¥ç¼“å­˜è¡¨</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">cacheud</span><span class="params">(lua_State *L, <span class="type">int</span> key, <span class="type">int</span> cache_ref)</span> &#123;</span><br><span class="line">    lua_rawgeti(L, LUA_REGISTRYINDEX, cache_ref);</span><br><span class="line">    lua_pushvalue(L, <span class="number">-2</span>);</span><br><span class="line">    lua_rawseti(L, <span class="number">-2</span>, key);</span><br><span class="line">    lua_pop(L, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>xlua_pushcsobj</code>çš„ä¸»è¦é€»è¾‘æ˜¯ï¼Œä»£è¡¨å¯¹è±¡çš„ç´¢å¼•è¢« <code>push</code> åˆ° Lua åï¼ŒLua ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ª <code>userdata</code>ï¼Œå¹¶å°†è¿™ä¸ª<code>userdata</code> æŒ‡å‘å¯¹è±¡ç´¢å¼•ï¼Œå¦‚æœéœ€è¦ç¼“å­˜åˆ™å°† <code>userdata</code> ä¿å­˜åˆ°ç¼“å­˜è¡¨ä¸­ï¼Œ æœ€åä¸º <code>userdata</code> è®¾ç½®äº†å…ƒè¡¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒC# å¯¹è±¡åœ¨ Lua è¿™è¾¹å¯¹åº”çš„å°±æ˜¯ä¸€ä¸ª<code>userdata</code>ï¼Œåˆ©ç”¨å¯¹è±¡ç´¢å¼•ä¿æŒä¸ C# å¯¹è±¡çš„è”ç³»ã€‚</p><h3 id="æ³¨å†Œ -C- ç±»å‹ä¿¡æ¯åˆ° -Lua">æ³¨å†Œ C# ç±»å‹ä¿¡æ¯åˆ° Lua</h3><p>ä¸º <code>userdata</code>ï¼ˆç‰¹æŒ‡ C# å¯¹è±¡åœ¨ Lua è¿™è¾¹å¯¹åº”çš„ä»£ç†<code>userdata</code>ï¼Œåé¢å†å‡ºç°çš„<code>userdata</code> ä¹Ÿæ˜¯åŒæ ·çš„å«ä¹‰ï¼Œå°±ä¸å†èµ˜è¿°äº†ï¼‰è®¾ç½®çš„å…ƒè¡¨ï¼Œè¡¨ç¤ºçš„å®é™…æ˜¯å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€‚åœ¨å°† C# å¯¹è±¡ä¼ é€’åˆ° Lua ä»¥åï¼Œè¿˜éœ€è¦å‘ŠçŸ¥ Lua è¯¥å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ï¼Œæ¯”å¦‚å¯¹è±¡ç±»å‹æœ‰å“ªäº›æˆå‘˜æ–¹æ³•ï¼Œå±æ€§æˆ–æ˜¯é™æ€æ–¹æ³•ç­‰ã€‚å°†è¿™äº›éƒ½æ³¨å†Œåˆ° Lua åï¼ŒLua æ‰èƒ½æ­£ç¡®çš„è°ƒç”¨ã€‚è¿™ä¸ªå…ƒè¡¨æ˜¯é€šè¿‡ <code>getTypeId</code> å‡½æ•°ç”Ÿæˆçš„</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ObjectTranslator.cs</span></span><br><span class="line"><span class="function"><span class="keyword">internal</span> <span class="built_in">int</span> <span class="title">getTypeId</span>(<span class="params">RealStatePtr L, Type type, <span class="keyword">out</span> <span class="built_in">bool</span> is_first, LOGLEVEL log_level = LOGLEVEL.WARN</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> type_id;</span><br><span class="line">    is_first = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (!typeIdMap.TryGetValue(type, <span class="keyword">out</span> type_id)) <span class="comment">// no reference</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        is_first = <span class="literal">true</span>;</span><br><span class="line">        Type alias_type = <span class="literal">null</span>;</span><br><span class="line">        aliasCfg.TryGetValue(type, <span class="keyword">out</span> alias_type);</span><br><span class="line">        LuaAPI.luaL_getmetatable(L, alias_type == <span class="literal">null</span> ? type.FullName : alias_type.FullName);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (LuaAPI.lua_isnil(L, <span class="number">-1</span>)) <span class="comment">//no meta yet, try to use reflection meta</span></span><br><span class="line">        &#123;</span><br><span class="line">            LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (TryDelayWrapLoader(L, alias_type == <span class="literal">null</span> ? type : alias_type))</span><br><span class="line">            &#123;</span><br><span class="line">                LuaAPI.luaL_getmetatable(L, alias_type == <span class="literal">null</span> ? type.FullName : alias_type.FullName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Fatal: can not load metatable of type:&quot;</span> + type);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾ªç¯ä¾èµ–ï¼Œè‡ªèº«ä¾èµ–è‡ªå·±çš„ classï¼Œæ¯”å¦‚æœ‰ä¸ªè‡ªèº«ç±»å‹çš„é™æ€ readonly å¯¹è±¡ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (typeIdMap.TryGetValue(type, <span class="keyword">out</span> type_id))</span><br><span class="line">        &#123;</span><br><span class="line">            LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            LuaAPI.lua_pushvalue(L, <span class="number">-1</span>);</span><br><span class="line">            type_id = LuaAPI.luaL_ref(L, LuaIndexes.LUA_REGISTRYINDEX);  <span class="comment">// å°†å…ƒè¡¨æ·»åŠ åˆ°æ³¨å†Œè¡¨ä¸­</span></span><br><span class="line">            LuaAPI.lua_pushnumber(L, type_id);</span><br><span class="line">            LuaAPI.xlua_rawseti(L, <span class="number">-2</span>, <span class="number">1</span>);   <span class="comment">// å…ƒè¡¨ [1] = type_id</span></span><br><span class="line">            LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (type.IsValueType())</span><br><span class="line">            &#123;</span><br><span class="line">                typeMap.Add(type_id, type);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            typeIdMap.Add(type, type_id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> type_id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡½æ•°ä¸»è¦é€»è¾‘æ˜¯ä»¥ç±»çš„åç§°ä¸º <code>key</code> é€šè¿‡ <code>luaL_getmetatable</code> è·å–ç±»å¯¹åº”çš„å…ƒè¡¨ï¼Œå¦‚æœè·å–ä¸åˆ°ï¼Œåˆ™é€šè¿‡ <code>TryDelayWrapLoader</code>å‡½æ•°ç”Ÿæˆã€‚ç„¶åè°ƒç”¨ <code>luaL_ref</code> å°†è·å–åˆ°çš„å…ƒè¡¨æ·»åŠ åˆ° Lua æ³¨å†Œè¡¨ä¸­ï¼Œå¹¶è¿”å› type_idã€‚type_id è¡¨ç¤ºçš„å°±æ˜¯å…ƒè¡¨åœ¨ Lua æ³¨å†Œè¡¨ä¸­çš„ç´¢å¼•ï¼Œé€šè¿‡è¿™ä¸ªç´¢å¼•å¯ä»¥åœ¨ Lua æ³¨å†Œè¡¨ä¸­å–å›å…ƒè¡¨ã€‚å‰é¢æåˆ°çš„ <code>xlua_pushcsobj</code>å‡½æ•°å°±æ˜¯åˆ©ç”¨ <code>type_id</code> å³<code>meta_ref</code>ï¼Œè·å–åˆ°å…ƒè¡¨ï¼Œç„¶åä¸º <code>userdata</code> è®¾ç½®çš„å…ƒè¡¨ã€‚<br>ä¸‹é¢æ¥çœ‹å…ƒè¡¨å…·ä½“æ˜¯æ€æ ·ç”Ÿæˆçš„</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ObjectTranslator.cs</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">TryDelayWrapLoader</span>(<span class="params">RealStatePtr L, Type type</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    LuaAPI.luaL_newmetatable(L, type.FullName); <span class="comment">// å…ˆå»ºä¸€ä¸ª metatableï¼Œå› ä¸ºåŠ è½½è¿‡ç¨‹å¯èƒ½ä¼šéœ€è¦ç”¨åˆ°</span></span><br><span class="line">    LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    Action&lt;RealStatePtr&gt; loader;</span><br><span class="line">    <span class="built_in">int</span> top = LuaAPI.lua_gettop(L);</span><br><span class="line">    <span class="keyword">if</span> (delayWrap.TryGetValue(type, <span class="keyword">out</span> loader))  <span class="comment">// å¦‚æœæœ‰é¢„å…ˆæ³¨å†Œçš„ç±»å‹å…ƒè¡¨ç”Ÿæˆå™¨ï¼Œåˆ™ç›´æ¥ä½¿ç”¨</span></span><br><span class="line">    &#123;</span><br><span class="line">        delayWrap.Remove(type);</span><br><span class="line">        loader(L);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> !GEN_CODE_MINIMIZE &amp;&amp; !ENABLE_IL2CPP &amp;&amp; (UNITY_EDITOR || XLUA_GENERAL) &amp;&amp; !FORCE_REFLECTION &amp;&amp; !NET_STANDARD_2_0</span></span><br><span class="line">        <span class="keyword">if</span> (!DelegateBridge.Gen_Flag &amp;&amp; !type.IsEnum() &amp;&amp; !<span class="keyword">typeof</span>(Delegate).IsAssignableFrom(type) &amp;&amp; Utils.IsPublic(type))</span><br><span class="line">        &#123;</span><br><span class="line">            Type wrap = ce.EmitTypeWrap(type);</span><br><span class="line">            MethodInfo method = wrap.GetMethod(<span class="string">&quot;__Register&quot;</span>, BindingFlags.Static | BindingFlags.Public);</span><br><span class="line">            method.Invoke(<span class="literal">null</span>, <span class="keyword">new</span> <span class="built_in">object</span>[] &#123; L &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Utils.ReflectionWrap(L, type, privateAccessibleFlags.Contains(type));</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">        Utils.ReflectionWrap(L, type, privateAccessibleFlags.Contains(type));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (top != LuaAPI.lua_gettop(L))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;top change, before:&quot;</span> + top + <span class="string">&quot;, after:&quot;</span> + LuaAPI.lua_gettop(L));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> nested_type <span class="keyword">in</span> type.GetNestedTypes(BindingFlags.Public))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (nested_type.IsGenericTypeDefinition())  <span class="comment">// è¿‡æ»¤æ³›å‹ç±»å‹å®šä¹‰</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        GetTypeId(L, nested_type);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="TryDelayWrapLoader- ä¸»è¦ç”¨æ¥å¤„ç†ä¸¤ç§æƒ…å†µ">TryDelayWrapLoader ä¸»è¦ç”¨æ¥å¤„ç†ä¸¤ç§æƒ…å†µ</h4><ol><li>é€šè¿‡ <code>delayWrap</code> åˆ¤æ–­ï¼Œæ˜¯å¦æœ‰ä¸ºè¯¥ç±»ç”Ÿæˆä»£ç ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥ä½¿ç”¨ç”Ÿæˆå‡½æ•°è¿›è¡Œå¡«å……å…ƒè¡¨ï¼ˆ<code>loader</code>æ–¹æ³•ï¼‰ã€‚åœ¨ xLua çš„ç”Ÿæˆä»£ç ä¸­æœ‰ä¸€ä¸ª XLuaGenAutoRegister.cs æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ä¼šä¸ºå¯¹åº”çš„ç±»æ³¨å†Œåˆå§‹åŒ–å™¨ï¼Œè€Œè¿™ä¸ªåˆå§‹åŒ–å™¨è´Ÿè´£å°†ç±»å¯¹åº”çš„å…ƒè¡¨ç”Ÿæˆå‡½æ•°æ·»åŠ åˆ° <code>delayWrap</code> ä¸­ã€‚</li></ol><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// XLuaGenAutoRegister.cs</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">XLua_Gen_Initer_Register__</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">wrapInit0</span>(<span class="params">LuaEnv luaenv, ObjectTranslator translator</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        translator.DelayWrapLoader(<span class="keyword">typeof</span>(TestXLua), TestXLuaWrap.__Register);  <span class="comment">// å°†ç±»å‹å¯¹åº”çš„å…ƒè¡¨å¡«å……å‡½æ•°__Register æ·»åŠ åˆ° delayWrap ä¸­</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params">LuaEnv luaenv, ObjectTranslator translator</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        wrapInit0(luaenv, translator);</span><br><span class="line">        translator.AddInterfaceBridgeCreator(<span class="keyword">typeof</span>(System.Collections.IEnumerator), SystemCollectionsIEnumeratorBridge.__Create);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">XLua_Gen_Initer_Register__</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">            XLua.LuaEnv.AddIniter(Init);  <span class="comment">// æ³¨å†Œåˆå§‹åŒ–å™¨</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å¦‚æœæ²¡æœ‰ç”Ÿæˆä»£ç ï¼Œé€šè¿‡åå°„å¡«å……å…ƒè¡¨ï¼ˆ<code>ReflectionWrap</code>æ–¹æ³•ï¼‰</li></ol><h3 id="ä½¿ç”¨ç”Ÿæˆå‡½æ•°å¡«å……å…ƒè¡¨">ä½¿ç”¨ç”Ÿæˆå‡½æ•°å¡«å……å…ƒè¡¨</h3><p>ä»¥ <code>LuaCallCSharp</code> ä¿®é¥°çš„ <code>TestXLua</code> ç±»ä¸ºä¾‹æ¥æŸ¥çœ‹ç”Ÿæˆå‡½æ•°æ˜¯å¦‚ä½•ç”Ÿæˆçš„</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TestXLua.cs</span></span><br><span class="line">[<span class="meta">LuaCallCSharp</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestXLua</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test1</span>(<span class="params"><span class="built_in">int</span> a</span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Test2</span>(<span class="params"><span class="built_in">int</span> a, <span class="built_in">bool</span> b, <span class="built_in">string</span> c</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Generate Code ä¹‹åç”Ÿæˆçš„ TestXLuaWrap.cs å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestXLuaWrap</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> __Register(RealStatePtr L)</span><br><span class="line">    &#123;</span><br><span class="line">        ObjectTranslator translator = ObjectTranslatorPool.Instance.Find(L);</span><br><span class="line">        System.Type type = <span class="keyword">typeof</span>(TestXLua);</span><br><span class="line">        Utils.BeginObjectRegister(type, L, translator, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        Utils.RegisterFunc(L, Utils.METHOD_IDX, <span class="string">&quot;Test1&quot;</span>, _m_Test1);</span><br><span class="line">        Utils.RegisterFunc(L, Utils.GETTER_IDX, <span class="string">&quot;Name&quot;</span>, _g_get_Name);</span><br><span class="line">        Utils.RegisterFunc(L, Utils.SETTER_IDX, <span class="string">&quot;Name&quot;</span>, _s_set_Name);</span><br><span class="line">        Utils.EndObjectRegister(type, L, translator, <span class="literal">null</span>, <span class="literal">null</span>,</span><br><span class="line">            <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        Utils.BeginClassRegister(type, L, __CreateInstance, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        Utils.RegisterFunc(L, Utils.CLS_IDX, <span class="string">&quot;Test2&quot;</span>, _m_Test2_xlua_st_);</span><br><span class="line">        Utils.EndClassRegister(type, L, translator);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">MonoPInvokeCallbackAttribute(typeof(LuaCSFunction))</span>]</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">int</span> __CreateInstance(RealStatePtr L)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ObjectTranslator translator = ObjectTranslatorPool.Instance.Find(L);</span><br><span class="line">            <span class="keyword">if</span>(LuaAPI.lua_gettop(L) == <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                TestXLua gen_ret = <span class="keyword">new</span> TestXLua();</span><br><span class="line">                translator.Push(L, gen_ret);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(System.Exception gen_e) &#123;</span><br><span class="line">            <span class="keyword">return</span> LuaAPI.luaL_error(L, <span class="string">&quot;c# exception:&quot;</span> + gen_e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> LuaAPI.luaL_error(L, <span class="string">&quot;invalid arguments to TestXLua constructor!&quot;</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">MonoPInvokeCallbackAttribute(typeof(LuaCSFunction))</span>]</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">int</span> _m_Test1(RealStatePtr L)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ObjectTranslator translator = ObjectTranslatorPool.Instance.Find(L);</span><br><span class="line">            TestXLua gen_to_be_invoked = (TestXLua)translator.FastGetCSObj(L, <span class="number">1</span>);</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">int</span> _a = LuaAPI.xlua_tointeger(L, <span class="number">2</span>);</span><br><span class="line">                gen_to_be_invoked.Test1(_a);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(System.Exception gen_e) &#123;</span><br><span class="line">            <span class="keyword">return</span> LuaAPI.luaL_error(L, <span class="string">&quot;c# exception:&quot;</span> + gen_e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">MonoPInvokeCallbackAttribute(typeof(LuaCSFunction))</span>]</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">int</span> _m_Test2_xlua_st_(RealStatePtr L)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">int</span> _a = LuaAPI.xlua_tointeger(L, <span class="number">1</span>);</span><br><span class="line">                <span class="built_in">bool</span> _b = LuaAPI.lua_toboolean(L, <span class="number">2</span>);</span><br><span class="line">                <span class="built_in">string</span> _c = LuaAPI.lua_tostring(L, <span class="number">3</span>);</span><br><span class="line">                TestXLua.Test2(_a, _b, _c);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(System.Exception gen_e) &#123;</span><br><span class="line">            <span class="keyword">return</span> LuaAPI.luaL_error(L, <span class="string">&quot;c# exception:&quot;</span> + gen_e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">MonoPInvokeCallbackAttribute(typeof(LuaCSFunction))</span>]</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">int</span> _g_get_Name(RealStatePtr L)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ObjectTranslator translator = ObjectTranslatorPool.Instance.Find(L);</span><br><span class="line">        </span><br><span class="line">            TestXLua gen_to_be_invoked = (TestXLua)translator.FastGetCSObj(L, <span class="number">1</span>);</span><br><span class="line">            LuaAPI.lua_pushstring(L, gen_to_be_invoked.Name);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(System.Exception gen_e) &#123;</span><br><span class="line">            <span class="keyword">return</span> LuaAPI.luaL_error(L, <span class="string">&quot;c# exception:&quot;</span> + gen_e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">MonoPInvokeCallbackAttribute(typeof(LuaCSFunction))</span>]</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">int</span> _s_set_Name(RealStatePtr L)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ObjectTranslator translator = ObjectTranslatorPool.Instance.Find(L);</span><br><span class="line">        </span><br><span class="line">            TestXLua gen_to_be_invoked = (TestXLua)translator.FastGetCSObj(L, <span class="number">1</span>);</span><br><span class="line">            gen_to_be_invoked.Name = LuaAPI.lua_tostring(L, <span class="number">2</span>);</span><br><span class="line">        </span><br><span class="line">        &#125; <span class="keyword">catch</span>(System.Exception gen_e) &#123;</span><br><span class="line">            <span class="keyword">return</span> LuaAPI.luaL_error(L, <span class="string">&quot;c# exception:&quot;</span> + gen_e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç”Ÿæˆå‡½æ•° -Register ä¸»è¦æ˜¯è¿™æ ·ä¸€ä¸ªæ¡†æ¶">ç”Ÿæˆå‡½æ•° <code>__Register</code> ä¸»è¦æ˜¯è¿™æ ·ä¸€ä¸ªæ¡†æ¶</h4><ol><li><code>Utils.BeginObjectRegister</code>ï¼Œåœ¨å¯¹ç±»çš„éé™æ€å€¼ï¼ˆä¾‹å¦‚æˆå‘˜å˜é‡ï¼Œæˆå‘˜æ–¹æ³•ç­‰ï¼‰è¿›è¡Œæ³¨å†Œå‰åšä¸€äº›å‡†å¤‡å·¥ä½œã€‚ä¸»è¦æ˜¯ä¸ºå…ƒè¡¨æ·»åŠ  <code>__gc</code> å’Œ<code>__tostring</code>å…ƒæ–¹æ³•ï¼Œä»¥åŠå‡†å¤‡å¥½ <code>method</code> è¡¨ã€<code>getter</code>è¡¨ã€<code>setter</code>è¡¨ï¼Œåé¢è°ƒç”¨ <code>RegisterFunc</code> æ—¶ï¼Œå¯ä»¥é€‰æ‹©æ’å…¥åˆ°å¯¹åº”çš„è¡¨ä¸­</li></ol><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Utils.cs</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">BeginObjectRegister</span>(<span class="params">Type type, RealStatePtr L, ObjectTranslator translator, <span class="built_in">int</span> meta_count, <span class="built_in">int</span> method_count, <span class="built_in">int</span> getter_count,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="built_in">int</span> setter_count, <span class="built_in">int</span> type_id = <span class="number">-1</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (type_id == <span class="number">-1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Fatal: must provide a type of type_id&quot;</span>);</span><br><span class="line">        LuaAPI.xlua_rawgeti(L, LuaIndexes.LUA_REGISTRYINDEX, type_id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.luaL_getmetatable(L, type.FullName);</span><br><span class="line">        <span class="comment">// å¦‚æœ type.FullName å¯¹åº”çš„å…ƒè¡¨æ˜¯ç©ºï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å…ƒè¡¨ï¼Œå¹¶è®¾ç½®åˆ°æ³¨å†Œè¡¨ä¸­</span></span><br><span class="line">        <span class="keyword">if</span> (LuaAPI.lua_isnil(L, <span class="number">-1</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line">            LuaAPI.luaL_newmetatable(L, type.FullName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    LuaAPI.lua_pushlightuserdata(L, LuaAPI.xlua_tag());</span><br><span class="line">    LuaAPI.lua_pushnumber(L, <span class="number">1</span>);</span><br><span class="line">    LuaAPI.lua_rawset(L, <span class="number">-3</span>);  <span class="comment">// ä¸ºå…ƒè¡¨è®¾ç½®æ ‡å¿—</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((type == <span class="literal">null</span> || !translator.HasCustomOp(type)) &amp;&amp; type != <span class="keyword">typeof</span>(<span class="built_in">decimal</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__gc&quot;</span>);</span><br><span class="line">        LuaAPI.lua_pushstdcallcfunction(L, translator.metaFunctions.GcMeta);</span><br><span class="line">        LuaAPI.lua_rawset(L, <span class="number">-3</span>);  <span class="comment">// ä¸ºå…ƒè¡¨è®¾ç½®__gc æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__tostring&quot;</span>);</span><br><span class="line">    LuaAPI.lua_pushstdcallcfunction(L, translator.metaFunctions.ToStringMeta);</span><br><span class="line">    LuaAPI.lua_rawset(L, <span class="number">-3</span>);  <span class="comment">// ä¸ºå…ƒè¡¨è®¾ç½®__tostring æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method_count == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_pushnil(L);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_createtable(L, <span class="number">0</span>, method_count);  <span class="comment">// åˆ›å»º method è¡¨</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (getter_count == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_pushnil(L);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_createtable(L, <span class="number">0</span>, getter_count);  <span class="comment">// åˆ›å»º getter è¡¨</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (setter_count == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_pushnil(L);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_createtable(L, <span class="number">0</span>, setter_count);  <span class="comment">// åˆ›å»º setter è¡¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å¤šä¸ª <code>Utils.RegisterFunc</code>ï¼Œå°†ç±»çš„æ¯ä¸ªéé™æ€å€¼å¯¹åº”çš„åŒ…è£¹æ–¹æ³•æ³¨å†Œåˆ°ä¸åŒçš„ Lua è¡¨ä¸­ã€‚åŒ…è£¹æ–¹æ³•æ˜¯ Generate Code æ—¶åŠ¨æ€ç”Ÿæˆçš„ï¼Œå¯¹äºç±»çš„å±æ€§ä¼šç”Ÿæˆä¸¤ä¸ªåŒ…è£¹æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯<code>get</code> å’Œ<code>set</code>åŒ…è£¹æ–¹æ³•</li></ol><p>ä¾‹å¦‚æˆå‘˜æ–¹æ³• <code>Test1</code> å¯¹åº”çš„åŒ…è£¹æ–¹æ³•æ˜¯ <code>_m_Test1</code>ï¼Œå¹¶è¢«æ³¨å†Œåˆ°äº†<code>method</code> è¡¨ä¸­ã€‚<code>Name</code>å˜é‡çš„ <code>_g_get_Name</code> åŒ…è£¹æ–¹æ³•è¢«æ³¨å†Œåˆ°<code>getter</code> è¡¨ï¼Œè€Œ <code>_s_set_Name</code> åŒ…è£¹æ–¹æ³•è¢«æ³¨å†Œåˆ° <code>setter</code> è¡¨ã€‚è¿™ä¸ªåŒ…è£¹æ–¹æ³•åªæ˜¯å¯¹åŸæ¥æ–¹æ³•çš„ä¸€å±‚åŒ…è£¹ï¼Œè°ƒç”¨è¿™ä¸ªåŒ…è£¹æ–¹æ³•æœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨åŸæ¥çš„æ–¹æ³•ã€‚è‡³äºä¸ºä»€ä¹ˆéœ€è¦ç”ŸæˆåŒ…è£¹æ–¹æ³•ï¼Œåé¢ä¼šå†è®²åˆ°</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Utils.cs RegisterFunc æ ¹æ®ä¸åŒçš„å®å®šä¹‰ä¼šæœ‰ä¸åŒçš„ç‰ˆæœ¬ï¼Œä½†å¤§åŒå°å¼‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RegisterFunc</span>(<span class="params">RealStatePtr L, <span class="built_in">int</span> idx, <span class="built_in">string</span> name, LuaCSFunction func</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    idx = abs_idx(LuaAPI.lua_gettop(L), idx);</span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, name);</span><br><span class="line">    LuaAPI.lua_pushstdcallcfunction(L, func);</span><br><span class="line">    LuaAPI.lua_rawset(L, idx);  <span class="comment">// å°† idx æŒ‡å‘çš„è¡¨ä¸­æ·»åŠ é”®å€¼å¯¹ name = func</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><code>Utils.EndObjectRegister</code>ï¼Œç»“æŸå¯¹ç±»çš„éé™æ€å€¼çš„æ³¨å†Œã€‚ä¸»è¦é€»è¾‘æ˜¯ä¸ºå…ƒè¡¨ç”Ÿæˆ <code>__index</code> å…ƒæ–¹æ³•å’Œ <code>__newindex</code> å…ƒæ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ Lua è°ƒç”¨ C# çš„æ ¸å¿ƒæ‰€åœ¨</li></ol><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Utils.cs</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">EndObjectRegister</span>(<span class="params">Type type, RealStatePtr L, ObjectTranslator translator, LuaCSFunction csIndexer,</span></span></span><br><span class="line"><span class="params"><span class="function">    LuaCSFunction csNewIndexer, Type base_type, LuaCSFunction arrayIndexer, LuaCSFunction arrayNewIndexer</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> top = LuaAPI.lua_gettop(L);</span><br><span class="line">    <span class="built_in">int</span> meta_idx = abs_idx(top, OBJ_META_IDX);</span><br><span class="line">    <span class="built_in">int</span> method_idx = abs_idx(top, METHOD_IDX);</span><br><span class="line">    <span class="built_in">int</span> getter_idx = abs_idx(top, GETTER_IDX);</span><br><span class="line">    <span class="built_in">int</span> setter_idx = abs_idx(top, SETTER_IDX);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//begin index gen</span></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__index&quot;</span>);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, method_idx);  <span class="comment">// 1. å‹å…¥ methods è¡¨</span></span><br><span class="line">    LuaAPI.lua_pushvalue(L, getter_idx);  <span class="comment">// 2. å‹å…¥ getters è¡¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (csIndexer == <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_pushnil(L);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        LuaAPI.lua_pushstdcallcfunction(L, csIndexer);  <span class="comment">// 3. å‹å…¥ csindexer</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    translator.Push(L, type == <span class="literal">null</span> ? base_type : type.BaseType());  <span class="comment">// 4. å‹å…¥ base</span></span><br><span class="line"></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaIndexsFieldName);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);  <span class="comment">// 5. å‹å…¥ indexfuncs</span></span><br><span class="line">    <span class="keyword">if</span> (arrayIndexer == <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_pushnil(L);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        LuaAPI.lua_pushstdcallcfunction(L, arrayIndexer);  <span class="comment">// 6. å‹å…¥ arrayindexer</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LuaAPI.gen_obj_indexer(L);  <span class="comment">// ç”Ÿæˆ__index å…ƒæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (type != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.xlua_pushasciistring(L, LuaIndexsFieldName);</span><br><span class="line">        LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);<span class="comment">//store in lua indexs function tables</span></span><br><span class="line">        translator.Push(L, type);</span><br><span class="line">        LuaAPI.lua_pushvalue(L, <span class="number">-3</span>);</span><br><span class="line">        LuaAPI.lua_rawset(L, <span class="number">-3</span>);  <span class="comment">// æ³¨å†Œè¡¨ [LuaIndexs][type] = __index å‡½æ•°</span></span><br><span class="line">        LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LuaAPI.lua_rawset(L, meta_idx);</span><br><span class="line">    <span class="comment">//end index gen</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//begin newindex gen</span></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__newindex&quot;</span>);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, setter_idx);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (csNewIndexer == <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_pushnil(L);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        LuaAPI.lua_pushstdcallcfunction(L, csNewIndexer);</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    translator.Push(L, type == <span class="literal">null</span> ? base_type : type.BaseType());</span><br><span class="line"></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaNewIndexsFieldName);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (arrayNewIndexer == <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_pushnil(L);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        LuaAPI.lua_pushstdcallcfunction(L, arrayNewIndexer);</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LuaAPI.gen_obj_newindexer(L);  <span class="comment">// ç”Ÿæˆ__newindex å…ƒæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (type != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.xlua_pushasciistring(L, LuaNewIndexsFieldName);</span><br><span class="line">        LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);<span class="comment">//store in lua newindexs function tables</span></span><br><span class="line">        translator.Push(L, type);</span><br><span class="line">        LuaAPI.lua_pushvalue(L, <span class="number">-3</span>);</span><br><span class="line">        LuaAPI.lua_rawset(L, <span class="number">-3</span>);  <span class="comment">// æ³¨å†Œè¡¨ [LuaNewIndexs][type] = __newindex å‡½æ•°</span></span><br><span class="line">        LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LuaAPI.lua_rawset(L, meta_idx);</span><br><span class="line">    <span class="comment">//end new index gen</span></span><br><span class="line">    LuaAPI.lua_pop(L, <span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>__index</code>å…ƒæ–¹æ³•æ˜¯é€šè¿‡è°ƒç”¨ <code>gen_obj_indexer</code> è·å¾—çš„ï¼Œåœ¨è°ƒç”¨è¯¥æ–¹æ³•å‰ä¼šä¾æ¬¡å‹å…¥ 6 ä¸ªå‚æ•°ï¼ˆä»£ç æ³¨é‡Šä¸­æœ‰æ ‡æ³¨ï¼‰ï¼Œ<code>gen_obj_indexer</code>å†…éƒ¨åˆä¼šå†å‹å…¥ä¸€ä¸ª <code>nil</code> å€¼ï¼Œç”¨äºä¸º <code>baseindex</code> æå‰å ä½ã€‚å…± 7 ä¸ªå‚æ•°ä¼šä½œä¸º <code>upvalue</code> å…³è”åˆ°é—­åŒ… <code>obj_indexer</code>ã€‚<code>obj_indexer</code> å‡½æ•°å°±æ˜¯ <code>__index</code> å…ƒæ–¹æ³•ï¼Œå®ƒçš„é€»è¾‘æ˜¯å½“è®¿é—® <code>userdata[key]</code> æ—¶ï¼Œå…ˆä¾æ¬¡æŸ¥è¯¢ä¹‹å‰é€šè¿‡ <code>RegisterFunc</code> å¡«å……çš„ <code>methods</code>ï¼Œ<code>getters</code> ç­‰è¡¨ä¸­æ˜¯å¦å­˜æœ‰å¯¹åº” <code>key</code> çš„åŒ…è£¹æ–¹æ³•ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥ä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰åˆ™é€’å½’åœ¨çˆ¶ç±»ä¸­æŸ¥æ‰¾ã€‚<code>__newindex</code>å…ƒæ–¹æ³•æ˜¯é€šè¿‡è°ƒç”¨ <code>gen_obj_newindexer</code> è·å¾—çš„ï¼Œä¸<code>__index</code> çš„è·å¾—åŸç†ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸å†åˆ—å‡ºäº†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xlua.c</span></span><br><span class="line">LUA_API <span class="type">int</span> <span class="title function_">gen_obj_indexer</span><span class="params">(lua_State *L)</span> &#123;</span><br><span class="line">    lua_pushnil(L);</span><br><span class="line">    lua_pushcclosure(L, obj_indexer, <span class="number">7</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//upvalue --- [1]: methods, [2]:getters, [3]:csindexer, [4]:base, [5]:indexfuncs, [6]:arrayindexer, [7]:baseindex</span></span><br><span class="line"><span class="comment">//param   --- [1]: obj, [2]: key</span></span><br><span class="line">LUA_API <span class="type">int</span> <span class="title function_">obj_indexer</span><span class="params">(lua_State *L)</span> &#123;        </span><br><span class="line">    <span class="keyword">if</span> (!lua_isnil(L, lua_upvalueindex(<span class="number">1</span>))) &#123;  <span class="comment">// å¦‚æœ methods ä¸­æœ‰ keyï¼Œåˆ™ä½¿ç”¨ methods[key]</span></span><br><span class="line">        lua_pushvalue(L, <span class="number">2</span>);</span><br><span class="line">        lua_gettable(L, lua_upvalueindex(<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">if</span> (!lua_isnil(L, <span class="number">-1</span>)) &#123;<span class="comment">//has method</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        lua_pop(L, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!lua_isnil(L, lua_upvalueindex(<span class="number">2</span>))) &#123;  <span class="comment">// å¦‚æœ getters ä¸­ keyï¼Œåˆ™è°ƒç”¨ getters[key]</span></span><br><span class="line">        lua_pushvalue(L, <span class="number">2</span>);</span><br><span class="line">        lua_gettable(L, lua_upvalueindex(<span class="number">2</span>));</span><br><span class="line">        <span class="keyword">if</span> (!lua_isnil(L, <span class="number">-1</span>)) &#123;<span class="comment">//has getter</span></span><br><span class="line">            lua_pushvalue(L, <span class="number">1</span>);</span><br><span class="line">            lua_call(L, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        lua_pop(L, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!lua_isnil(L, lua_upvalueindex(<span class="number">6</span>)) &amp;&amp; lua_type(L, <span class="number">2</span>) == LUA_TNUMBER) &#123;  <span class="comment">// å¦‚æœ arrayindexer ä¸­æœ‰ key ä¸” key æ˜¯æ•°å­—ï¼Œåˆ™è°ƒç”¨ arrayindexer[key]</span></span><br><span class="line">        lua_pushvalue(L, lua_upvalueindex(<span class="number">6</span>));</span><br><span class="line">        lua_pushvalue(L, <span class="number">1</span>);</span><br><span class="line">        lua_pushvalue(L, <span class="number">2</span>);</span><br><span class="line">        lua_call(L, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!lua_isnil(L, lua_upvalueindex(<span class="number">3</span>))) &#123;  <span class="comment">// å¦‚æœ csindexer ä¸­æœ‰ keyï¼Œåˆ™è°ƒç”¨ csindexer[key]</span></span><br><span class="line">        lua_pushvalue(L, lua_upvalueindex(<span class="number">3</span>));</span><br><span class="line">        lua_pushvalue(L, <span class="number">1</span>);</span><br><span class="line">        lua_pushvalue(L, <span class="number">2</span>);</span><br><span class="line">        lua_call(L, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (lua_toboolean(L, <span class="number">-2</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        lua_pop(L, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!lua_isnil(L, lua_upvalueindex(<span class="number">4</span>))) &#123;  <span class="comment">// é€’å½’å‘ä¸Šåœ¨ base ä¸­æŸ¥æ‰¾</span></span><br><span class="line">        lua_pushvalue(L, lua_upvalueindex(<span class="number">4</span>));</span><br><span class="line">        <span class="keyword">while</span>(!lua_isnil(L, <span class="number">-1</span>)) &#123;</span><br><span class="line">            lua_pushvalue(L, <span class="number">-1</span>);</span><br><span class="line">            lua_gettable(L, lua_upvalueindex(<span class="number">5</span>));</span><br><span class="line">            <span class="keyword">if</span> (!lua_isnil(L, <span class="number">-1</span>)) <span class="comment">// found</span></span><br><span class="line">            &#123;</span><br><span class="line">                lua_replace(L, lua_upvalueindex(<span class="number">7</span>)); <span class="comment">//baseindex = indexfuncs[base]</span></span><br><span class="line">                lua_pop(L, <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            lua_pop(L, <span class="number">1</span>);</span><br><span class="line">            lua_getfield(L, <span class="number">-1</span>, <span class="string">&quot;BaseType&quot;</span>);</span><br><span class="line">            lua_remove(L, <span class="number">-2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        lua_pushnil(L);</span><br><span class="line">        lua_replace(L, lua_upvalueindex(<span class="number">4</span>));<span class="comment">//base = nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!lua_isnil(L, lua_upvalueindex(<span class="number">7</span>))) &#123;  </span><br><span class="line">        lua_settop(L, <span class="number">2</span>);</span><br><span class="line">        lua_pushvalue(L, lua_upvalueindex(<span class="number">7</span>));  </span><br><span class="line">        lua_insert(L, <span class="number">1</span>);</span><br><span class="line">        lua_call(L, <span class="number">2</span>, <span class="number">1</span>);  <span class="comment">// è°ƒç”¨çˆ¶ç±»çš„__indexï¼Œindexfuncs[base](obj, key)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li><code>Utils.BeginClassRegister</code>ï¼Œåœ¨å¯¹ç±»çš„é™æ€å€¼ï¼ˆä¾‹å¦‚é™æ€å˜é‡ï¼Œé™æ€æ–¹æ³•ç­‰ï¼‰è¿›è¡Œæ³¨å†Œå‰åšä¸€äº›å‡†å¤‡å·¥ä½œã€‚ä¸»è¦æ˜¯ä¸ºç±»ç”Ÿæˆå¯¹åº”çš„ <code>cls_table</code> è¡¨ï¼Œä»¥åŠæå‰åˆ›å»ºå¥½ <code>static_getter</code> è¡¨ä¸ <code>static_setter</code> è¡¨ï¼Œåç»­ç”¨æ¥å­˜æ”¾é™æ€å­—æ®µå¯¹åº”çš„ <code>get</code> å’Œ<code>set</code>åŒ…è£¹æ–¹æ³•ã€‚æ³¨æ„è¿™é‡Œè¿˜ä¼šä¸º <code>cls_table</code> è®¾ç½®å…ƒè¡¨<code>meta_table</code></li></ol><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Utils.cs</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">BeginClassRegister</span>(<span class="params">Type type, RealStatePtr L, LuaCSFunction creator, <span class="built_in">int</span> class_field_count,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="built_in">int</span> static_getter_count, <span class="built_in">int</span> static_setter_count</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ObjectTranslator translator = ObjectTranslatorPool.Instance.Find(L);</span><br><span class="line">    LuaAPI.lua_createtable(L, <span class="number">0</span>, class_field_count);</span><br><span class="line"></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;UnderlyingSystemType&quot;</span>);</span><br><span class="line">    translator.PushAny(L, type);</span><br><span class="line">    LuaAPI.lua_rawset(L, <span class="number">-3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">int</span> cls_table = LuaAPI.lua_gettop(L);</span><br><span class="line"></span><br><span class="line">    SetCSTable(L, type, cls_table);</span><br><span class="line"></span><br><span class="line">    LuaAPI.lua_createtable(L, <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">int</span> meta_table = LuaAPI.lua_gettop(L);</span><br><span class="line">    <span class="keyword">if</span> (creator != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__call&quot;</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> GEN_CODE_MINIMIZE</span></span><br><span class="line">        translator.PushCSharpWrapper(L, creator);</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">        LuaAPI.lua_pushstdcallcfunction(L, creator);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">        LuaAPI.lua_rawset(L, <span class="number">-3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (static_getter_count == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_pushnil(L);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_createtable(L, <span class="number">0</span>, static_getter_count);   <span class="comment">// åˆ›å»ºå¥½ static_getter è¡¨</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (static_setter_count == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_pushnil(L);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_createtable(L, <span class="number">0</span>, static_setter_count);  <span class="comment">// åˆ›å»ºå¥½ static_setter è¡¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    LuaAPI.lua_pushvalue(L, meta_table);</span><br><span class="line">    LuaAPI.lua_setmetatable(L, cls_table);  <span class="comment">// è®¾ç½®å…ƒè¡¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>cls_table</code> è¡¨æ˜¯æ ¹æ®ç±»çš„å‘½åç©ºé—´åé€å±‚æ·»åŠ åˆ°æ³¨å†Œè¡¨ä¸­çš„ï¼Œä¸»è¦æ˜¯é€šè¿‡ <code>SetCSTable</code> å®ç°</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Utils.cs</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SetCSTable</span>(<span class="params">RealStatePtr L, Type type, <span class="built_in">int</span> cls_table</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> oldTop = LuaAPI.lua_gettop(L);</span><br><span class="line">    cls_table = abs_idx(oldTop, cls_table);</span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaEnv.CSHARP_NAMESPACE);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);</span><br><span class="line"></span><br><span class="line">    List&lt;<span class="built_in">string</span>&gt; path = getPathOfType(type);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹äº A.B.C æ¥è¯´</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// for å¾ªç¯å¤„ç† A.B</span></span><br><span class="line">    <span class="comment">// 1. æ³¨å†Œè¡¨ [xlua_csharp_namespace][A] = &#123;&#125; ä¸”å‡ºæ ˆ æ³¨å†Œè¡¨ [xlua_csharp_namespace]</span></span><br><span class="line">    <span class="comment">// 2. æ³¨å†Œè¡¨ [xlua_csharp_namespace][A][B] = &#123;&#125; ä¸”å‡ºæ ˆ æ³¨å†Œè¡¨ [xlua_csharp_namespace][A]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; path.Count - <span class="number">1</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.xlua_pushasciistring(L, path[i]);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> != LuaAPI.xlua_pgettable(L, <span class="number">-2</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> err = LuaAPI.lua_tostring(L, <span class="number">-1</span>);</span><br><span class="line">            LuaAPI.lua_settop(L, oldTop);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;SetCSTable for [&quot;</span> + type + <span class="string">&quot;] error: &quot;</span> + err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (LuaAPI.lua_isnil(L, <span class="number">-1</span>))  <span class="comment">// å¦‚æœ æ³¨å†Œè¡¨ [xlua_csharp_namespace] ä¸­æ²¡æœ‰ key path[i] , åˆ™æ·»åŠ ä¸€ä¸ª path[i] = &#123;&#125; é”®å€¼å¯¹</span></span><br><span class="line">        &#123;</span><br><span class="line">            LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line">            LuaAPI.lua_createtable(L, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            LuaAPI.xlua_pushasciistring(L, path[i]);</span><br><span class="line">            LuaAPI.lua_pushvalue(L, <span class="number">-2</span>);</span><br><span class="line">            LuaAPI.lua_rawset(L, <span class="number">-4</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!LuaAPI.lua_istable(L, <span class="number">-1</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            LuaAPI.lua_settop(L, oldTop);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;SetCSTable for [&quot;</span> + type + <span class="string">&quot;] error: ancestors is not a table!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        LuaAPI.lua_remove(L, <span class="number">-2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç† C</span></span><br><span class="line">    <span class="comment">// æ³¨å†Œè¡¨ [xlua_csharp_namespace][A][B][C] = cls_table ä¸”å‡ºæ ˆ [xlua_csharp_namespace][A][B][C]</span></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, path[path.Count - <span class="number">1</span>]);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, cls_table);</span><br><span class="line">    LuaAPI.lua_rawset(L, <span class="number">-3</span>);  </span><br><span class="line">    LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ æ³¨å†Œè¡¨ [xlua_csharp_namespace] ä¸­æ·»åŠ é”®å€¼å¯¹ [type å¯¹åº”çš„ lua ä»£ç† userdata] = cls_table</span></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaEnv.CSHARP_NAMESPACE);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);</span><br><span class="line">    ObjectTranslatorPool.Instance.Find(L).PushAny(L, type);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, cls_table);</span><br><span class="line">    LuaAPI.lua_rawset(L, <span class="number">-3</span>);</span><br><span class="line">    LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ <code>A.B.C</code> ç±»ä¸ºä¾‹ï¼Œå°†åœ¨ Lua æ³¨å†Œè¡¨ä¸­æ·»åŠ ä»¥ä¸‹è¡¨ç»“æ„ï¼Œè€Œ Lua æ³¨å†Œè¡¨ <code>xlua_csharp_namespace</code> å®é™…ä¸Šå¯¹åº”çš„å°±æ˜¯ CS å…¨å±€è¡¨ï¼Œæ‰€ä»¥è¦åœ¨ xLua ä¸­è®¿é—® C# ç±»æ—¶æ‰å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>CS.A.B.C</code> è¿™æ ·çš„å½¢å¼</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Lua æ³¨å†Œè¡¨ = &#123;</span><br><span class="line">    xlua_csharp_namespace = &#123;  <span class="comment">-- å°±æ˜¯ CS å…¨å±€è¡¨</span></span><br><span class="line">        A = &#123;</span><br><span class="line">            B = &#123;</span><br><span class="line">                C = cls_table</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>å¤šä¸ª <code>Utils.RegisterFunc</code>ï¼Œä¸<code>BeginObjectRegister</code> åˆ°<code>EndObjectRegister</code>ä¹‹é—´çš„ <code>RegisterFunc</code> ä½œç”¨ç›¸åŒï¼Œå°†ç±»çš„æ¯ä¸ªé™æ€å€¼å¯¹åº”çš„åŒ…è£¹æ–¹æ³•æ³¨å†Œåˆ°å¯¹åº”çš„ Lua è¡¨ä¸­ã€‚é™æ€å˜é‡å¯¹åº”çš„ get å’Œ set åŒ…è£¹æ–¹æ³•ä¼šè¢«åˆ†åˆ«æ³¨å†Œåˆ° <code>static_getter</code> è¡¨å’Œ <code>static_setter</code> è¡¨ï¼ˆåªè¯»çš„é™æ€å˜é‡é™¤å¤–ï¼‰</li><li><code>Utils.EndClassRegister</code>ï¼Œç»“æŸå¯¹ç±»çš„é™æ€å€¼çš„æ³¨å†Œã€‚ä¸ <code>EndObjectRegister</code> ç±»ä¼¼ï¼Œä½†å®ƒæ˜¯ä¸º <code>cls_table</code> çš„å…ƒè¡¨ <code>meta_tabl</code> è®¾ç½® <code>__index</code> å…ƒæ–¹æ³•å’Œ <code>__newindex</code> å…ƒæ–¹æ³•</li></ol><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Utils.cs</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">EndClassRegister</span>(<span class="params">Type type, RealStatePtr L, ObjectTranslator translator</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> top = LuaAPI.lua_gettop(L);</span><br><span class="line">    <span class="built_in">int</span> cls_idx = abs_idx(top, CLS_IDX);</span><br><span class="line">    <span class="built_in">int</span> cls_getter_idx = abs_idx(top, CLS_GETTER_IDX);</span><br><span class="line">    <span class="built_in">int</span> cls_setter_idx = abs_idx(top, CLS_SETTER_IDX);</span><br><span class="line">    <span class="built_in">int</span> cls_meta_idx = abs_idx(top, CLS_META_IDX);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//begin cls index</span></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__index&quot;</span>);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, cls_getter_idx);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, cls_idx);</span><br><span class="line">    translator.Push(L, type.BaseType());</span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaClassIndexsFieldName);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);  </span><br><span class="line">    LuaAPI.gen_cls_indexer(L);</span><br><span class="line"></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaClassIndexsFieldName);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);<span class="comment">//store in lua indexs function tables  </span></span><br><span class="line">    translator.Push(L, type);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, <span class="number">-3</span>);</span><br><span class="line">    LuaAPI.lua_rawset(L, <span class="number">-3</span>);  <span class="comment">// æ³¨å†Œè¡¨ [LuaClassIndexs][type] = __index å‡½æ•°</span></span><br><span class="line">    LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    LuaAPI.lua_rawset(L, cls_meta_idx);</span><br><span class="line">    <span class="comment">//end cls index</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//begin cls newindex</span></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__newindex&quot;</span>);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, cls_setter_idx);</span><br><span class="line">    translator.Push(L, type.BaseType());</span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaClassNewIndexsFieldName);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);</span><br><span class="line">    LuaAPI.gen_cls_newindexer(L);</span><br><span class="line"></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaClassNewIndexsFieldName);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);<span class="comment">//store in lua newindexs function tables</span></span><br><span class="line">    translator.Push(L, type);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, <span class="number">-3</span>);</span><br><span class="line">    LuaAPI.lua_rawset(L, <span class="number">-3</span>);  <span class="comment">// æ³¨å†Œè¡¨ [LuaClassNewIndexs][type] = __newindex å‡½æ•°</span></span><br><span class="line">    LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    LuaAPI.lua_rawset(L, cls_meta_idx);</span><br><span class="line">    <span class="comment">//end cls newindex</span></span><br><span class="line"></span><br><span class="line">    LuaAPI.lua_pop(L, <span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿° 6 ä¸ªéƒ¨åˆ†çš„ä»£ç é‡æ¯”è¾ƒå¤§ï¼Œé€»è¾‘ä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œåˆ°è¿™é‡Œæœ‰å¿…è¦åšä¸€ä¸ªæ€»ç»“</p><p>ç”Ÿæˆä»£ç ä¼šä¸ºç±»çš„éé™æ€å€¼éƒ½ç”Ÿæˆå¯¹åº”çš„åŒ…è£¹æ–¹æ³•ï¼Œå¹¶å°†åŒ…è£¹æ–¹æ³•ä»¥ <code>key = func</code> çš„å½¢å¼æ³¨å†Œåˆ°ä¸åŒçš„è¡¨ä¸­ã€‚<code>userdata</code>å…ƒè¡¨çš„ <code>__index</code> å’Œ<code>__newindex</code>è´Ÿè´£ä»è¿™ä¸åŒçš„è¡¨ä¸­æ‰¾åˆ°å¯¹åº” <code>key</code> çš„åŒ…è£¹æ–¹æ³•ï¼Œæœ€ç»ˆé€šè¿‡è°ƒç”¨åŒ…è£¹æ–¹æ³•å®ç°å¯¹ C# å¯¹è±¡çš„æ§åˆ¶</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- lua æµ‹è¯•ä»£ç </span></span><br><span class="line"><span class="keyword">local</span> obj = CS.TestXLua()</span><br><span class="line">obj.Name = <span class="string">&quot;test&quot;</span>  <span class="comment">-- èµ‹å€¼æ“ä½œå°†è§¦å‘ obj å…ƒè¡¨çš„__newindexï¼Œ__newindex åœ¨ setter è¡¨ä¸­æ‰¾åˆ° Name å¯¹åº”çš„ set åŒ…è£¹æ–¹æ³•_s_set_Nameï¼Œç„¶åé€šè¿‡è°ƒç”¨_s_set_Name æ–¹æ³•è®¾ç½®äº† TestXLua å¯¹è±¡çš„ Name å±æ€§ä¸º &quot;test&quot;</span></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆä»£ç è¿˜ä¼šä¸ºæ¯ä¸ªç±»ä»¥å‘½åç©ºé—´ä¸ºå±‚æ¬¡ç»“æ„ç”Ÿæˆ <code>cls_table</code> è¡¨ã€‚ä¸ç±»çš„éé™æ€å€¼ç›¸åŒï¼Œç”Ÿæˆä»£ç ä¹Ÿä¼šä¸ºç±»çš„é™æ€å€¼éƒ½ç”Ÿæˆå¯¹åº”çš„åŒ…è£¹æ–¹æ³•å¹¶æ³¨å†Œåˆ°ä¸åŒçš„è¡¨ä¸­ï¼ˆæ³¨æ„è¿™é‡Œæœ‰äº›åŒºåˆ«ï¼Œç±»çš„é™æ€æ–¹æ³•ä¼šè¢«ç›´æ¥æ³¨å†Œåˆ° <code>cls_table</code> è¡¨ä¸­ï¼‰ã€‚è€Œ <code>cls_table</code> å…ƒè¡¨çš„ <code>__index</code> å’Œ<code>__newindex</code>è´Ÿè´£ä»è¿™ä¸åŒçš„è¡¨ä¸­æ‰¾åˆ°å¯¹åº” <code>key</code> çš„åŒ…è£¹æ–¹æ³•ï¼Œæœ€ç»ˆé€šè¿‡è°ƒç”¨åŒ…è£¹æ–¹æ³•å®ç°å¯¹ C# ç±»çš„æ§åˆ¶</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- lua æµ‹è¯•ä»£ç </span></span><br><span class="line">CS.TestXLua.Test2()  <span class="comment">-- CS.TestXLua è·å–åˆ° TestXLua ç±»å¯¹åº”çš„ cls_tableï¼Œç”±äº Test2 æ˜¯é™æ€æ–¹æ³•ï¼Œåœ¨ cls_table ä¸­å¯ä»¥ç›´æ¥æ‹¿åˆ°å…¶å¯¹åº”çš„åŒ…è£¹æ–¹æ³•_m_Test2_xlua_st_ï¼Œç„¶åé€šè¿‡è°ƒç”¨_m_Test2_xlua_st_è€Œé—´æ¥è°ƒç”¨äº† TestXLua ç±»çš„ Test2 æ–¹æ³•</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨åå°„å¡«å……å…ƒè¡¨">ä½¿ç”¨åå°„å¡«å……å…ƒè¡¨</h3><p>å½“æ²¡æœ‰ç”Ÿæˆä»£ç æ—¶ï¼Œä¼šä½¿ç”¨åå°„è¿›è¡Œæ³¨å†Œï¼Œä¸ç”Ÿæˆä»£ç è¿›è¡Œæ³¨å†Œçš„é€»è¾‘åŸºæœ¬ç›¸åŒã€‚é€šè¿‡åå°„è·å–åˆ°ç±»çš„å„ä¸ªé™æ€å€¼å’Œéé™æ€å€¼ï¼Œç„¶ååˆ†åˆ«æ³¨å†Œåˆ°ä¸åŒçš„è¡¨ä¸­ï¼Œä»¥åŠå¡«å…… <code>__index</code> å’Œ<code>__newindex</code>å…ƒæ–¹æ³•</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Utils.cs</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ReflectionWrap</span>(<span class="params">RealStatePtr L, Type type, <span class="built_in">bool</span> privateAccessible</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    LuaAPI.lua_checkstack(L, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">int</span> top_enter = LuaAPI.lua_gettop(L);</span><br><span class="line">    ObjectTranslator translator = ObjectTranslatorPool.Instance.Find(L);</span><br><span class="line">    <span class="comment">//create obj meta table</span></span><br><span class="line">    LuaAPI.luaL_getmetatable(L, type.FullName);</span><br><span class="line">    <span class="keyword">if</span> (LuaAPI.lua_isnil(L, <span class="number">-1</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line">        LuaAPI.luaL_newmetatable(L, type.FullName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸ºå…ƒè¡¨æ·»åŠ  xlua_tag æ ‡å¿—</span></span><br><span class="line">    LuaAPI.lua_pushlightuserdata(L, LuaAPI.xlua_tag());</span><br><span class="line">    LuaAPI.lua_pushnumber(L, <span class="number">1</span>);</span><br><span class="line">    LuaAPI.lua_rawset(L, <span class="number">-3</span>);  <span class="comment">// å…ƒè¡¨ [xlua_tag] = 1</span></span><br><span class="line">    <span class="built_in">int</span> obj_meta = LuaAPI.lua_gettop(L);  </span><br><span class="line"></span><br><span class="line">    LuaAPI.lua_newtable(L);</span><br><span class="line">    <span class="built_in">int</span> cls_meta = LuaAPI.lua_gettop(L);</span><br><span class="line"></span><br><span class="line">    LuaAPI.lua_newtable(L);</span><br><span class="line">    <span class="built_in">int</span> obj_field = LuaAPI.lua_gettop(L);</span><br><span class="line">    LuaAPI.lua_newtable(L);</span><br><span class="line">    <span class="built_in">int</span> obj_getter = LuaAPI.lua_gettop(L);</span><br><span class="line">    LuaAPI.lua_newtable(L);</span><br><span class="line">    <span class="built_in">int</span> obj_setter = LuaAPI.lua_gettop(L);</span><br><span class="line">    LuaAPI.lua_newtable(L);</span><br><span class="line">    <span class="built_in">int</span> cls_field = LuaAPI.lua_gettop(L);</span><br><span class="line">    <span class="comment">//set cls_field to namespace</span></span><br><span class="line">    SetCSTable(L, type, cls_field);</span><br><span class="line">    <span class="comment">//finish set cls_field to namespace</span></span><br><span class="line">    LuaAPI.lua_newtable(L);</span><br><span class="line">    <span class="built_in">int</span> cls_getter = LuaAPI.lua_gettop(L);</span><br><span class="line">    LuaAPI.lua_newtable(L);</span><br><span class="line">    <span class="built_in">int</span> cls_setter = LuaAPI.lua_gettop(L);</span><br><span class="line"></span><br><span class="line">    LuaCSFunction item_getter;</span><br><span class="line">    LuaCSFunction item_setter;</span><br><span class="line">    makeReflectionWrap(L, type, cls_field, cls_getter, cls_setter, obj_field, obj_getter, obj_setter, obj_meta,</span><br><span class="line">        <span class="keyword">out</span> item_getter, <span class="keyword">out</span> item_setter, privateAccessible ? (BindingFlags.Public | BindingFlags.NonPublic) : BindingFlags.Public);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// init obj metatable</span></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__gc&quot;</span>);</span><br><span class="line">    LuaAPI.lua_pushstdcallcfunction(L, translator.metaFunctions.GcMeta);</span><br><span class="line">    LuaAPI.lua_rawset(L, obj_meta);</span><br><span class="line"></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__tostring&quot;</span>);</span><br><span class="line">    LuaAPI.lua_pushstdcallcfunction(L, translator.metaFunctions.ToStringMeta);</span><br><span class="line">    LuaAPI.lua_rawset(L, obj_meta);</span><br><span class="line"></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__index&quot;</span>);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, obj_field);  <span class="comment">// 1.upvalue methods = obj_field</span></span><br><span class="line">    LuaAPI.lua_pushvalue(L, obj_getter);  <span class="comment">// 2.upvalue getters = obj_getter</span></span><br><span class="line">    translator.PushFixCSFunction(L, item_getter);  <span class="comment">// 3.upvalue csindexer = item_getter</span></span><br><span class="line">    translator.PushAny(L, type.BaseType());  <span class="comment">// å‹å…¥ BaseTypeï¼Œ4.upvalue base</span></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaIndexsFieldName);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);  <span class="comment">// 5.upvalue indexfuncs = æ³¨å†Œè¡¨ [LuaIndexs]</span></span><br><span class="line">    LuaAPI.lua_pushnil(L);  <span class="comment">// 6.upvalue arrayindexer = nil</span></span><br><span class="line">    LuaAPI.gen_obj_indexer(L);  <span class="comment">// ç”Ÿæˆ__index å‡½æ•°</span></span><br><span class="line">    <span class="comment">//store in lua indexs function tables</span></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaIndexsFieldName);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);  </span><br><span class="line">    translator.Push(L, type);  <span class="comment">// å‹å…¥ type</span></span><br><span class="line">    LuaAPI.lua_pushvalue(L, <span class="number">-3</span>);</span><br><span class="line">    LuaAPI.lua_rawset(L, <span class="number">-3</span>);  <span class="comment">// æ³¨å†Œè¡¨ [LuaIndexs][type] = __index å‡½æ•°</span></span><br><span class="line">    LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line">    LuaAPI.lua_rawset(L, obj_meta); <span class="comment">// set __index  å³ obj_meta[&quot;__index&quot;] = ç”Ÿæˆçš„__index å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__newindex&quot;</span>);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, obj_setter);</span><br><span class="line">    translator.PushFixCSFunction(L, item_setter);</span><br><span class="line">    translator.Push(L, type.BaseType());</span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaNewIndexsFieldName);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);</span><br><span class="line">    LuaAPI.lua_pushnil(L);</span><br><span class="line">    LuaAPI.gen_obj_newindexer(L);</span><br><span class="line">    <span class="comment">//store in lua newindexs function tables</span></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaNewIndexsFieldName);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);</span><br><span class="line">    translator.Push(L, type);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, <span class="number">-3</span>);</span><br><span class="line">    LuaAPI.lua_rawset(L, <span class="number">-3</span>);  <span class="comment">// æ³¨å†Œè¡¨ [LuaNewIndexs][type] = __newindex å‡½æ•°</span></span><br><span class="line">    LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line">    LuaAPI.lua_rawset(L, obj_meta); <span class="comment">// set __newindex</span></span><br><span class="line">                                    <span class="comment">//finish init obj metatable</span></span><br><span class="line"></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;UnderlyingSystemType&quot;</span>);</span><br><span class="line">    translator.PushAny(L, type);</span><br><span class="line">    LuaAPI.lua_rawset(L, cls_field);  <span class="comment">// cls_field[&quot;UnderlyingSystemType&quot;] = type  ï¼Œ è®°å½•ç±»çš„åŸºç¡€ç±»å‹</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (type != <span class="literal">null</span> &amp;&amp; type.IsEnum())</span><br><span class="line">    &#123;</span><br><span class="line">        LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__CastFrom&quot;</span>);</span><br><span class="line">        translator.PushFixCSFunction(L, genEnumCastFrom(type));</span><br><span class="line">        LuaAPI.lua_rawset(L, cls_field);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//init class meta</span></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__index&quot;</span>);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, cls_getter);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, cls_field);</span><br><span class="line">    translator.Push(L, type.BaseType());</span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaClassIndexsFieldName);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);</span><br><span class="line">    LuaAPI.gen_cls_indexer(L);</span><br><span class="line">    <span class="comment">//store in lua indexs function tables</span></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaClassIndexsFieldName);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);</span><br><span class="line">    translator.Push(L, type);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, <span class="number">-3</span>);</span><br><span class="line">    LuaAPI.lua_rawset(L, <span class="number">-3</span>);  <span class="comment">// æ³¨å†Œè¡¨ [LuaClassIndexs][type] = __index å‡½æ•°</span></span><br><span class="line">    LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line">    LuaAPI.lua_rawset(L, cls_meta); <span class="comment">// set __index </span></span><br><span class="line"></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__newindex&quot;</span>);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, cls_setter);</span><br><span class="line">    translator.Push(L, type.BaseType());</span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaClassNewIndexsFieldName);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);</span><br><span class="line">    LuaAPI.gen_cls_newindexer(L);</span><br><span class="line">    <span class="comment">//store in lua newindexs function tables</span></span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, LuaClassNewIndexsFieldName);</span><br><span class="line">    LuaAPI.lua_rawget(L, LuaIndexes.LUA_REGISTRYINDEX);</span><br><span class="line">    translator.Push(L, type);</span><br><span class="line">    LuaAPI.lua_pushvalue(L, <span class="number">-3</span>);</span><br><span class="line">    LuaAPI.lua_rawset(L, <span class="number">-3</span>);  <span class="comment">// // æ³¨å†Œè¡¨ [LuaClassNewIndexs][type] = __newindex å‡½æ•°</span></span><br><span class="line">    LuaAPI.lua_pop(L, <span class="number">1</span>);</span><br><span class="line">    LuaAPI.lua_rawset(L, cls_meta); <span class="comment">// set __newindex</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨ -C- æ–¹æ³•æ—¶å‚æ•°çš„ä¼ é€’">è°ƒç”¨ C# æ–¹æ³•æ—¶å‚æ•°çš„ä¼ é€’</h3><p>å…ˆæ¥è§£å†³å‰é¢é—ç•™çš„ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äºç±»çš„é™æ€å€¼æˆ–æ˜¯éé™æ€å€¼ä¸ºä»€ä¹ˆéƒ½éœ€è¦ç”Ÿæˆå¯¹åº”çš„åŒ…è£¹æ–¹æ³•ï¼Ÿå…¶å®åŒ…è£¹æ–¹æ³•å°±æ˜¯ç”¨æ¥å¤„ç†å‚æ•°ä¼ é€’é—®é¢˜çš„ã€‚</p><p>ä¸ºäº†æ­£ç¡®çš„å’Œ Lua é€šè®¯ï¼ŒC å‡½æ•°å·²ç»å®šä¹‰å¥½äº†åè®®ã€‚è¿™ä¸ªåè®®å®šä¹‰äº†å‚æ•°ä»¥åŠè¿”å›å€¼ä¼ é€’æ–¹æ³•ï¼šC å‡½æ•°é€šè¿‡ Lua ä¸­çš„æ ˆæ¥æ¥å—å‚æ•°ï¼Œå‚æ•°ä»¥æ­£åºå…¥æ ˆï¼ˆç¬¬ä¸€ä¸ªå‚æ•°é¦–å…ˆå…¥æ ˆï¼‰ã€‚å› æ­¤ï¼Œå½“å‡½æ•°å¼€å§‹çš„æ—¶å€™ï¼Œ<code>lua_gettop(L)</code>å¯ä»¥è¿”å›å‡½æ•°æ”¶åˆ°çš„å‚æ•°ä¸ªæ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰åœ¨ç´¢å¼• 1 çš„åœ°æ–¹ï¼Œè€Œæœ€åä¸€ä¸ªå‚æ•°åœ¨ç´¢å¼• <code>lua_gettop(L)</code> å¤„ã€‚å½“éœ€è¦å‘ Lua è¿”å›å€¼çš„æ—¶å€™ï¼ŒC å‡½æ•°åªéœ€è¦æŠŠå®ƒä»¬ä»¥æ­£åºå‹åˆ°å †æ ˆä¸Šï¼ˆç¬¬ä¸€ä¸ªè¿”å›å€¼æœ€å…ˆå‹å…¥ï¼‰ï¼Œç„¶åè¿”å›è¿™äº›è¿”å›å€¼çš„ä¸ªæ•°ã€‚åœ¨è¿™äº›è¿”å›å€¼ä¹‹ä¸‹çš„ï¼Œå †æ ˆä¸Šçš„ä¸œè¥¿éƒ½ä¼šè¢« Lua ä¸¢æ‰ã€‚å’Œ Lua å‡½æ•°ä¸€æ ·ï¼Œä» Lua ä¸­è°ƒç”¨ C å‡½æ•°å¯ä»¥æœ‰å¾ˆå¤šè¿”å›å€¼ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼ŒLua è¿™è¾¹è°ƒç”¨ C å‡½æ•°æ—¶çš„å‚æ•°ä¼šè¢«è‡ªåŠ¨çš„å‹æ ˆï¼Œè¿™å¥—æœºåˆ¶ Lua å†…éƒ¨å·²ç»å®ç°å¥½äº†ã€‚æ–‡ç« å¼€å¤´ä¹Ÿæåˆ°ï¼ŒC# å¯ä»¥å€ŸåŠ© C/C++ æ¥ä¸ Lua è¿›è¡Œæ•°æ®é€šä¿¡ï¼Œæ‰€ä»¥ C# éœ€è¦é€šè¿‡ C API è·å–åˆ° Lua ä¼ é€’è¿‡æ¥çš„å‚æ•°ï¼Œè€Œè¿™ä¸ªé€»è¾‘å°±è¢«å°è£…åœ¨äº†åŒ…è£¹æ–¹æ³•ä¸­ã€‚ä»¥ <code>TestXLua</code> çš„<code>Test1</code>æ–¹æ³•ä¸ºä¾‹ï¼Œå®ƒéœ€è¦ä¸€ä¸ª <code>int</code> å‚æ•°ã€‚æ‰€ä»¥å®ƒçš„åŒ…è£¹æ–¹æ³•éœ€è¦é€šè¿‡ C API è·å–åˆ°ä¸€ä¸ª <code>int</code> å‚æ•°ï¼Œç„¶åå†ä½¿ç”¨è¿™ä¸ªå‚æ•°å»è°ƒç”¨çœŸæ­£çš„æ–¹æ³•</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">MonoPInvokeCallbackAttribute(typeof(LuaCSFunction))</span>]</span><br><span class="line"><span class="keyword">static</span> <span class="built_in">int</span> _m_Test1(RealStatePtr L)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ObjectTranslator translator = ObjectTranslatorPool.Instance.Find(L);</span><br><span class="line">        TestXLua gen_to_be_invoked = (TestXLua)translator.FastGetCSObj(L, <span class="number">1</span>);</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> _a = LuaAPI.xlua_tointeger(L, <span class="number">2</span>);  <span class="comment">// è·å–åˆ° int å‚æ•°</span></span><br><span class="line">            gen_to_be_invoked.Test1(_a);  <span class="comment">// è°ƒç”¨çœŸæ­£çš„ Test1 æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span>(System.Exception gen_e) &#123;</span><br><span class="line">        <span class="keyword">return</span> LuaAPI.luaL_error(L, <span class="string">&quot;c# exception:&quot;</span> + gen_e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆéœ€è¦ä¸ºç±»çš„å±æ€§ç”Ÿæˆå¯¹åº”çš„ <code>get</code> å’Œ<code>set</code>æ–¹æ³•ï¼Œå› ä¸ºåªæœ‰å°† Lua çš„è®¿é—®æˆ–èµ‹å€¼æ“ä½œè½¬æ¢æˆå‡½æ•°è°ƒç”¨å½¢å¼æ—¶ï¼Œå‚æ•°æ‰èƒ½åˆ©ç”¨å‡½æ•°è°ƒç”¨æœºåˆ¶è¢«è‡ªåŠ¨çš„å‹æ ˆï¼Œä»è€Œä¼ é€’ç»™ C#</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- lua æµ‹è¯•ä»£ç </span></span><br><span class="line">obj.Name = <span class="string">&quot;test&quot;</span>  <span class="comment">-- èµ‹å€¼æ“ä½œ</span></span><br><span class="line">setter[<span class="string">&quot;Name&quot;</span>](<span class="string">&quot;test&quot;</span>)  <span class="comment">-- å‡½æ•°è°ƒç”¨å½¢å¼</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå†æä¸€ä¸‹å‡½æ•°é‡è½½çš„é—®é¢˜ï¼Œå› ä¸º C# æ˜¯æ”¯æŒé‡è½½çš„ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨å¤šä¸ªåŒåå‡½æ•°ï¼Œä½†å‚æ•°ä¸åŒçš„æƒ…å†µã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œåªèƒ½é€šè¿‡åŒåå‡½æ•°è¢«è°ƒç”¨æ—¶ä¼ é€’çš„å‚æ•°æƒ…å†µæ¥åˆ¤æ–­åˆ°åº•åº”è¯¥è°ƒç”¨å“ªä¸ªå‡½æ•°</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">LuaCallCSharp</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestXLua</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å‡½æ•°é‡è½½ Test1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test1</span>(<span class="params"><span class="built_in">int</span> a</span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å‡½æ•°é‡è½½ Test1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test1</span>(<span class="params"><span class="built_in">bool</span> b</span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸º Test1 ç”Ÿæˆçš„åŒ…è£¹æ–¹æ³•</span></span><br><span class="line">[<span class="meta">MonoPInvokeCallbackAttribute(typeof(LuaCSFunction))</span>]</span><br><span class="line"><span class="keyword">static</span> <span class="built_in">int</span> _m_Test1(RealStatePtr L)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ObjectTranslator translator = ObjectTranslatorPool.Instance.Find(L);</span><br><span class="line">        TestXLua gen_to_be_invoked = (TestXLua)translator.FastGetCSObj(L, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">int</span> gen_param_count = LuaAPI.lua_gettop(L);</span><br><span class="line">        <span class="keyword">if</span>(gen_param_count == <span class="number">2</span>&amp;&amp; LuaTypes.LUA_TNUMBER == LuaAPI.lua_type(L, <span class="number">2</span>))  <span class="comment">// æ ¹æ®å‚æ•°æ•°é‡ä¸ç±»å‹åˆ¤æ–­è°ƒç”¨å“ªä¸ªæ–¹æ³•</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> _a = LuaAPI.xlua_tointeger(L, <span class="number">2</span>);</span><br><span class="line">            gen_to_be_invoked.Test1(_a);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(gen_param_count == <span class="number">2</span>&amp;&amp; LuaTypes.LUA_TBOOLEAN == LuaAPI.lua_type(L, <span class="number">2</span>))  <span class="comment">// æ ¹æ®å‚æ•°æ•°é‡ä¸ç±»å‹åˆ¤æ–­è°ƒç”¨å“ªä¸ªæ–¹æ³•</span></span><br><span class="line">        &#123; </span><br><span class="line">            <span class="built_in">bool</span> _b = LuaAPI.lua_toboolean(L, <span class="number">2</span>);</span><br><span class="line">            gen_to_be_invoked.Test1(_b);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span>(System.Exception gen_e) &#123;</span><br><span class="line">        <span class="keyword">return</span> LuaAPI.luaL_error(L, <span class="string">&quot;c# exception:&quot;</span> + gen_e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> LuaAPI.luaL_error(L, <span class="string">&quot;invalid arguments to TestXLua.Test1!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="GC">GC</h3><p>C# å’Œ Lua éƒ½æ˜¯æœ‰è‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶çš„ï¼Œå¹¶ä¸”ç›¸äº’æ˜¯æ— æ„ŸçŸ¥çš„ã€‚å¦‚æœä¼ é€’åˆ° Lua çš„ C# å¯¹è±¡è¢« C# è‡ªåŠ¨å›æ”¶æ‰äº†ï¼Œè€Œ Lua è¿™è¾¹ä»æ¯«ä¸çŸ¥æƒ…ç»§ç»­ä½¿ç”¨ï¼Œåˆ™å¿…ç„¶ä¼šå¯¼è‡´æ— æ³•é¢„çŸ¥çš„é”™è¯¯ã€‚æ‰€ä»¥åŸºæœ¬åŸåˆ™æ˜¯ä¼ é€’åˆ° Lua çš„ C#å¯¹è±¡ï¼ŒC# ä¸èƒ½è‡ªåŠ¨å›æ”¶ï¼Œåªèƒ½ Lua åœ¨ç¡®å®šä¸å†ä½¿ç”¨åé€šçŸ¥ C# è¿›è¡Œå›æ”¶<br>ä¸ºäº†ä¿è¯ C# ä¸ä¼šè‡ªåŠ¨å›æ”¶å¯¹è±¡ï¼Œæ‰€æœ‰ä¼ é€’ç»™ Lua çš„å¯¹è±¡éƒ½ä¼šè¢« <code>objects</code> ä¿æŒå¼•ç”¨ã€‚çœŸå®ä¼ é€’ç»™ Lua çš„å¯¹è±¡ç´¢å¼•å°±æ˜¯å¯¹è±¡åœ¨ <code>objects</code> ä¸­çš„ç´¢å¼•<br>Lua è¿™è¾¹ä¸ºå¯¹è±¡ç´¢å¼•å»ºç«‹çš„ <code>userdata</code> ä¼šè¢«ä¿å­˜åœ¨ç¼“å­˜è¡¨ä¸­ï¼Œè€Œç¼“å­˜è¡¨çš„å¼•ç”¨æ¨¡å¼è¢«è®¾ç½®ä¸ºå¼±å¼•ç”¨</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ObjectTranslator.cs</span></span><br><span class="line">LuaAPI.lua_newtable(L);  <span class="comment">// åˆ›å»ºç¼“å­˜è¡¨</span></span><br><span class="line">LuaAPI.lua_newtable(L);  <span class="comment">// åˆ›å»ºå…ƒè¡¨</span></span><br><span class="line">LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__mode&quot;</span>);</span><br><span class="line">LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;v&quot;</span>);</span><br><span class="line">LuaAPI.lua_rawset(L, <span class="number">-3</span>);  <span class="comment">// å…ƒè¡¨ [__mode] = vï¼Œè¡¨ç¤ºè¿™å¼ è¡¨çš„æ‰€æœ‰å€¼çš†ä¸ºå¼±å¼•ç”¨</span></span><br><span class="line">LuaAPI.lua_setmetatable(L, <span class="number">-2</span>);  <span class="comment">// ä¸ºç¼“å­˜è¡¨è®¾ç½®å…ƒè¡¨</span></span><br><span class="line">cacheRef = LuaAPI.luaL_ref(L, LuaIndexes.LUA_REGISTRYINDEX);</span><br></pre></td></tr></table></figure><p>å½“ Lua è¿™è¾¹ä¸å†å¼•ç”¨è¿™ä¸ª <code>userdata</code> æ—¶ï¼Œ<code>userdata</code>ä¼šè¢«ä»ç¼“å­˜è¡¨ä¸­ç§»é™¤ï¼ŒLua GC æ—¶ä¼šå›æ”¶è¿™ä¸ª userdataï¼Œå›æ”¶ä¹‹å‰åˆä¼šè°ƒç”¨ <code>userdata</code> å…ƒè¡¨çš„ <code>__gc</code> æ–¹æ³•ï¼Œä»¥æ­¤æ¥é€šçŸ¥ C#ï¼Œâ€œæˆ‘ Lua è¿™è¾¹ä¸å†ä½¿ç”¨è¿™ä¸ªå¯¹è±¡äº†ï¼Œä½ è¯¥å›æ”¶å¯ä»¥å›æ”¶äº†â€ã€‚åœ¨ <code>BeginObjectRegister</code>æ–¹æ³•å†…éƒ¨ï¼Œä¼šä¸º <code>userdata</code> çš„å…ƒè¡¨æ·»åŠ  <code>__gc</code> æ–¹æ³•</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Utils.cs BeginObjectRegister æ–¹æ³•</span></span><br><span class="line"><span class="keyword">if</span> ((type == <span class="literal">null</span> || !translator.HasCustomOp(type)) &amp;&amp; type != <span class="keyword">typeof</span>(<span class="built_in">decimal</span>))</span><br><span class="line">&#123;</span><br><span class="line">    LuaAPI.xlua_pushasciistring(L, <span class="string">&quot;__gc&quot;</span>);</span><br><span class="line">    LuaAPI.lua_pushstdcallcfunction(L, translator.metaFunctions.GcMeta);</span><br><span class="line">    LuaAPI.lua_rawset(L, <span class="number">-3</span>);  <span class="comment">// ä¸ºå…ƒè¡¨è®¾ç½®__gc æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>translator.metaFunctions.GcMeta</code>å®é™…ä¸Šå°±æ˜¯ <code>StaticLuaCallbacks</code> çš„<code>LuaGC</code>æ–¹æ³•</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// StaticLuaCallbacks.cs</span></span><br><span class="line">[<span class="meta">MonoPInvokeCallback(typeof(LuaCSFunction))</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">LuaGC</span>(<span class="params">RealStatePtr L</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> udata = LuaAPI.xlua_tocsobj_safe(L, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (udata != <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            ObjectTranslator translator = ObjectTranslatorPool.Instance.Find(L);</span><br><span class="line">            <span class="keyword">if</span> (translator != <span class="literal">null</span> )</span><br><span class="line">            &#123;</span><br><span class="line">                translator.collectObject(udata);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> LuaAPI.luaL_error(L, <span class="string">&quot;c# exception in LuaGC:&quot;</span> + e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>LuaGC</code>æ–¹æ³•åˆä¼šè°ƒç”¨ <code>collectObject</code> æ–¹æ³•ã€‚åœ¨ <code>collectObject</code> æ–¹æ³•å†…éƒ¨ä¼šå°†å¯¹è±¡ä» <code>objects</code> ç§»é™¤ï¼Œä»è€Œä½¿å¯¹è±¡ä¸å†è¢«å›ºå®šå¼•ç”¨ï¼Œèƒ½å¤Ÿè¢« C# GC æ­£å¸¸å›æ”¶</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ObjectTranslator.cs</span></span><br><span class="line"><span class="function"><span class="keyword">internal</span> <span class="keyword">void</span> <span class="title">collectObject</span>(<span class="params"><span class="built_in">int</span> obj_index_to_collect</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">object</span> o;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (objects.TryGetValue(obj_index_to_collect, <span class="keyword">out</span> o))</span><br><span class="line">    &#123;</span><br><span class="line">        objects.Remove(obj_index_to_collect);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (o != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> obj_index;</span><br><span class="line">            <span class="comment">//lua gc æ˜¯å…ˆæŠŠ weak table ç§»é™¤åå†è°ƒç”¨__gcï¼Œè¿™æœŸé—´åŒä¸€ä¸ªå¯¹è±¡å¯èƒ½å†æ¬¡ push åˆ° luaï¼Œå…³è”åˆ°æ–°çš„ index</span></span><br><span class="line">            <span class="built_in">bool</span> is_enum = o.GetType().IsEnum();</span><br><span class="line">            <span class="keyword">if</span> ((is_enum ? enumMap.TryGetValue(o, <span class="keyword">out</span> obj_index) : reverseMap.TryGetValue(o, <span class="keyword">out</span> obj_index))</span><br><span class="line">                &amp;&amp; obj_index == obj_index_to_collect)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (is_enum)</span><br><span class="line">                &#123;</span><br><span class="line">                    enumMap.Remove(o);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    reverseMap.Remove(o);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="é¢è¯•" scheme="https://silhouettesforyou.github.io/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
    <category term="C#" scheme="https://silhouettesforyou.github.io/tags/C/"/>
    
    <category term="xLua" scheme="https://silhouettesforyou.github.io/tags/xLua/"/>
    
  </entry>
  
  <entry>
    <title>ProtoBuf çš„åŸºæœ¬åŸç†</title>
    <link href="https://silhouettesforyou.github.io/2024/06/04/54/"/>
    <id>https://silhouettesforyou.github.io/2024/06/04/54/</id>
    <published>2024-06-04T06:28:00.000Z</published>
    <updated>2024-06-04T13:30:32.937Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>ğŸ”— <a class="link" href="https://sunyunqiang.com/blog/protobuf_encode/"> åŸæ–‡é“¾æ¥ <i class="fas fa-external-link-alt"></i></a></p></blockquote><p>Protobuf æ˜¯ç”± Google è®¾è®¡çš„ä¸€ç§é«˜æ•ˆã€è½»é‡çº§çš„ä¿¡æ¯æè¿°æ ¼å¼ï¼Œèµ·åˆæ˜¯åœ¨ Google å†…éƒ¨ä½¿ç”¨ï¼Œåæ¥è¢«å¼€æ”¾å‡ºæ¥ï¼Œå®ƒå…·æœ‰è¯­è¨€ä¸­ç«‹ã€å¹³å°ä¸­ç«‹ã€é«˜æ•ˆã€å¯æ‰©å±•ç­‰ç‰¹æ€§ï¼Œå®ƒéå¸¸é€‚åˆç”¨æ¥åšæ•°æ®å­˜å‚¨ã€RPC æ•°æ®äº¤æ¢ç­‰ã€‚ä¸ jsonã€xml ç›¸æ¯”ï¼ŒProtobuf çš„ç¼–ç é•¿åº¦æ›´çŸ­ã€ä¼ è¾“æ•ˆç‡æ›´é«˜ï¼Œå…¶å®ä¸¥æ ¼æ„ä¹‰ä¸Šè®²ï¼Œjsonã€xml å¹¶éæ˜¯ä¸€ç§ã€Œç¼–ç ã€, è€Œåªèƒ½ç§°ä¹‹ä¸ºã€Œæ ¼å¼ã€, jsonã€xml çš„å†…å®¹æœ¬èº«éƒ½æ˜¯å­—ç¬¦å½¢å¼ï¼Œå®ƒä»¬çš„ç¼–ç é‡‡ç”¨çš„æ˜¯ ASCII ç¼–ç ï¼Œæœ¬æ–‡è®²è¿° Protobuf çš„åº•å±‚ç¼–ç åŸç†ï¼Œä»¥ä¾¿äºäº†è§£ Protobuf ä¸ºä»€ä¹ˆç¼–ç é•¿åº¦çŸ­å¹¶ä¸”æ‰©å±•æ€§å¼ºï¼Œä¸æ­¤åŒæ—¶æˆ‘ä»¬ä¹Ÿå°†äº†è§£åˆ°å®ƒæœ‰å“ªäº›ä¸è¶³ <br>Protobuf çš„ä¸€ä¸ªå…¸å‹åº”ç”¨åœºæ™¯ä¾¿æ˜¯åšé€šä¿¡çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œå®ƒåœ¨é€šä¿¡ç®¡é“ä¸Šæ˜¯ä»¥çº¯äºŒè¿›åˆ¶çš„å½¢å¼è¿›è¡Œä¼ è¾“ï¼Œå‘é€ç«¯ä½¿ç”¨ç¼–ç å™¨å°†æ•°æ®åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶ï¼Œæ¥æ”¶ç«¯ä½¿ç”¨è§£ç å™¨å°†æ”¶åˆ°çš„äºŒè¿›åˆ¶æµè¿›è¡Œååºåˆ—åŒ–ä»è€Œå–å¾—åŸå§‹ä¿¡æ¯ï¼Œå› æ­¤å½“å¯¹é€šä¿¡ç®¡é“è¿›è¡ŒæŠ“åŒ…æ—¶æ— æ³•è·çŸ¥æ•°æ®çš„è¯¦ç»†å†…å®¹ï¼Œäº‹å®ä¸Šï¼ŒåŒä¸€æ®µ Protobuf çš„äºŒè¿›åˆ¶æ•°æ®æµï¼Œåœ¨æ¥æ”¶ç«¯ä½¿ç”¨ä¸åŒçš„è§£ç æ ¼å¼è¿›è¡Œè§£ç ï¼Œå¯èƒ½å¾—åˆ°å®Œå…¨ä¸åŒçš„ä¿¡æ¯ã€‚åœ¨äº†è§£ Protobuf çš„åº•å±‚ç¼–ç ç»†èŠ‚ä¹‹å‰ï¼Œéœ€è¦é¦–å…ˆäº†è§£ Protobuf æ‰€ç”¨åˆ°çš„ä¸¤ç§ä¸»è¦çš„ç¼–ç æ–¹å¼ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ Varints ç¼–ç å’Œ Zigzag ç¼–ç  </p><h3 id="1-1-Varints- ç¼–ç ">1.1 Varints ç¼–ç  </h3><p> é€šå¸¸æ¥è¯´ï¼Œæ™®é€šçš„ int æ•°æ®ç±»å‹ï¼Œæ— è®ºå…¶å€¼çš„å¤§å°ï¼Œæ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´éƒ½æ˜¯ç›¸ç­‰çš„ï¼Œè¿™ç‚¹å¯ä»¥å¼•èµ·äººä»¬çš„æ€è€ƒï¼Œæ˜¯å¦å¯ä»¥æ ¹æ®æ•°å€¼çš„å¤§å°æ¥åŠ¨æ€åœ°å ç”¨å­˜å‚¨ç©ºé—´ï¼Œä½¿å¾—å€¼æ¯”è¾ƒå°çš„æ•°å­—å ç”¨è¾ƒå°‘çš„å­—èŠ‚æ•°ï¼Œå€¼ç›¸å¯¹æ¯”è¾ƒå¤§çš„æ•°å­—å ç”¨è¾ƒå¤šçš„å­—èŠ‚æ•°ï¼Œè¿™ä¾¿æ˜¯å˜é•¿æ•´å‹ç¼–ç çš„åŸºæœ¬æ€æƒ³ï¼Œé‡‡ç”¨å˜é•¿æ•´å‹ç¼–ç çš„æ•°å­—ï¼Œå…¶å ç”¨çš„å­—èŠ‚æ•°ä¸æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œä¸ºäº†è¾¾åˆ°è¿™ä¸€ç‚¹ï¼ŒVarints ç¼–ç ä½¿ç”¨æ¯ä¸ªå­—èŠ‚çš„æœ€é«˜æœ‰æ•ˆä½ä½œä¸ºæ ‡å¿—ä½ï¼Œè€Œå‰©ä½™çš„ 7 ä½ä»¥äºŒè¿›åˆ¶è¡¥ç çš„å½¢å¼æ¥å­˜å‚¨æ•°å­—å€¼æœ¬èº«ï¼Œå½“æœ€é«˜æœ‰æ•ˆä½ä¸º 1 æ—¶ï¼Œä»£è¡¨å…¶åè¿˜è·Ÿæœ‰å­—èŠ‚ï¼Œå½“æœ€é«˜æœ‰æ•ˆä½ä¸º 0 æ—¶ï¼Œä»£è¡¨å·²ç»æ˜¯è¯¥æ•°å­—çš„æœ€åçš„ä¸€ä¸ªå­—èŠ‚ï¼Œåœ¨ Protobuf ä¸­ï¼Œä½¿ç”¨çš„æ˜¯ Base128 Varints ç¼–ç ï¼Œä¹‹æ‰€ä»¥å«è¿™ä¸ªåå­—åŸå› å³æ˜¯åœ¨è¿™ç§æ–¹å¼ä¸­ï¼Œä½¿ç”¨ 7 bit æ¥å­˜å‚¨æ•°å­—ï¼Œåœ¨ Protobuf ä¸­ï¼ŒBase128 Varints é‡‡ç”¨çš„æ˜¯å°ç«¯åºï¼Œå³æ•°å­—çš„ä½ä½å­˜æ”¾åœ¨é«˜åœ°å€ï¼Œä¸¾ä¾‹æ¥çœ‹ï¼Œå¯¹äºæ•°å­— 1, æˆ‘ä»¬å‡è®¾ int ç±»å‹å  4 ä¸ªå­—èŠ‚ï¼Œä»¥æ ‡å‡†çš„æ•´å‹å­˜å‚¨ï¼Œå…¶äºŒè¿›åˆ¶è¡¨ç¤ºåº”ä¸º </p><p>00000000 00000000 00000000 00000001</p><p> å¯è§ï¼Œåªæœ‰æœ€åä¸€ä¸ªå­—èŠ‚å­˜å‚¨äº†æœ‰æ•ˆæ•°å€¼ï¼Œå‰ 3 ä¸ªå­—èŠ‚éƒ½æ˜¯ 0, è‹¥é‡‡ç”¨ Varints ç¼–ç ï¼Œå…¶äºŒè¿›åˆ¶å½¢å¼ä¸º </p><p>00000001</p><p> å› ä¸ºå…¶æ²¡æœ‰åç»­å­—èŠ‚ï¼Œå› æ­¤å…¶æœ€é«˜æœ‰æ•ˆä½ä¸º 0, å…¶ä½™çš„ 7 ä½ä»¥è¡¥ç å½¢å¼å­˜æ”¾ 1, å†æ¯”å¦‚æ•°å­— 666, å…¶ä»¥æ ‡å‡†çš„æ•´å‹å­˜å‚¨ï¼Œå…¶äºŒè¿›åˆ¶è¡¨ç¤ºä¸º </p><p>00000000 00000000 00000010 10011010</p><p> è€Œé‡‡ç”¨ Varints ç¼–ç ï¼Œå…¶äºŒè¿›åˆ¶å½¢å¼ä¸º </p><p>10011010 00000101</p><p> æˆ‘ä»¬å¯ä»¥å°è¯•æ¥å¤åŸä¸€ä¸‹ä¸Šé¢è¿™ä¸ª Base128 Varints ç¼–ç çš„äºŒè¿›åˆ¶ä¸²ï¼Œé¦–å…ˆçœ‹æœ€é«˜æœ‰æ•ˆä½ï¼Œé«˜ 8 ä½çš„æœ€é«˜æœ‰æ•ˆä½ä¸º 1, ä»£è¡¨å…¶åè¿˜è·Ÿæœ‰æœ‰æ•ˆå­—èŠ‚ï¼Œä½ 8 ä½çš„æœ€é«˜æœ‰æ•ˆä½ä¸º 0, ä»£è¡¨å…¶å·²æ˜¯æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œç”±äº Protobuf é‡‡ç”¨å°ç«¯å­—èŠ‚åºå­˜å‚¨æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬ç§»é™¤ä¸¤ä¸ªå­—èŠ‚çš„æœ€é«˜æœ‰æ•ˆä½ï¼Œå¹¶äº¤æ¢å­—èŠ‚åºä¾¿å¾—åˆ° </p><p>1010011010</p><p> è½¬æ¢ä¸ºåè¿›åˆ¶ï¼Œå³æ˜¯æ•°å­— 666</p><p> ä»ä¸Šé¢çš„ç¼–ç è§£ç è¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œå¯å˜é•¿æ•´å‹ç¼–ç å¯¹äºä¸åŒå¤§å°çš„æ•°å­—ï¼Œå…¶æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´æ˜¯ä¸åŒçš„ï¼Œç¼–ç æ€æƒ³ä¸ CPU çš„é—´æ¥å¯»å€åŸç†ç›¸ä¼¼ï¼Œéƒ½æ˜¯ç”¨ä¸€æ¯”ç‰¹æ¥æ ‡è¯†æ˜¯å¦èµ°åˆ°æœ«å°¾ï¼Œä½†é‡‡ç”¨è¿™ç§æ–¹å¼å­˜å‚¨æ•°å­—ï¼Œä¹Ÿæœ‰ä¸€ä¸ªç›¸å¯¹ä¸å¥½çš„ç‚¹ä¾¿æ˜¯ï¼Œæ— æ³•å¯¹ä¸€ä¸ªåºåˆ—çš„æ•°å€¼è¿›è¡ŒéšæœºæŸ¥æ‰¾ï¼Œå› ä¸ºæ¯ä¸ªæ•°å­—æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´ä¸æ˜¯ç­‰é•¿çš„ï¼Œå› æ­¤è‹¥è¦è·å¾—åºåˆ—ä¸­çš„ç¬¬ N ä¸ªæ•°å­—ï¼Œæ— æ³•åƒç­‰é•¿å­˜å‚¨é‚£æ ·åœ¨æŸ¥æ‰¾ä¹‹å‰ç›´æ¥è®¡ç®—å‡º Offset, åªèƒ½ä»å¤´å¼€å§‹é¡ºåºæŸ¥æ‰¾ </p><h3 id="1-2-Zigzag- ç¼–ç ">1.2 Zigzag ç¼–ç  </h3><p>Varints ç¼–ç çš„å®è´¨åœ¨äºå»æ‰æ•°å­—å¼€å¤´çš„ 0, å› æ­¤å¯ç¼©çŸ­æ•°å­—æ‰€å çš„å­˜å‚¨å­—èŠ‚æ•°ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªä¸¾ä¾‹è¯´æ˜äº†æ­£æ•°çš„ Varints ç¼–ç ï¼Œä½†å¦‚æœæ•°å­—ä¸ºè´Ÿæ•°ï¼Œåˆ™é‡‡ç”¨ Varints ç¼–ç ä¼šæ’å®šå ç”¨ 10 ä¸ªå­—èŠ‚ï¼ŒåŸå› åœ¨äºè´Ÿæ•°çš„ç¬¦å·ä½ä¸º 1, å¯¹äºè´Ÿæ•°å…¶ä»ç¬¦å·ä½å¼€å§‹çš„é«˜ä½å‡ä¸º 1, åœ¨ Protobuf çš„å…·ä½“å®ç°ä¸­ï¼Œä¼šå°†æ­¤è§†ä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ— ç¬¦å·æ•°ï¼Œä»¥ Go è¯­è¨€çš„å®ç°ä¸ºä¾‹ï¼Œå¯¹äº int32 ç±»å‹çš„ pb å­—æ®µï¼Œå¯¹äºå¦‚ä¸‹å®šä¹‰çš„ proto</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line">package pbTest;</span><br><span class="line"></span><br><span class="line">message Request &#123;</span><br><span class="line">    int32 a = 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Request ä¸­åŒ…å«ç±»å‹ä¸º int32 ç±»å‹çš„å­—æ®µï¼Œå½“ a ä¸ºè´Ÿæ•°æ—¶ï¼Œå…¶åºåˆ—åŒ–ä¹‹åå°†æ’å®šå ç”¨ 10 ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„æµ‹è¯•ä»£ç  </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := pbTest.Request&#123;</span><br><span class="line">        A: <span class="number">-5</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    bytes, err := proto.Marshal(&amp;a)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(fmt.Sprintf(<span class="string">&quot;%08b&quot;</span>, bytes))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> å¯¹äº int32 ç±»å‹çš„æ•°å­— -5, å…¶åºåˆ—åŒ–ä¹‹åçš„äºŒè¿›åˆ¶ä¸º </p><center>    <img src="/2024/06/04/54/protobuf-zig-zag.png"></center><p> ç©¶å…¶åŸå› åœ¨äº Protobuf çš„å†…éƒ¨å°† int32 ç±»å‹çš„è´Ÿæ•°è½¬æ¢ä¸º uint64 æ¥å¤„ç†ï¼Œè½¬æ¢åçš„ uint64 æ•°å€¼çš„é«˜ä½å…¨ä¸º 1, ç›¸å½“äºæ˜¯ä¸€ä¸ª 8 å­—èŠ‚çš„å¾ˆå¤§çš„æ— ç¬¦å·æ•°ï¼Œå› æ­¤é‡‡ç”¨ Base128 Varints ç¼–ç åå°†æ’å®šå ç”¨ 10 ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œå¯è§ Varints ç¼–ç å¯¹äºè¡¨ç¤ºè´Ÿæ•°æ¯«æ— ä¼˜åŠ¿ï¼Œç”šè‡³æ¯”æ™®é€šçš„å›ºå®š 32 ä½å­˜å‚¨è¿˜è¦å¤šå  4 ä¸ªå­—èŠ‚ã€‚Varints ç¼–ç çš„å®è´¨åœ¨äºè®¾æ³•ç§»é™¤æ•°å­—å¼€å¤´çš„ 0 æ¯”ç‰¹ï¼Œè€Œå¯¹äºè´Ÿæ•°ï¼Œç”±äºå…¶æ•°å­—é«˜ä½éƒ½æ˜¯ 1, å› æ­¤ Varints ç¼–ç åœ¨æ­¤åœºæ™¯ä¸‹å¤±æ•ˆï¼ŒZigzag ç¼–ç ä¾¿æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒZigzag ç¼–ç çš„å¤§è‡´æ€æƒ³æ˜¯é¦–å…ˆå¯¹è´Ÿæ•°åšä¸€æ¬¡å˜æ¢ï¼Œå°†å…¶æ˜ å°„ä¸ºä¸€ä¸ªæ­£æ•°ï¼Œå˜æ¢ä»¥åä¾¿å¯ä»¥ä½¿ç”¨ Varints ç¼–ç è¿›è¡Œå‹ç¼©ï¼Œè¿™é‡Œå…³é”®çš„ä¸€ç‚¹åœ¨äºå˜æ¢çš„ç®—æ³•ï¼Œé¦–å…ˆç®—æ³•å¿…é¡»æ˜¯å¯é€†çš„ï¼Œå³å¯ä»¥æ ¹æ®å˜æ¢åçš„å€¼è®¡ç®—å‡ºåŸå§‹å€¼ï¼Œå¦åˆ™å°±æ— æ³•è§£ç ï¼ŒåŒæ—¶è¦æ±‚å˜æ¢ç®—æ³•è¦å°½å¯èƒ½ç®€å•ï¼Œä»¥é¿å…å½±å“ Protobuf ç¼–ç ã€è§£ç çš„é€Ÿåº¦ï¼Œæˆ‘ä»¬å‡è®¾ n æ˜¯ä¸€ä¸ª 32 ä½ç±»å‹çš„æ•°å­—ï¼Œåˆ™ Zigzag ç¼–ç çš„è®¡ç®—æ–¹å¼ä¸º </p><p><code>(n &lt;&lt; 1) ^ (n &gt;&gt; 31)</code></p><p> è¦æ³¨æ„è¿™é‡Œå·¦è¾¹æ˜¯é€»è¾‘ç§»ä½ï¼Œå³è¾¹æ˜¯ç®—æœ¯ç§»ä½ï¼Œå³è¾¹çš„å«ä¹‰å®é™…æ˜¯å¾—åˆ°ä¸€ä¸ªå…¨ 1 ï¼ˆå¯¹äºè´Ÿæ•°ï¼‰ æˆ–å…¨ 0 ï¼ˆå¯¹äºæ­£æ•°ï¼‰çš„æ¯”ç‰¹åºåˆ—ï¼Œå› ä¸ºå¯¹äºä»»æ„ä¸€ä¸ªä½æ•°ä¸º Î· çš„æœ‰ç¬¦å·æ•° n, å…¶æœ€é«˜ä½ä¸ºç¬¦å·ä½ï¼Œå‰©ä¸‹çš„ Î· - 1 ä½ä¸ºæ•°å­—ä½ï¼Œå°†å…¶ç®—æœ¯å³ç§» Î· - 1 ä½ï¼Œç”±äºæ˜¯ç®—æœ¯ç§»ä½ï¼Œå› æ­¤å³ç§»æ—¶å·¦è¾¹äº§ç”Ÿçš„ç©ºä½å°†ç”±ç¬¦å·ä½æ¥å¡«å……ï¼Œè¿›è¡Œ Î· - 1 æ¬¡ç®—æœ¯å³ç§»ä¹‹åä¾¿å¾—åˆ° Î· ä½ä¸åŸå…ˆçš„ç¬¦å·ä½ç›¸ç­‰çš„åºåˆ—ï¼Œç„¶åå¯¹ä¸¤è¾¹æŒ‰ä½å¼‚æˆ–ä¾¿å¾—åˆ° Zigzag ç¼–ç ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªå›¾ç¤ºæ¥ç›´è§‚åœ°è¯´æ˜ Zigzag ç¼–ç çš„è®¾è®¡æ€æƒ³ï¼Œä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬å‡å®šæ•°å­—æ˜¯ 16 ä½çš„ï¼Œå…ˆæ¥çœ‹è´Ÿæ•°çš„æƒ…å½¢ï¼Œå‡è®¾æ•°å­—ä¸º -5, å…¶åœ¨å†…å­˜ä¸­çš„å½¢å¼ä¸º </p><p>11111111 11111011</p><p> é¦–å…ˆå¯¹å…¶è¿›è¡Œä¸€æ¬¡é€»è¾‘å·¦ç§»ï¼Œç§»ä½åç©ºå‡ºçš„æ¯”ç‰¹ä½ç”± 0 å¡«å…… </p><p>11111111 11110110</p><p> ç„¶åå¯¹åŸæ•°å­—è¿›è¡Œ 15 æ¬¡ç®—æœ¯å³ç§»ï¼Œå¾—åˆ° 16 ä½å…¨ä¸ºåŸç¬¦å·ä½ï¼ˆå³ 1) çš„æ•°å­— </p><p>11111111 11111111</p><p> ç„¶åå¯¹é€»è¾‘ç§»ä½å’Œç®—æœ¯ç§»ä½çš„ç»“æœæŒ‰ä½å¼‚æˆ–ï¼Œä¾¿å¾—åˆ°æœ€ç»ˆçš„ Zigzag ç¼–ç  </p><p>00000000 00001001</p><p> å¯ä»¥çœ‹åˆ°ï¼Œå¯¹è´Ÿæ•°ä½¿ç”¨ Zigzag ç¼–ç ä»¥åï¼Œå…¶é«˜ä½çš„ 1 å…¨éƒ¨å˜æˆäº† 0, è¿™æ ·ä»¥æ¥æˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨ Varints ç¼–ç è¿›è¡Œè¿›ä¸€æ­¥åœ°å‹ç¼©ï¼Œå†æ¥çœ‹æ­£æ•°çš„æƒ…å½¢ï¼Œå¯¹äº 16 ä½çš„æ­£æ•° 5, å…¶åœ¨å†…å­˜ä¸­çš„å­˜å‚¨å½¢å¼ä¸º </p><p>00000000 00000101</p><p> æˆ‘ä»¬æŒ‰ç…§ä¸è´Ÿæ•°ç›¸åŒçš„å¤„ç†æ–¹æ³•ï¼Œå¯ä»¥å¾—åˆ°å…¶ Zigzag ç¼–ç ä¸º </p><p>00000000 00001010</p><p> ä»ä¸Šé¢çš„ç»“æœæ¥çœ‹ï¼Œæ— è®ºæ˜¯æ­£æ•°è¿˜æ˜¯è´Ÿæ•°ï¼Œç»è¿‡ Zigzag ç¼–ç ä»¥åï¼Œæ•°å­—é«˜ä½éƒ½æ˜¯ 0, è¿™æ ·ä»¥æ¥ï¼Œä¾¿å¯ä»¥è¿›ä¸€æ­¥ä½¿ç”¨ Varints ç¼–ç è¿›è¡Œæ•°æ®å‹ç¼©ï¼Œå³ Zigzag ç¼–ç åœ¨ Protobuf ä¸­å¹¶ä¸å•ç‹¬ä½¿ç”¨ï¼Œè€Œæ˜¯é…åˆ Varints ç¼–ç å…±åŒæ¥è¿›è¡Œæ•°æ®å‹ç¼©ï¼ŒGoogle åœ¨ Protobuf çš„å®˜æ–¹æ–‡æ¡£ä¸­å†™é“ï¼š<br>Google Protobuf<br>If you use int32 or int64 as the type for a negative number, the resulting varint is always ten bytes long â€“ it is, effectively, treated like a very large unsigned integer. If you use one of the signed types, the resulting varint uses ZigZag encoding, which is much more efficient.</p><p> åœ¨ä¸Šé¢çš„è®¨è®ºä¸­ï¼Œæˆ‘ä»¬äº†è§£äº† Protobuf æ‰€ä½¿ç”¨çš„ Varints ç¼–ç å’Œ Zigzag ç¼–ç çš„ç¼–ç åŸç†ï¼Œæœ¬èŠ‚æˆ‘ä»¬æ¥è®¨è®º Protobuf çš„æ•°æ®ç»„ç»‡æ–¹å¼ï¼Œé¦–å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½¿ç”¨ protobuf ä½œä¸ºæ•°æ®äº¤æ¢æ ¼å¼ï¼Œproto çš„å…·ä½“å®šä¹‰ä¸º </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line">package pbTest;</span><br><span class="line"></span><br><span class="line">message Request &#123;</span><br><span class="line">    int32 age = 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Request ä¸­åŒ…å«äº†ä¸€ä¸ªåç§°ä¸º name çš„å­—æ®µï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ–¹éƒ½ç”¨åŒä¸€ä»½ç›¸åŒçš„ proto æ–‡ä»¶æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼Œå‡è®¾å®¢æˆ·ç«¯è‡ªå·±å°† proto æ–‡ä»¶åšäº†ä¿®æ”¹ï¼Œä¿®æ”¹åçš„ proto æ–‡ä»¶å¦‚ä¸‹ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line">package pbTest;</span><br><span class="line"></span><br><span class="line">message Request &#123;</span><br><span class="line">    int32 age_test = 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> åœ¨è¿™ç§æƒ…å½¢ä¸‹ï¼ŒæœåŠ¡ç«¯ä¸ä¿®æ”¹åº”ç”¨ç¨‹åºä»èƒ½å¤Ÿæ­£ç¡®åœ°è§£ç ï¼ŒåŸå› åœ¨äºåºåˆ—åŒ–åçš„ Protobuf æ²¡æœ‰ä½¿ç”¨å­—æ®µåç§°ï¼Œè€Œä»…ä»…é‡‡ç”¨äº†å­—æ®µç¼–å·ï¼Œä¸ json xml ç­‰ç›¸æ¯”ï¼ŒProtobuf ä¸æ˜¯ä¸€ç§å®Œå…¨è‡ªæè¿°çš„åè®®æ ¼å¼ï¼Œå³æ¥æ”¶ç«¯åœ¨æ²¡æœ‰ proto æ–‡ä»¶å®šä¹‰çš„å‰æä¸‹æ˜¯æ— æ³•è§£ç ä¸€ä¸ª protobuf æ¶ˆæ¯ä½“çš„ï¼Œä¸æ­¤ç›¸å¯¹çš„ï¼Œjson xml ç­‰åè®®æ ¼å¼æ˜¯å®Œå…¨è‡ªæè¿°çš„ï¼Œæ‹¿åˆ°äº† json æ¶ˆæ¯ä½“ï¼Œä¾¿å¯ä»¥çŸ¥é“è¿™æ®µæ¶ˆæ¯ä½“ä¸­æœ‰å“ªäº›å­—æ®µï¼Œæ¯ä¸ªå­—æ®µçš„å€¼åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œå…¶å®å¯¹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šä¿¡åŒæ–¹æ¥è¯´ï¼Œçº¦å®šå¥½äº†æ¶ˆæ¯æ ¼å¼ä¹‹åå®Œå…¨æ²¡æœ‰å¿…è¦åœ¨æ¯ä¸€æ¡æ¶ˆæ¯ä¸­éƒ½æºå¸¦å­—æ®µåç§°ï¼ŒProtobuf åœ¨é€šä¿¡æ•°æ®ä¸­ç§»é™¤å­—æ®µåç§°ï¼Œè¿™å¯ä»¥å¤§å¤§é™ä½æ¶ˆæ¯çš„é•¿åº¦ï¼Œæé«˜é€šä¿¡æ•ˆç‡ï¼ŒProtobuf è¿›ä¸€æ­¥å°†é€šä¿¡çº¿è·¯ä¸Šæ¶ˆæ¯ç±»å‹åšäº†åˆ’åˆ†ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤º </p><center>    <img src="/2024/06/04/54/protobuf-message-type.png"></center><p> å¯¹äº int32, int64, uint32 ç­‰æ•°æ®ç±»å‹åœ¨åºåˆ—åŒ–ä¹‹åéƒ½ä¼šè½¬ä¸º Varints ç¼–ç ï¼Œé™¤å»ä¸¤ç§å·²æ ‡è®°ä¸º deprecated çš„ç±»å‹ï¼Œç›®å‰ Protobuf åœ¨åºåˆ—åŒ–ä¹‹åçš„æ¶ˆæ¯ç±»å‹ (wire-type) æ€»å…±æœ‰ 4 ç§ï¼ŒProtobuf é™¤äº†å­˜å‚¨å­—æ®µçš„å€¼ä¹‹å¤–ï¼Œè¿˜å­˜å‚¨äº†å­—æ®µçš„ç¼–å·ä»¥åŠå­—æ®µåœ¨é€šä¿¡çº¿è·¯ä¸Šçš„æ ¼å¼ç±»å‹ (wire-type), å…·ä½“çš„å­˜å‚¨æ–¹å¼ä¸º </p><p><code>field_num &lt;&lt; 3 | wire type</code></p><p> å³å°†å­—æ®µæ ‡å·é€»è¾‘å·¦ç§» 3 ä½ï¼Œç„¶åä¸è¯¥å­—æ®µçš„ wire type çš„ç¼–å·æŒ‰ä½æˆ–ï¼Œåœ¨ä¸Šè¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œwire type æ€»å…±æœ‰ 6 ç§ç±»å‹ï¼Œå› æ­¤å¯ä»¥ç”¨ 3 ä½äºŒè¿›åˆ¶æ¥æ ‡è¯†ï¼Œæ‰€ä»¥ä½ 3 ä½å®é™…ä¸Šå­˜å‚¨äº†å…¶åæ‰€è·Ÿçš„æ•°æ®çš„ wire type, æ¥æ”¶ç«¯å¯ä»¥åˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼Œç»“åˆ proto æ–‡ä»¶æ¥è§£ç æ¶ˆæ¯ç»“æ„ä½“ï¼Œæˆ‘ä»¬ä»¥ä¸Šé¢ proto ä¸ºä¾‹æ¥çœ‹ä¸€æ®µ Protobuf å®é™…åºåˆ—åŒ–ä¹‹åçš„å®Œæ•´äºŒè¿›åˆ¶æ•°æ®ï¼Œå‡è®¾ age ä¸º 5, ç”±äº age åœ¨ proto æ–‡ä»¶ä¸­å®šä¹‰çš„æ˜¯ int32 ç±»å‹ï¼Œå› æ­¤åºåˆ—åŒ–ä¹‹åå®ƒçš„ wire type ä¸º 0, å…¶å­—æ®µç¼–å·ä¸º 1, å› æ­¤æŒ‰ç…§ä¸Šé¢çš„è®¡ç®—æ–¹å¼ï¼Œå³ 1 &lt;&lt; 3 | 0, æ‰€ä»¥å…¶ç±»å‹å’Œå­—æ®µç¼–å·çš„ä¿¡æ¯åªå  1 ä¸ªå­—èŠ‚ï¼Œå³ 00001000, åé¢è·Ÿä¸Šå­—æ®µå€¼ 5 çš„ Varints ç¼–ç ï¼Œæ‰€ä»¥æ•´ä¸ªç»“æ„ä½“åºåˆ—åŒ–ä¹‹åä¸º </p><center>    <img src="/2024/06/04/54/protobuf-zig-zag-1.png"></center><p> æœ‰äº†å­—æ®µç¼–å·å’Œ wire type, å…¶åæ‰€è·Ÿçš„æ•°æ®çš„é•¿åº¦ä¾¿æ˜¯ç¡®å®šçš„ï¼Œå› æ­¤ Protobuf æ˜¯ä¸€ç§éå¸¸ç´§å¯†çš„æ•°æ®ç»„ç»‡æ ¼å¼ï¼Œå…¶ä¸éœ€è¦ç‰¹åˆ«åœ°åŠ å…¥é¢å¤–çš„åˆ†éš”ç¬¦æ¥åˆ†å‰²ä¸€ä¸ªæ¶ˆæ¯å­—æ®µï¼Œè¿™å¯å¤§å¤§æå‡é€šä¿¡çš„æ•ˆç‡ï¼Œè§„é¿å†—ä½™çš„æ•°æ®ä¼ è¾“ </p><h3 id="1-4- æ€»ç»“">1.4 æ€»ç»“ </h3><ul><li>Protobuf æ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®æè¿°æ ¼å¼ï¼Œå…·æœ‰å¹³å°æ— å…³ã€è¯­è¨€æ— å…³ã€å¯æ‰©å±•ç­‰ç‰¹ç‚¹ï¼Œé€‚åˆåšæ•°æ®å­˜å‚¨ã€RPC çš„é€šä¿¡åè®®ç­‰åœºæ™¯ </li><li>Protobuf é‡‡ç”¨ Varints ç¼–ç å’Œ Zigzag ç¼–ç æ¥ç¼–ç æ•°æ®ï¼Œå…¶ä¸­ Varints ç¼–ç çš„æ€æƒ³æ˜¯ç§»é™¤æ•°å­—é«˜ä½çš„ 0, ç”¨å˜é•¿çš„äºŒè¿›åˆ¶ä½æ¥æè¿°ä¸€ä¸ªæ•°å­—ï¼Œå¯¹äºå°æ•°å­—ï¼Œå…¶ç¼–ç é•¿åº¦çŸ­ï¼Œå¯æé«˜æ•°æ®ä¼ è¾“æ•ˆç‡ï¼Œä½†ç”±äºå®ƒåœ¨æ¯ä¸ªå­—èŠ‚çš„æœ€é«˜ä½é¢å¤–é‡‡ç”¨äº†ä¸€ä¸ªæ ‡å¿—ä½æ¥æ ‡è®°å…¶åæ˜¯å¦è¿˜è·Ÿæœ‰æœ‰æ•ˆå­—èŠ‚ï¼Œå› æ­¤å¯¹äºå¤§çš„æ­£æ•°ï¼Œå®ƒä¼šæ¯”ä½¿ç”¨æ™®é€šçš„å®šé•¿æ ¼å¼å ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œå¦å¤–å¯¹äºè´Ÿæ•°ï¼Œç›´æ¥é‡‡ç”¨ Varints ç¼–ç å°†æ’å®šå ç”¨ 10 ä¸ªå­—èŠ‚ï¼ŒZigzag ç¼–ç å¯å°†è´Ÿæ•°æ˜ å°„ä¸ºæ— ç¬¦å·çš„æ­£æ•°ï¼Œç„¶åé‡‡ç”¨ Varints ç¼–ç è¿›è¡Œæ•°æ®å‹ç¼©ï¼Œåœ¨å„ç§è¯­è¨€çš„ Protobuf å®ç°ä¸­ï¼Œå¯¹äº int32 ç±»å‹çš„æ•°æ®ï¼ŒProtobuf éƒ½ä¼šè½¬ä¸º uint64 è€Œåä½¿ç”¨ Varints ç¼–ç æ¥å¤„ç†ï¼Œå› æ­¤å½“å­—æ®µå¯èƒ½ä¸ºè´Ÿæ•°æ—¶ï¼Œæˆ‘ä»¬åº”ä½¿ç”¨ sint32 æˆ– sint64, è¿™æ · Protobuf ä¼šæŒ‰ç…§ Zigzag ç¼–ç å°†æ•°æ®å˜æ¢åå†é‡‡ç”¨ Varints ç¼–ç è¿›è¡Œå‹ç¼©ï¼Œä»è€Œç¼©çŸ­æ•°æ®çš„äºŒè¿›åˆ¶ä½æ•° </li><li>Protobuf ä¸æ˜¯å®Œå…¨è‡ªæè¿°çš„ä¿¡æ¯æè¿°æ ¼å¼ï¼Œæ¥æ”¶ç«¯éœ€è¦æœ‰ç›¸åº”çš„è§£ç å™¨ï¼ˆå³ proto å®šä¹‰ï¼‰æ‰å¯è§£ææ•°æ®æ ¼å¼ï¼Œåºåˆ—åŒ–åçš„ Protobuf æ•°æ®ä¸æºå¸¦å­—æ®µåï¼Œåªä½¿ç”¨å­—æ®µç¼–å·æ¥æ ‡è¯†ä¸€ä¸ªå­—æ®µï¼Œå› æ­¤æ›´æ”¹ proto çš„å­—æ®µåä¸ä¼šå½±å“æ•°æ®è§£æï¼ˆä½†è¿™æ˜¾ç„¶ä¸æ˜¯ä¸€ç§å¥½çš„è¡Œä¸ºï¼‰, å­—æ®µç¼–å·ä¼šè¢«ç¼–ç è¿›äºŒè¿›åˆ¶çš„æ¶ˆæ¯ç»“æ„ä¸­ï¼Œå› æ­¤æˆ‘ä»¬åº”å°½å¯èƒ½åœ°ä½¿ç”¨å°å­—æ®µç¼–å· </li><li>Protobuf æ˜¯ä¸€ç§ç´§å¯†çš„æ¶ˆæ¯ç»“æ„ï¼Œç¼–ç åå­—æ®µä¹‹é—´æ²¡æœ‰é—´éš”ï¼Œæ¯ä¸ªå­—æ®µå¤´ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šå­—æ®µç¼–å·å’Œ wire type, å­—æ®µå¤´å¯ç¡®å®šæ•°æ®æ®µçš„é•¿åº¦ï¼Œå› æ­¤å…¶å­—æ®µä¹‹å‰æ— éœ€åŠ å…¥é—´éš”ï¼Œä¹Ÿæ— éœ€å¼•å…¥ç‰¹å®šçš„æ•°æ®æ¥æ ‡è®°å­—æ®µæœ«å°¾ï¼Œå› æ­¤ Protobuf çš„ç¼–ç é•¿åº¦çŸ­ï¼Œä¼ è¾“æ•ˆç‡é«˜ </li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="é¢è¯•" scheme="https://silhouettesforyou.github.io/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
    <category term="proto" scheme="https://silhouettesforyou.github.io/tags/proto/"/>
    
  </entry>
  
  <entry>
    <title>ç°ä»£ C++ åŸºç¡€</title>
    <link href="https://silhouettesforyou.github.io/2024/06/03/53/"/>
    <id>https://silhouettesforyou.github.io/2024/06/03/53/</id>
    <published>2024-06-03T06:11:57.000Z</published>
    <updated>2024-06-18T12:45:53.465Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h3 id="Basics-Review">Basics Review</h3><h4 id="Array-Type">Array Type</h4><ul><li>Multidimensional array å¤šç»´æ•°ç»„<ul><li>é™¤äº†ç¬¬ä¸€ç»´å…¶å®ƒç»´å¿…é¡»æ˜ç¡®æŒ‡å‡ºå¤§å°ï¼ˆexplicit sizeï¼‰</li><li>ä¸å¯ä»¥å…¨éƒ¨ decay</li><li>Dynamic allocation<ul><li><code>malloc</code> in C and <code>new</code>/<code>new []</code> in C++</li><li><code>new</code>å’Œ <code>malloc</code> è¿”å›éƒ½æ˜¯æŒ‡é’ˆ</li><li>é‡Šæ”¾</li></ul></li></ul></li></ul><h4 id="Function">Function</h4><ul><li>å‡½æ•°è¿”å›ç±»å‹ä¸èƒ½æ˜¯å‡½æ•°æˆ–è€…æ•°ç»„ï¼ˆä½†æ˜¯å¯ä»¥æ˜¯å®ƒä»¬çš„å¼•ç”¨ï¼‰<ul><li>ä¸åº”è¯¥è¿”å›å±€éƒ¨å˜é‡çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨ï¼ˆè¶…å‡ºäº†å±€éƒ¨å˜é‡ç”Ÿå‘½å‘¨æœŸçš„èŒƒå›´ï¼‰<ul><li>e.g. <code>int&amp; Test() { int a = 1; return &amp;a;}</code></li></ul></li><li>å£°æ˜ä¸º <code>static</code> çš„å±€éƒ¨å˜é‡å…·æœ‰å…¨å±€æ€§</li></ul></li><li>Function pointers å‡½æ•°æŒ‡é’ˆ<ul><li><p><code>void(*)(int)</code></p></li><li><p>clockwise/spiral rule</p></li><li><p>Type alias ç”¨ C++ 11 ä¸­çš„<code>using</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> MyFuncType1 = <span class="built_in">int</span>(*)(<span class="type">float</span>);</span><br><span class="line"><span class="keyword">using</span> MyFuncType2 = <span class="built_in">int</span>(*)(<span class="type">int</span>);</span><br><span class="line"><span class="keyword">using</span> MyFuncType3 = <span class="built_in">int</span>(*)(MyFuncType1);</span><br></pre></td></tr></table></figure></li><li><p>C è¯­è¨€ä¸­å¯ä»¥ç”¨ <code>typedef</code>ï¼Œä½†æ˜¯æ²¡æœ‰<code>using</code> å¼ºå¤§</p></li></ul></li></ul><h4 id="Attribute">Attribute</h4><ul><li><code>[[attribute]]</code> C++ 11ï¼Œ<code>[[attribute("reason")]]</code> C++ 20</li><li><code>[[deprecated]]</code>å’Œ<code>[[deprecated("reason")]]</code> C++ 14</li><li><code>[[noreturn]]</code> C++ 11</li><li><code>[[maybe_unused]]</code> C++ 17</li></ul><p>e.g.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[[nodiscard]] <span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>{<span class="keyword">return</span> a + b; }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">Add</span>(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// int res = Add(1, 2);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>warning: æ”¾å¼ƒå…·æœ‰ [[nodiscard]] å±æ€§å‡½æ•°çš„è¿”å›å€¼</p><h4 id="Enumeration">Enumeration</h4><blockquote><p>ä¸€ä¸ªè¢«é™åˆ¶å–å€¼çš„ç±»</p></blockquote><ul><li>æ¯”è¾ƒåƒä½¿ç”¨å…¨å±€å˜é‡</li><li>åŒæ—¶è¿›è¡Œæ•´å½¢è¿ç®—ä¹Ÿæ²¡æœ‰å®‰å…¨æ£€æŸ¥</li><li>C++ 11 å¼•å…¥äº† scoped enumeration æé«˜å®‰å…¨æ€§</li></ul><p>e.g.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enum Day {Monday};</span></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Day</span> {Monday};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// int a = Monday;</span></span><br><span class="line">    Day a = Day::Monday</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥ä½¿ç”¨ <code>std::underlying_type&lt;Day&gt;::type</code> æˆ–è€…<code>std::underlying_type_t&lt;Day&gt;</code> C++ 14 è½¬æˆæ•´æ•°ç±»å‹<ul><li>C++ 23 ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨<code>std::to_underlying&lt;Day&gt;(day)</code></li></ul></li><li>å¯ä»¥ä½¿ç”¨ <code>Day day{1};</code> åˆå§‹åŒ– C++ 17ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥èµ‹å€¼<code>Day day = 1;</code> æˆ–<code>day = 1;</code></li><li>å¯ä»¥ä½¿ç”¨ä½æ“ä½œç¬¦</li></ul><h4 id="Expression">Expression</h4><ul><li>è¿ç®—ç¬¦å’Œè¡¨è¾¾å¼ä¸‰ä¸ªé‡è¦æ¦‚å¿µ<ul><li>Precedence ä¼˜å…ˆçº§</li><li>Associativity ç»“åˆæ€§</li><li>Order é¡ºåº</li></ul></li><li>From the view of compiler, an expression is in fact a tree, determined by associativity and precedence. e.g. <code>9 / 3 / 2 + 2 * 3</code><ul><li>Precedence is used to split terms first.</li><li>Associativity determines how the tree will grow.</li><li>Then, itâ€™s order of expression evaluation that computes the whole tree. ä½†æ˜¯é¡ºåºæ˜¯ä¸ç¡®å®šçš„<ul><li><code>f1() + f2() + f3()</code>ï¼Œ<code>f1()</code>ï¼Œ<code>f1()</code>ï¼Œ<code>f1()</code>å“ªä¸€ä¸ªå…ˆè¢« evaluated æ˜¯ä¸ç¡®å®šçš„</li></ul></li></ul></li><li>There are some rules<ul><li>For <code>&amp;&amp;</code> and <code>||</code>, since they have short-circuit property, the first part will be fully evaluated.</li><li>For a function call, all parameters (including <code>a</code> for e.g. <code>a.Func()</code> or <code>a-&gt;Func()</code>) are fully evaluated before entering the function.</li><li>ä¸‰ç›®è¿ç®—</li><li>é€—å·è¡¨è¾¾å¼</li><li>C++ 17<ul><li>Parameters in function are evaluated indeterminately, i.e. every sub-tree represented by te parameter is fully evaluated in a <strong>non-overlap</strong> way ä¸ä¼šä»¥äº¤å çš„å½¢å¼ evaluated</li><li>è¿ç®—ç¬¦é‡è½½ï¼Œå’Œ build-in è¿ç®—ç¬¦çš„ evaluated é¡ºåºä¸€è‡´ï¼Œè€Œä¸æ˜¯è¢«å½“ä½œæ™®é€šå‡½æ•°</li><li>More useful examples: chained call</li></ul></li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::string s = <span class="string">"I have it even works if you don't believe"</span>;</span><br><span class="line">s.<span class="built_in">replace</span>(<span class="number">0</span>, <span class="number">8</span>, <span class="string">""</span>).<span class="built_in">replace</span>(s.<span class="built_in">find</span>(<span class="string">"even"</span>), <span class="number">4</span>, <span class="string">"sometimes"</span>).<span class="built_in">replace</span>(s.<span class="built_in">find</span>(<span class="string">"you don't"</span>), <span class="number">9</span>, <span class="string">"I"</span>);</span><br></pre></td></tr></table></figure><h3 id="class">class</h3><h4 id="Ctor-Dtor">Ctor &amp; Dtor</h4><ul><li>æ‹·è´æ„é€ å‡½æ•°</li><li>èµ‹å€¼æ„é€ å‡½æ•°</li><li>The recommended way is member initializer list:<ul><li><code>member1{...}, member2{...}, ... {/* function body */}</code></li><li><code>{}</code> is used since C++ 11</li></ul></li><li>é»˜è®¤æ„é€ å‡½æ•°å»ºè®®ä½¿ç”¨<code>Class() = default;</code></li><li>å¦‚æœæˆå‘˜å˜é‡æœ‰é»˜è®¤å€¼ï¼Œå°±ä¸å»ºè®®ä½¿ç”¨ä¸Šé¢çš„æ„é€ å‡½æ•°çš„å½¢å¼ï¼Œè€Œæ˜¯ç›´æ¥ç”¨é»˜è®¤å€¼åˆå§‹åŒ–</li></ul><h4 id="Initialization-of-Object">Initialization of Object</h4><ul><li>Since C++ 11, Uniform Initialization is introduced<ul><li>æ‰€æœ‰çš„åˆå§‹åŒ–éƒ½å¯ä»¥ç”¨<code>{}</code></li><li>ç›¸æ¯”äº <code>()</code> æ›´å®‰å…¨ Narrowing Conversion ç¼©çª„å˜æ¢æ£€æŸ¥<ul><li>the converted type cannot represent all values<ul><li><code>uint32_t</code>ç±»å‹ç”¨ <code>uint16_t</code> åˆå§‹åŒ–ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™</li></ul></li><li>the facilitates type safety</li></ul></li></ul></li><li>Value initialization: No parameter for initialization <code>T a()</code>ï¼Œ <code>T a{}</code>ï¼Œ <code>new T{}</code>ï¼Œ <code>new T()</code></li><li>Direct initialization: <code>T a(x, y, ...)</code>ï¼Œ<code>T(x, y, ...)</code>ï¼Œ<code>new T(x, y, ...)</code>ï¼Œ<code>T a{x, y, ...}</code></li><li>Copy initialization: <code>T a = xx;</code>ï¼Œ<code>T a[] = { xx, ...};</code><ul><li>Ctors that use <code>explicit</code> cannot use this way</li><li>Before C++ 17, this also requires available copy ctor.</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> {<span class="keyword">public</span>: <span class="function"><span class="keyword">explicit</span> <span class="title">A</span><span class="params">(<span class="type">int</span> a)</span> </span>{}};</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Func</span><span class="params">(A a)</span> </span>{}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    A a = <span class="number">1</span>;    <span class="comment">// error</span></span><br><span class="line">    A a = <span class="built_in">A</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">Func</span>(<span class="number">1</span>);    <span class="comment">// error</span></span><br><span class="line">    <span class="built_in">Func</span>(<span class="built_in">A</span>(<span class="number">1</span>)); </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><ul><li>List initialization</li><li>Aggregate initialization</li></ul><h4 id="Member-Functions">Member Functions</h4><ul><li>æ‰€æœ‰çš„æˆå‘˜å‡½æ•°éƒ½éšå¼æœ‰ä¸€ä¸ª <code>this</code> æŒ‡é’ˆ</li><li>å¦‚æœæœŸæœ›å‡½æ•°ä¸èƒ½æ›´æ”¹æˆå‘˜å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ <code>const</code> å…³é”®å­— make <code>this</code> to be <code>const</code></li><li>é™æ€æˆå‘˜å‡½æ•°<ul><li>æ²¡æœ‰ <code>this</code> æŒ‡é’ˆ</li></ul></li></ul><h4 id="Access-Control">Access Control</h4><ul><li><code>private</code>ã€<code>protected</code>ã€<code>public</code>ï¼Œé»˜è®¤æ˜¯<code>private</code></li><li><code>protected</code>ç”¨åœ¨ç»§æ‰¿ä¸­</li><li>å‹å…ƒ</li></ul><h4 id="Inheritance">Inheritance</h4><ul><li>å­ç±» / æ´¾ç”Ÿç±»ã€çˆ¶ç±» / åŸºç±»</li><li>å­ç±» / æ´¾ç”Ÿç±»å¯ä»¥è®¿é—®çˆ¶ç±»ä¸­æ‰€æœ‰ <code>public</code> å’Œ<code>protected</code>æˆå‘˜</li><li>ç»§æ‰¿å’Œç»„åˆ</li><li>æ´¾ç”Ÿç±»å¯ä»¥éšå¼çš„è½¬åŒ–æˆåŸºç±»</li></ul><h5 id="Slicing-Problem">Slicing Problem</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    Student student1{...}, student2{...};</span><br><span class="line">    Person&amp; student1Ref = student1;</span><br><span class="line">    student1Ref = student2;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><ul><li>There exists implicit conversion in <code>student1Ref = student2</code> so actually it calls <code>Person::operator=(const Person&amp;)</code></li><li>Can decorating <code>operator=</code> with <code>virtual</code> help<ul><li><code>Person::operator=</code> needs <code>const Person&amp;</code> but <code>Student::operator=</code> accepts <code>const Student&amp;</code> å‚æ•°éƒ½ä¸ä¸€æ ·ï¼Œè™šå‡½æ•°éƒ½ä¸ç”Ÿæ•ˆ</li></ul></li><li>This is called â€œslicingâ€ because such operation will only affect the base slice but not the initial object as whole åªå½±å“äº†ä¸€å°ç‰‡</li><li>Polymorphic base class should hide their copy &amp; move functions if it has data member, otherwise deleting them å¯¹äºå…·æœ‰å¤šæ€å±æ€§çš„åŸºç±»ï¼Œåº”è¯¥éšè—å®ƒä»¬çš„æ‹·è´å’Œç§»åŠ¨å‡½æ•°</li><li>Make copy &amp; move functions <code>protected</code> so derived class can call them</li></ul><h5 id="Multiple-Inheritance">Multiple Inheritance</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Elephant</span> {};</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Seal</span> {};</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElephantSeal</span> : <span class="keyword">public</span> Elephant, <span class="keyword">public</span> Seal {};</span><br></pre></td></tr></table></figure><ul><li>Dreaded diamond</li><li>C++ introduces virtual inheritance<ul><li>All virtual bases will be merged and seen as the same</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> {<span class="keyword">public</span>: <span class="type">int</span> weight; };</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Elephant</span> : <span class="keyword">public</span> <span class="keyword">virtual</span> Animal {};</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Seal</span> : <span class="keyword">virtual</span> <span class="keyword">public</span> Animal {}; <span class="comment">// virtual å’Œ public é¡ºåºæ˜¯ä¸é‡è¦çš„</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElephantSeat</span> : <span class="keyword">public</span> Elephant, <span class="keyword">public</span> Seal {};</span><br></pre></td></tr></table></figure><ul><li>That is, you define many ABCs, which tries to reduce data members and non-pure-virtual member functions as much as you can å®šä¹‰å¾ˆå¤šæŠ½è±¡ç±»ï¼Œå°½å¯èƒ½å‡å°‘æˆå‘˜å˜é‡å’Œéçº¯è™šå‡½æ•°çš„æ•°é‡ï¼Œæœ€å¥½æ˜¯æ²¡æœ‰</li><li>They usually denote â€œ-ableâ€ functionality è¿™æ ·å±•ç°å‡ºæ¥çš„å°±æ˜¯å°±æœ‰æŸç§èƒ½åŠ›</li></ul><h4 id="Polymorphism- å¤šæ€">Polymorphism å¤šæ€</h4><ul><li>you can use the base class to load the derived object and call tis own methods ä½¿ç”¨åŸºç±»çš„æŒ‡é’ˆ / å¼•ç”¨ï¼Œæ‰¿è½½æ´¾ç”Ÿç±»çš„å¯¹è±¡ï¼Œä»è€Œè°ƒç”¨æ´¾ç”Ÿç±»çš„æ–¹æ³•</li><li>virtual pointer and virtual table</li><li>Every object whose class has a virtual method will have a virtual pointer, which points to virtual table of its class æ¯ä¸ªç±»ä¸­éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘è™šè¡¨çš„æŒ‡é’ˆï¼Œè™šè¡¨å†…å®¹å°±æ˜¯å£°æ˜ä¸º <code>virtual</code> å‡½æ•°çš„åœ°å€</li><li>In C++ 11, itâ€™s recommended to use <code>override</code> å­ç±»æ²¡æœ‰ <code>override</code> ç¼–è¯‘å™¨ä¼šæŠ¥é”™</li><li><code>final</code> It means override, and the derived class cannot override again ç»§æ‰¿é“¾ä¸­çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹<ul><li><code>class A final {...};</code> è®©ç±»ä¸èƒ½è¢«ç»§æ‰¿</li><li>å»è™šåŒ–ï¼Œç¼–è¯‘ä¼˜åŒ–</li></ul></li><li><code>abstract class</code> æŠ½è±¡ç±»<ul><li>æŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–</li><li>å¯ä»¥æ˜¯ä½¿ç”¨æŠ½è±¡ç±»çš„æŒ‡é’ˆï¼ŒæŒ‡å‘çš„éƒ½æ˜¯æ´¾ç”Ÿç±»çš„å¯¹è±¡</li><li>C++ é€šè¿‡çº¯è™šå‡½æ•°å®ç°æŠ½è±¡ç±» <code>virtual void PrintInfo() const = 0;</code></li><li>æ´¾ç”Ÿç±»ç»§æ‰¿è‡ªæŠ½è±¡ç±»å¿…é¡»å®ç°çº¯è™šå‡½æ•°ï¼Œå¦åˆ™ä»ç„¶æ˜¯æŠ½è±¡ç±»</li><li>Donâ€™t call <strong>any</strong> virtual function and any function that calls virtual function in ctor &amp; dtor åœ¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­ä¸è¦è°ƒç”¨ä»»ä½•è™šå‡½æ•°ï¼Œä¹Ÿä¸è¦æ‰è°ƒç”¨ä»»ä½•å¯èƒ½è°ƒç”¨è™šå‡½æ•°çš„å‡½æ•°</li><li>You should usually make dtor of base class <code>virtual</code> é€šå¸¸å°†ææ„å‡½æ•°å£°æ˜ä¸ºè™šå‡½æ•°<ul><li>deleting <code>Base*</code> that cast from <code>Derived*</code> will lead to correct dtor æ´¾ç”Ÿç±»æŒ‡é’ˆèµ‹ç»™åŸºç±»ï¼Œå½“è°ƒç”¨ <code>delete</code> æ—¶ï¼Œå¦‚æœä¸åŸºç±»ä¸æ˜¯è™šææ„å‡½æ•°ï¼Œå°±ä¼šè°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°</li></ul></li><li>æ„é€ å‡½æ•°ä¸èƒ½æ˜¯çº¯è™šå‡½æ•°</li></ul></li></ul><h4 id="Some-Covert-Facts-in-Inheritance">Some Covert Facts in Inheritance</h4><ul><li><code>override</code>ä¸æ­¢è¡¨ç¤ºå¤å†™è™šå‡½æ•°çš„å«ä¹‰ï¼Œå¯¹äºéè™šå‡½æ•°çš„å¤å†™ä¹Ÿå«â€œoverrideâ€</li><li><code>private</code> inheritance usually denotes the relation of <strong>has-a</strong></li><li>è™šå‡½æ•°çš„è¿”å›ç±»å‹å¯ä»¥æœ‰äº›è®¸æ”¹å˜ï¼šyou can use <code>Base*</code> to both accept <code>Base*</code> and <code>Derived*</code> å¤å†™è™šå‡½æ•°çš„è¿”å›å€¼å¯ä»¥æ˜¯æŒ‡å‘åŸºç±»çš„æŒ‡é’ˆï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡å‘æ´¾ç”Ÿç±»çš„æŒ‡é’ˆ<ul><li>æ™ºèƒ½æŒ‡é’ˆä¸èƒ½æœ‰â€œåå˜â€</li></ul></li><li>å½“è™šæ–¹æ³•æœ‰é»˜è®¤å‚æ•°çš„æ—¶å€™ï¼Œç”¨ä»€ä¹ˆç±»å‹çš„æŒ‡é’ˆè°ƒç”¨æ—¶ï¼Œå°±ä¼šè¿”å›è¯¥ç±»å‹å†…çš„é»˜è®¤å€¼<ul><li>é»˜è®¤çš„å‚æ•°åœ¨ç¼–è¯‘æœŸé—´è¢«è¯†åˆ«ï¼Œè™šè¡¨æ˜¯åœ¨è¿è¡Œæ—¶è·³è½¬çš„</li></ul></li></ul><p>e.g.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Parent::Go</span><span class="params">(<span class="type">int</span> i = <span class="number">2</span>)</span> </span>{std::cout &lt;&lt; <span class="string">"Base's go with i = "</span> &lt;&lt; i &lt;&lt; <span class="string">"\n"</span>; }</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Child::Go</span><span class="params">(<span class="type">int</span> i = <span class="number">4</span>)</span> </span>{std::cout &lt;&lt; <span class="string">"Derived's go with i ="</span> &lt;&lt; i &lt;&lt; <span class="string">"\n"</span>; }</span><br><span class="line"></span><br><span class="line">Child child;</span><br><span class="line">child.<span class="built_in">Go</span>(); <span class="comment">// Derived's go with i = 4</span></span><br><span class="line">Parent&amp; childRef = child;</span><br><span class="line">childRef.<span class="built_in">Go</span>();  <span class="comment">// Base's go with i = 2</span></span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥æ›´æ”¹è™šæ–¹æ³•çš„è®¿é—®å±æ€§ï¼ˆä½†æ˜¯ä¸å»ºè®®ï¼‰</li></ul><h3 id="struct"><code>struct</code></h3><ul><li>å’Œ <code>class</code> åŸºæœ¬ä¸Šä¸€æ ·ï¼Œé™¤äº† <code>struct</code> é»˜è®¤çš„è®¿é—®æ§åˆ¶æ˜¯<code>public</code><ul><li>ä¸åº”è¯¥æœ‰æˆå‘˜å‡½æ•°ï¼Œæœ€å¤šæœ‰ ctorã€dtor å’Œè¿ç®—ç¬¦é‡è½½</li><li>With these constraints (except for ctor), <code>struct</code> will be an aggregate, which can use aggregate initialization<ul><li>Since C++ 20, aggregate can also use <strong>designated initialization</strong> æŒ‡å®šåˆå§‹åŒ–</li></ul></li></ul></li></ul><p>e.g.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Priority</span> {<span class="type">int</span> cal; }</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> x, y;</span><br><span class="line">    Priority priority[<span class="number">2</span>];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    Point p{.x = <span class="number">1</span>, .y = <span class="number">2</span>, .priority = {{ .val = <span class="number">1</span>}, {.val = <span class="number">2</span> } } };</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="Function-Overloading- å‡½æ•°é‡è½½">Function Overloading å‡½æ•°é‡è½½</h3><ul><li>C++ ä¸­å°±æ˜¯ç›¸åŒçš„å‡½æ•°åä¸åŒçš„å‚æ•°<ul><li>C ä¸­æ˜¯ç¦æ­¢çš„</li></ul></li><li>This is done by compilers using a technique called <strong>name mangling</strong></li><li>Operator Overloading è¿ç®—ç¬¦é‡è½½<ul><li><code>+</code>ï¼Œ<code>-</code>ï¼Œ<code>*</code>ï¼Œ<code>/</code>ï¼Œ<code>%</code>ï¼Œ<code>|</code>ï¼Œ<code>&amp;</code>ï¼Œ<code>^</code>ï¼Œ<code>&lt;&lt;</code>ï¼Œ<code>&gt;&gt;</code>ï¼šæ¨èä½¿ç”¨åœ¨å…¨å±€å‡½æ•°ä¸­</li><li><code>+=</code>ï¼Œ<code>-=</code>ï¼Œ<code>*=</code>ï¼Œ<code>/=</code>ï¼Œ<code>|=</code>ï¼Œ<code>&amp;=</code>ï¼Œ<code>^=</code>ï¼Œ<code>&lt;&lt;=</code>ï¼Œ<code>&gt;&gt;=</code>ï¼šå¿…é¡»æ˜¯æˆå‘˜å‡½æ•° since the first operand must be a â€œnamedâ€ object; return reference (i.e. <code>*this</code>)</li><li>Prefix<code>++</code> &amp; Prefix<code>--</code>ï¼šå¿…é¡»æ˜¯æˆå‘˜å‡½æ•° return <code>*this</code></li><li>Postfix<code>++</code> &amp; Postfix<code>--</code> have an unused parameter int, which is used to distinguish the prefix and postfix</li><li><code>*</code>ï¼Œ<code>-&gt;</code>ï¼šusually used in e.g. some wrapper of pointers</li><li><code>&amp;&amp;</code>ï¼Œ<code>||</code>ï¼šshort-circuit ç‰¹æ€§ä¼šå¤±æ•ˆ</li><li><code>&lt;=&gt;</code>ï¼šä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦</li><li><code>()</code></li><li><code>[]</code><ul><li>Since C++ 23, you can use multidimensional subscript in <code>operator[]</code></li></ul></li></ul></li></ul><h3 id="Lambda-Expression">Lambda Expression</h3><ul><li>æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŒ¿åçš„ <code>struct</code>ï¼Œé‡è½½äº†<code>operator() const</code> æ–¹æ³•</li><li>Basic format: <code>auto func = [captures](params) -&gt; ReturnType {function body;};</code><ul><li>Captures are actually members of the <code>struct</code></li><li>ReturnType, params and function are for <code>operator()</code></li><li>Every lambda expression has its unique type</li><li>ä¸ä¼ ä»»ä½•å‚æ•° <code>()</code> å¯ä»¥çœç•¥æ‰</li></ul></li><li>å»ºè®®å°† Lambda è¡¨è¾¾å¼ä¸­çš„æ•è·çš„ä¸œè¥¿æ˜ç¡®å†™å‡ºæ¥</li><li>static å’Œ global å˜é‡æ˜¯ä¸éœ€è¦è¢«æ•è·çš„</li><li>æ•è· <code>this</code> æŒ‡é’ˆ<ul><li><code>this</code> by reference, since only copy pointer</li><li><code>*this</code> really copy all members</li><li>åŒ…æ‹¬ç§æœ‰æˆå‘˜ä¹Ÿå¯ä»¥æ•è·</li></ul></li><li>You may add specifiers after <code>()</code><ul><li><code>mutable</code>: since C++ 17, remove <code>const</code> in <code>operator()</code></li><li><code>static</code>: since C++ 23, same as <code>static operator()</code></li><li><code>constexpr</code>ã€<code>consteval</code>ã€<code>noexcept</code></li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">auto</span> m = [i] {i = <span class="number">1</span>; <span class="keyword">return</span> <span class="number">0</span>; }; <span class="comment">// ä¸å…è®¸ä¿®æ”¹ i = 1ï¼Œå› ä¸ºé‡è½½çš„ operator() æ˜¯ const</span></span><br><span class="line">    <span class="keyword">auto</span> m = [i]() <span class="keyword">mutable</span> {i = <span class="number">1</span>; <span class="keyword">return</span> <span class="number">0</span>; }; <span class="comment">// ä¿®æ”¹çš„ä¸æ˜¯å¤–é¢å®šä¹‰çš„å˜é‡ï¼Œæœ¬è´¨ä¸Šä¿®æ”¹çš„æ˜¯ i çš„æ‹·è´</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><ul><li>Itâ€™s also legal to add attributes between <code>[]</code> and <code>()</code></li><li>å‡½æ•°ä¹Ÿå¯ä»¥å†™æˆ Lambda è¡¨è¾¾å¼çš„å½¢å¼ <code>auto Foo(params) -&gt; ReturnType {function body;}</code></li></ul><p>Code Block With Initializer</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> it = table.<span class="built_in">find</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> (it == table.<span class="built_in">end</span>())</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="comment">//</span></span><br></pre></td></tr></table></figure><ul><li><code>it</code>ä¼šæ³„éœ²å‡ºå»ï¼Œä¸‹é¢å¦‚æœç»§ç»­åˆ¤æ–­ä¼šå†å®šä¹‰è¿­ä»£å™¨ç±»å‹çš„å˜é‡</li><li>Since C++ 17, you mey code like</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">auto</span> it = table.<span class="built_in">find</span>(<span class="number">1</span>); it == table.<span class="built_in">end</span>())</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="comment">//</span></span><br></pre></td></tr></table></figure><ul><li>Since C++ 20, range-based for loop can also add an additional initializer, e.g. <code>for (auto vec = GetVec(); auto&amp; m : vec);</code></li><li>Since C++ 23, type alias declaration can also be initializer, e.g. <code>if (using T = xx; ...)</code></li></ul><h3 id="Template">Template</h3><ul><li>Since C++ 17, CATD(class template argument deduction) is introduced, meaning that the argument of ctor can deduce the template parameter of class. e.g. <code>std::vector v{1, 2, 3, 4}</code></li><li>Lambda expression can also use template</li></ul><h2 id="Container">Container</h2><ul><li><code>std::size_t</code>: the type of <code>sizeof()</code> æ„å‘³ç€å¯¹è±¡çš„å¤§å°ä¸èƒ½è¶…è¿‡ <code>std::size_t</code> æ‰€è¡¨ç¤ºçš„èŒƒå›´<ul><li>ä¹Ÿæ„å‘³ç€æ•°ç»„çš„å¤§å°ä¸èƒ½è¶…è¿‡ <code>std::size_t</code> æ‰€è¡¨ç¤ºçš„èŒƒå›´</li><li>å®¹å™¨çš„å¤§å°ä¹Ÿä¸èƒ½è¶…è¿‡<code>std::size_t</code></li></ul></li><li><code>std::ptrdiff_t</code>ï¼šä¸¤ä¸ªæŒ‡é’ˆç›¸å‡å¾—åˆ°çš„ç±»å‹</li></ul><h3 id="Iterators">Iterators</h3><ul><li>Input/Output iterator<ul><li>For output <code>*it = val</code>, <code>it++</code>, <code>++it</code>, â€˜it1 = it2â€™</li><li>For input <code>==</code>, <code>!=</code>, <code>-&gt;</code></li></ul></li><li>Forward iterator: e.g. linked list</li><li>Bidirectional iterator: <code>--it</code>, <code>it--</code> e.g. double linked list, map</li><li>Random access iterator: <code>+</code>, <code>-</code>, <code>+=</code>, <code>-=</code>, <code>[]</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>!=</code> e.g. deque</li><li>Contiguous iterator (since C++ 17): ä¿è¯åœ°å€ç©ºé—´æ˜¯è¿ç»­çš„</li><li><strong>IMPORTANT</strong>: Iterator are as unsafe as pointers çº¿ç¨‹ä¸å®‰å…¨çš„</li><li>All containers can get their iterators by:<ul><li><code>.begin()</code>, <code>.end()</code></li><li><code>.cbegin()</code>, <code>cend()</code> read-only access</li></ul></li><li>åŒå‘é“¾è¡¨ç­‰è¿˜æä¾›äº†å€’åºçš„éå†è¿­ä»£å™¨<ul><li><code>.rbegin()</code>, <code>.rend()</code>, <code>.crbegin()</code>, <code>crend()</code></li></ul></li><li>è¿˜å¯ä»¥ä½¿ç”¨å…¨å±€çš„æ–¹æ³•å¾—åˆ°è¿­ä»£å™¨<ul><li><code>std::begin(vec)</code>, <code>std::end(vec)</code></li><li>C++ 20 å»ºè®®ä½¿ç”¨<code>std::ranges::begin</code></li><li>åªæœ‰ç±»ä¼¼ <code>int arr[5]</code> ä¼ å…¥åˆ° <code>std::begin()</code> æˆ–<code>std::end()</code>ä¸­æ‰æœ‰æ•ˆï¼ŒæŒ‡é’ˆä¼ å…¥è¿›æ¥æ˜¯æ— æ•ˆçš„</li></ul></li><li>There are also general methods of iterator operations, defined in <code>&lt;iterator&gt;</code><ul><li><code>std::advance(InputIt&amp; it, n)</code>: <code>it += n</code></li><li><code>std::next(InputIt it, n = 1)</code>: <code>return it + n</code></li><li><code>std::prev(InputIt it, n = 1)</code>: <code>return it - n</code></li><li><code>std::distance(InputIt it1, InputIt it2)</code>: <code>return it2 - it1</code> ä¸åŒçš„å®¹å™¨æ—¶é—´å¤æ‚åº¦ä¸ä¸€æ ·</li></ul></li></ul><h4 id="Iterator-traitsï¼ˆæ˜¾è‘—çš„ç‰¹ç‚¹ï¼Œç‰¹å¾ï¼‰">Iterator traitsï¼ˆæ˜¾è‘—çš„ç‰¹ç‚¹ï¼Œç‰¹å¾ï¼‰</h4><ul><li>Iterators provide some types to show their information:<ul><li><code>value_type</code>: The type of elements referred to</li><li><code>difference_type</code>: The type that can be used to represent the distance between elements (usually <code>ptrdiff_t</code>) è¿­ä»£å™¨ä¹‹é—´çš„è·ç¦»æ‰€è¡¨ç¤ºçš„ç±»å‹ï¼Œä¸€èˆ¬å°±æ˜¯<code>ptrdiff_t</code></li><li><code>iterator_category</code>: e.g. <code>input_iterator_tag</code>, <code>continuous_iterator_tag</code></li><li><code>pointer</code> &amp; <code>reference</code>: only available in container iterators åªæœ‰åœ¨å®¹å™¨ä¸­æ‰ä¼šæœ‰çš„ç‰¹æ€§<ul><li>å¯ä»¥ä½¿ç”¨ <code>std::iterator_traits&lt;IteratorType&gt;::xxx</code> è·å–</li></ul></li></ul></li></ul><h4 id="Stream-iterator">Stream iterator</h4><ul><li><code>std::istream_iterator&lt;T&gt;</code> &amp; <code>std:ostream_iterator&lt;T&gt;</code></li><li>The default constructed <code>istream_iterator</code> is <code>end()</code> é»˜è®¤çš„æ„é€ å‡½æ•°è¡¨ç¤ºç»ˆæ­¢çš„è¿­ä»£å™¨</li></ul><h4 id="Iterator-adaptor">Iterator adaptor</h4><p>æœ‰ä¸¤ç§ç±»å‹çš„è¿­ä»£å™¨é€‚é…å™¨</p><ul><li>One is created from iterators to preform different utilities:<ul><li>E.g. reversed iterators åå‘è¿­ä»£å™¨ï¼Œ++ çš„æœ¬è´¨ä¸Šæ˜¯ --ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ <code>begin()</code> åˆå§‹åŒ–ï¼Œå³<code>std:::reverse_iterator r{p.begin() }</code></li><li>You can get the underlying iterator by <code>.base()</code>, which actually returns the iterator that points to the elements after the referred one è°ƒç”¨ <code>.base()</code> å®é™…ä¸Šæ˜¯æŒ‡å‘å½“å‰æŒ‡å‘ä½ç½®çš„ä¸‹ä¸€ä¸ªå…ƒç´ <ul><li><code>rbegin().base() == end()</code></li></ul></li></ul></li><li>Another is created from containers to work more than â€œiterateâ€<ul><li><code>std::back_insert_iterator{container}</code>: <code>*it = val</code> will call <code>push_back(val)</code> to insert</li><li><code>std:front_insert_iterator{container}</code>: call <code>push_front(val)</code> to insert</li><li><code>std::insert_iterator{container, pos}</code>: call <code>insert(pos, val)</code> to insert</li></ul></li><li>Notice that inserting/assigning a range directly is usually better than inserting one by one for <code>vector</code> or <code>deque</code></li></ul><h3 id="Sequential-Container">Sequential Container</h3><h4 id="Array">Array</h4><ul><li>E.g. <code>int a[5]</code> will decay to <code>int*</code> when passing to function, and the size information is dropped ä»¥å‚æ•°çš„æ–¹å¼ä¼ é€’åˆ°å‡½æ•°ä¸­ä¼šé€€åŒ–æˆæŒ‡é’ˆï¼Œå¹¶ä¸”å¤§å°ä¹Ÿè¢«èˆå¼ƒäº†</li><li><code>std::array&lt;T, size&gt;</code> the same as <code>T[size]</code>. It always preserves size, can copy from another array, and can do more things like bound check</li><li>Itâ€™s allocated on stack<ul><li>But if you <code>new std::array</code>, then it;s still allocated on heap</li></ul></li><li>ç‰¹æ®Šçš„æ„é€ å‡½æ•°éœ€è¦é¢å¤–çš„ <code>{}</code> e.g. <code>struct S {int i; int j;}</code> åˆå§‹åŒ–æ—¶æ˜¯<code>std::array&lt;S, 2&gt; arr{{{1, 2}, {3, 4}}}</code><ul><li>ç¬¬ä¸€ä¸ª <code>{}</code> æ˜¯<code>array</code>æœ¬èº«åˆå§‹åŒ–çš„<code>{}</code></li><li>ç¬¬äºŒä¸ª <code>{}</code> æ˜¯æ•°ç»„åˆå§‹åŒ–çš„<code>{}</code></li></ul></li><li>For member accessing æˆå‘˜è®¿é—®<ul><li><code>operator[]</code></li><li><code>at()</code> will check the bound</li><li><code>front()</code>, <code>back()</code>: get the first/last element of vector é¦–å…ˆè¦ä¿è¯éç©º</li><li>If you want to get the raw pointer of array content, you can use <code>.data()</code></li></ul></li><li>Additional methods<ul><li><code>.swap()</code></li><li><code>operator=</code>, <code>operator&lt;=&gt;</code> ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦</li><li><code>.fill()</code> å°†æ•´ä¸ªæ•°ç»„å¡«å……ä¸ºæŸä¸ªç‰¹å®šå€¼</li><li><code>std::to_array</code>(C-style array)</li></ul></li><li>Size operations<ul><li><code>.size()</code>: return <code>size_t</code></li><li><code>empty()</code></li><li><code>.max_size()</code>: get maximum possible size in this system(usually useless)</li></ul></li></ul><h4 id="vector">vector</h4><ul><li>åŠ¨æ€æ•°ç»„<ul><li>æ”¯æŒéšæœºè®¿é—®ï¼Œå æ®è¿ç»­ç©ºé—´</li><li>When inserting and removing elements at the end (i.e. pushing/poping back), the complexity is amortizedï¼ˆå‡æ‘Šï¼‰ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li>If not at end, itâ€™ll be <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li></ul></li><li>åœ¨ cache ä¸Šçš„æ•ˆæœéå¸¸ä¸é”™ï¼Œå¯¹ cache åˆ©ç”¨ç‡éå¸¸æ˜¾è‘—</li><li>å®ç°æ€è·¯<ul><li>å‡†å¤‡ä¸€éƒ¨åˆ†ç©ºé—´ï¼Œè¿™æ ·åœ¨ pushing æˆ–è€… poping çš„æ—¶å€™æ—¶é—´å¤æ‚åº¦æ‰æ˜¯<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li>å½“å®¹é‡ä¸å¤Ÿçš„æ—¶å€™åœ¨é‡æ–°åˆ†é…ï¼ˆreallocationï¼‰ï¼Œé‡åˆ†é…çš„å‡æ‘Šå¤æ‚åº¦ä¹Ÿè¦æ±‚æ˜¯<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li>The element number is called size; total space is called capacity</li><li>é‡åˆ†é…çš„ç­–ç•¥<ul><li>The easiest strategy is increasing space linearly<ul><li>E.g. 0 -&gt; 4 -&gt; 8 -&gt; 12 -&gt; 16 -&gt; â€¦</li><li>Every <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewbox="0 -694 521 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g></g></svg></mjx-container> operations will trigger reallocation an copy <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="7.54ex" height="1.756ex" role="img" focusable="false" viewbox="0 -694 3332.6 776"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(877.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(1933.6,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mi" transform="translate(2454.6,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g></g></g></svg></mjx-container> elements<ul><li>So, the amortized complexity is <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.798ex;" xmlns="http://www.w3.org/2000/svg" width="26.843ex" height="3.38ex" role="img" focusable="false" viewbox="0 -1141.1 11864.5 1493.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mfrac" transform="translate(1167,0)"><g data-mml-node="mrow" transform="translate(220,582.8) scale(0.707)"><g data-mml-node="munderover"><g data-mml-node="mo"><path data-c="2211" d="M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z"/></g><g data-mml-node="mi" transform="translate(1089,477.1) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="TeXAtom" transform="translate(1089,-285.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mn" transform="translate(1123,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2453.3,0)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mi" transform="translate(521,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g></g><g data-mml-node="mrow" transform="translate(898.9,-345) scale(0.707)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mi" transform="translate(521,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g></g><rect width="2547.1" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(3954.1,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(4620.9,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(5676.7,0)"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(6454.7,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(6843.7,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(7721.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(8388.4,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(9444.2,0)"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(10222.2,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mfrac" transform="translate(10611.2,0)"><g data-mml-node="mi" transform="translate(220,394) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mi" transform="translate(247.9,-345) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><rect width="624.3" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(11475.5,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li>Considering that <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewbox="0 -694 521 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g></g></svg></mjx-container> is an constant, this is still <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li></ul></li></ul></li><li>So, what about exponentiallyï¼ˆæŒ‡æ•°ï¼‰?<ul><li>E.g. 1 -&gt; 2 -&gt; 4 -&gt; 8 -&gt; 16 -&gt; 32 -&gt; â€¦</li><li>Every <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.152ex" height="1.932ex" role="img" focusable="false" viewbox="0 -853.7 951.4 853.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g></g></g></svg></mjx-container> operations will trigger reallocation an copy <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="6.527ex" height="2.117ex" role="img" focusable="false" viewbox="0 -853.7 2885 935.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(877.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msup" transform="translate(1933.6,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g></g></g></svg></mjx-container> elements<ul><li>So, the amortized complexity is <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.885ex;" xmlns="http://www.w3.org/2000/svg" width="17.432ex" height="3.752ex" role="img" focusable="false" viewbox="0 -1267.1 7705 1658.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mfrac" transform="translate(1167,0)"><g data-mml-node="mrow" transform="translate(220,582.8) scale(0.707)"><g data-mml-node="munderover"><g data-mml-node="mo"><path data-c="2211" d="M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z"/></g><g data-mml-node="mi" transform="translate(1089,477.1) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="TeXAtom" transform="translate(1089,-285.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mn" transform="translate(1123,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2453.3,0)"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g></g></g><g data-mml-node="msup" transform="translate(1043.4,-391.4) scale(0.707)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,289) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g><rect width="2519.5" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(3926.5,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(4593.3,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(5649,0)"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(6427,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(6816,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(7316,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li></ul></li></ul></li><li>Finally, why is the exponent 2?<ul><li>å¯ä»¥è¯æ˜ä»»ä½•å¤§äº 1 çš„æŒ‡æ•°æœ€åçš„å‡æ‘Šå¤æ‚åº¦éƒ½æ˜¯<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li>This is a trade-off between space and time ç©ºé—´å’Œæ—¶é—´çš„æƒè¡¡</li><li>In MSï¼ˆå¾®è½¯ï¼‰, itâ€™s 1.5</li></ul></li></ul></li><li>vector ä¸ä¼šè‡ªåŠ¨çš„è¿›è¡Œç¼©å®¹ï¼ˆshrinkï¼‰ï¼Œä½†æ˜¯ä¼šæš´éœ²å‡ºæ¥å£æ‰‹åŠ¨ç¼©å®¹</li><li>Insert æ˜¯ä»åå‘å‰çš„ï¼ˆmove backwardsï¼‰</li><li>Removal is similar, but move forwards from the end of deletion to the deletion point, and finally destruct the last several elements</li><li><code>std::initializer_list</code></li><li>For member accessing (same as array)<ul><li>operator[]<code>,</code>at()<code>: accessing by index;</code>at()<code>will check th bound, i.e. if the index is greater than size,</code>std::out_of_range` will be thrown</li><li><code>front()</code>, <code>back()</code>: get the first/last element of vector</li><li>If you want to get the raw pointer of array content, you can use <code>.data()</code></li></ul></li><li>For capacity operations (i.e. adjust memory)<ul><li><code>.capacity()</code>: get capacity (return <code>size_t</code>)</li><li><code>.reserve(n)</code>: ç›´æ¥åˆ†é… <code>n</code> å¤§å°çš„å†…å­˜ï¼Œå¦‚æœæ¯”å½“å‰ capacity å°å°±ä»€ä¹ˆéƒ½ä¸åšï¼Œsize æ˜¯ä¸ä¼šæ”¹å˜çš„<ul><li>ä½œç”¨æ˜¯å‰æçŸ¥é“éœ€è¦åˆ†é…çš„æ•°é‡ï¼Œä¸€æ¬¡æ€§åˆ†é…ï¼Œå°±ä¸éœ€è¦æœ‰æ‰©å®¹çš„æ“ä½œäº†</li></ul></li><li><code>.shrink_to_fit</code>: request to shrink the capacity so that <code>capacity == size</code></li></ul></li><li>For size operations<ul><li><code>.size()</code></li><li><code>.empty()</code></li><li><code>.resize(n, obj = Object{})</code></li><li><code>.clear()</code>: remove all things; size will be 0 after this</li></ul></li><li><code>.push_back(obj)</code></li><li><code>.emplace_back(params)</code>: insert an element constructed by params at the end å°±åœ°æ ¹æ® <code>params</code> æ„é€ å…ƒç´ <ul><li>Since C++ 17, it returns reference of inserted element (before itâ€™s <code>void</code>)</li></ul></li><li><code>.pop_back()</code></li><li><code>.insert(const_iterator pos, xxx)</code></li><li><code>.erase(const_iterator pos)</code>, <code>.erase(const_iterator first, const_iterator last)</code>: erase a single element/elements from <code>[first, last)</code><ul><li>insert/erase will return next valid iterator of inserted/erase elements</li></ul></li><li>Interact with another vector<ul><li><code>.assign</code></li><li><code>.swap(vec)</code></li></ul></li><li>Since C++ 23, ranges-related methods are added<ul><li><code>.assign_range(Range)</code></li><li><code>insert_range(const_iterator pos, Range)</code></li><li><code>append_range(Range)</code></li></ul></li></ul></li></ul><h4 id="Iterator-Invalidation">Iterator Invalidation</h4><ul><li>è¿­ä»£å™¨å°±æ˜¯æŒ‡é’ˆçš„åŒ…è£…ï¼Œä½†æ˜¯æŒ‡é’ˆæ˜¯ä¸å®‰å…¨çš„</li><li>å¯¼è‡´ä¸å®‰å…¨çš„æƒ…å†µ<ul><li>reallocation é‡åˆ†é…ï¼Œé€ æˆåŸæ¥ä¿å­˜çš„æŒ‡é’ˆæ‚¬å‚</li><li>Insertion &amp; removal æ’å…¥å’Œåˆ é™¤</li></ul></li><li>For vector<ul><li><p>If the capacity changes, all iterators are invalid</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    std::vector{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>};</span><br><span class="line">    <span class="keyword">auto</span> it = v.<span class="built_in">begin</span>();</span><br><span class="line">    v.<span class="built_in">reserve</span>(<span class="number">10086</span>); <span class="comment">// ä¼šå¯¼è‡´ä¸Šä¸€è¡Œçš„ `it` å¤±æ•ˆ</span></span><br><span class="line">    it = v.<span class="built_in">begin</span>(); <span class="comment">// å¿…é¡»è¿›è¡Œé‡æ–°è·å–</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure></li><li><p>If the capacity doesnâ€™t change, but some elements are moved, iterators after the changed points are invalid</p></li></ul></li></ul><h4 id="Span">Span</h4><ul><li>è§†å›¾ View means that it doesnâ€™t actually hold the data; it observes the data</li><li>Span is a view for contiguous memory (e.g. vector, array, string, C-style array initializer list, etc.)</li><li>å¯ä»¥åƒ array ä¸€æ ·æ“æ§ span</li><li><code>.first(N)/.last(N)</code></li><li><code>.subspan(beginPos(, size))</code></li><li>span is just a pointer with a size</li></ul><h4 id="Dequeue-Double-Ended-Queue- åŒç«¯é˜Ÿåˆ—">Dequeue Double-Ended Queue åŒç«¯é˜Ÿåˆ—</h4><ul><li>æœ€ä¸»è¦çš„ç‰¹ç‚¹å°±æ˜¯<ul><li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> on insertion &amp; removal of elements at the front or the back</li><li>Random access</li></ul></li><li>Other properties are just like vector<ul><li><code>push_front</code></li><li><code>emplace_front</code></li><li><code>pop_front</code></li><li><code>prepend_range</code> C++ 23</li></ul></li><li>Circular queue<ul><li>When enqueue, tail moves forward</li><li>When dequeue, head moves forward</li><li>If <code>tail == head</code> i.e. the queue is full, overwrite the element at head, both tail and head move forward</li></ul></li><li>Dequeue ç›¸å½“äºåŠ¨æ€çš„å¾ªç¯é˜Ÿåˆ—ï¼Œå½“é˜Ÿåˆ—æ»¡çš„æ—¶å€™éœ€è¦è¿›è¡Œæ‰©å®¹<ul><li>æ‰©å®¹æ˜¯åšåˆ°å‡æ‘Šå¤æ‚åº¦æ˜¯<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li>å¯ä»¥åšåˆ°éšæœºè®¿é—®çš„åŸç†æ˜¯ e.g. <code>deque[i]</code> is just <code>vec[(head + i) % size]</code></li></ul></li><li>å®ç°æ–¹å¼<ul><li>é™ä½æ‹·è´çš„ä»£ä»·</li><li>é€šå¸¸çš„å®ç°æ–¹å¼æ˜¯ä½¿ç”¨åŠ¨æ€å¾ªç¯é˜Ÿåˆ—ï¼ˆcalled mapï¼‰ï¼Œé‡Œé¢çš„å…ƒç´ æ˜¯æŒ‡é’ˆ<ul><li>æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ª blockï¼Œblock ä¸­å­˜å‚¨å¯¹è±¡</li><li>block çš„å¤§å°æ˜¯å›ºå®šçš„</li></ul></li><li>Dequeue ä¸­çš„æ•°æ®ç»“æ„<ul><li>The map and its size</li><li>The block size</li><li>The global offset of the first element <code>off</code><ul><li>We can use <code>off / block_size</code> to know the position of head</li></ul></li><li>Element numbers</li></ul></li><li>é‡æ–°åˆ†é…çš„æ—¶å€™åªéœ€è¦æ‹·è´æŒ‡é’ˆ</li><li>Map reallocation in dequeue<ul><li>å‡è®¾æ–°åŠ çš„ block çš„å¤§å°æ˜¯<code>count</code></li><li>éœ€è¦ä½¿å¾—å¾ªç¯é˜Ÿåˆ—ä»ç„¶æ˜¯è¿ç»­çš„<ul><li>First, copy all elements from <code>vec[head, vecEnd]</code> to <code>newVec[head, currEnd]</code></li><li>Then, if <code>head &lt;= count</code>, copy <code>[0, head)</code> to <code>[currEnd, ...)</code></li><li>Else, copy after <code>currEnd</code> as mush as possible, and the rest is arranged to the <code>newVecBegin</code></li><li>Finally, set all the rest to <code>nullptr</code></li></ul></li></ul></li></ul></li><li>Dequeue iterator invalidation<ul><li>All iterators are seen as invalid after insertion æ’å…¥ä¹‹åæ‰€æœ‰çš„è¿­ä»£å™¨éƒ½æ˜¯å¤±æ•ˆçš„ï¼Œè¿˜åŒ…æ‹¬<ul><li><code>resize</code></li><li><code>shrink_to_fit</code></li><li><code>clear</code></li></ul></li></ul></li></ul><h4 id="List">List</h4><ul><li>Double linked list</li><li>Properties<ul><li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> insertion and removal</li><li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> splice èåˆå¦ä¸€ä¸ª list çš„ä¸€éƒ¨åˆ†å…ƒç´ </li><li>ä¸æ”¯æŒéšæœºè®¿é—®</li></ul></li><li>æ¯ä¸ªèŠ‚ç‚¹éƒ½å·²ä¸€ä¸ªæ•°æ® <code>T data</code>ã€<code>prev</code>ã€<code>next</code>ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„<code>prev</code> æŒ‡å‘ <code>nullptr</code>ï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹çš„<code>next</code> æŒ‡å‘<code>nullptr</code></li><li>å¾®è½¯ç”¨å¾ªç¯ list å®ç°çš„<ul><li>å¼•å…¥äº†å“¨å…µèŠ‚ç‚¹ sentinel nodeï¼Œæ˜¯ <code>prev</code> æŒ‡é’ˆçš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ<code>next</code>æŒ‡é’ˆçš„åä¸€ä¸ªèŠ‚ç‚¹</li><li>ä¸éœ€è¦ç‰¹åˆ¤ nullptr`</li></ul></li><li>There are two methods to move nodes from another list<ul><li>å’Œ <code>insert(pos, it1, it2)</code> æœ‰åŒºåˆ«ï¼Œ<code>insert</code>åªæ˜¯æ‹·è´ï¼Œæ²¡æœ‰æ¸…é™¤æ“ä½œ</li><li><code>.merge(list2)/.merge(list2, cmp)</code>ï¼Œé€šå¸¸ç”¨åœ¨å·²æ’åºçš„ list ä¸­</li><li><code>.splice(pos, list2, ...)</code><ul><li><code>()</code>: insert the total <code>list2</code> to pos</li><li><code>(it2)</code>: insert <code>it2</code> to <code>pos</code> (and remove it from <code>list2</code>)</li><li><code>(first, last)</code>: insert <code>[first, last)</code> to <code>pos</code> (abd remove them from <code>list2</code>)</li></ul></li></ul></li></ul><h4 id="Froward-list">Froward list</h4><ul><li>Single linked list</li><li>Forward list çš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥ä¸æä¾› <code>.size()</code> å‡½æ•°</li><li>åªå­˜å‚¨å¤´éƒ¨èŠ‚ç‚¹</li></ul><h3 id="Container-adaptors">Container adaptors</h3><ul><li>å®¹å™¨é€‚é…å™¨æ˜¯å¯¹å·²ç»å­˜åœ¨çš„å®¹å™¨è¿›è¡ŒåŒ…è£…ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸æä¾›è¿­ä»£å™¨</li></ul><h4 id="Stack">Stack</h4><ul><li>Stack is a LIFO data structure</li><li>The provide container show have <code>push_back</code>, <code>emplace_back</code>, <code>pop_back</code>, so vector, deque and list are all OK</li><li>APIs<ul><li><code>.pop()</code></li><li><code>.push(val)</code>, <code>.emplace(params)</code></li><li><code>.push_range(params)</code> C++ 23</li><li><code>.top()</code></li><li><code>.empty()</code>, <code>.size()</code></li><li><code>.swap(s2)</code></li><li><code>operator=</code></li><li><code>operator&lt;=&gt;</code></li></ul></li></ul><h3 id="Queue">Queue</h3><ul><li>Queue is a FIFO data structure</li><li><code>.front()</code></li><li><code>.end()</code></li></ul><h4 id="Priority-queue">Priority queue</h4><ul><li>Itâ€™s defined in <code>&lt;queue&gt;</code></li><li>Itâ€™s in fact max heap<ul><li>æ’å…¥æˆ–è€…å¼¹å‡ºå…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.167ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 3610 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1152,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(2621,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(3221,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li>å»ºå †çš„æ—¶é—´å¤æ‚åº¦æ˜¯<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li>Percolation is the core algorithm<ul><li>æ’å…¥çš„æ—¶å€™è¿›è¡Œä¸Šæ»¤ percolate up</li><li>åˆ é™¤çš„æ—¶å€™è¿›è¡Œä¸‹æ»¤ percolate down</li></ul></li></ul></li></ul><h4 id="Flat-containers">Flat containers</h4><ul><li>The only defect of map/unordered_map/â€¦ is that theyâ€™re really cache-unfriendly</li><li>Flat containers å¯¹ç¼“å­˜åˆ©ç”¨ç‡æ›´é«˜<ul><li>The functionality is same as set/map</li><li>But itâ€™s in fact an ordered â€œvectorâ€<ul><li>æ²¡æœ‰å†—ä½™çš„æ•°æ®ï¼Œå¯¹ cache æ›´å‹å¥½</li><li>æœ¬è´¨ä¸Šæ˜¯ä¸¤ä¸ª â€œvectorâ€</li></ul></li></ul></li><li>The whole definition is <code>std::flat_map&lt;Key, Value, Compare = std::less&lt;Key&gt;, ContainerForKey = std::vector&lt;Key&gt;, ContainerForValue = std::vector&lt;Value&gt;&gt;</code></li><li>ä¹Ÿå¯ä»¥ä½¿ç”¨ deque ä½œä¸ºå®¹å™¨</li><li>The complexity<ul><li>For lookup, <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.819ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 3898 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1152,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(2621,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(3509,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> äºŒåˆ†æŸ¥æ‰¾</li><li>For insertion/removal, <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li>For <code>iterator++</code>, <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li></ul></li></ul><h3 id="Associative-containers">Associative containers</h3><ul><li>Theyâ€™re called associative because they associate key with value<ul><li>The value can also be omitted</li></ul></li><li>There exist ordered one and unordered one<ul><li>æœ‰åºçš„éœ€è¦æ¯”è¾ƒå‡½æ•° less than<ul><li>BBST (balanced binary search tree) æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="7.538ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 3332 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"/></g><g data-mml-node="mo" transform="translate(485,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(874,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(2343,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(2943,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container><ul><li>RB tree</li><li>AVL</li></ul></li></ul></li><li>æ— åºçš„éœ€è¦æä¾›å“ˆå¸Œå‡½æ•°å’Œåˆ¤æ–­æ˜¯å¦ç›¸ç­‰çš„å‡½æ•°<ul><li>æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="3.989ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 1763 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"/></g><g data-mml-node="mo" transform="translate(485,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(874,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1374,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li></ul></li></ul></li></ul><h4 id="Map">Map</h4><ul><li>The key is unique; a single key cannot be mapped to multiple values</li><li><code>std::map&lt;Key, Value, CMPForKey = std::less&lt;Key&gt;&gt;</code><ul><li>é»˜è®¤æ˜¯å°äºå·</li><li><code>CMPForKey</code> should be able to accept <code>const key</code></li></ul></li><li>For member accessing<ul><li><code>operator[]</code>, <code>at()</code></li><li>Bidirectional iterators<ul><li>Notice that the worst complexity of <code>++/--</code> is <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.819ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 3898 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1152,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(2621,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(3509,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li>å¯¹ BBST è¿›è¡Œä¸­åºéå†å°±èƒ½å¾—åˆ°æœ‰åºçš„åºåˆ—<ul><li><code>.begin()</code> is just the leftmost node and <code>.rbegin()</code> is just the rightmost node</li></ul></li></ul></li></ul></li><li>Note<ul><li><code>operator[]</code> will insert a default-constructed value if the key doesnâ€™t exits<ul><li>å¦‚æœ key ä¸å­˜åœ¨å¹¶ä¸”é»˜è®¤æ„é€ çš„å€¼ä¹Ÿä¸æ˜¯çœŸæ­£éœ€è¦çš„ï¼Œç”¨ <code>insert_xxx</code> æ•ˆç‡æ›´é«˜</li><li><code>const map</code>ä¸èƒ½ç”¨<code>operator[]</code></li><li>å¦‚æœ value æ˜¯ä¸èƒ½è¢«é»˜è®¤æ„é€ çš„ï¼ˆä¾‹å¦‚æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼‰ä¹Ÿæ˜¯ä¸èƒ½ç”¨<code>operator[]</code></li></ul></li><li>Key-value pair is stored in RB tree, so iterator also points to the pair</li><li>You can use structured binding to facilitate iteration</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">std::map&lt;string::string, <span class="type">int</span>&gt; scoreTable{</span><br><span class="line">    {<span class="string">"Li"</span>, <span class="number">99</span> },</span><br><span class="line">    {<span class="string">"God Liu"</span>, <span class="number">99</span> },</span><br><span class="line">    {<span class="string">"Saint Liu"</span>, <span class="number">99</span> },</span><br><span class="line">    {<span class="string">"Liang"</span>, <span class="number">99</span> },</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; [name, score] : scoreTable)</span><br><span class="line">    std::cout &lt;&lt; name &lt;&lt; <span class="string">''</span> &lt;&lt; score &lt;&lt; <span class="string">'\n'</span>;</span><br></pre></td></tr></table></figure><ul><li>APIs<ul><li><p><code>.lower_bound(key)</code>: find <code>it</code> that <code>prev(it)-&gt;key &lt; key &lt;= it-&gt;key</code></p><ul><li>Use key as a lower bound to make <code>[it, end) &gt;= key</code></li></ul></li><li><p><code>.lower_bound(key)</code>: find <code>it</code> that <code>prev(it)-&gt;key &lt;= key &lt; it-&gt;key</code></p><ul><li>Use key as a lower bound to make <code>[begin, it) &lt;= key</code></li></ul></li><li><p><code>.equal_range(key)</code>: find <code>it</code> pair with the same key as <code>key</code> in range</p></li><li><p>Insertion</p><ul><li>å› ä¸ºé”®æ˜¯å”¯ä¸€çš„ï¼Œæ’å…¥çš„æ—¶å€™å¦‚æœ key å­˜åœ¨ä¼šå¤±è´¥ï¼›æ— è®ºå¤±è´¥æˆåŠŸéƒ½è¿”å›<code>pair&lt;iterator, bool&gt;</code><ul><li>If succeed, <code>iterator</code> refers to inserted element and <code>bool</code> is <code>true</code></li><li>If fail, <code>iterator</code> refers to the element with the same key and <code>bool</code> is false`</li></ul></li><li>æ’å…¥å¤±è´¥ä¼šæœ‰å¤šä¸ªå¤„ç†æ–¹å¼<ul><li>Leave it unchanged<ul><li><code>.insert({key, value})</code></li><li><code>.emplace(params)</code></li></ul></li><li>Overwrite it (C++ 17)<ul><li><code>.insert_or_assign(key, value)</code>: return <code>pair&lt;iterator, bool&gt;</code></li></ul></li><li>Leave it unchanged and even not construct the inserted value (C++ 17)<ul><li><code>.try_emplace(key, params)</code>: same as <code>emplace</code>, except that the params are used to construct value, and <code>emplace</code> is not forbidden to construct the pair in failure æ„é€  value éå¸¸æ˜‚è´µçš„æ—¶å€™ä½¿ç”¨</li></ul></li></ul></li><li>You can also provide a hint iterator for insertion<ul><li><p>hint iterator åœ¨è¢«æ’å…¥å…ƒç´ åé¢çš„æ—¶å€™ä¼šæœ‰æ•ˆç‡æå‡ï¼Œåœ¨å‰é¢çš„è¯ä¼šä½¿æ•ˆç‡é™ä½</p></li><li><p>Hint is often used in idiom blow</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> pLoc = someMap.<span class="built_in">lower_bound</span>(someKey);</span><br><span class="line"><span class="keyword">if</span> (pLoc != someMap.<span class="built_in">end</span>() &amp;&amp; !(someMap.<span class="built_in">Key_comp</span>()(someKey, pLoc-&gt;first)))</span><br><span class="line">    <span class="keyword">return</span> pLoc-&gt;second;</span><br><span class="line"><span class="keyword">else</span> {</span><br><span class="line">    <span class="keyword">auto</span> newValue = <span class="built_in">expensiveCalculation</span>();</span><br><span class="line">    someMap.<span class="built_in">insert</span>(pLoc, <span class="built_in">make_pair</span>(someKey, <span class="keyword">new</span> Value));</span><br><span class="line">    <span class="keyword">return</span> newValue;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>Erasure</p><ul><li><code>.erase(...)</code><ul><li><code>(key)</code></li><li><code>(iterator pos)</code></li><li><code>(iterator first, iterator last)</code></li></ul></li></ul></li><li><p><code>.extract(key)</code>, <code>extract(iterator pos)</code>: extract out the node from the map</p></li><li><p><code>.insert(node_type&amp;&amp;)</code>: insert the node to the map</p></li><li><p><code>.merge(another map/multimap)</code></p></li></ul></li></ul><blockquote><p><strong>Structured binding</strong></p><ul><li>Structured binding is just <code>auto&amp; [...]{xx}</code><ul><li><code>{xx}</code> can be <code>(xx)</code> or <code>=xx</code></li><li><code>auto&amp;</code> can be anything</li><li><code>xx</code> can be a pair; it can also be<ul><li>An object with all public data members, which will be bound on them</li><li>A C-style array or <code>std::array</code>, which will be bound on elements <code>arr[i]</code></li><li>A tuple-like thing, which will be bound on every element</li></ul></li><li>Note<ul><li><p>pair and <code>std::array</code> is also somewhat tuple-like thing and can use some tuple methods, e.g. <code>std::get</code> pair å’Œ <code>std::array</code> ä¹Ÿå¯ä»¥åƒ tuple ä¸€æ ·ï¼Œè®¿é—®çš„æ—¶å€™ä¹Ÿå¯ä»¥ä½¿ç”¨è®¿é—® tuple çš„æ–¹æ³•</p></li><li><p>ç»“æ„åŒ–ç»‘å®šæ—¶ä¸€ä¸ªæ–°çš„å£°æ˜ï¼Œä¸èƒ½ç»‘å®šå·²ç»å­˜åœ¨çš„å˜é‡ï¼Œå¦‚æœæƒ³ç»‘å®šå·²å­˜åœ¨çš„å˜é‡å¯ä»¥ä½¿ç”¨<code>std::tie(name, score) = pair</code></p></li><li><p>ç»“æ„åŒ–ç»‘å®šçš„æœ¬è´¨æ˜¯åŒ¿åç»“æ„ä½“ï¼Œç»“æ„ä½“ä¸­çš„å˜é‡æ˜¯åˆ«å</p>  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::tuple&lt;<span class="type">int</span>, <span class="type">float</span>&gt; a{<span class="number">1</span>, <span class="number">1.0f</span> };</span><br><span class="line"><span class="type">const</span> <span class="keyword">auto</span>&amp; [b, c] = a;</span><br><span class="line"><span class="keyword">decltype</span>(b) m = <span class="number">0</span>; <span class="comment">// const int m  = 0;</span></span><br></pre></td></tr></table></figure></li><li><p>Structured binding is usually more efficient than novice/careless programmers å»ºè®®ä½¿ç”¨ç»“æ„åŒ–ç»‘å®š</p></li></ul></li></ul></li></ul><p><strong>Tuple</strong></p><ul><li><code>std::tuple&lt;int, float, double&gt; t{1, 2.0f, 3.0};</code></li><li>It can only be accessed by an index that can be determined in compile time ä¸‹æ ‡è®¿é—®çš„ä¸‹æ ‡åªèƒ½åœ¨ç¼–è¯‘æ—¶ç¡®å®š<ul><li><code>std::get&lt;0&gt;(tuple)</code> to get the <code>int 1</code></li><li>C++ 14 å¯ä»¥ä½¿ç”¨ç±»å‹è·å–ç›¸åº”çš„å€¼ï¼Œå‰ææ˜¯ç±»å‹ä¸èƒ½é‡å¤ e.g. <code>std::get&lt;int&gt;(tuple)</code></li><li><code>std::tuple_cat</code></li></ul></li></ul></blockquote><h4 id="Set">Set</h4><ul><li>Set is just a map without value</li><li>The only difference with amp is that it doesnâ€™t have <code>operator[]</code> and <code>.at()</code></li><li>The iterator points to only key instead of key-value pair</li></ul><h4 id="Multimap">Multimap</h4><ul><li>æŠŠ key çš„å”¯ä¸€æ€§å–æ¶ˆäº†</li><li>ä¸èƒ½ä½¿ç”¨ <code>operator[]</code> å’Œ<code>.at()</code></li><li>ç›¸ç­‰çš„å€¼çš„é¡ºåºå–å†³äºæ’å…¥æ—¶çš„é¡ºåº</li><li>æ’å…¥æ°¸è¿œéƒ½æ˜¯æˆåŠŸçš„</li><li>Nodes of multimap and map can be exchanged ä¸¤ä¸ªå®¹å™¨çš„èŠ‚ç‚¹æ˜¯å¯ä»¥ç›¸äº’æ›¿æ¢çš„</li></ul><h4 id="Multiset">Multiset</h4><ul><li>Except for only key and no value, same as multimap</li><li>You can also exchange nodes of multiset and set</li></ul><h4 id="Unordered-map">Unordered map</h4><ul><li><code>std::unordered_map&lt;Key, Value, Hash = std::hash&lt;key&gt;, Equal = std::equal_to&lt;Key&gt;&gt;</code></li><li>Many types have <code>std::hash&lt;Type&gt;</code>, e.g. <code>std::string</code>, <code>float</code>, etc.</li><li>The hash value of different keys may be same, so we need <code>Equal</code> to judge which key is wanted</li><li>å¾®è½¯çš„å®ç°åœ¨è§£å†³å†²çªçš„æ—¶å€™ç”¨åŒå‘é“¾è¡¨ï¼Œå¹¶ä¸”é“¾æ¥ç›¸é‚»çš„ Bucket å»¶ç”³å‡ºæ¥çš„åŒå‘é“¾è¡¨ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹</li><li>å½“æ’å…¥æ•°æ®å¤ªå¤šçš„æ—¶å€™ï¼Œæ¯ä¸ª bucket ä¹Ÿä¼šé“¾æ¥å¾ˆå¤šæ•°æ®<ul><li>è¿™æ ·ä¼šå¢åŠ æŸ¥æ‰¾çš„å¤æ‚åº¦</li><li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.798ex;" xmlns="http://www.w3.org/2000/svg" width="9.174ex" height="2.76ex" role="img" focusable="false" viewbox="0 -867.1 4054.7 1219.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mtext" transform="translate(1475.8,394) scale(0.707)"><path data-c="73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z"/><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z" transform="translate(394,0)"/><path data-c="7A" d="M42 263Q44 270 48 345T53 423V431H393Q399 425 399 415Q399 403 398 402L381 378Q364 355 331 309T265 220L134 41L182 40H206Q254 40 283 46T331 77Q352 105 359 185L361 201Q361 202 381 202H401V196Q401 195 393 103T384 6V0H209L34 1L31 3Q28 8 28 17Q28 30 29 31T160 210T294 394H236Q169 393 152 388Q127 382 113 367Q89 344 82 264V255H42V263Z" transform="translate(672,0)"/><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z" transform="translate(1116,0)"/></g><g data-mml-node="mtext" transform="translate(220,-345) scale(0.707)"><path data-c="62" d="M307 -11Q234 -11 168 55L158 37Q156 34 153 28T147 17T143 10L138 1L118 0H98V298Q98 599 97 603Q94 622 83 628T38 637H20V660Q20 683 22 683L32 684Q42 685 61 686T98 688Q115 689 135 690T165 693T176 694H179V543Q179 391 180 391L183 394Q186 397 192 401T207 411T228 421T254 431T286 439T323 442Q401 442 461 379T522 216Q522 115 458 52T307 -11ZM182 98Q182 97 187 90T196 79T206 67T218 55T233 44T250 35T271 29T295 26Q330 26 363 46T412 113Q424 148 424 212Q424 287 412 323Q385 405 300 405Q270 405 239 390T188 347L182 339V98Z"/><path data-c="75" d="M383 58Q327 -10 256 -10H249Q124 -10 105 89Q104 96 103 226Q102 335 102 348T96 369Q86 385 36 385H25V408Q25 431 27 431L38 432Q48 433 67 434T105 436Q122 437 142 438T172 441T184 442H187V261Q188 77 190 64Q193 49 204 40Q224 26 264 26Q290 26 311 35T343 58T363 90T375 120T379 144Q379 145 379 161T380 201T380 248V315Q380 361 370 372T320 385H302V431Q304 431 378 436T457 442H464V264Q464 84 465 81Q468 61 479 55T524 46H542V0Q540 0 467 -5T390 -11H383V58Z" transform="translate(556,0)"/><path data-c="63" d="M370 305T349 305T313 320T297 358Q297 381 312 396Q317 401 317 402T307 404Q281 408 258 408Q209 408 178 376Q131 329 131 219Q131 137 162 90Q203 29 272 29Q313 29 338 55T374 117Q376 125 379 127T395 129H409Q415 123 415 120Q415 116 411 104T395 71T366 33T318 2T249 -11Q163 -11 99 53T34 214Q34 318 99 383T250 448T370 421T404 357Q404 334 387 320Z" transform="translate(1112,0)"/><path data-c="6B" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T97 124T98 167T98 217T98 272T98 329Q98 366 98 407T98 482T98 542T97 586T97 603Q94 622 83 628T38 637H20V660Q20 683 22 683L32 684Q42 685 61 686T98 688Q115 689 135 690T165 693T176 694H179V463L180 233L240 287Q300 341 304 347Q310 356 310 364Q310 383 289 385H284V431H293Q308 428 412 428Q475 428 484 431H489V385H476Q407 380 360 341Q286 278 286 274Q286 273 349 181T420 79Q434 60 451 53T500 46H511V0H505Q496 3 418 3Q322 3 307 0H299V46H306Q330 48 330 65Q330 72 326 79Q323 84 276 153T228 222L176 176V120V84Q176 65 178 59T189 49Q210 46 238 46H254V0H246Q231 3 137 3T28 0H20V46H36Z" transform="translate(1556,0)"/><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z" transform="translate(2084,0)"/><path data-c="74" d="M27 422Q80 426 109 478T141 600V615H181V431H316V385H181V241Q182 116 182 100T189 68Q203 29 238 29Q282 29 292 100Q293 108 293 146V181H333V146V134Q333 57 291 17Q264 -10 221 -10Q187 -10 162 2T124 33T105 68T98 100Q97 107 97 248V385H18V422H27Z" transform="translate(2528,0)"/><path data-c="20" d=""transform="translate(2917,0)"/><path data-c="6E"d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"transform="translate(3167,0)"/><path data-c="75"d="M383 58Q327 -10 256 -10H249Q124 -10 105 89Q104 96 103 226Q102 335 102 348T96 369Q86 385 36 385H25V408Q25 431 27 431L38 432Q48 433 67 434T105 436Q122 437 142 438T172 441T184 442H187V261Q188 77 190 64Q193 49 204 40Q224 26 264 26Q290 26 311 35T343 58T363 90T375 120T379 144Q379 145 379 161T380 201T380 248V315Q380 361 370 372T320 385H302V431Q304 431 378 436T457 442H464V264Q464 84 465 81Q468 61 479 55T524 46H542V0Q540 0 467 -5T390 -11H383V58Z"transform="translate(3723,0)"/><path data-c="6D"d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"transform="translate(4279,0)"/></g><rect width="3814.7"height="60"x="120"y="220"/></g></g></g></svg></mjx-container> is called load factor è£…è½½å› å­</li><li>è£…è½½å› å­è¿‡å¤§æ—¶ï¼Œéœ€è¦å¯¹ bucket array è¿›è¡Œæ‰©å®¹</li><li>Rehash é‡å“ˆå¸Œ</li></ul></li><li>APIs<ul><li><code>.bucket_count()</code>: size of bucket array</li><li><code>.load_factor()</code>: <code>size() / bucket_count()</code></li><li><code>.max_load_factor()</code>: when load factor exceeds this limit, refresh will happen</li><li><code>.rehash(n)</code>: make <code>bucket_count() = max(n, ceil(size() / max_load_factor()))</code> and rehash</li><li><code>.reserve(n)</code></li><li><code>.bucket(key)</code>: get the bucket index of the key</li><li><code>.begin(index)</code>, <code>.cbegin(index)</code>, <code>.end(index)</code>, <code>.cend(index)</code>: get the iterator of the bucket at index</li><li><code>.bucket_size(index)</code>: get the size of bucket at index</li></ul></li><li>You can also extract nodes and insert them</li></ul><h2 id="Ranges">Ranges</h2><ul><li><p>Using ranges is very like functional programming</p></li><li><p>There are three important components in ranges:</p><ul><li>Range: A type provides a begin iterator and end sentinel, so that it can be iterated over</li><li>View: A range that can be moved in <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>, copied in <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> (or cannot be copied) and destructed in <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li>Range adaptor</li></ul></li><li><p>Note</p><ul><li>Range å¯ä»¥æŒ‰ç…§è¿­ä»£å™¨è¿›è¡Œåˆ†ç±»</li><li>è®¡ç®—æ˜¯æƒ°æ€§è®¡ç®—</li></ul></li><li><p>Theyâ€™re all defined in <code>&lt;range&gt;</code>; all views are defines as <code>std::ranges::xx_view</code>, and all range adaptors are defined as <code>std::views::xx</code></p><ul><li>ä¸€èˆ¬ç”¨åˆ«åæ¥ç®€åŒ–å®šä¹‰ <code>namespace stdr = std::ranges</code> å’Œ<code>namespace stdv = std::views</code></li><li><code>stdr::iota_view{lower, upper = INF}</code>, <code>stdv::iota(lower, upper = INF)</code>: å’Œ python ä¸­çš„ <code>range(a, b)</code> ç±»ä¼¼</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> oddNum : stdv::<span class="built_in">iota</span>(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">  | stdv::<span class="built_in">filter</span>([](<span class="type">int</span> num) {<span class="keyword">return</span> num % <span class="number">2</span> == <span class="number">1</span>; })</span><br><span class="line">  | stdv::<span class="built_in">take</span>(<span class="number">3</span>))</span><br><span class="line">{</span><br><span class="line">    std::cout &lt;&lt; oddNum &lt;&lt; <span class="string">'';</span></span><br><span class="line"><span class="string">}</span></span><br></pre></td></tr></table></figure></li><li><p>Writable</p><ul><li><code>stdv::filter(Pred)</code>: drop the element if the predicate function <code>Pred</code> returns <code>false</code></li><li><code>stdv::take(x)</code>: take first <code>x</code> elements (but not exceed <code>end</code>)</li><li><code>stdv::take_while(Pred)</code>: take elements until <code>Pred</code> return <code>false</code> (or <code>end</code>)</li><li><code>stdv::drop(x)</code>: drop first <code>x</code> elements</li><li><code>stdv::drop_while(Pred)</code>: drop elements until <code>Pred</code> returns <code>false</code></li><li><code>stdv::reverse</code></li><li><code>stdv::keys</code>: get the first element from a tuple-like thing</li><li><code>stdv::values</code></li><li><code>stdv::elements&lt;i&gt;</code>: get the <code>i</code>th element from a tuple-like thing</li><li><code>stdv::stride(k)</code>: use <code>k</code> as stride to iterate<ul><li>e.g. <code>stdv::iota(1, 0) | stdv::stride(2)</code> gets <code>{1, 3, 5, 7, 9}</code></li></ul></li><li><code>stdv::join</code>: flattens the ranges to a single range éœ€è¦ç”¨ <code>|</code> è¿æ¥</li><li><code>stdv::join_with(xx)</code>: fill the interval with <code>xx</code> éœ€è¦ç”¨ <code>|</code> è¿æ¥</li><li><code>stdv::zip(r1, r2, ...)</code>: zip values from ranges to a tuple</li><li><code>stdv::cartesian_product(r1, r2, ...)</code>: return a tuple of elements from the cartesian product of these ranges</li><li><code>stdv::enumerate</code>: return <code>std::tuple&lt;Integer, T&amp;&gt;</code>; Integer is index whose tpe is diff type of iterator</li><li><code>stdv::slide(width)</code>: slide the range in a sliding window of <code>width</code><ul><li>e.g. <code>std::vector v{1, 2, 3, 4, 5}; v | stdv::slide(3)</code> gets <code>{{1, 2, 3}, {2, 3, 4}, {3, 4, 5}}</code></li></ul></li><li><code>stdv::adjacent&lt;width&gt;</code>: same as <code>stdv::slide(width)</code></li><li><code>stdv::pairwise</code>: i.e. stdv::adjacent&lt;2&gt;</li><li><code>stdv::chunk(width)</code>: partition the range by <code>width</code></li><li><code>stdv::chunk_by(pred2)</code>: partition the range by <code>pred2</code>, i.e. a view sill stop when <code>pred2(*it, *next(it))</code> return <code>false</code></li><li><code>stdv::split(xx)</code></li><li><code>stdv::lazy_split(xx)</code></li></ul></li><li><p>Read-only</p><ul><li>Either make the view const, i.e. <code>std::as_const</code>; this will return <code>const T&amp;</code> or <code>tuple&lt;const T&amp;, ...&gt;</code></li><li>Or return value, i.e. transform-related, which will return <code>T</code> or <code>tuple&lt;T, ...&gt;</code><ul><li><p><code>stdv::zip_transform(TransformN, r1, r2, ...)</code>: return a view of <code>TransformN(ele1, ele2, ...)</code></p></li><li><p><code>stdv::adjacent_transform&lt;N&gt;(TransformN)</code>: return a view of <code>TransformN(...)</code>, where <code>...</code> is the elements of the sliding windows</p></li><li><p><code>stdv::transform(Transform)</code>: transform element to another element</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> };</span><br><span class="line"><span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">auto</span> r = v | stdv::<span class="built_in">transform</span>([&amp;cnt](<span class="type">const</span> <span class="type">int</span> ele) {</span><br><span class="line">    std::cout &lt;&lt; std::format(<span class="string">"cnt={}, ele={}\n"</span>, cnt, ele);</span><br><span class="line">    cnt++;</span><br><span class="line">    <span class="keyword">return</span> cnt + ele;</span><br><span class="line">}) | stdv::<span class="built_in">take_while</span>([](<span class="type">const</span> <span class="type">int</span> ele) {<span class="keyword">return</span> ele &lt; <span class="number">10</span>; });</span><br><span class="line"><span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; i : r);</span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line"><span class="comment">// cnt=0, ele=1</span></span><br><span class="line"><span class="comment">// cnt=1, ele=1</span></span><br><span class="line"><span class="comment">// cnt=2, ele=2</span></span><br><span class="line"><span class="comment">// cnt=3, ele=2</span></span><br><span class="line"><span class="comment">// cnt=4, ele=3</span></span><br><span class="line"><span class="comment">// cnt=5, ele=3</span></span><br><span class="line"><span class="comment">// cnt=6, ele=4</span></span><br></pre></td></tr></table></figure><ul><li><code>++</code> will trigger transform since <code>take_while</code> needs the transformed value to advance the iterator (i.e. by <code>Pred(*it)</code>)</li><li><code>const auto&amp; ele = *it</code> will trigger it again</li><li>Thatâ€™s because the result doesnâ€™t reference some existing elements, but generate from temporary; every time you need it, lazy evaluation generate it again å¤ª lazy äº†</li><li>Sometimes, you may want to convert a range to a e.g. container, which needs to eagerly evaluate all<ul><li><code>stdr::to</code>, e.g. <code>stdr::to&lt;std::vector&gt;()</code></li></ul></li></ul></li></ul></li></ul></li><li><p>There are also some naÃ¯ve range factories</p><ul><li><code>stdv::single(obj)</code>: make a view that copies/moves an object, i.e. the view owns only a single element</li><li><code>stdv::empty&lt;T&gt;</code>: create an empty view</li><li><code>stdv::repeat(r, k = INF)</code>: repeat a range <code>r</code> for <code>k</code> times, i.e. like a range <code>[r, r, r, ...]</code></li><li><code>stdv::istream&lt;xxx&gt;(stream)</code>: similar to <code>istream_iterator</code>; it caches value</li><li><code>stdr::subrange(first, last)</code></li></ul></li></ul><h2 id="Generator">Generator</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">end</span>):</span><br><span class="line">    begin = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> begin != end:</span><br><span class="line">        <span class="keyword">yield</span> begin</span><br><span class="line">        begin += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">generator = func(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> generator:</span><br><span class="line">    <span class="built_in">print</span>(num)</span><br></pre></td></tr></table></figure><p>When the function reaches <code>yield</code>, it will pause and <code>return</code> the number; when iterator moves forward, the function will resume and continue to execute until the next <code>yield</code> or real <code>return</code></p><ul><li>Since C++ 23, generator is also supported by <strong>coroutine</strong><ul><li>Coroutines <strong>cooperates</strong> with each other and yield their execution flow themselves åç¨‹ä¹‹é—´æ˜¯ç›¸äº’é…åˆçš„æ§åˆ¶æµ<ul><li>By contrast, for threads, they usually compete with each other and are interrupted by OS to give other threads chances to execute çº¿ç¨‹åˆ™æ˜¯æŠ¢å å¼çš„</li></ul></li></ul></li><li>Generator is just the same; when you need the next value , you just yield your execution flow to the generator function; when the generator function completes its task, it will give back the right of execution</li><li>Generator is also an <code>input_range</code> and view; it provides <code>begin()</code> and <code>end()</code> to iterate, and <code>++</code> the iterator will resume the function<ul><li>NOTICE: Call <code>.begin()</code> will start the coroutine</li></ul></li></ul><p>e.g.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::generator&lt;<span class="type">int</span>&gt; <span class="title">func</span><span class="params">(<span class="type">int</span> end)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    std::cout &lt;&lt; <span class="string">"Ahh..."</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> begin = <span class="number">0</span>; begin &lt; end; begin++)</span><br><span class="line">        <span class="keyword">co_yield</span> begin;</span><br><span class="line">    <span class="keyword">co_return</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">auto</span> generator = <span class="built_in">func</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it = generator.<span class="built_in">begin</span>(); it != generator.<span class="built_in">end</span>(); it++)</span><br><span class="line">    std::cout &lt;&lt; *it;</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; num : generator)</span><br><span class="line">    std::cout &lt;&lt; num;</span><br></pre></td></tr></table></figure><ul><li>Some notes<ul><li>One generator can only be used once åªèƒ½ä½¿ç”¨ä¸€æ¬¡</li><li>Generator has <code>operator=</code></li><li><code>co_return</code> can be omitted</li><li>Saving contexts also needs memory, so an allocator can also be provided as the last template parameter</li></ul></li></ul><h2 id="Function- å‡½æ•°">Function å‡½æ•°</h2><h3 id="Pointer-to-member-functions">Pointer to member functions</h3><ul><li>Member functions can be static or non-static<ul><li>Static ones are just normal functions with some <code>Class::</code>, their pointers are same as normal ones</li><li>Non-static ones are always bound to some specific objects, i.e. there is a <code>this</code> pointer as a parameter</li></ul></li></ul><p>e.g.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span>: <span class="type">unsigned</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">AddAge</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> n)</span> </span>{</span><br><span class="line">        age += n;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> FuncPtr = <span class="built_in">void</span> (Person::*)(<span class="type">unsigned</span> <span class="type">int</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    Person p{<span class="number">0</span> }, *pointer = &amp;p;</span><br><span class="line">    FuncPtr ptr = &amp;Person::AddAge;</span><br><span class="line">    (p.*ptr)(<span class="number">5</span>);</span><br><span class="line">    (pointer-&gt;*ptr)(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// C++ 17</span></span><br><span class="line">    std::<span class="built_in">invoke</span>(ptr, p, <span class="number">5</span>);</span><br><span class="line">    std::<span class="built_in">invoke</span>(ptr, pointer, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><ul><li>Define a pointer to member function is <code>Ret (Class::*)(params)</code></li><li><code>std::invoke</code> define in <code>&lt;functional&gt;</code> since C++ 17</li><li>Since C++ 23, <code>std::invoke_r&lt;Result&gt;</code> is provided</li></ul><h3 id="Callable-parameter">Callable parameter</h3><h4 id="Function-as-parameter">Function as parameter</h4><ul><li>å‡½æ•°æŒ‡é’ˆä¹Ÿå¯ä»¥å®ç°å°†å‡½æ•°è§†ä¸ºå‚æ•°æ¥ä¼ é€’ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªé—®é¢˜<ul><li>æœ‰æ—¶å€™å‡½æ•°æŒ‡é’ˆçš„å‚æ•°ç±»å‹æœ‰ä¸¥æ ¼çš„é™åˆ¶ï¼Œä¾‹å¦‚ <code>int</code> can be converted to <code>double</code>, <code>func(double)</code> is also acceptable</li><li>In C++, usually what you need is just â€œsomething callableâ€, i.e. a functor is allowed æœ‰æ—¶å€™åªæ˜¯æƒ³ä¼ å…¥ä¸€ä¸ªå¯è°ƒç”¨çš„ç±»å‹</li></ul></li><li>æœ‰ä¸¤ç§æ–¹å¼è§£å†³<ul><li>Use a template parameter <code>&lt;algorithm&gt;</code>å¸¸ç”¨çš„æ–¹æ³•é‡‡ç”¨æ¨¡æ¿å‚æ•°æ¥å—å¯è°ƒç”¨çš„å‚æ•°</li><li>Use a <code>std::function</code> defined in <code>&lt;functional&gt;</code><ul><li><code>std::function&lt;RetType(Args...)&gt;</code> can adopt almost all callable that have the return type <strong>convertible</strong> to <code>RetType</code> and accept <code>Args</code></li><li>The member function even preserves polymorphism</li><li>After getting the <code>std::function</code>, you can just use <code>operator()</code> to call it</li><li>Even more powerful, you can bind some parameters to get new functors<ul><li>E.g. you can use <code>std::bind(any_callable, params)</code> to get a <code>std::function</code> <code>std::bind</code>å·²ç»æ²¡æœ‰ç”¨äº†ï¼Œå®Œå…¨å¯ä»¥ç”¨ Lambda è¡¨è¾¾å¼ç»‘å®š</li></ul></li><li>There are two defects<ul><li>Performance: It roughly causes 10% - 20% performance loss compared with direct function call<ul><li>æœ‰å¯èƒ½ä¼šç”¨ <code>new</code>/<code>delete</code> è‡ªå®šä¹‰<code>ctor</code>/<code>dtor</code></li><li>è§£å†³æ–¹å¼æ˜¯ä½¿ç”¨ SOO(small object optimization)ï¼Œåœ¨æ ˆä¸Šå‡†å¤‡ä¸€å—å°çš„ buffer ç”¨äºåˆ†é…å‡½æ•°ç©ºé—´</li><li>å¦‚æœç»‘å®šçš„ Lambda è¡¨è¾¾æ˜¯å¤ªå¤§å¯ä»¥ä½¿ç”¨ <code>auto lambda = xx;</code>ï¼Œç„¶åå†é€šè¿‡<code>std::ref(lambda)</code> ä¼ ç»™ <code>std::function</code> çš„æ„é€ å‡½æ•°ï¼ˆä½†æ˜¯è¦æ³¨æ„å£°æ˜å‘¨æœŸï¼‰ï¼Œä½†æ˜¯ä¸å¯ä»¥ä½¿ç”¨<code>std::ref(&amp;&amp;xx)(){...}</code>ï¼Œlambda è¡¨è¾¾å¼ä¼šç«‹é©¬å¤±æ•ˆ</li></ul></li><li>The second defect of <code>std::function</code> is that it cannot really accept all functors å¹¶ä¸æ˜¯æ”¯æŒæ‰€æœ‰çš„å¯è°ƒç”¨ç±»å‹<ul><li>When the functor is not copiable (e.g. move-only, like <code>std::unique_ptr</code>) ä»¿å‡½æ•°ä¸èƒ½æ‹·è´çš„å°±ä¸èƒ½æ¥å—<ul><li>Thus, since C++ 23, <code>std::move_only_function</code> is introduced</li></ul></li></ul></li></ul></li></ul></li><li>Reference wrapper<ul><li><code>std::(c)ref()</code> in fact create <code>std::reference_wrapper&lt;(const) T&gt;</code>, which can be seen as an instantiated reference<ul><li>ä¾‹å¦‚å®¹å™¨ä¸­ä¸å¯èƒ½å­˜å‚¨å¼•ç”¨ç±»å‹çš„ï¼Œå¦‚æœæƒ³å‚¨å­˜å¼•ç”¨ç±»å‹å¯ä»¥ä½¿ç”¨<code>std::vector&lt;std::reference_wrapper&lt;T&gt;&gt;</code></li><li>Itâ€™s in fact a wrapper of pointer, but it cannot be null, just like reference</li><li>Different from reference, it can be bound to another object by <code>operator=</code>, just like pointer å¼•ç”¨æ˜¯ä¸å¯ä»¥æ¢ç»‘çš„ï¼Œä½†æ˜¯ <code>std::ref()</code> å¯ä»¥</li></ul></li><li>Itâ€™s also used to denote â€œit should be a referenceâ€ explicitly in some methods in standard library, e.g. <code>std::bind_back</code> or <code>std::bind_front</code></li></ul></li></ul></li><li>There are also some predefined template functors in <code>&lt;functional&gt;</code><ul><li>Arithmetic functors: <code>plus</code>, <code>minus</code>, <code>multiplies</code>, <code>divides</code>, <code>modulus</code>, <code>negate</code></li><li>Comparison functors: <code>equal_to</code>, <code>not_equal_to</code>, <code>greater</code>, <code>less</code>, <code>greater_equal</code>, <code>less_equal</code>, <code>compare_three_way</code></li><li>Logical functors: <code>logical_and</code>, <code>logical_or</code>, <code>logical_not</code></li><li>Bitwise functors: <code>bit_and</code>, <code>bit_or</code>, <code>bit_xor</code>, <code>bit_not</code></li><li>These <code>Functor&lt;T&gt;</code> all have <code>auto operator()(const T&amp;, const T&amp;) const</code></li></ul></li></ul><h4 id="Lambda-expression">Lambda expression</h4><ul><li>We call lambda expression without capture <em>stateless lambda</em>; otherwise <em>stateful lambda</em></li><li>å¯ä»¥ä½¿ç”¨ <code>decltype(...)</code> å»æ¨æ–­ lambda è¡¨è¾¾å¼çš„ç±»å‹</li><li>ç†è®ºä¸Šå¯ä»¥ä½¿ç”¨æ¨æ–­å‡ºæ¥çš„ä»¿å‡½æ•°çš„ç±»å‹è¿›è¡Œå£°æ˜ï¼Œä½†æ˜¯åªæœ‰å† C++ 20 ä¹‹åæ‰æ˜¯åˆæ³•çš„<ul><li>E.g. <code>auto l = [](int a, int b) {return a + b;}; using T = decltype(l); T l2{};</code></li><li>åªé€‚ç”¨ stateless lambda</li></ul></li></ul><h2 id="Algorithms">Algorithms</h2><h3 id="Algorithmsâ€™-Consist">Algorithmsâ€™ Consist</h3><ul><li>Iterator pairs è¿­ä»£å™¨å¯¹ï¼Œæˆ–è€…ç›´æ¥ä¼ å…¥ ranges</li><li>Predicate function / transform function åˆ¤åˆ«å‡½æ•°æˆ–è€…å˜æ¢å‡½æ•°ï¼Œé€šå¸¸æƒ…å†µä¸‹å˜æ¢éƒ½æ˜¯<code>const&amp;</code>ï¼Œæˆ–è€…å¯¹äºæ¯”è¾ƒå°çš„ç±»å‹ä¼ å…¥æ‹·è´</li><li>å¤§éƒ¨åˆ†ç®—æ³•éƒ½è¿”å›ä¸€ä¸ªèŒƒå›´è¿­ä»£å™¨</li><li>ä»æ¥éƒ½ä¸ä¼šæ”¹å˜åºåˆ—çš„å¤§å°</li><li>Callables of algorithm are of value type instead of reference type åˆ¤åˆ«å‡½æ•°æˆ–è€…å˜æ¢å‡½æ•°éƒ½æ˜¯ä¼ é€’å€¼ç±»å‹ï¼Œä¸æ˜¯å¼•ç”¨ç±»å‹</li></ul><h3 id="Search">Search</h3><ul><li>ä¸¤ç§æœç´¢ç®—æ³•<ul><li>Linear search<ul><li>Find single value<ul><li><code>std::find</code></li><li><code>std::find_if</code></li></ul></li><li>Find one of values in a range<ul><li><code>std::find_first_of</code></li></ul></li><li>Find a sub-sequence in a sequence (Pattern matching)<ul><li><code>std::search</code></li><li><code>std::find_end</code></li></ul></li><li>Others<ul><li><code>std::adjacent_find(begin, end[, Pred2])</code>: ç›¸é‚»å…ƒç´ ç›¸ç­‰çš„ä½ç½®</li><li><code>std::search_n(begin, end, count, value, [, Pred2])</code></li></ul></li></ul></li><li>Binary search, which is applied on sorted sequence<ul><li><code>std::binary_search</code>: return bool, denoting whether <code>value</code> exists in <code>[begin, end)</code></li><li><code>std::lower_bound</code>: return <code>it</code> so that <code>value</code> is the lower bound of <code>[it, end)</code></li><li><code>std::upper_bound</code>: return <code>it</code> so that <code>value</code> is the lower upper of <code>[begin, end)</code></li><li><code>std::equal_range</code>: return an iterator pair <code>(it1, it2)</code> so that <code>value</code> is equal to <code>[it1, it2)</code></li></ul></li></ul></li></ul><h3 id="Comparison">Comparison</h3><ul><li><code>std::equal(begin1, end1, ..., [, Pred2])</code>: return a bool</li><li><code>std::lexicographical_compare(begin1, end1, begin2, end2[, Pred2])</code>: return bool; Pred2<code>acts as</code>operator&lt;&gt;`<ul><li>Compare until <code>ele1 &lt; ele2 || ele2 &lt; ele1</code></li></ul></li><li><code>std::lexicographical_compare_three_way(begin1, end1, begin2, end2[, Pred2])</code>: return an ordering; <code>Pred2</code> acts as <code>operator&lt;=&gt;</code></li><li><code>std::mismatch(begin1, end1, ...[, Pred2])</code>:  return an iterator pair <code>(it1, it2)</code> denoting the first occurrence of mismatching</li><li>These algorithms are all <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li></ul><h3 id="Counting">Counting</h3><ul><li><code>std::all_of/any_of/none_of(begin, end, Pred)</code></li><li><code>std::count(begin, end, value)</code></li><li><code>std::count_if(begin, end, Pred)</code></li><li>These algorithms are all <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li></ul><h3 id="Generating-and-Transforming">Generating and Transforming</h3><ul><li><code>std::fill(begin, end, value)</code></li><li><code>std::fill_n(begin, count, value)</code></li><li><code>std::generate(begin, end, Gen)</code>: for each element in <code>[begin, end)</code>, <code>ele = Gen()</code></li><li><code>std::for_each(begin, end, Transform)</code>: for each element in <code>[begin, end)</code>, call <code>Transform(ele)</code></li><li><code>std::transform</code>: There are unary/binary transforms<ul><li><code>(begin, end, dstBegin, Transform)</code>: unary ä¸€å…ƒ</li><li><code>(begin, end, begin2, dstBeing, Transform)</code>: binary, the transformation is <code>Transform(*it1, *it2)</code></li></ul></li></ul><h3 id="Modifying">Modifying</h3><ul><li><code>std::remove(begin, end, value)/std::remove_if(begin, end, Pred)</code>: return the iterator so that <code>[begin, it)</code> has no element that is equal to <code>value</code> or make <code>Pred</code> return <code>true</code><ul><li>ä¸ä¼šçœŸçš„æ“¦é™¤è¿­ä»£å™¨</li><li>Since C++ 20, theyâ€™re integrated as methods <code>std::erase/std::erase_if</code></li></ul></li><li><code>std::unique(begin, end[, Pred2])</code>: return the iterator so that <code>[begin, it)</code> has not adjacent equal element; <code>Pred2</code> acts as <code>operator==</code> ä½¿å¾—åœ¨ <code>[begin, it)</code> åŒºé—´å†…æ²¡æœ‰ç›¸é‚»ä¸”ç›¸ç­‰çš„å…ƒç´ </li><li>These algorithms are all <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>, by the technique of dual pointers ç®—æ³•ç”¨åŒæŒ‡é’ˆå®ç°<ul><li>å®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆ <code>before</code> å’Œ<code>after</code></li><li>ä¸¤ä¸ªæŒ‡é’ˆä¸€å¼€å§‹éƒ½æŒ‡å‘<code>begin</code></li><li>å…ˆå‰è¿›<code>after</code></li><li>åˆ¤æ–­ <code>*before == *after</code>ï¼›ç›¸ç­‰åªå‰è¿›<code>after</code>ï¼Œä¸ç›¸ç­‰åˆ™å‰è¿›<code>before</code>ï¼Œå¹¶å°†<code>after</code> æŒ‡å‘çš„å€¼å’Œ <code>before</code> äº¤æ¢ï¼Œå‰è¿›<code>after</code></li><li>ç›´åˆ°<code>after == end</code></li><li>éœ€è¦è€ƒè™‘ <code>begin == end</code> å’Œæ•´ä¸ªåºåˆ—å°±æ˜¯ unique çš„æƒ…å†µ</li></ul></li><li><code>std::replace(begin, end, oldValue, newValue)/std::replace_if(begin, end, Pred, newValue)</code></li><li><code>std::swap(x, y)</code></li><li><code>std::iter_swap(it1, it2)</code></li><li><code>std::swap_range(begin1, end1, begin2)</code></li><li><code>std::reverse(begin, end)</code></li><li><code>std::rotate(begin, mid, end)</code>: left rotate <code>[begin, mid)</code><ul><li>2, 3, 4, 4, 5 -&gt; 4, 5, 2, 3, 4 ç›¸å½“äºå·¦ç§»</li><li>Rotate is also <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container><ul><li>brute-force method: swap each element ot its position (just like bubble sort). This will be <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="11.727ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 5183.4 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mo" transform="translate(1673,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(2062,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(2884.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mi" transform="translate(3884.4,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mo" transform="translate(4405.4,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(4794.4,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> ä¸€ä¸ªä¸€ä¸ªçš„äº¤æ¢ï¼Œéœ€è¦ä¸¤å±‚å¾ªç¯<ul><li>å¯ä»¥è€ƒè™‘å°†ç¬¬ä¸€ä¸ªå…ƒç´ æ‹¿å‡ºæ¥ï¼Œå†ç¡®å®šåºåˆ—ä¸­å“ªä¸€ä¸ªå…ƒç´ ä¼šå†ä¸‹ä¸€æ­¥å‡ºç°åœ¨ç¬¬ä¸€ä¸ªä½ç½®ï¼Œç„¶åè¿›è¡Œæ›¿æ¢ï¼Œä»¥æ­¤ç±»æ¨å®Œæˆæ—‹è½¬</li><li>ä½†æ˜¯è¿™ç§æ–¹å¼å¯¹ cache ä¸å‹å¥½</li></ul></li><li>swap all groups together<ul><li>The complexity is <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container><center>    <img src="/2024/06/03/53/algorithm-modifying-rotate.png"></center></li></ul></li><li>reverse<ul><li>In fact, reverse is the basis of many algorithms</li><li><code>[begin, mid - 1]``[mid, end - 1]</code></li><li>Reverse two sub-sequences, get <code>[mid - 1, being]``[end - 1, mid]</code></li><li>Reverse the total sequence, get <code>[mid, end - 1]``[begin, mid - 1]</code></li><li>The complexity is <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="23.931ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 10577.3 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1167,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mo" transform="translate(1688,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(2299.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(3299.4,0)"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(4077.4,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(4466.4,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(5288.7,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mi" transform="translate(6288.9,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mo" transform="translate(6809.9,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(7421.1,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(8421.3,0)"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(9199.3,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(9588.3,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(10188.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li></ul></li></ul></li></ul></li><li><code>std::shift_left/right(begin, end, n)</code>: the dropped elements are permanently dropped (invalid)</li></ul><h3 id="Copying">Copying</h3><ul><li><code>std::copy(begin1, end1, dstBegin)</code></li><li><code>std::copy_if(begin1, end1, dstBegin[, Pred])</code></li><li><code>std::copy_n(begin1, n, dstBegin)</code></li><li><code>std::copy_backward(begin1, end1, dstBegin)</code></li></ul><h3 id="Partition-and-Sort">Partition and Sort</h3><h4 id="Partition">Partition</h4><p>Partition denotes that a range is divide into two parts; assuming predicate function <code>Pred</code>, then there exists an iterator <code>it</code> (i.e. partition point è½´ç‚¹ï¼‰ so that all elements in <code>[begin, it)</code> make <code>Pred</code> return <code>true</code> while <code>[it, end)</code> make <code>Pred</code> return <code>false</code> å·¦è¾¹çš„éƒ½å°äºè½´ç‚¹ï¼ˆä½¿å¾— <code>Pred</code> å‡½æ•°è¿”å› <code>true</code>ï¼‰ï¼Œå³è¾¹çš„éƒ½å¤§äºè½´ç‚¹ï¼ˆä½¿å¾—<code>Pred</code> å‡½æ•°è¿”å›<code>false</code>ï¼‰</p><ul><li><code>std::is_partitioned(begin, end, Pred)</code></li><li><code>std::partition(begin, end, Pred)</code></li><li><code>std::stable_partition(begin, end, Pred)</code>: each sub-partition preserves the original order ä¿è¯ partition åçš„ç»“æœå’ŒåŸåºåˆ—çš„é¡ºåºä¸€è‡´<ul><li>åŸåºåˆ— <code>{0, 1, 9, 4, 5, 2, 7, 8}</code>, <code>Pred</code>ä¸º <code>[](const int ele) {return ele % 2;}</code> å·¦è¾¹æ˜¯å¥‡æ•°å³è¾¹æ˜¯å¶æ•°</li><li><code>std::partition</code>: <code>{7, 1, 9, 5, 4, 2, 0, 8}</code></li><li><code>std::stable_partition</code>: <code>{1, 9, 5, 7, 0, 4, 2, 8}</code></li><li>Implementation:<ul><li>When the memory is enough ï¼ˆå†…å­˜è¶³å¤Ÿï¼‰, prepare a buffer; move the <code>false</code> range to the buffer and move the <code>true</code> range to be consecutive (just like preform <code>std::remove_if()</code>, with removed range saved in buffer). Then move the buffer elements back</li><li>When the memory is not enough ï¼ˆå†…å­˜ä¸å¤Ÿï¼‰, divide the sequence into two halves and stable partition each half<ul><li>This will from <code>[true, false], [true, false]</code> sequence æœ€ç»ˆéƒ½ä¼šå˜æˆè¿™æ ·çš„åºåˆ—</li><li>Rotate the middle <code>[false, true]</code> so that the final result is totally partitioned</li><li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.781ex;" xmlns="http://www.w3.org/2000/svg" width="21.777ex" height="2.477ex" role="img" focusable="false" viewbox="0 -750 9625.3 1095"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mo" transform="translate(704,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1093,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1693,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(2359.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mn" transform="translate(3415.6,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(3915.6,0)"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mo" transform="translate(4619.6,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mfrac" transform="translate(5008.6,0)"><g data-mml-node="mi" transform="translate(220,394) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mn" transform="translate(255.4,-345) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><rect width="624.3" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(5872.8,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(6484,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(7484.3,0)"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(8247.3,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(8636.3,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(9236.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>, to itâ€™s overall <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.896ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 3932 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"/></g><g data-mml-node="mo" transform="translate(485,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(874,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1474,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(2943,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(3543,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li></ul></li></ul></li></ul></li><li><code>std::partition_point(begin, end, Pred)</code>: assume the range is a partition å‰ææ˜¯åºåˆ—å·²ç»æ˜¯ partition</li></ul><h4 id="Sort">Sort</h4><ul><li><code>std::is_sorted(begin, end[, Pred2])</code> <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li><code>std::is_sorted_until(begin, end[, Pred2])</code> <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li><code>std::sort(begin, end[, Pred2])</code> <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="10.828ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4786 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2040,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(3509,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(4397,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li><code>std::stable_sort(begin, end[, Pred2])</code><ul><li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> space complexity, <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="10.828ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4786 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2040,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(3509,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(4397,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> time complexity</li><li>If space is insufficient, <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="13.576ex" height="2.452ex" role="img" focusable="false" viewbox="0 -833.9 6000.6 1083.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2429,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(3898,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="msup" transform="translate(4786,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mn" transform="translate(422,363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g></g><g data-mml-node="mo" transform="translate(5611.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> time complexity</li></ul></li><li>Since <code>std::sort</code> requires the complexity exactly <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="10.828ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4786 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2040,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(3509,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(4397,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>, quick sort is not enough å¿«æ’åªæ˜¯å¹³å‡æ„ä¹‰ä¸Šçš„<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="10.828ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4786 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2040,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(3509,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(4397,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>ï¼Œæœ€åçš„æƒ…å†µæ˜¯<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="6.606ex" height="2.452ex" role="img" focusable="false" viewbox="0 -833.9 2919.8 1083.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="msup" transform="translate(1152,0)"><g data-mml-node="mi"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mn" transform="translate(975.3,363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g></g><g data-mml-node="mo" transform="translate(2530.8,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li>C++ æ ‡å‡†åº“å¹¿æ³›ä½¿ç”¨çš„æ’åºç®—æ³•æ˜¯ Introspective Sort(IntroSort)<ul><li>It integrates insertion sort, heap sort and quick sort ç»“åˆäº†æ’å…¥æ’åºï¼Œå †æ’åºå’Œå¿«æ’</li><li>When the element number is <strong>low enough</strong>, insertion sort is used</li><li>When the recursion is too deep, heap sort is used<ul><li>é¿å…å¿«æ’çš„æœ€åæƒ…å†µ</li><li>å †æ’åºæ˜¯ç¨³å®š<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="10.828ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4786 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2040,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(3509,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(4397,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li>å †æ’åºé€Ÿåº¦ä¸æ˜¯å¾ˆå¿«ï¼Œå¯¹ cache ä¹Ÿä¸æ˜¯å¾ˆå‹å¥½</li></ul></li></ul></li><li><code>std::partial_sort(begin, mid, end)</code></li><li><code>std::nth_element(begin, mid, end)</code>: rearrange <code>[begin, end)</code> so that <code>*mid</code> is sorted (i.e. same as the <code>*mid</code> in the full sorted range) and the whole range is partitioned by it åœ¨æ’å¥½åºçš„ä¸­ç¬¬ n ä¸ªä½ç½®çš„å…ƒç´ </li><li><code>std::merge(begin1, end1, begin2, end2, dstBegin[, Pred2])</code></li><li><code>std::inplace_merge(begin, mid, end)</code></li></ul><h4 id="Heap">Heap</h4><ul><li><code>std::is_heap(_until)(begin, end[, Pred2])</code></li><li><code>std::make_heap(begin, end[, Pred2])</code>: Floyd algorithm <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li><li><code>std::push_heap(begin, end[, Pred2])</code></li><li><code>std::pop_heap(begin, end[, Pred2])</code></li><li><code>std::sort_heap(begin, end[, Pred2])</code></li></ul><h4 id="Set-Operations">Set Operations</h4><p>Set operations are used on <strong>sorted</strong> range, including <code>set</code></p><ul><li><code>std::includes(begin1, end1, begin2, end2[, Pred2])</code>: check whether th second range is subset of the first range<center>    <img src="/2024/06/03/53/set-operations-inclues-1.png">    <img src="/2024/06/03/53/set-operations-inclues-2.png"></center></li><li><code>std::set_intersection(begin1, end1, begin2, end2, dstBegin[, Pred2])</code>: <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="5.929ex" height="1.67ex" role="img" focusable="false" viewbox="0 -716 2620.4 738"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g><g data-mml-node="mo" transform="translate(972.2,0)"><path data-c="2229" d="M88 -21T75 -21T55 -7V200Q55 231 55 280Q56 414 60 428Q61 430 61 431Q77 500 152 549T332 598Q443 598 522 544T610 405Q611 399 611 194V-7Q604 -22 591 -22Q582 -22 572 -9L570 405Q563 433 556 449T529 485Q498 519 445 538T334 558Q251 558 179 518T96 401Q95 396 95 193V-7Q88 -21 75 -21Z"/></g><g data-mml-node="mi" transform="translate(1861.4,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g></g></g></svg></mjx-container></li><li><code>std::set_union(begin1, end1, begin2, end2, dstBegin[, Pred2])</code>: <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="5.929ex" height="1.67ex" role="img" focusable="false" viewbox="0 -716 2620.4 738"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g><g data-mml-node="mo" transform="translate(972.2,0)"><path data-c="222A" d="M591 598H592Q604 598 611 583V376Q611 345 611 296Q610 162 606 148Q605 146 605 145Q586 68 507 23T333 -22Q268 -22 209 -1T106 66T56 173Q55 180 55 384L56 585Q66 598 75 598Q85 598 95 585V378L96 172L98 162Q112 95 181 57T332 18Q415 18 487 58T570 175Q571 180 571 383V583Q579 598 591 598Z"/></g><g data-mml-node="mi" transform="translate(1861.4,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g></g></g></svg></mjx-container></li><li><code>std::set_symmetric_difference(begin1, end1, begin2, end2, dstBegin[, Pred2])</code>: <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="6.18ex" height="1.805ex" role="img" focusable="false" viewbox="0 -716 2731.4 798"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g><g data-mml-node="mo" transform="translate(972.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mi" transform="translate(1972.4,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g></g></g></svg></mjx-container></li><li><code>std::set_difference(begin1, end1, begin2, end2, dstBegin[, Pred2])</code>: <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="12.151ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 5370.9 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g><g data-mml-node="mo" transform="translate(972.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mo" transform="translate(1972.4,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(2361.4,0)"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g><g data-mml-node="mo" transform="translate(3333.7,0)"><path data-c="2229" d="M88 -21T75 -21T55 -7V200Q55 231 55 280Q56 414 60 428Q61 430 61 431Q77 500 152 549T332 598Q443 598 522 544T610 405Q611 399 611 194V-7Q604 -22 591 -22Q582 -22 572 -9L570 405Q563 433 556 449T529 485Q498 519 445 538T334 558Q251 558 179 518T96 401Q95 396 95 193V-7Q88 -21 75 -21Z"/></g><g data-mml-node="mi" transform="translate(4222.9,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="mo" transform="translate(4981.9,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li></ul><h4 id="MinMax">MinMax</h4><ul><li><code>std::min/max/minmax(a, b[, Pred2])</code>: return (pair of) reference of the smaller/bigger element</li><li><code>std::min_element/max_element/minmax_element(begin, end[, Pred2])</code>: return the iterator of the minimum/maximum value in the range</li><li><code>std::clamp(value, low, high)</code></li></ul><h4 id="Permutation">Permutation</h4><p>Permutation means that two sequence are <strong>unorderly equal</strong></p><ul><li><code>std::is_permutation(begin, end1, begin2[, Pred2])</code><ul><li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.832ex" height="2.452ex" role="img" focusable="false" viewbox="0 -833.9 2577.6 1083.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="msup" transform="translate(1152,0)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mn" transform="translate(633,363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g></g><g data-mml-node="mo" transform="translate(2188.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li></ul></li><li><code>std::prev/next_permutation(begin, end[, Pred2])</code>: return the sequence to the previous/next permutation</li></ul><h4 id="Numeric-Algorithms">Numeric Algorithms</h4><p>They are all <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></p><ul><li>For the most basic ones:<ul><li><code>std::iota(begin, end, beginVal)</code>: fill in <code>[begin, end)</code> with <code>{beginVal, ++beginVal, ...}</code></li><li><code>std::adjacent_difference(begin, end, dstBegin, Op = std::minus)</code>: as its name, output <code>{val[0], val[1] - val[0], val[2] - val[1], ...}</code></li><li><code>std::accumulate(begin, end, initVal, Op = std::plus)</code>: accumulate all values, return <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.975ex;" xmlns="http://www.w3.org/2000/svg" width="19.261ex" height="3.165ex" role="img" focusable="false" viewbox="0 -967.8 8513.5 1398.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtext"><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z"/><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"/><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z" transform="translate(834,0)"/><path data-c="74" d="M27 422Q80 426 109 478T141 600V615H181V431H316V385H181V241Q182 116 182 100T189 68Q203 29 238 29Q282 29 292 100Q293 108 293 146V181H333V146V134Q333 57 291 17Q264 -10 221 -10Q187 -10 162 2T124 33T105 68T98 100Q97 107 97 248V385H18V422H27Z" transform="translate(1112,0)"/><path data-c="56" d="M114 620Q113 621 110 624T107 627T103 630T98 632T91 634T80 635T67 636T48 637H19V683H28Q46 680 152 680Q273 680 294 683H305V637H284Q223 634 223 620Q223 618 313 372T404 126L490 358Q575 588 575 597Q575 616 554 626T508 637H503V683H512Q527 680 627 680Q718 680 724 683H730V637H723Q648 637 627 596Q627 595 515 291T401 -14Q396 -22 382 -22H374H367Q353 -22 348 -14Q346 -12 231 303Q114 617 114 620Z" transform="translate(1501,0)"/><path data-c="61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z" transform="translate(2251,0)"/><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z" transform="translate(2751,0)"/></g><g data-mml-node="mo" transform="translate(3251.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="munderover" transform="translate(4251.4,0)"><g data-mml-node="mo"><path data-c="2211" d="M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z"/></g><g data-mml-node="TeXAtom" transform="translate(1089,477.1) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z"/><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(444,0)"/><path data-c="64" d="M376 495Q376 511 376 535T377 568Q377 613 367 624T316 637H298V660Q298 683 300 683L310 684Q320 685 339 686T376 688Q393 689 413 690T443 693T454 694H457V390Q457 84 458 81Q461 61 472 55T517 46H535V0Q533 0 459 -5T380 -11H373V44L365 37Q307 -11 235 -11Q158 -11 96 50T34 215Q34 315 97 378T244 442Q319 442 376 393V495ZM373 342Q328 405 260 405Q211 405 173 369Q146 341 139 305T131 211Q131 155 138 120T173 59Q203 26 251 26Q322 26 373 103V342Z" transform="translate(1000,0)"/></g></g><g data-mml-node="TeXAtom" transform="translate(1089,-285.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><path data-c="62" d="M307 -11Q234 -11 168 55L158 37Q156 34 153 28T147 17T143 10L138 1L118 0H98V298Q98 599 97 603Q94 622 83 628T38 637H20V660Q20 683 22 683L32 684Q42 685 61 686T98 688Q115 689 135 690T165 693T176 694H179V543Q179 391 180 391L183 394Q186 397 192 401T207 411T228 421T254 431T286 439T323 442Q401 442 461 379T522 216Q522 115 458 52T307 -11ZM182 98Q182 97 187 90T196 79T206 67T218 55T233 44T250 35T271 29T295 26Q330 26 363 46T412 113Q424 148 424 212Q424 287 412 323Q385 405 300 405Q270 405 239 390T188 347L182 339V98Z"/><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z" transform="translate(556,0)"/><path data-c="67" d="M329 409Q373 453 429 453Q459 453 472 434T485 396Q485 382 476 371T449 360Q416 360 412 390Q410 404 415 411Q415 412 416 414V415Q388 412 363 393Q355 388 355 386Q355 385 359 381T368 369T379 351T388 325T392 292Q392 230 343 187T222 143Q172 143 123 171Q112 153 112 133Q112 98 138 81Q147 75 155 75T227 73Q311 72 335 67Q396 58 431 26Q470 -13 470 -72Q470 -139 392 -175Q332 -206 250 -206Q167 -206 107 -175Q29 -140 29 -75Q29 -39 50 -15T92 18L103 24Q67 55 67 108Q67 155 96 193Q52 237 52 292Q52 355 102 398T223 442Q274 442 318 416L329 409ZM299 343Q294 371 273 387T221 404Q192 404 171 388T145 343Q142 326 142 292Q142 248 149 227T179 192Q196 182 222 182Q244 182 260 189T283 207T294 227T299 242Q302 258 302 292T299 343ZM403 -75Q403 -50 389 -34T348 -11T299 -2T245 0H218Q151 0 138 -6Q118 -15 107 -34T95 -74Q95 -84 101 -97T122 -127T170 -155T250 -167Q319 -167 361 -139T403 -75Z" transform="translate(1000,0)"/><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z" transform="translate(1500,0)"/><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(1778,0)"/></g></g></g><g data-mml-node="mtext" transform="translate(7207.5,0)"><path data-c="76" d="M338 431Q344 429 422 429Q479 429 503 431H508V385H497Q439 381 423 345Q421 341 356 172T288 -2Q283 -11 263 -11Q244 -11 239 -2Q99 359 98 364Q93 378 82 381T43 385H19V431H25L33 430Q41 430 53 430T79 430T104 429T122 428Q217 428 232 431H240V385H226Q187 384 184 370Q184 366 235 234L286 102L377 341V349Q377 363 367 372T349 383T335 385H331V431H338Z"/><path data-c="61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z" transform="translate(528,0)"/><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z" transform="translate(1028,0)"/></g></g></g></svg></mjx-container></li><li><code>std::partial_sum(begin, end, dstBegin, Op = std::plus)</code>: output <code>{val[0], val[0] + val[1], val[0] + val[1] + val[2], ...}</code></li><li><code>std::inner_product(begin1, end1, begin2, initVal, Op1 = std::plus, Op2 = std::multiplies)</code>: finally get <code>initVal + a[0] * b[0] + a[1] * b[1] + ...</code></li><li><code>std::reduce(begin, end, initVal, Op = std::plus)</code>: same as accumulate</li><li><code>std::inclusive_scan(begin, end, dstBegin, Op = std::plus[, initVal])</code>: same as partial sum</li><li><code>std::transform_reduce(begin1, end1, begin2, initVal, ReduceOp = std::plus, BiTransformOp = std::multiplies)</code>: same as inner product</li><li><code>std::exclusive_scan(begin, end, dstBegin, initVal, Op = std::plus)</code>: similar to partial, but exclude the element itself, i.e. the sequence is <code>{initVal, initVal + val[0], ..., initVal + val[0] + ... + val[n - 2]}</code></li><li><code>std::transform_inclusive_scan(begin, end, dstBegin, Op, UnaryTransformOp[, initVal])</code></li><li><code>std::transform_exclusive_scan(begin, end, dstBegin, Op, UnaryTransformOp[, initVal])</code></li></ul></li><li><code>std::gcd(a, b)</code>: æœ€å¤§å…¬çº¦æ•°</li><li><code>std::lcm(a, b)</code>: æœ€å°å…¬å€æ•°</li><li><code>std::midpoint(a, b)</code>: since C++ 20, return <code>a + (b - a) / 2</code></li></ul><h4 id="Parallel-Algorithm">Parallel Algorithm</h4><ul><li>There are two kinds of parallelism<ul><li>SIMD: single instruction multiple data å•æŒ‡ä»¤å¤šæ•°æ®</li><li>SIMT: single instruction multiple threads</li></ul></li><li>Since C++ 17, parallel-version algorithms are added</li><li>Defined in <code>&lt;execution&gt;</code><ul><li>There are four execution policies defined in <code>std::execution</code><ul><li><code>seq</code>: sequenced policy å®Œå…¨ä¸å¹¶è¡Œ</li><li><code>par</code>: parallel policy å¹¶è¡Œ</li><li><code>unseq</code>: unsequenced policy (since C++ 20) ç®—æ³•å¯ä»¥é€‚åº” SIMD</li><li><code>par_unseq</code>: parallel and unsequenced policy</li></ul></li></ul></li><li>There are four kinds of data dependencies<ul><li>RAR: read after read å¯ä»¥ä½¿ç”¨<code>par_unseq</code><ul><li>E.g. <code>std::adjacent_find</code></li></ul></li><li>RAW: read after write, e.g. <code>a[j] = a[j - 1] + 1</code></li><li>WAR: write after read, e.g. <code>a[j - 1] = a[j] + 1</code></li><li>WAW: write after write</li></ul></li><li>Parallel algorithms<ul><li><code>std::partition</code>, <code>std::nth_element</code></li><li><code>std::merge</code></li><li><code>std::inplace_merge</code></li></ul></li><li>There are also some algorithms that cannot be parallelized<ul><li>Those who only operate on several values, e.g. <code>std::min/max/minmax/clamp</code>, <code>std::swap/iter_swap</code></li><li>éšæœºç®—æ³•</li><li><code>std::search</code></li><li><code>std::push/pop/make/sort_heap</code></li><li>æ’åˆ—ç®—æ³•</li><li>äºŒå‰æœç´¢ç®—æ³•</li><li>Ordered numeric algorithms, i.e. <code>std::iota/accumulate/inner_product/partial_sum</code></li></ul></li></ul><h4 id="Range-version-Algorithms">Range-version Algorithms</h4><p>ç®—æ³•ä¸­éœ€è¦å£°æ˜è¿­ä»£å™¨ï¼Œå½“æ“ä½œçš„æ˜¯ä¸€æ•´ä¸ªå®¹å™¨æ—¶ï¼Œå°±éœ€è¦ <code>begin</code> å’Œ<code>end</code>ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨<code>ranges</code>ã€‚range-version ç®—æ³•ä¹Ÿå¯ä»¥å«åš constrained algorithmsï¼Œä½¿å¾—ç®—æ³•æ“ä½œæ›´åŠ çµæ´»</p><ul><li>You can additionally specify <strong>projection</strong> as the last parameter, i.e. transformation of elements before entering the real function æœ€åä¸€ä¸ªå‚æ•°å¯ä»¥æŒ‡å®šä¸€ä¸ªæ˜ å°„ï¼Œä¾‹å¦‚ä½¿ç”¨ transform åœ¨ä¼ å…¥å‡½æ•°å‰è¿›è¡Œå˜æ¢<ul><li>This just changes criteriaï¼ˆæ ‡å‡†ï¼›æ¡ä»¶ï¼‰, the element itself is unchanged</li><li>Multiple ranges may specify multiple projections</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">std::vector vec{<span class="number">-1</span>, <span class="number">2</span>, <span class="number">-3</span>, <span class="number">4</span>, <span class="number">-5</span>, <span class="number">6</span> };</span><br><span class="line"><span class="keyword">auto</span> print = [](<span class="type">int</span> i) {</span><br><span class="line">    std::cout &lt;&lt; i &lt;&lt; <span class="string">","</span>;</span><br><span class="line">};</span><br><span class="line">std::cout &lt;&lt; <span class="string">"with abs() projection: \n"</span>;</span><br><span class="line">std::ranges::<span class="built_in">sort</span>(vec, {}, [](<span class="type">int</span> i) {<span class="keyword">return</span> std::<span class="built_in">abs</span>(i); });</span><br><span class="line">std::range::for_each(vec, print);</span><br></pre></td></tr></table></figure><ul><li>Range-version algorithms also have these advantages<ul><li>ä½¿ç”¨äº† C++20 ä¸­çš„ concept</li><li>The range doesnâ€™t need to be comma (i.e. <code>begin/end</code> with the same type) <code>begin</code>å’Œ <code>end</code> ä¸è¦æ±‚ç±»å‹ç›¸åŒ</li><li>æ›´åŠ å®‰å…¨</li><li>æœ‰äº›ç®—æ³•è¢«åŠ å¼ºäº†</li><li>æ–°çš„æ–¹æ³•åŠ å…¥è¿›æ¥</li><li>ç”¨æ¨¡æ¿æ–¹æ³•æ›´å®¹æ˜“</li></ul></li><li>There are also some defects<ul><li>ä¸èƒ½ä½¿ç”¨å¹¶è¡Œç®—æ³•</li><li>ä¸€äº›ç®—æ³•è¢«å‰Šå¼±äº†</li><li>è¿”å›å€¼ç±»å‹å¹¶ä¸å’Œ <code>std::</code> ç›¸åŒï¼Œè¿”å›å€¼æ”¹å˜æœ‰ä»¥ä¸‹å‡ ç§å½¢å¼<ul><li><code>stdr::in_in_result&lt;I1, I2&gt;</code>: æœ¬æ¥è¿”å›ä¸¤ä¸ªè¿­ä»£å™¨ï¼Œç°åœ¨è¿”å›äº†ä¸€ä¸ªç»“æ„ä½“ï¼Œé‡Œé¢çš„æˆå‘˜å˜é‡æ˜¯ä¸¤ä¸ªè¿­ä»£å™¨</li><li><code>stdr::in_out_result&lt;I, O&gt;</code></li><li><code>stdr::in_in_out_result&lt;I1, I2, O&gt;</code><ul><li><code>stdr::set_union/intersection/symmetric_difference</code></li><li><code>stdr::merge</code></li><li>binary <code>stdr::transform</code></li></ul></li><li><code>stdr::in_out_out_result&lt;I1, I2, O&gt;</code><ul><li><code>stdr::partition_copy</code></li></ul></li><li><code>stdr::in_found_result&lt;T&gt;</code></li></ul></li></ul></li></ul><h2 id="Lifetime">Lifetime</h2><h3 id="Storage-duration- å­˜å‚¨æŒç»­æ€§">Storage duration å­˜å‚¨æŒç»­æ€§</h3><p>There are four kinds of storage duration</p><ul><li>Static storage duration: global variables, static variables in a function/class</li><li>Automatic storage duration: variables that belong to a block scope ro function arguments å®šä¹‰çš„æ—¶å€™æ„é€ ï¼Œæ¨å‡ºçš„æ—¶å€™ææ„</li><li>Dynamic storage duration: you can create objects by using or some other allocation functions</li><li>Thread storage duration: çº¿ç¨‹åˆ›å»ºçš„æ—¶å€™æ„é€ ï¼Œçº¿ç¨‹é€€å‡ºçš„æ—¶å€™ææ„</li></ul><p>The lifetime of an object begins when storage with proper alignment and size is allocated and the object is initialized åˆé€‚çš„å¯¹é½ï¼Œåˆé€‚çš„å¤§å°ï¼Œä»¥åŠåˆå§‹åŒ–</p><p>The lifetime of an object ends when itâ€™s destroy, or the dtor is called, or its storage is released or reused by non-nested object ææ„å‡½æ•°è¢«è°ƒç”¨ï¼Œå­˜å‚¨è¢«é‡Šæ”¾ï¼Œè¢«é‡ç”¨ï¼ˆ<code>float</code>ç±»å‹çš„å˜é‡é€šè¿‡æŸäº›æ‰‹æ®µè¢« <code>int</code> ç±»å‹å˜é‡å ç”¨ï¼‰</p><p>Temporary objects are only alive until the statement ends (i.e. until <code>;</code>) ä¸´æ—¶å˜é‡çš„å£°æ˜å‘¨æœŸåªåˆ°è¯­å¥ç»“æŸä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯ <code>;</code> åˆ†å·ä¹‹åæ‰ç»“æŸ</p><ul><li><p>å‡½æ•°ä¸­çš„å‚æ•°ä¼ é€’ <code>const&amp;</code> æˆ–<code>std::function_ref</code>æ˜¯å®‰å…¨çš„</p></li><li><p>è¿”å›ä¸´æ—¶å˜é‡å¯ä»¥å»¶é•¿å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¾‹å¦‚<code>const&amp;</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span>{};</span><br><span class="line"><span class="function">A <span class="title">bar</span><span class="params">()</span> </span>{<span class="keyword">return</span> A{};};</span><br><span class="line"><span class="type">const</span> A&amp; a = <span class="built_in">bar</span>();</span><br></pre></td></tr></table></figure></li></ul><p>In modern C++, <strong>pointer is far beyond address</strong>; it has type <code>T*</code>, and you can hardly ever access some address by it when there are no underlying objects of type <code>T</code> alive æŒ‡é’ˆçš„åŠŸèƒ½è¿œè¿œè¶…å‡ºå¯»å€çš„è¯­ä¹‰ï¼ŒæŒ‡é’ˆæ˜¯å¸¦æœ‰ç±»å‹çš„æ¦‚å¿µï¼›å¦‚æœæŒ‡é’ˆæŒ‡å‘çš„åœ°å€ä¸ç¬¦åˆæŒ‡é’ˆå…·æœ‰çš„ç±»å‹ï¼Œå¦‚æœå†ç”¨æŒ‡é’ˆè®¿é—®ç›¸åº”çš„å…ƒç´ å°±ä¼šæ˜¯æ— æ•ˆçš„</p><h3 id="Placement-new">Placement new</h3><p>â€œå°±åœ°åˆå§‹åŒ–â€ <code>ConstructOnBuffet</code>, which wonâ€™t allocate memory, but only create the object at the place ä¸åœ¨é‡æ–°åˆ†é…å†…å­˜ï¼Œç›´æ¥åœ¨ç°æœ‰å·²å¼€è¾Ÿçš„å†…å­˜ç©ºé—´ä¸­åˆ›å»ºå¯¹è±¡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alignas</span>(T) <span class="type">unsigned</span> chat buf[<span class="built_in">sizeof</span>(T)];</span><br><span class="line">T* tptr = <span class="built_in">new</span>(buf) T;</span><br><span class="line">tptr-&gt;~<span class="built_in">T</span>();</span><br></pre></td></tr></table></figure><ul><li><code>new(buffet) Type Initializer</code>, where <code>Initializer</code> is optional</li><li>Of course, you need to make sure the alignment satisfies the requirement of the type, so you can use keyword <code>alignas</code>  ä¸ºäº†ä¿è¯ç±»å‹å¯¹é½éœ€è¦ç”¨åˆ°åœ¨ C++ 11 å¼•å…¥çš„å…³é”®å­—<code>alignas</code></li></ul><blockquote><ul><li><code>std::byte</code>: defined in <code>&lt;cstddef&gt;</code> since C++ 17; itâ€™s just an enumeration class and explicitly represents a byte (before we may use <code>unsigned char</code>)</li><li>Trivial dtor<ul><li>Itâ€™s implicitly declared or declared with <code>=default</code> éšå¼ç”Ÿæˆï¼ˆç¼–è¯‘å™¨ï¼‰çš„æˆ–è€…è¢«å®šä¹‰ä¸º<code>default</code></li><li>Itâ€™s non-virtual and all non-static data members have trivial dtor æ‰€æœ‰çš„éé™æ€æˆå‘˜éƒ½æœ‰ trivial dtorï¼Œå¹¶ä¸”æˆå‘˜ä¸èƒ½æ˜¯è™šçš„</li><li>For example<ul><li>âœ…<code>struct A{int a; float b;};</code></li><li>âœ…<code>class A{int a; public: float b; ~A() = default };</code></li><li>âœ…<code>class A{int a; public: float b; virtual ~A() = default };</code></li><li>â<code>class B : public A{};</code></li><li>â<code>class A{~A() {}};</code></li><li>â<code>class A{std::unique_ptr&lt;int&gt; ptr;};</code></li></ul></li></ul></li></ul></blockquote><h3 id="Corner-Cases">Corner Cases</h3><ul><li>Case1: if you construct an object that has the same type as the original object, and they occupies exactly same storage, then the original name, pointers and references are still valid å°±åƒèµ‹å€¼ç¬¦å·ä¸€æ ·</li><li>Case2: itâ€™s best to reuse storage of plain types like <code>int</code> or classes that have trivial dtor å¦‚æœè¦é‡ç”¨å†…å­˜å°½é‡ä½¿ç”¨ç®€å•çš„ç±»å‹ï¼Œä¾‹å¦‚ <code>int</code> æˆ–è€…å¸¦æœ‰ trivial dtor çš„ç±»ï¼Œå¯¹äºå…¶ä»–ç±»å‹ç¼–è¯‘å™¨ä¼šåœ¨é€€å‡ºå½“å‰ scope æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°</li><li>Case3: itâ€™s illegal to reuse memory of <code>const</code> objects that have determined their value in the compilation time</li><li>Case4: <code>unsigned char/std::byte</code> array is explicitly regulated to be able to provide storage è¿™ä¸¤ä¸ªç±»å‹çš„æ•°ç»„æ˜¯æ˜ç¡®åœ°å¯ä»¥æä¾› storage çš„</li><li>Case5: Itâ€™s legal to access the underlying object by pointers without the same type in these cases (type punning/aliasing ç±»å‹å †å  / ç±»å‹åˆ«åï¼‰ åœ¨å°‘æ•°æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ä¸åŒç±»å‹çš„æŒ‡é’ˆè®¿é—®ä¸€äº›å¯¹è±¡<ul><li>add/remove cv-qualification <code>int</code>ç±»å‹çš„æŒ‡é’ˆå¯ä»¥ä½¿ç”¨ <code>const int</code> ç±»å‹çš„æŒ‡é’ˆè®¿é—®</li><li>decayed array ç”¨æŒ‡é’ˆè®¿é—®æ•°ç»„çš„å…ƒç´ </li><li>if the underlying type is integer, then using the pointer of its signed/unsigned variant to access it is OK</li><li>convert it to <code>(unsigned) char*/ std::byte*</code> å…è®¸å°†å¯¹è±¡è§†ä½œå­—èŠ‚æ•°ç»„ byte array</li></ul></li><li>Case6:If you have an old pointer where youâ€™ve constructed a new object, but you want to use the old pointer to get the new pointer, you can use <code>std::launder</code>ï¼ˆæ´—æ¶¤ï¼›æ´—é’±ï¼‰ defined in <code>&lt;new&gt;</code> since C++ 17<ul><li><code>std::launder(reinterpret_cast&lt;A*&gt;(buffer))</code> to get the actual valid pointer ç”¨æ—§çš„æŒ‡é’ˆè·å¾—æŒ‡å‘æ–°çš„å¯¹è±¡çš„æŒ‡é’ˆ</li></ul></li></ul><h3 id="Strict-Aliasing-Rules">Strict Aliasing Rules</h3><p>Strict aliasing rules, if pointers are not aliased or not contained as member, then compilers can freely assume that theyâ€™re different objects æœ¬è´¨ä¸Šå°±æ˜¯æ£€æŸ¥ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘çš„åŒºåŸŸæœ‰æ²¡æœ‰å¯èƒ½é‡å </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">T</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">uint8_t</span>* target;</span><br><span class="line">    <span class="type">char</span>* source;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Unpack</span><span class="params">(<span class="type">int</span> size)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">while</span> (size &gt; <span class="number">0</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="type">uint64_t</span> t;</span><br><span class="line">            std::<span class="built_in">memcpy</span>(&amp;t, source, <span class="built_in">sizeof</span>(t));</span><br><span class="line">            target[<span class="number">0</span>] = t &amp; <span class="number">0x7</span>;</span><br><span class="line">            target[<span class="number">1</span>] = (t &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">            target[<span class="number">2</span>] = (t &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">            target[<span class="number">3</span>] = (t &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">            source += <span class="number">6</span>, size -= <span class="number">6</span>, target += <span class="number">16</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></table></figure><ul><li>Compared with non-member version (i.e. <code>Unpack(uint8_t* target, char* src, int size)</code>), itâ€™s 15% slower</li><li><code>target</code> is an alias of <code>this</code>. It will then always reload <code>target[i]</code> instead of caching a <code>qword</code> to prevent change of <code>target</code> ç¼–è¯‘å™¨è®¤ä¸º <code>target</code> æ˜¯<code>this</code>çš„åˆ«å</li></ul><h3 id="Others">Others</h3><ul><li>Attention to lambda lifetime<ul><li>Lambda lifetime should always be shorter than reference captures</li><li>If you capture in the class, then this only captures members by <code>this</code>, which may be invalid after destruction å¦‚æœ <code>this</code> è¢«ææ„æ‰ï¼Œå°±ç®—æ˜¯æŠŠ <code>this</code> æ‹·è´å‡ºæ¥ï¼Œè¿˜æ˜¯å¤±æ•ˆçš„</li></ul></li><li>Attention to view lifetime<ul><li>Sometimes you mey return a view generated by range adaptor in a function (e.g. <code>v | std::reverse</code>)<ul><li>For lvalue, itâ€™s same as the lvalue itself, i.e. <code>v</code> here</li><li>For rvalue, itâ€™ll same as return a value, so that itâ€™s always safe ä¸´æ—¶å€¼</li></ul></li><li>æ‰€æœ‰çš„ range adaptors åœ¨è°ƒç”¨ä¹‹å‰éƒ½ä¼šè°ƒç”¨ <code>stdv::all</code> å°è¯•å°† range è½¬æ¢æˆ viewï¼›ä½†æ˜¯å¯¹äº view æ¥è¯´ä¸åšä»»ä½•äº‹æƒ…<ul><li>For lvalue range, itâ€™ll create a <code>stdr::ref_view</code></li><li>For rvalue range, itâ€™ll create a <code>stdr::owning_view</code></li></ul></li></ul></li></ul><h2 id="Type-Safety">Type Safety</h2><h3 id="Implicit-Conversion">Implicit Conversion</h3><ul><li>Some implicit conversions are automatic (standard conversions), and others are user-defined å¾ˆå¤šéšå¼çš„è½¬å‹éƒ½æ˜¯è‡ªåŠ¨çš„<ul><li>E.g. <code>operator float()</code>. If you declare it as <code>explicit</code>, then implicit conversion will be disabled</li></ul></li><li>Standard conversions<ul><li>Lvalue-to rvalue conversion, array-to-pointer conversion, function-to-pointer conversion<ul><li>Decay actually means<ul><li>Array/Function -&gt; pointer</li><li>Or for other types, remove remove references first, remove cv-qualifiers(const &amp; volatile) next</li><li>You can use <code>std::decay_t&lt;T&gt;</code> to get the decayed type</li><li><code>auto a = xx;</code> will also decay the deduced type, while <code>auto&amp;</code> will not<ul><li>But structured binding <code>auto [a, b] = xx;</code> â€œseemsâ€ not decay decay çœ‹ä¼¼æ²¡å‘ç”Ÿï¼Œå…¶å®æ˜¯å‘ç”Ÿåœ¨ç»“æ„åŒ–ç»‘å®šçš„å®ç°ä¸Šï¼Œç›¸å½“äº <code>auto anonymous = xx;</code>ï¼Œ<code>a</code> å’Œ<code>b</code>æ˜¯æˆå‘˜å˜é‡çš„åˆ«åï¼Œdecay å‘ç”Ÿåœ¨ <code>anonymous</code> ä¸­</li></ul></li></ul></li></ul></li><li>Numeric promotions and conversions<ul><li>Promotion: promotion has higher precedence and will not lose precision<ul><li><code>b + c</code> where <code>b</code> and <code>c</code> are <code>unsigned short</code> will in fact silently promote them to <code>int</code> and then do <code>+</code> å…ˆæå‡åˆ° <code>int</code> ç„¶åå†åšåŠ æ³•</li><li>è‡³å°‘æå‡åˆ°<code>int</code></li><li><code>float</code> can be promoted to <code>double</code></li></ul></li><li>Signed value has negative values while unsigned ones donâ€™t, but conversion may happen</li><li><code>float</code> cannot represent all <code>int/...</code> but <code>int</code> can be converted to <code>float</code> implicitly</li><li>Any scalar types can be converted to <code>bool</code></li><li>Pointers can be converted to <code>void*</code> to base class, and <code>nullptr</code> can be converted to pointer directly</li><li>Pointer to member of derived class can also be converted to pointer to member of base class, i.e. <code>Derived::int*</code> -&gt; <code>Base::int*</code></li><li>There are also some numeric conversions that need explicit cast æ•°å€¼ä¸Šçš„è½¬æ¢éœ€è¦æ˜¾ç¤ºçš„è½¬æ¢<ul><li>Narrow integer conversion will mod <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.279ex" height="1.528ex" role="img" focusable="false" viewbox="0 -675.5 1007.3 675.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g></g></g></g></svg></mjx-container> ä¾‹å¦‚ <code>int</code> -&gt; <code>short</code>ï¼Œ<code>long long</code> -&gt; <code>int</code> ä¼šæŠŠé«˜ä½çš„ä½æ•°æˆªæ–­</li><li>Narrow floating conversion will be rounded</li><li>Floating to integer will truncate the digits after dot; UB if truncated integer is not representable by converted type</li></ul></li></ul></li><li>(Exception-specified) function pointer conversion<ul><li>å¯ä»¥æŠŠ <code>noexcept</code> çš„å‡½æ•°æŒ‡é’ˆè½¬æ¢æˆæ²¡æœ‰ <code>noexcept</code> çš„å‡½æ•°æŒ‡é’ˆ</li></ul></li><li>Qualification conversions<ul><li>You can convert a non-const/non-volatile to const/volatile one</li></ul></li></ul></li></ul><h3 id="Static-Cast">Static Cast</h3><p><code>static_cast</code> is the most powerful one, which can process almost all of normal conversion,defined as <code>static_cast&lt;TargetType&gt;(Exp)</code></p><blockquote><p><strong>Standard-layout</strong></p><ul><li>æ‰€æœ‰çš„æˆå‘˜éƒ½æœ‰ç›¸åŒçš„è®¿é—®å±æ€§</li><li>æ²¡æœ‰è™šå‡½æ•°</li><li>The base class is not the type of the first member data åŸºç±»å¯¹è±¡ä¸èƒ½æ˜¯å­ç±»ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡</li><li>æ•´ä¸ªç»§æ‰¿ç»“æ„ï¼Œåªèƒ½æœ‰å…¶ä¸­ä¸€ä¸ªç±»æ˜¯æœ‰éé™æ€çš„å˜é‡</li></ul></blockquote><ul><li>All implicit conversions can be explicitly denoted by <code>static_cast</code> å¯ä»¥åšä»»ä½•ä¸€ç§éšå¼çš„è½¬æ¢ï¼Œä¹Ÿä¼šå…è®¸é€†æ“ä½œ e.g. <code>int</code> -&gt; <code>short</code>, <code>double</code> -&gt; <code>float</code></li><li>Scoped enumeration can be converted to/from integer or floating point, which is same as the underlying integer type</li><li>Inheritance-related conversions<ul><li>upcast å‘åŸºç±»è½¬æ¢ï¼›æ›´å®‰å…¨çš„</li><li>downcast å‘æ´¾ç”Ÿç±»è½¬æ¢ï¼›æœ‰ç‚¹å±é™©</li></ul></li><li>For <code>static_cast</code>, besides inheritance-related pointer conversion, it also processes <code>void*</code><ul><li>You can convert any object pointer to <code>void*</code> (this is also implicit conversion)</li><li>You can also convert explicitly <code>void*</code> to any object pointer å‰ææ˜¯å¯¹è±¡æ½œåœ¨çš„ç±»å‹ <code>U</code> å’ŒæŒ‡é’ˆçš„ç±»å‹ <code>T</code> æœ‰æŸç§ç‰¹æ®Šçš„å…³ç³»â€”â€”pointer-interconvertible<ul><li><code>T == U</code></li><li><code>U</code> is a union type, while <code>T</code> is type of its member</li><li><code>U</code> is standard-layout, while <code>T</code> is type of its first member or its base class</li><li>Or all vice versa/transitivity</li></ul></li></ul></li><li>å¹¶ä¸ä¿è¯åœ°å€æ˜¯ç›¸åŒçš„</li><li>Convert to <code>void</code>: just discard value, nothing happens</li><li>Construct new object: if the object ctor can accept a single parameter, which is convertible from the expression, then it in fact constructs a new object. E.g. <code>static_cast&lt;A&gt;(a)</code> for <code>A(int)</code></li><li>Transform value category</li><li><code>static_cast</code> can be used to specify which overload of functions is used by function-to-pointer conversion</li></ul><h3 id="Dynamic-Cast-and-RTTI">Dynamic Cast and RTTI</h3><h4 id="Dynamic-Cast">Dynamic Cast</h4><p><code>static_cast</code>åœ¨ç»§æ‰¿é“¾ä¸­æ£€æŸ¥æ˜¯éå¸¸å¼±çš„ï¼ˆå¯ä»¥è¯´æ˜¯ä¸åšæ£€æŸ¥ï¼‰ï¼Œå³ä¾¿è½¬æ¢çš„å¯¹è±¡ä¸æ˜¯æ´¾ç”Ÿç±»çš„ç±»å‹ä»ç„¶ä¼šåšè½¬æ¢ï¼Œåªæ˜¯ä¼šå¸¦æ¥ undefined behaviorã€‚<code>dynamic_cast</code>å°è¯•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœè½¬æ¢ä¸åˆé€‚ä¼šå¤±è´¥</p><ul><li>å¼•ç”¨ä¸Šè½¬æ¢å¤±è´¥ä¼šæŠ›å‡ºå¼‚å¸¸<code>throw std::bad_cast</code></li><li>æŒ‡é’ˆä¸Šè½¬æ¢å¤±è´¥ä¼šè¿”å›<code>nullptr</code></li><li>æ¯” UB æ›´å¼ºï¼Œæ›´å®¹æ˜“å®šä½ bug</li></ul><p>ä¸ºäº†åšäº†è¿è¡Œæ—¶æ£€æŸ¥ï¼ŒC++ ç¼–è¯‘å™¨ä¼šåœ¨æ–‡ä»¶ä¸­ä¿ç•™è¿è¡Œæ—¶çš„ç±»å‹è¯†åˆ«ï¼ˆRTTI, Run-Time Type Information/Identificationï¼‰ï¼Œ<code>dynamic_cast</code>åªèƒ½ç”¨åœ¨å¤šæ€çš„ç±»å‹è½¬æ¢ä¸­ï¼Œå› ä¸º RTTI ä¾èµ–äºè™šæŒ‡é’ˆç­‰ç‰¹æ€§ã€‚ä½†æ˜¯ <code>dynamic_cast</code> æ€§èƒ½ä¸Šè¦æ¯” <code>static_cast</code> æ…¢ 10 å€ç”šè‡³ç™¾å€</p><ul><li>You can do downcast in polymorphic types<ul><li>è¢«è½¬æ¢çš„å¯¹è±¡ï¼Œæ½œåœ¨çš„å¯¹è±¡ç±»å‹å¿…é¡»å’ŒåŸºç±»çš„ç±»å‹ç›¸åŒï¼Œå¦åˆ™ä¸èƒ½è½¬æ¢æˆåŠŸ</li><li><code>dynamic_cast</code>ä¸èƒ½ç”¨åœ¨å½“å‰ç±»æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­ï¼Œå› ä¸ºå½“å‰ç±»çš„è™šæŒ‡é’ˆä¸æ˜¯å®Œæ•´çš„</li></ul></li><li>You can also do sidecast in polymorphic types with multiple inheritance</li></ul><h4 id="RTTI">RTTI</h4><p>C++ æä¾›äº†ä¸€ç§æ–¹å¼å¯ä»¥ç›´æ¥å¾—åˆ°ç±»å‹çš„ä¿¡æ¯ï¼Œå®šä¹‰åœ¨ <code>&lt;typeinfo&gt;</code>ï¼ŒåŒæ ·è¦é™åˆ¶ä½¿ç”¨ï¼Œä¼šé€ æˆæ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚å¯ä»¥ä½¿ç”¨<code>typeid(xxx)</code> å¾—åˆ° <code>const std::type_info</code>ï¼Œç±»ä¼¼äº<code>sizeof</code> æ“ä½œç¬¦ã€‚<code>type_info</code>æ˜¯åªè¯»çš„ï¼Œä¸èƒ½é€šè¿‡æ‹·è´æˆ–è€…æ„é€ ï¼Œåªèƒ½é€šè¿‡ <code>typeid</code> è·å¾—æˆ–è€…å¼•ç”¨ã€‚å¯ä»¥ä½¿ç”¨ <code>.name()</code> è¿›è¡Œ debug</p><ul><li><code>.name()</code></li><li><code>.hash_code()</code></li><li><code>.before()</code></li></ul><p>RTTI is unfriendly to shared library å¯¹åŠ¨æ€é“¾æ¥åº“ä¸æ˜¯å‹å¥½çš„</p><ul><li>Since GCC 3.0, symbols are compared equality by address instead fo names. So to preserve only one symbol across many <code>.obj</code> file, it  merges them when linking (like in static library) ç¬¦å·ä½¿ç”¨åœ°å€æ¯”è¾ƒç›¸ç­‰æ€§ï¼Œè€Œä¸æ˜¯é€šè¿‡åå­—æ¯”è¾ƒç›¸ç­‰æ€§ï¼›å³ä½¿ä¸¤ä¸ªç¬¦å·çš„åå­—æ˜¯ç›¸ç­‰çš„ï¼Œåœ°å€ä¸ç›¸ç­‰ï¼Œå½“å‡ºç°åœ¨ä¸åŒçš„ <code>.obj</code> æ–‡ä»¶ä¸­çš„æ—¶å€™ï¼Œä¼šå°†åå­—ç›¸ç­‰çš„ç¬¦å·è¿›è¡Œåœ°å€åˆå¹¶</li><li>So to load shared library quickly, many procedures are omitted, which includes resolving different RTTI symbols ä¸ºäº†å¿«é€Ÿé“¾æ¥åŠ¨æ€é“¾æ¥åº“ï¼Œå¾ˆå¤šæ­¥éª¤éƒ½è¦è¢«çœç•¥ï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬ RTTI ç¬¦å·çš„åˆå¹¶</li></ul><h4 id="Const-Cast">Const Cast</h4><ul><li>It tries to drop the cv-qualifiers<ul><li>æ˜ç¡®çš„çŸ¥é“äº†åŸæ¥çš„å¯¹è±¡å°±æ˜¯é read-onlyï¼Œç„¶åæ¥æ”¶åˆ°çš„å¯¹è±¡æ˜¯ <code>const</code> ç±»å‹çš„</li><li>The author forgets the <code>const</code> in parameter, but it in fact doesnâ€™t write it</li></ul></li><li><code>volatile</code> is similar æŠŠ <code>volatile</code> å»æ‰ä¼šæœ‰ cache çš„é£é™©ï¼Œ<code>volatile</code>è¦æ±‚æ¯æ¬¡ä½¿ç”¨éƒ½è¦åˆ°å†…å­˜ä¸­é‡æ–°å»è¯»</li><li>ä¸€èˆ¬æƒ…å†µä¸‹ç”¨ä¸åˆ°</li></ul><h4 id="Reinterpret-Cast">Reinterpret Cast</h4><p><code>reinterpret_cast</code> is used to process pointers of different types, which is dangerous because of life time</p><ul><li>Converting from an object pointer to another type, i.e. <code>reinterpret_cast&lt;T*&gt;(xxx)</code><ul><li>This is same as <code>static_cast&lt;T*&gt;)(static_cast&lt;(cv) void*&gt;(xxx))</code></li><li><code>std::launder</code></li></ul></li><li>Converting from a pointer to function to another type of pointer to function; or pointer to member to another one</li><li>Converting pointer to integer or vice versa ï¼ˆåä¹‹äº¦ç„¶ï¼‰<ul><li>A pointer can be converted to integer by <code>reinterpret_cast</code> if the integer is large enough (<code>std::uintptr_t</code>)</li><li>This integer can be converted back to get the original pointer</li><li><code>reinterpret_cast</code> from <code>0/NULL</code> is UB</li><li>Reference is also convertible å¼•ç”¨å’ŒæŒ‡é’ˆä¸€æ ·</li></ul></li></ul><h4 id="Type-safe-union-and-void">Type-safe <code>union</code> and <code>void*</code></h4><ul><li>Since C++ 17, <code>&lt;variant&gt;</code> and <code>&lt;any&gt;</code> are introduced to guarantee the safety<ul><li><p><code>std::variant</code> can eb seen as a <code>union</code> with a <code>size_t</code> index, which will inspect whether the member is  in its lifetime when getting</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std::variant&lt;<span class="type">int</span>, <span class="type">float</span>, <span class="type">int</span>, std::vector&lt;<span class="type">int</span>&gt;&gt; v{<span class="number">1.0f</span> };</span><br><span class="line"><span class="comment">// ç±»ä¼¼äº</span></span><br><span class="line"><span class="keyword">union</span> <span class="title class_">Union</span> {</span><br><span class="line">    <span class="type">int</span> _1;</span><br><span class="line">    <span class="type">float</span> _2;</span><br><span class="line">    <span class="type">int</span> _3;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; _4;</span><br><span class="line">};</span><br></pre></td></tr></table></figure><ul><li>For construction<ul><li>By default, the first alternative is value-initialized é»˜è®¤ç¬¬ä¸€ä¸ªä½ç½®è¢«åˆå§‹åŒ–</li><li>You can also assign a value with the same type of some alternative, then thisâ€™s the active alternative</li><li>You can also construct the member in place,i.e. by <code>(std::in_place_type&lt;T&gt;, args...)</code></li><li>You can construct by index, i.e. <code>(std::in_place_index&lt;Index&gt;, args...)</code></li></ul></li><li>To access or check the existence of alternative<ul><li><code>.index()</code>: return the index of active alternative</li><li>These methods need the examined type <strong>unique</strong> in type params<ul><li><code>std::hold_alternative&lt;T&gt;(v)</code>: return Boolean that denotes whether the active alternative is of type <code>T</code></li><li><code>std::get&lt;T&gt;(v)</code>: return the active alternative of type <code>T</code> ä¼ å…¥å¼•ç”¨</li><li><code>std::get_if&lt;T&gt;(v)</code>: return the pointer to the active alternative of type <code>T</code> ä¼ å…¥æŒ‡é’ˆ</li></ul></li><li>If not unique, you can also use index-based access: <code>std::get&lt;I&gt;(v)</code>, <code>std::get_if&lt;I&gt;(v)</code></li></ul></li><li>Besides type safety, the most important extension of <code>std::variant</code> than <code>union</code> is that it implements <strong>visitor pattern</strong></li></ul></li><li><p><code>std::any</code> can be seen as a <code>void*</code> with the original type â€œstoredâ€ magically, so that youâ€™ll fail to graspï¼ˆç†è§£ï¼›é¢†ä¼šï¼‰ the inner object with the wrong type å¯ä»¥åŠ è½½ä»»æ„çš„å¯¹è±¡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::any a{<span class="number">1</span> };</span><br><span class="line">a = <span class="number">2.0f</span>;</span><br><span class="line">a = <span class="string">"test"</span>;</span><br></pre></td></tr></table></figure><ul><li>æ‰¿è½½çš„å¯¹è±¡å¿…é¡»æœ‰æ„é€ å‡½æ•°ï¼Œç±»å‹ä¼š decay</li><li>You can also default-construct it or call <code>.reset()</code>, then it holds nothing</li><li><code>.has_value()</code></li><li><code>(std::in_place_t&lt;T&gt;, args...)</code></li><li>When you need to get the underlying object, you need to use <code>std::any_cast&lt;T&gt;(a)</code> or <code>(&amp;a)</code></li><li><code>std::any</code> can have SBO (small buffer optimization) like <code>std::function</code> ç¼–è¯‘å™¨ä¼šç»™ <code>std::any</code> åœ¨æ ˆä¸Šåˆ†é…æ¯”è¾ƒå°çš„ bufferï¼Œå­˜å‚¨ä¸€äº›éå¸¸å°çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯åœ¨å †ä¸Šåˆ†é…å†…å­˜</li><li><code>.swap/std::swap/.emplace</code></li><li><code>.type()</code></li><li><code>std::make_any</code>, same as constructing <code>std::any</code></li></ul></li></ul></li></ul><h2 id="Programming-in-Multiple-Files">Programming in Multiple Files</h2><p>Remember the compilation procedures of C</p><ul><li>Preprocess, where comments are stripped and <strong>macros are processed</strong> (so that your <code>#include</code> can get the file correctly)</li><li>Compile, where each source file is compiled independently ç¼–è¯‘</li><li>Assemble; this is not something we care since it just translate assembly to object file æ±‡ç¼–</li><li>Link, to locate symbols that are referred in other TUs(Translation unit) é“¾æ¥</li></ul><h3 id="Preprocessor- é¢„å¤„ç†å™¨">Preprocessor é¢„å¤„ç†å™¨</h3><p>To be specific, preprocessing can be divided into 6 phases</p><ul><li>Read files and map them to translation character set, which guarantees UTF-7 to be supported è¯»æ–‡ä»¶ æ˜ å°„</li><li>Backslashes as the end of line are processed to concatenate two physical lines into a single logical line å¤„ç†åæ–œæ <code>\</code></li><li>Comments and macros are extracted, and the whole file is parsed</li><li>Preprocessor runs to process all macros</li><li>String literals are encoded as specified by the prefix å¤„ç†å­—ç¬¦ä¸²å¸¸é‡ï¼ŒæŒ‰ç…§æŒ‡å®šçš„å‰ç¼€è¿›è¡Œç¼–ç </li><li>Adjacent string literals are concatenated ï¼›é‚»è¿‘çš„å­—ç¬¦ä¸²æ‹¼æ¥</li></ul><p>A preprocessing directive begins with <code>#</code>. There are four kinds of directives</p><ul><li><code>#include ...</code>, which copies all file content into the current file<ul><li><code>#include &lt;...&gt;</code></li><li><code>#include "..."</code></li></ul></li><li><code>#define</code> i.e. macros, which does pure text replacement<ul><li><p><code>#define FUNC(a, b) a + b</code></p></li><li><p>Parameters of macros can be blank</p></li><li><p>Parameters of macros are directly parsed by commas when no paratheses surrounded, e.g. <code>FUNC(SomeFunc&lt;int, double&gt;())</code> -&gt; <code>SomeFunc&lt;int + double&gt;()</code> ç”¨ <code>,</code> ç›´æ¥è¿›è¡Œåˆ†è¯ï¼Œé‡åˆ° <code>,</code> å°±ä¼šæ›¿æ¢</p><ul><li><p>You need to add an additional pair of paratheses to help parse, e.g. <code>FUNC((SomeFunc&lt;int, double&gt;()), 3)</code></p></li><li><p>You can use <code>...</code> for parameters of any number, and reference them by <code>__VA_ARGS__</code> å˜é•¿å‚æ•°çš„æ›¿æ¢</p></li><li><p>Since C++ 20, you can use <code>__VA_OPT__(content)</code>, which will be enabled only when <code>__VA_ARGS__</code> is not empty</p></li><li><p><code>#</code> can be used to turn parameters to strings, and  <code>##</code> can be used to concatenate parameters to make them a whole token</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> NameToStr(a, b) #a #b</span></span><br><span class="line"><span class="keyword">auto</span> str = <span class="built_in">NameToStr</span>(<span class="number">1</span>, aa)</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ConcatName(a, id) a ## id</span></span><br><span class="line"><span class="type">int</span> <span class="built_in">ConcatName</span>(a, <span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line">std::cout &lt;&lt; a1;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>You need <code>#undef</code> to drop the definition of the macro å–æ¶ˆå®å®šä¹‰</p></li></ul></li><li>Conditional choice of code<ul><li><code>#ifdef</code>, (<code>#elifdef</code> since C++ 23), <code>#else</code></li><li><code>#ifndef</code>, (<code>#elifndef</code> since C++ 23), <code>#else</code></li><li><code>#if defined xx</code> is equivalent to <code>#ifdef xx</code></li><li><code>#endif</code></li><li><code>#if</code>, <code>#elif</code>, <code>#else</code></li></ul></li><li><code>#pragma</code> is in fact a macro for implementation-defined usage éœ€è¦æŸ¥çœ‹ç¼–è¯‘å™¨æ–‡æ¡£æˆ–è€…å…¶ä»–ç›¸å…³æ–‡æ¡£æ‰èƒ½çŸ¥é“å…·ä½“çš„ç”¨é€”<ul><li><code>#pragma once</code>, <code>#pragma pack</code></li></ul></li><li><code>#line</code>: specify the line number manually</li></ul><h3 id="Compile">Compile</h3><h4 id="Declaration-Definition">Declaration &amp; Definition</h4><ul><li>Translation unit (TU)<ul><li>æ¯ä¸€ä¸ªæºæ–‡ä»¶éƒ½æ˜¯å•ç‹¬è¿›è¡Œç¼–è¯‘ï¼Œæœ€åé€šè¿‡è¿æ¥å™¨å»é“¾æ¥æœªçŸ¥çš„ç¬¦å·ï¼Œæ¯ä¸ªæºæ–‡ä»¶é€šè¿‡é¢„å¤„ç†å°†å…¶ä»–ç¬¦å·åŠ åˆ°å½“å‰æ–‡ä»¶ä¸­ï¼Œè¿™ä¸€æ•´ä¸ªå¤„ç†ç»“æœå°±æ˜¯ TU</li><li>C++ è¦æ±‚å…ˆå£°æ˜å†ä½¿ç”¨ï¼Œæ‰€ä»¥æ¯ä¸ª TU é¦–å…ˆè¦çœ‹åˆ°æ‰€ä½¿ç”¨çš„å£°æ˜</li><li>C/C++ has One-Definition Rule (ODR), meaning that each entity should have only one definition in a TU or even in a program ä¸€ä¸ªå®ä½“åªèƒ½å®šä¹‰ä¸€æ¬¡</li></ul></li><li>å…¸å‹çš„å£°æ˜å’Œå®šä¹‰<ul><li>Function prototype &amp; one with function body å‡½æ•°ç­¾åå’Œå…·æœ‰å‡½æ•°ä½“çš„å‡½æ•°ï¼Œä¹ŸåŒ…æ‹¬ç±»çš„æˆå‘˜å‡½æ•°</li><li><code>class A;</code>, <code>class A{...}</code>, <code>struct</code> ç±»çš„å£°æ˜å’Œå®šä¹‰</li><li><code>enum class A (: Type)</code></li></ul></li><li>ç±»çš„å£°æ˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„å®ä½“ï¼Œå¯¹äºå‡½æ•°æ¥è¯´åªéœ€è¦æš´éœ²å‡½æ•°çš„ç­¾åå°±å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯å¯¹äºç±»æ¥è¯´å£°æ˜æ˜¯è¿œè¿œä¸èƒ½å¤Ÿä½¿ç”¨ç±»</li><li>It only requires the class to be defined only once in a TU</li><li>Besides, class definition requires to fully see all definitions of its members &amp; base classes ç±»çš„å®šä¹‰å¿…é¡»è¦æ±‚æœ‰å®Œæ•´çš„å®šä¹‰ï¼ŒåŒ…æ‹¬ç±»çš„æˆå‘˜å’ŒåŸºç±»<ul><li>You cannot <code>class Vector3; class A {Vector3 v;};</code></li><li>This is because compilers need to determine the layout of the class; if definition of some members are unknown, its <code>sizeof</code> is unclear ç¼–è¯‘å™¨å¿…é¡»çŸ¥é“ç±»çš„å¤§å°</li></ul></li><li>We can use mere class declarations in these cases åªéœ€è¦ä½¿ç”¨ç±»çš„å£°æ˜çš„æƒ…å†µ<ul><li>As an argument of prototype; its members and layout are not used åšä¸ºå‡½æ•°çš„å‚æ•°</li><li>When you only needs a pointer or reference as members ç”¨æŒ‡é’ˆæˆ–è€…å¼•ç”¨æŒ‡å‘ç±»</li></ul></li><li>Notes<ul><li>Itâ€™s allowed to put definition of methods into class definition</li><li>Return types and parameter types of declarations and definitions of methods should be the same</li><li><code>friend</code> will implicitly declares the class or function</li><li>Class members in class definition is in fact definition instead of just simple declaration, so we donâ€™t need to define it again in .cpp</li><li>Default parameters of functions should be put into declaration, and shouldnâ€™t be put into definition</li><li>Type alias (like <code>using</code>) and <code>static_assert</code> are also declarations</li><li><strong>header guard</strong> è§£å†³å®šä¹‰å‡ºç°ä¸¤æ¬¡çš„é—®é¢˜ <code>#pragma once</code></li></ul></li><li>Template çš„å£°æ˜å’Œå®šä¹‰<ul><li>Template will not preserve its information to object file</li><li>åœ¨å¤´æ–‡ä»¶ä¸­å†™å£°æ˜å’Œå®šä¹‰</li><li>Function template in class should also be put into header</li></ul></li></ul><h4 id="Namespace">Namespace</h4><ul><li><p>When code base is large, name conflicts usually happen è§£å†³å‘½åå†²çªï¼ŒC è¯­è¨€ä¸­è§£å†³æ–¹å¼æ˜¯åŠ å¤§é‡çš„å‰ç¼€</p></li><li><p><code>using namespace xx</code> is like <code>from xx import *</code></p></li><li><p><code>using yy::xx</code> is like <code>from yy import xx</code></p></li><li><p>You should <strong>never</strong> put <code>using namespace xxx</code> or <code>using xx</code> into header files</p></li><li><p>Inline namespace has nothing to do with <code>inline</code>. Itâ€™ll expose contents into the parent namespace, as if there is a <code>using namespace xx</code> å’Œå…³é”®å­— <code>inline</code> æ¯«æ— å…³ç³»ï¼Œç›®çš„æ˜¯æŠŠæ‰€åŒ…å«çš„å†…å®¹æš´éœ²åˆ°ä¸Šå±‚å‘½åç©ºé—´ä¸­</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">namespace</span> Test6</span><br><span class="line">  {</span><br><span class="line">      <span class="keyword">inline</span> <span class="keyword">namespace</span> Implv1</span><br><span class="line">      {</span><br><span class="line">          <span class="function"><span class="type">void</span> <span class="title">Func</span><span class="params">()</span></span>;</span><br><span class="line">      }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">namespace</span> Test6::Implv1</span><br><span class="line">  {</span><br><span class="line">      <span class="function"><span class="type">void</span> <span class="title">Func</span><span class="params">()</span></span></span><br><span class="line"><span class="function">      </span>{</span><br><span class="line">          std::cout &lt;&lt; <span class="string">"This is v1.\n"</span>;</span><br><span class="line">      }</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// è°ƒç”¨çš„æ—¶å€™å®Œå…¨å¯ä»¥å°† `Implv1` å¿½ç•¥æ‰</span></span><br><span class="line">  Test6::<span class="built_in">Func</span>();</span><br><span class="line">  ````</span><br><span class="line"></span><br><span class="line">#### Inline</span><br><span class="line"></span><br><span class="line">* Recall procedures of function calls</span><br><span class="line">  * Caller saves registers on the stack</span><br><span class="line">  * Jump to the calling position è·³è½¬åˆ°å‡½æ•°æ‰€åœ¨çš„åœ°å€</span><br><span class="line">  * Callee saves registers, execute code, <span class="keyword">and</span> restores registers å¯¹äºå‡½æ•°æœ¬èº«æ¥è¯´ä¹Ÿä¼šä¿å­˜å¯„å­˜å™¨ï¼Œå¹¶æ‰§è¡Œä»£ç ï¼Œåœ¨æŠŠå¯„å­˜å™¨ä¸­çš„å†…å­˜æ¢å¤</span><br><span class="line">  * Jumping back by popping up the <span class="keyword">return</span> address</span><br><span class="line">  * Caller restores registers on the stack</span><br><span class="line">* If we can fuse function body into the caller <span class="keyword">and</span> optimize together, then <span class="keyword">register</span> saving / restoring <span class="keyword">and</span> jumping will be almost eliminated ç›´æ¥å°†å†…è”å‡½æ•°æ’å…¥åˆ°è°ƒç”¨çš„åœ°æ–¹ï¼Œå¯„å­˜å™¨çš„ä¿å­˜å’Œæ¢å¤ï¼Œä»¥åŠè·³è½¬çš„å¼€é”€ä¼šè¢«æ¶ˆé™¤ä»¥è¾¾åˆ°ä¼˜åŒ–çš„ç›®çš„</span><br><span class="line">* Inline function should be put into header files å› ä¸ºæ¯ä¸ªæºæ–‡ä»¶éƒ½éœ€è¦çŸ¥é“å†…è”çš„å‡½æ•°ä½“</span><br><span class="line">* `<span class="keyword">inline</span>` ä¹Ÿä¼šé€ æˆå…¶ä»–é—®é¢˜</span><br><span class="line">  * The code size may <span class="built_in">bloat</span>(è†¨èƒ€), since the function body is inserted everywhere</span><br><span class="line">  * Utility of instruction cache may be lower, since the same function has different addresses å¯¹ i-cache çš„åˆ©ç”¨ç‡é™ä½ï¼Œç›¸åŒçš„ä»£ç å…·æœ‰å®Œå…¨ä¸ä¸€æ ·çš„åœ°å€</span><br><span class="line">  * Inline function won<span class="number">'</span>t create their function address, so you cannot <span class="string">"jump to the next"</span> when debugging è¿›è¡Œ debug æ—¶æŠŠæ•´ä¸ªå‡½æ•°è·³è¿‡å»äº†</span><br><span class="line">* `<span class="keyword">inline</span>` is just an suggestion to compiler, <span class="keyword">and</span> compiler may choose to <span class="keyword">not</span> <span class="keyword">inline</span> the body</span><br><span class="line">  * é€’å½’è°ƒç”¨</span><br><span class="line">  * å‡½æ•°æœ¬èº«é€»è¾‘æ¯”è¾ƒå¤æ‚</span><br><span class="line">  * ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ `<span class="keyword">inline</span>` åˆé€‚</span><br><span class="line">* Since C++ <span class="number">17</span>, <span class="keyword">inline</span> variables are introduced å†…è”å˜é‡ï¼Œå¯ä»¥ç›´æ¥æŠŠå†…è”å˜é‡æ”¾åˆ°å¤´æ–‡ä»¶ä¸­</span><br><span class="line">  * This mainly facilitates header-only libraries, since they hope to use some global variables without source files</span><br><span class="line">  * Inline variables can also be in <span class="keyword">class</span> definitions, so that `<span class="type">static</span>` variable can be unnecessary to split definition <span class="keyword">and</span> declaration é™æ€å˜é‡å°±ä¸éœ€è¦åˆ†å¼€å£°æ˜å’Œå®šä¹‰äº†</span><br><span class="line">* Inline functions/variables may cause <span class="type">double</span> symbols in shared libraries å†…è”å‡½æ•° / å˜é‡ä¼šåœ¨åŠ¨æ€é“¾æ¥æ˜¯é€ æˆåŒå®šä¹‰</span><br><span class="line">  * é™æ€é“¾æ¥åº“æ˜¯éœ€è¦å®Œå…¨çš„ç¬¦å·åˆå¹¶</span><br><span class="line">  * ä½†æ˜¯åŠ¨æ€é“¾æ¥åº“çš„ç¬¦å·æ˜¯æœªå¿…è¿›è¡Œåˆå¹¶çš„ RTTI</span><br><span class="line">  * åœ¨é“¾æ¥åº“çš„å†…å¤–ä¼šå­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬çš„å˜é‡</span><br><span class="line"></span><br><span class="line">### Linkage</span><br><span class="line"></span><br><span class="line">External linkage: Linker can always find the symbol in other TUs é“¾æ¥å™¨åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½èƒ½åœ¨å…¶ä»–çš„ TU ä¸­æ‰¾åˆ°ç›¸å…³ç¬¦å·ï¼Œè¿™ç§çš„å«åšå¤–éƒ¨é“¾æ¥ï¼Œå‡ ä¹æ‰€æœ‰çš„å®ä½“åœ¨ä¸åŠ å…³é”®å­—çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ external linkage</span><br><span class="line"></span><br><span class="line">* Class members</span><br><span class="line">* Functions</span><br><span class="line">* Functions declared by `<span class="keyword">friend</span>`</span><br><span class="line">* Enumerations</span><br><span class="line">* Templates</span><br><span class="line">* Non-<span class="type">const</span> variables, <span class="keyword">volatile</span> variables <span class="keyword">and</span> <span class="keyword">inline</span> variables</span><br><span class="line"></span><br><span class="line">Internal linkage: ä½†æ˜¯æœ‰çš„æ—¶å€™ä¸æƒ³æš´éœ²å®ä½“ï¼Œä½¿ç”¨å¤–éƒ¨é“¾æ¥ä¼šè®©å…¶ä»– TU çªƒå–å®ç°çš„ç§å¯†æ€§</span><br><span class="line"></span><br><span class="line">* `<span class="type">static</span>` in introduced to force internal linkage ç”¨ `<span class="type">static</span>` å…³é”®å­—å£°æ˜å†…éƒ¨é“¾æ¥æ€§å®ä½“</span><br><span class="line">  * Unlike <span class="type">static</span> member functions, `<span class="type">static</span>` that denotes linkage is necessary in definition åœ¨å‡½æ•°å®šä¹‰æ—¶éœ€è¦å¸¦ä¸Š `<span class="type">static</span>`ï¼Œæˆå‘˜å‡½æ•°åˆ™ä¸éœ€è¦</span><br><span class="line">  * å¤–éƒ¨é“¾æ¥æ€§å’Œæ¨¡æ¿å®ä¾‹åŒ–ä¸ä¼šå†²çªï¼Œå®Œå…¨æ˜¯ä¸¤ä¸ªä¸ç›¸å¹²çš„æ¦‚å¿µ</span><br><span class="line">* Another way is to define things in an anonymous <span class="keyword">namespace</span> éœ€è¦å®šä¹‰å¤§é‡çš„å†…éƒ¨é“¾æ¥æ€§å®ä½“æ—¶å€™å¯ä»¥ä½¿ç”¨</span><br><span class="line">* There are some special cases where entities are born with internal linkage</span><br><span class="line">  * `<span class="type">const</span>` global variables</span><br><span class="line">  * Anonymous unions</span><br><span class="line"></span><br><span class="line">#### Singleton</span><br><span class="line"></span><br><span class="line">* Reason</span><br><span class="line">  * The sequence of initializing global variables across TU isn<span class="number">'</span>t determined å…¨å±€å˜é‡åˆå§‹åŒ–çš„é¡ºåºåœ¨åŒä¸€ä¸ª TU ä¸­å¯ä»¥ä¿è¯ï¼Œä½†æ˜¯åœ¨ä¸åŒçš„ TU ä¸­ä¸èƒ½ä¿è¯</span><br><span class="line">  * Side effects caused by global variables may <span class="keyword">not</span> be executed</span><br><span class="line"></span><br><span class="line">```c++</span><br><span class="line"><span class="comment">// singleton.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="keyword">class</span> Singleton</span><br><span class="line">{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">static</span> Singleton&amp; <span class="built_in">GetInstance</span>();</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Singleton</span>() = <span class="keyword">default</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// singleton.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"singleton.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">Singleton&amp; <span class="title">Singleton::GetInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="type">static</span> Singleton* instance = <span class="keyword">new</span> <span class="built_in">Singleton</span>();</span><br><span class="line">    <span class="keyword">return</span> *instance;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li><li><p>No linkage æ— é“¾æ€§</p><ul><li>This happens for static local variables (i.e. <code>static</code> variables in functions) and normal local variables</li><li>You can even define a class inside the block scope, which also has no linkage</li></ul></li></ul><h2 id="XMake">XMake</h2><p>XMake acts as both a build tool and a package manager</p><ul><li><p>(Optional) Project name, project version and required xmake version</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set_project(<span class="string">"Programming in Multiple Files"</span>)</span><br><span class="line">set_xmakever(<span class="string">"2.8.1"</span>)</span><br><span class="line">set_version(<span class="string">"0.0.0"</span></span><br></pre></td></tr></table></figure></li><li><p>Modes and language version</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_rules(<span class="string">"mode.debug"</span>, <span class="string">"mode.release"</span>)</span><br><span class="line">set_languages(<span class="string">"cxx20"</span>)</span><br></pre></td></tr></table></figure></li><li><p>Some other options</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set_policy(<span class="string">"build.warning"</span>, <span class="literal">true</span>)</span><br><span class="line">set_warning(<span class="string">"all"</span>)</span><br></pre></td></tr></table></figure><ul><li><code>set_policy("build.warning", true)</code> means that report warning even if compile success</li></ul></li><li><p>Add required packages <code>add_requires("ctre 3.8.1", "catch2")</code></p></li><li><p>Specify the building target</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">target(<span class="string">"example"</span>)</span><br><span class="line">    set_kind(<span class="string">"binary"</span>)</span><br><span class="line">    add_headerfiles(<span class="string">"example1/*.h"</span>)</span><br><span class="line">    add_files(<span class="string">"example1/*.cpp"</span>)</span><br></pre></td></tr></table></figure><ul><li><code>target(name)</code></li><li><code>set_kind(...)</code><ul><li><code>binary</code> will compile the executable</li><li><code>static</code> static library</li><li><code>shared</code> stared library/dynamic-linked library</li><li><code>phony</code> empty, just used to combine targets like libraries</li><li><code>header_only</code> for projects that only have header files</li></ul></li><li><code>add_files(...)</code></li><li><code>add_headerfiles(...)</code></li></ul></li><li><p><code>xmake</code> to compile all targets</p><ul><li><code>xmake -b xx</code> to compile specific targets</li><li><code>xmake run xx</code> to run specific executable</li></ul></li></ul><h2 id="Modules">Modules</h2><ul><li>There are several problems in headers<ul><li>Non-inline functions cannot be defined to keep ODR</li><li><code>#include</code> always requires the preprocessor to copy all contents, which makes the real file huge and drags the compilation stage</li><li>If marcos arenâ€™t undef, they will be leaked</li></ul></li><li>Every module has only one primary interface unit<ul><li>Begin with <code>export module Name</code> åœ¨æ–‡ä»¶å¼€å§‹æ—¶å£°æ˜</li><li>It regulates that entities are visible to other modules by <code>export</code> æ–‡ä»¶ä¸­çš„å…¶ä»–å®ä½“éƒ½å¯ä»¥åŠ  <code>export</code> å…³é”®å­—</li><li>Module interface files have no determined suffix<ul><li>msvc - ixx</li><li>clang - cppm</li><li>gcc - donâ€™t care</li><li>It can also be mmp, mmx</li></ul></li><li><code>export import</code> å­—é¢æ„ä¹‰</li><li>Modules ä¹Ÿå…è®¸å£°æ˜å’Œå®šä¹‰åˆ†ç¦»ï¼ŒåŸç†æ˜¯ module implementation unit<ul><li><p>It begins with <code>module Name;</code> and shouldnâ€™t have any <code>export</code></p></li><li><p>A module can have multiple implementation files, as long as they all begin with <code>module Name;</code> ä¸€ä¸ªæ¨¡å—å¯ä»¥æœ‰å¤šä¸ªæºæ–‡ä»¶å»å®ç°</p></li><li><p>You can directly <code>import "xxx.h"</code>; theyâ€™re called <strong>header unit</strong></p></li><li><p>C++ uses <strong>global module fragment</strong></p><pre><code class="language-c++">module; // global module fragment#define NEED_PARAM#include "Old.h"module Person; //</code></pre><ul><li>It begins before <code>export module Name;</code> or <code>module Name;</code></li></ul></li></ul></li></ul></li><li>You can partition either interface or implementation å¦‚æœæ¨¡å—å¤ªå¤§ä¹Ÿå¯ä»¥è¿›è¡Œæ‹†åˆ†<ul><li>Interface partition unit: begin with <code>export module Name:SubName;</code></li><li>Implementation partition unit: begin with <code>module Name:SubName2;</code></li><li>åˆ†åŒºæ—¶æ¨¡å—å†…éƒ¨çš„æ¦‚å¿µï¼Œå¯¹å…¶ä»–æ¨¡å—æ˜¯é€æ˜çš„<ul><li>Inside the module, it can use <code>import :SubName</code> to import the partition</li><li>But in other modules, they cannot use <code>import Name:SubName</code></li></ul></li><li>Unlike module implementation, implementation partition is not implementation of interface partition æ¨¡å—çš„å®ç°åˆ†åŒºå’Œæ¨¡å—çš„æ¥å£åˆ†åŒºå¹¶ä¸æ˜¯å®ç°çš„å¯¹åº”å…³ç³»ï¼Œä¸èƒ½åœ¨å‡ºç°åŒåçš„åˆ†åŒºäº†<ul><li>If there exists <code>module A:B</code>; there shouldnâ€™t exist <code>export module A:B</code></li></ul></li><li>Partitions cannot have partitions (depth == 1) åˆ†åŒºä¸èƒ½å†è¿›è¡Œåˆ†åŒº</li></ul></li></ul><h2 id="Error-Handling">Error Handling</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="C++" scheme="https://silhouettesforyou.github.io/categories/C/"/>
    
    
    <category term="C++" scheme="https://silhouettesforyou.github.io/tags/C/"/>
    
    <category term="ç°ä»£ C++" scheme="https://silhouettesforyou.github.io/tags/%E7%8E%B0%E4%BB%A3-C/"/>
    
  </entry>
  
  <entry>
    <title>DIY æ‘†æ”¾</title>
    <link href="https://silhouettesforyou.github.io/2024/05/31/52/"/>
    <id>https://silhouettesforyou.github.io/2024/05/31/52/</id>
    <published>2024-05-31T06:45:00.000Z</published>
    <updated>2024-06-01T16:51:12.080Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="åˆ†æ">åˆ†æ</h2><center>    <img src="/2024/05/31/52/mind-map.png"></center><h2 id="ç›¸å…³ç»†èŠ‚">ç›¸å…³ç»†èŠ‚</h2><h3 id="è‡ªå®šä¹‰ç½‘æ ¼">è‡ªå®šä¹‰ç½‘æ ¼</h3><p>åŸºç¡€ç½‘æ ¼</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Grid</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> T[,] grids;</span><br><span class="line">    <span class="keyword">public</span> Vector3 rotation; <span class="comment">// ä¸º 0 æ—¶è¡¨ç¤ºåœ°é¢ï¼Œ63ï¼ˆarctan2ï¼‰æ—¶è¡¨ç¤ºå¢™é¢</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> width;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> height;</span><br><span class="line">    <span class="keyword">private</span> Vector3 cellSize; <span class="comment">// ç½‘æ ¼å¤§å°ï¼Œç±»ä¼¼ unity ä¸­ tilemapï¼Œlayout è®¾ç½®ä¸º `isometric` ç±»å‹ï¼Œ(2, 1, 1) è¡¨ç¤ºæ¯ä¸ª cell çš„ width:height ä¸º 2:1</span></span><br><span class="line">    <span class="keyword">private</span> Vector3 origin;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç½‘æ ¼ç‰©ä»¶</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GridObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> x, y;</span><br><span class="line">    <span class="keyword">private</span> Grid&lt;GridObject&gt; grid;</span><br><span class="line">    <span class="keyword">public</span> PlaceableObject PlaceableObject;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> CanBuild;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GridObject</span>(<span class="params">Grid&lt;GridObject&gt; grid, <span class="built_in">int</span> x, <span class="built_in">int</span> y</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.grid = grid;</span><br><span class="line">        <span class="keyword">this</span>.x = x;</span><br><span class="line">        <span class="keyword">this</span>.y = y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><center>    <img src="/2024/05/31/52/grid-ground.jpg">    <img src="/2024/05/31/52/grid-wall.png"></center><h3 id="å¯æ”¾ç½®ç‰©ä»¶">å¯æ”¾ç½®ç‰©ä»¶</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlaceableObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> depth; <span class="comment">// è®°å½•ç‰©ä»¶çš„æ·±åº¦ï¼Œæ¯æœ‰ä¸€ä¸ªç‰©ä»¶è¢«æ”¾ç½®æ·±åº¦åŠ ä¸€</span></span><br><span class="line">    <span class="keyword">public</span> Vector2Int offset; <span class="comment">// ç›¸å¯¹äºç½‘æ ¼åŸç‚¹çš„åç§»</span></span><br><span class="line">    <span class="keyword">public</span> Transform placedObjectTransform; <span class="comment">// è´´å›¾ transform</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Vector2Int&gt; GridPositions; <span class="comment">// å æ®çš„ç½‘æ ¼å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Grid&lt;GridObject&gt;&gt; grids; <span class="comment">// ç‰©ä»¶ä¹Ÿæœ‰ç½‘æ ¼ï¼Œç”¨äºå †å </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é®æŒ¡å’Œæ’åº">é®æŒ¡å’Œæ’åº</h3><ul><li>æ·±åº¦å€¼è¶Šå¤§çš„ï¼ˆå³è¢«æ”¾ç½®åˆ°å…¶ä»–ç‰©ä»¶ä¹‹ä¸Šï¼‰ï¼Œè¶Šé å‰</li><li>ç½‘æ ¼ç´¢å¼• (x, 0, z) è¶Šå°æ’åºè¶Šé å‰</li><li>åœ°é¢çš„å¯ä»¥é®æŒ¡å¢™é¢çš„</li></ul><h3 id="å·¥å…·">å·¥å…·</h3><ul><li>å®šä¹‰å¯ç¼–è¾‘åœºæ™¯ï¼Œå¯¼å…¥ç›¸å…³èµ„æº</li><li>ç¼–è¾‘æ¨¡å¼<ul><li>ç¼–è¾‘ç‰©ä»¶çš„ Placeable éƒ¨åˆ†</li><li>ç¼–è¾‘ç‰©ä»¶çš„ Grid éƒ¨åˆ†</li><li>åˆ é™¤åŒºåŸŸ</li></ul></li><li>å“åº”åˆ©ç”¨å°„çº¿æ£€æµ‹é¼ æ ‡ä½ç½®ï¼Œåœ¨ä¸åŒç¼–è¾‘æ¨¡å¼ä¸‹ï¼Œå°†å±å¹•åæ ‡è½¬æˆä¸–ç•Œåæ ‡ï¼Œå†è½¬æ¢åˆ°ç½‘æ ¼åæ ‡</li><li>å­˜å‚¨ç¼–è¾‘ç»“æœ<ul><li>åˆ©ç”¨<code>ScriptableObject</code>ã€<code>Json</code>ã€äºŒè¿›åˆ¶ç­‰å­˜å‚¨æ–¹å¼è¿›è¡Œä¿å­˜</li><li>åŠ è½½</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="Unity" scheme="https://silhouettesforyou.github.io/categories/Unity/"/>
    
    
    <category term="Unity" scheme="https://silhouettesforyou.github.io/tags/Unity/"/>
    
    <category term="C#" scheme="https://silhouettesforyou.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>é¢ç»</title>
    <link href="https://silhouettesforyou.github.io/2024/05/13/51/"/>
    <id>https://silhouettesforyou.github.io/2024/05/13/51/</id>
    <published>2024-05-13T14:12:47.000Z</published>
    <updated>2024-06-18T12:46:27.314Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="æ³¢å…‹åŸå¸‚">æ³¢å…‹åŸå¸‚</h2><h3 id="åç¨‹æ˜¯å¦å…±äº«å †æ ˆ">åç¨‹æ˜¯å¦å…±äº«å †æ ˆ</h3><ul><li>è¿›ç¨‹æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å †å’Œæ ˆï¼Œæ—¢ä¸å…±äº«å †ï¼Œäº¦ä¸å…±äº«æ ˆï¼Œè¿›ç¨‹ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦</li><li>çº¿ç¨‹æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆå’Œå…±äº«çš„å †ï¼Œå…±äº«å †ï¼Œä¸å…±äº«æ ˆï¼Œçº¿ç¨‹äº¦ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦ï¼ˆæ ‡å‡†çº¿ç¨‹æ˜¯çš„ï¼‰</li><li><strong>åç¨‹å’Œçº¿ç¨‹ </strong> ä¸€æ ·å…±äº«å †ï¼Œä¸å…±äº«æ ˆï¼Œåç¨‹ç”±ç¨‹åºå‘˜åœ¨åç¨‹çš„ä»£ç é‡Œæ˜¾ç¤ºè°ƒåº¦</li></ul><h3 id="é€æ˜ç‰©ä½“ä½äº -Unity- å“ªä¸ªæ¸²æŸ“é˜¶æ®µ">é€æ˜ç‰©ä½“ä½äº Unity å“ªä¸ªæ¸²æŸ“é˜¶æ®µ</h3><h3 id="å·²çŸ¥æ³•å‘çº¹ç†ï¼Œå¦‚ä½•è¿˜åŸæ³•çº¿å‘é‡">å·²çŸ¥æ³•å‘çº¹ç†ï¼Œå¦‚ä½•è¿˜åŸæ³•çº¿å‘é‡</h3><h3 id="å¦‚ä½•è®¡ç®— -MipMap- ä¸ªæ•°">å¦‚ä½•è®¡ç®— MipMap ä¸ªæ•°</h3><h3 id="æè¿° -Blooming- æ–¹æ³•">æè¿° Blooming æ–¹æ³•</h3><h3 id="å¦‚ä½•è§£å†³ -AssetBundle- ä¾èµ–">å¦‚ä½•è§£å†³ AssetBundle ä¾èµ–</h3><h2 id="B- ç«™">B ç«™</h2><h3 id="å›¾é›†æ˜¯æ€æ ·ç”Ÿæˆçš„">å›¾é›†æ˜¯æ€æ ·ç”Ÿæˆçš„</h3><h3 id="èµ„æºåŠ è½½">èµ„æºåŠ è½½</h3><h4 id="Unity-AssetDatabase å’Œ Resources èµ„æºç®¡ç†">Unity <code>AssetDatabase</code>å’Œ <code>Resources</code> èµ„æºç®¡ç†</h4><p>Unity å¸¸ç”¨çš„èµ„æºå¤§æ¦‚æœ‰ä»¥ä¸‹å‡ ç±»ï¼š</p><ul><li>çº¯èµ„æºï¼ˆmaterialï¼Œtextureï¼Œshaderï¼Œaudioï¼Œâ€¦ï¼‰è¿™äº›èµ„æºä¸èƒ½ç›´æ¥æ‹–åˆ°åœºæ™¯é‡Œä½¿ç”¨</li><li>é¢„ç½®ï¼ˆprefabï¼‰ï¼Œè¿™ç§èµ„æºéœ€è¦å®ä¾‹åŒ–ä¹‹åæ‰èƒ½ä½¿ç”¨</li><li>scene ä¹Ÿæ˜¯ä¸€ç§èµ„æº</li><li>è„šæœ¬å¯¹è±¡ï¼Œæ–‡æœ¬æ–‡ä»¶ï¼Œunity è‡ªå·±å†…ç½®çš„èµ„æºï¼ˆåƒæ–°å»ºç²’å­æ—¶çš„é»˜è®¤æè´¨ä¹‹ç±»çš„ï¼‰</li></ul><p>Unity ç®¡ç†è¿™äº›èµ„æºåˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>åœ¨ç¼–è¾‘å™¨å†…ç®¡ç†ï¼Œä½¿ç”¨ <code>AssetDatabase</code> åŠ è½½å¸è½½èµ„æº<ul><li>åœ¨ç¼–è¾‘å™¨å†…åŠ è½½å¸è½½èµ„æºï¼Œå¹¶ä¸èƒ½åœ¨æ¸¸æˆå‘å¸ƒæ—¶ä½¿ç”¨ï¼Œå®ƒåªèƒ½åœ¨ç¼–è¾‘å™¨å†…ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œå®ƒåŠ è½½é€Ÿåº¦å¿«ï¼Œæ•ˆç‡é«˜ï¼Œé€‚åˆåœ¨æµ‹è¯•æ—¶ä½¿ç”¨</li></ul></li><li>è¿è¡Œæ—¶ç®¡ç†ï¼Œç®€å•åŒ–ä½¿ç”¨<code>Resources</code>ï¼Œå¤æ‚åŒ–ä½¿ç”¨ AssetBundle<ul><li>åœ¨è¿è¡Œæ—¶ç®¡ç†èµ„æºï¼Œç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ <code>Resources</code> æ¥å£ã€‚è¿™ç§æ–¹å¼æ§åˆ¶èµ„æºçš„ç®¡ç†æ•ˆç‡é«˜ï¼Œèµ„æºéœ€è¦æ”¾åœ¨ Resources æ–‡ä»¶å¤¹ä¸‹ã€‚è¿™å°±è¯´æ˜ Unity åœ¨æ‰“åŒ…æ—¶åªä¼šæ‰“åŒ… Resources æ–‡ä»¶å¤¹ä¸‹çš„èµ„æºåˆ°ç»ˆç«¯ä¸Šã€‚ åŠ è½½è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„èµ„æºä¸éœ€è¦æ‰©å±•åã€‚æœ€å¥½ä¸è¦å»ºç«‹å¤šä¸ª Resources æ–‡ä»¶å¤¹ï¼Œå¦åˆ™ Unity å¯èƒ½ä¼šä¸çŸ¥é“è¦åŠ è½½å“ªä¸€ä¸ª</li></ul></li></ul><h2 id="å çº¸ä¸€é¢">å çº¸ä¸€é¢</h2><h3 id="C- è°ƒç”¨ -Lua-GC- æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Œå¦‚ä½•é¿å… -GC">C# è°ƒç”¨ Lua GC æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Œå¦‚ä½•é¿å… GC</h3><h3 id="UGUI- è‡ªé€‚åº”å¤§å°">UGUI è‡ªé€‚åº”å¤§å°</h3><h3 id="å¦‚ä½•é¿å…è£…ç®±æ‹†ç®±">å¦‚ä½•é¿å…è£…ç®±æ‹†ç®±</h3><h3 id="Lua- å…ƒè¡¨æ˜¯ä»€ä¹ˆ">Lua å…ƒè¡¨æ˜¯ä»€ä¹ˆ</h3><p>åŸè¡¨æ˜¯ Lua ä¸­å…ƒè¡¨ï¼ˆMetatableï¼‰çš„ä¸€ç§ç‰¹æ®Šç±»å‹ã€‚å…ƒè¡¨æ˜¯ä¸€ç§å¯é€‰çš„é™„åŠ åˆ°è¡¨ä¸Šçš„è¡¨ï¼Œç”¨äºæ§åˆ¶è¡¨çš„è¡Œä¸ºã€‚å½“æˆ‘ä»¬è¿›è¡Œç‰¹å®šçš„æ“ä½œæ—¶ï¼Œä¾‹å¦‚è®¿é—®è¡¨ä¸­ä¸å­˜åœ¨çš„é”®ã€è¿›è¡Œç®—æœ¯è¿ç®—æˆ–æ¯”è¾ƒç­‰ï¼ŒLua ä¼šåœ¨å…ƒè¡¨ä¸­æŸ¥æ‰¾ç›¸åº”çš„å…ƒæ–¹æ³•å¹¶æ‰§è¡Œç›¸å…³çš„æ“ä½œã€‚</p><p>å…ƒè¡¨é€šè¿‡å®šä¹‰å…ƒæ–¹æ³•æ¥å®šä¹‰ç‰¹å®šæ“ä½œçš„è¡Œä¸ºã€‚å…ƒæ–¹æ³•æ˜¯ä¸€ç»„é¢„å®šä¹‰çš„å‡½æ•°ï¼Œä»¥ç‰¹å®šçš„é”®å­˜å‚¨åœ¨å…ƒè¡¨ä¸­ã€‚å½“æ‰§è¡Œç›¸å…³æ“ä½œæ—¶ï¼ŒLua ä¼šæ£€æŸ¥å…ƒè¡¨ä¸­æ˜¯å¦å­˜åœ¨å¯¹åº”çš„å…ƒæ–¹æ³•ï¼Œå¹¶æ ¹æ®å…ƒæ–¹æ³•çš„å®šä¹‰æ¥å¤„ç†æ“ä½œã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å…ƒæ–¹æ³•åŠå…¶å¯¹åº”çš„æ“ä½œï¼š</p><ul><li><code>__index</code>ï¼šè¯¥å…ƒæ–¹æ³•ç”¨äºå¤„ç†å½“è®¿é—®è¡¨ä¸­ä¸å­˜åœ¨çš„é”®æ—¶çš„è¡Œä¸ºã€‚å½“ Lua æ— æ³•åœ¨è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„é”®æ—¶ï¼Œå®ƒä¼šæŸ¥æ‰¾å…ƒè¡¨ä¸­çš„__index å…ƒæ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼ŒLua ä¼šè°ƒç”¨è¯¥å…ƒæ–¹æ³•ï¼Œå¹¶å°†è¡¨å’Œè¢«è®¿é—®çš„é”®ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒã€‚è¯¥å…ƒæ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªå€¼æ¥ä½œä¸ºè®¿é—®çš„ç»“æœï¼Œæˆ–è€…å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä»¥ä¾¿è¿›è¡Œè¿›ä¸€æ­¥çš„æ“ä½œã€‚</li><li><code>__newindex</code>ï¼šè¯¥å…ƒæ–¹æ³•ç”¨äºå¤„ç†å½“å¯¹è¡¨ä¸­ä¸å­˜åœ¨çš„é”®è¿›è¡Œèµ‹å€¼æ—¶çš„è¡Œä¸ºã€‚å½“ Lua æ— æ³•åœ¨è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„é”®æ—¶ï¼Œå®ƒä¼šæŸ¥æ‰¾å…ƒè¡¨ä¸­çš„__newindex å…ƒæ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼ŒLua ä¼šè°ƒç”¨è¯¥å…ƒæ–¹æ³•ï¼Œå¹¶å°†è¡¨ã€è¢«èµ‹å€¼çš„é”®å’Œèµ‹äºˆçš„å€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¯¥å…ƒæ–¹æ³•ä¸­è‡ªå®šä¹‰å¤„ç†é€»è¾‘ï¼Œä¾‹å¦‚æ•è·èµ‹å€¼æ“ä½œå¹¶æ‰§è¡Œè‡ªå®šä¹‰çš„æ“ä½œæˆ–è€…æŠ›å‡ºé”™è¯¯ã€‚</li><li><code>__add</code>ã€<code>__sub</code>ã€<code>__mul</code>ã€<code>__div</code>ç­‰ï¼šè¿™äº›å…ƒæ–¹æ³•ç”¨äºé‡è½½è¡¨çš„ç®—æœ¯è¿ç®—ç¬¦ã€‚å½“è¿›è¡Œç›¸åº”çš„ç®—æœ¯è¿ç®—æ—¶ï¼ŒLua ä¼šæŸ¥æ‰¾å…ƒè¡¨ä¸­å¯¹åº”çš„å…ƒæ–¹æ³•ï¼Œå¹¶æ ¹æ®å…ƒæ–¹æ³•çš„å®šä¹‰æ¥æ‰§è¡Œè‡ªå®šä¹‰çš„æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™äº›å…ƒæ–¹æ³•ä¸­å®ç°è‡ªå®šä¹‰çš„ç®—æœ¯è¿ç®—é€»è¾‘ã€‚</li><li><code>__eq</code>ã€<code>__lt</code>ã€<code>__le</code>ï¼šè¿™äº›å…ƒæ–¹æ³•ç”¨äºé‡è½½è¡¨çš„æ¯”è¾ƒè¿ç®—ç¬¦ã€‚å½“è¿›è¡Œç›¸åº”çš„æ¯”è¾ƒæ“ä½œæ—¶ï¼ŒLua ä¼šæŸ¥æ‰¾å…ƒè¡¨ä¸­å¯¹åº”çš„å…ƒæ–¹æ³•ï¼Œå¹¶æ ¹æ®å…ƒæ–¹æ³•çš„å®šä¹‰æ¥æ‰§è¡Œè‡ªå®šä¹‰çš„æ¯”è¾ƒé€»è¾‘ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™äº›å…ƒæ–¹æ³•ä¸­å®ç°è‡ªå®šä¹‰çš„æ¯”è¾ƒé€»è¾‘ã€‚<br>è¦å°†å…ƒè¡¨å…³è”åˆ°è¡¨ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨ setmetatable å‡½æ•°ã€‚é€šè¿‡å°†è¡¨ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå…ƒè¡¨ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™ setmetatable å‡½æ•°ï¼Œå³å¯å°†å…ƒè¡¨å…³è”åˆ°è¡¨ä¸Šã€‚</li></ul><p>åŸè¡¨çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œå¯ä»¥ç”¨äºå®ç°é¢å‘å¯¹è±¡çš„ç‰¹æ€§ï¼Œä¾‹å¦‚ç»§æ‰¿ã€å¤šæ€ç­‰ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰å…ƒæ–¹æ³•æ¥è‡ªå®šä¹‰å¯¹è±¡çš„è¡Œä¸ºï¼ŒåŒæ—¶è¿˜å¯ä»¥é€šè¿‡åŸè¡¨æ¥å®ç°ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œå¦‚ä»£ç†ï¼ˆProxyï¼‰ã€å±æ€§è®¿é—®ã€äº‹ä»¶è§¦å‘ç­‰ã€‚é€šè¿‡å®šä¹‰é€‚å½“çš„å…ƒæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¦æˆªå’Œé‡å®šä¹‰å¯¹è¡¨çš„æ“ä½œï¼Œä»è€Œå®ç°å„ç§å®šåˆ¶åŒ–çš„è¡Œä¸ºã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ›´å…·ä¸“ä¸šæ€§çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨åŸè¡¨æ¥å®ç°ä»£ç†æ¨¡å¼ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åŸå§‹å¯¹è±¡</span></span><br><span class="line"><span class="keyword">local</span> realObject = &#123;</span><br><span class="line">  value = <span class="number">42</span>,</span><br><span class="line">  getName = <span class="function"><span class="keyword">function</span><span class="params">(self)</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Real Object&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="keyword">local</span> proxyObject = &#123;</span><br><span class="line">  value = <span class="number">0</span>,</span><br><span class="line">  getName = <span class="function"><span class="keyword">function</span><span class="params">(self)</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Proxy Object&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å®šä¹‰ä»£ç†çš„å…ƒè¡¨</span></span><br><span class="line"><span class="keyword">local</span> proxyMetatable = &#123;</span><br><span class="line">  <span class="built_in">__index</span> = <span class="function"><span class="keyword">function</span><span class="params">(table, key)</span></span></span><br><span class="line">    <span class="comment">-- å½“è®¿é—®å€¼æ—¶ï¼Œä»£ç†è¿”å›ä»£ç†å¯¹è±¡çš„å€¼</span></span><br><span class="line">    <span class="keyword">if</span> key == <span class="string">&quot;value&quot;</span> <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">table</span>.value</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- å½“è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä»£ç†è¿”å›åŸå§‹å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">if</span> key == <span class="string">&quot;getName&quot;</span> <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">return</span> realObject.getName</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span>,</span><br><span class="line">  <span class="built_in">__newindex</span> = <span class="function"><span class="keyword">function</span><span class="params">(table, key, value)</span></span></span><br><span class="line">    <span class="comment">-- ä»£ç†åªå…è®¸ä¿®æ”¹ä»£ç†å¯¹è±¡çš„å€¼ï¼Œè€Œä¸å½±å“åŸå§‹å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> key == <span class="string">&quot;value&quot;</span> <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">table</span>.value = value</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="TimeLine- å’Œ -Animator">TimeLine å’Œ Animator</h3><p>Animator æ˜¯ç»„ä»¶ï¼Œè€Œ Timeline æ˜¯èµ„äº§</p><p>Animator è¿™ä¸ªç»„ä»¶ï¼Œæ˜¯ç”¨æ¥å®ç°â€œä½¿ç”¨æŸç§åŠ¨ç”»æ•°æ®æ¥é©±åŠ¨æ‰€åœ¨ GameObject åŠå…¶å­ç‰©ä½“çš„å„ç§å‚æ•°éšæ—¶é—´æ¨ç§»è€Œå‘ç”Ÿå˜åŒ–â€è¿™ä¸€åŠŸèƒ½çš„ã€‚æ¯”å¦‚ï¼šAnimator å‘Šè¯‰ Transform ç»„ä»¶å°† position å’Œ rotation è®¾ç½®åˆ°æŸä¸€ä¸ªæ•°å€¼ï¼Œè€Œè¿™ä¸ªæ•°å€¼çš„æ¥æºå°±æ˜¯æˆ‘ä»¬çš„åŠ¨ç”»ç‰‡æ®µï¼ˆAnimation clipï¼Œä¹Ÿå°±æ˜¯ã€‚anim æ–‡ä»¶èµ„äº§ï¼‰</p><p>ä½† Animator è¿™ä¸ªç»„ä»¶å¹¶ä¸ç›´æ¥è¯»å–ã€‚anim èµ„äº§çš„æ•°æ®ï¼Œè€Œæ˜¯é€šè¿‡ Animator Controller èµ„äº§æ¥é—´æ¥è·å–ã€‚Animator Controller æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå¯ä»¥è®¾ç½®ä¸€ç³»åˆ—å‚æ•°æ¥æ§åˆ¶å¤šä¸ªå¤šä¸ªåŠ¨ç”»ç‰‡æ®µä¹‹é—´çš„èåˆè¿‡æ¸¡ã€‚æœ‰äº† Animator Controller çš„å‚ä¸ï¼ŒAnimator ç»„ä»¶å°±ä¸éœ€è¦ç›´æ¥æ§åˆ¶å¾ˆå¤šå¾ˆå¤šçš„åŠ¨ç”»ç‰‡æ®µäº†ï¼ˆç‰¹åˆ«ç‰¹åˆ«éº»çƒ¦ï¼‰ï¼Œåªéœ€è¦æ§åˆ¶ç›¸åº”çš„â€œå‚æ•°â€å°±å¯ä»¥è¾¾åˆ°æ§åˆ¶å¾ˆå¤šåŠ¨ç”»ç‰‡æ®µä¹‹é—´çš„èåˆè¿‡æ¸¡çš„ç›®çš„</p><p>Animator Controller æ˜¯ç”¨æ¥æ•´åˆã€‚anim æ•°æ®çš„èµ„äº§ï¼ŒTimeline ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿæ˜¯ã€‚Timeline çš„ Animation Track åšåˆ°äº‹æƒ…ï¼Œå°±æ˜¯å°†å¤šä¸ªåŠ¨ç”»ç‰‡æ®µæŒ‰æ—¶é—´é¡ºåºè¿æ¥èµ·æ¥ï¼ˆä½ å¯ä»¥æŠŠ Timeline ç†è§£æˆä¸€ä¸ªéçº¿æ€§åŠ¨ç”»ç¼–è¾‘å™¨ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦æ‰‹åŠ¨æ§åˆ¶è¿™äº›åŠ¨ç”»ç‰‡æ®µçš„æ’­æ”¾æ—¶é—´ï¼Œåªéœ€è¦åœ¨éœ€è¦çš„æ—¶å€™æ’­æ”¾ Timeline å³å¯ã€‚å½“ç„¶ï¼Œä½¿ç”¨ Animator Controller ä¹Ÿèƒ½è¾¾åˆ°ç±»ä¼¼çš„ç›®çš„ï¼Œæ¯”å¦‚å°†å¤šä¸ªç‰‡æ®µâ€œä¸²èµ·æ¥â€ï¼Œä½† Timeline çš„æ•´åˆæ˜¾ç„¶æ›´ç›´è§‚æ›´å¥½ç”¨</p><h3 id="Animator- å¦‚ä½•è§£å†³å¸§æ•°å†²çª">Animator å¦‚ä½•è§£å†³å¸§æ•°å†²çª</h3><h3 id="Lua- æ’å…¥å“ˆå¸Œè¡¨è¿˜æ˜¯æ•°ç»„">Lua æ’å…¥å“ˆå¸Œè¡¨è¿˜æ˜¯æ•°ç»„</h3><h3 id="readonly å’Œ const åŒºåˆ«"><code>readonly</code>å’Œ <code>const</code> åŒºåˆ«</h3><ul><li><code>const</code>ä¿®é¥°ç¬¦<ul><li>åˆå§‹åŒ–æ—¶æœºï¼šç¼–è¯‘æ—¶ï¼Œå³ç¼–è¯‘ç¨‹åºæ—¶å°†å€¼å·²ç»åµŒå…¥ä»£ç ä¸­ï¼›</li><li>å€¼çŠ¶æ€ï¼šä¸å…è®¸åŠ¨æ€ä¿®æ”¹</li><li>ä¿®é¥°èŒƒå›´ï¼šå­—æ®µã€å±€éƒ¨å˜é‡</li><li>ä¸»è¦åº”ç”¨åœºæ™¯ï¼šä¸»è¦åº”ç”¨äºç¨‹åºè¿è¡Œä¸­ä¸éœ€è¦æ”¹å˜çš„å˜é‡çš„å€¼ï¼Œæ¯”å¦‚æ•°å­¦ç¬¦å· PIï¼›</li></ul></li><li><code>static</code>ä¿®é¥°ç¬¦<ul><li>åˆå§‹åŒ–æ—¶æœºï¼šè¿è¡Œæ—¶ï¼Œå¯ä»¥å£°æ˜æ—¶èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ å‡½æ•°ï¼Œæˆ–ä½¿ç”¨æ—¶èµ‹å€¼</li><li>å€¼çŠ¶æ€ï¼šå…è®¸ä¿®æ”¹</li><li>ä¿®é¥°èŒƒå›´ï¼šç±»ã€å­—æ®µã€å±æ€§ã€æ–¹æ³•ã€è¿ç®—ç¬¦ã€äº‹ä»¶ã€æ„é€ å‡½æ•°ï¼ˆä¸èƒ½ç”¨äºç´¢å¼•å™¨ã€ææ„å‡½æ•°æˆ–ç±»ä»¥å¤–çš„ç±»å‹ï¼‰</li><li>ä¸»è¦åº”ç”¨åœºæ™¯ï¼šä¸»è¦ä½œç”¨äºç±»çš„å…¬å…±å±æ€§</li></ul></li><li><code>readonly</code>ä¿®é¥°ç¬¦<ul><li>åˆå§‹åŒ–æ—¶æœºï¼šè¿è¡Œæ—¶ï¼Œå¯ä»¥å£°æ˜æ—¶èµ‹å€¼æˆ–åœ¨ç±»ä¸­çš„æ„é€ å‡½æ•°ä¸­èµ‹å€¼</li><li>å€¼çŠ¶æ€ï¼šå…è®¸ä¿®æ”¹ï¼Œä½†åªèƒ½åœ¨æ„é€ å‡½æ•°ä¸­ä¿®æ”¹</li><li>ä¿®é¥°èŒƒå›´ï¼šå­—æ®µ</li><li>ä¸»è¦åº”ç”¨åœºæ™¯ï¼šä¸»è¦ä½œç”¨äºå®ä¾‹åŒ–çš„å¯¹è±¡çš„åªè¯»å±æ€§</li></ul></li><li><code>static readonly</code>ä¿®é¥°ç¬¦<ul><li>åˆå§‹åŒ–æ—¶æœºï¼šè¿è¡Œæ—¶ï¼Œæ˜¯ä¸¤ä¸ªå…³é”®å­—çš„ç»„åˆ</li><li>å€¼çŠ¶æ€ï¼šå…è®¸ä¿®æ”¹ï¼Œå£°æ˜æ—¶èµ‹å€¼æˆ–è€…é™æ€æ„é€ å‡½æ•°ä¸­èµ‹å€¼</li><li>ä¿®é¥°èŒƒå›´ï¼šå­—æ®µ</li><li>ä¸»è¦åº”ç”¨åœºæ™¯ï¼š<ul><li>å’Œ <code>const</code> ç›¸æ¯”ï¼Œå®ƒä¸»è¦åº”ç”¨äºå¼•ç”¨æ€§å˜é‡ï¼›è€Œ <code>const</code>ï¼Œåªèƒ½ç”¨äº<code>string</code> ç±»å‹çš„å¼•ç”¨æ€§å˜é‡ï¼›</li><li>ç±»çš„åªè¯»å…¬å…±å±æ€§<br>æ€»ç»“ï¼š</li></ul></li></ul></li><li><code>const</code>æ˜¯é™æ€çš„ã€ç¼–è¯‘æœŸå˜é‡ï¼Œåªèƒ½åœ¨å£°æ˜å˜é‡çš„æ—¶å€™èµ‹å€¼ã€‚</li><li><code>readonly</code>æ˜¯è¿è¡Œæ—¶å˜é‡ï¼Œå¯ä»¥åœ¨å£°æ˜çš„æ—¶å€™æˆ–åœ¨æ„é€ å‡½æ•°å†…èµ‹å€¼ã€‚</li><li><code>static readonly</code>å˜é‡å°±å˜æˆäº†é™æ€çš„ã€ç¼–è¯‘æœŸå˜é‡ã€‚åªèƒ½é™æ€æ„é€ å‡½æ•°ä¸­è¿›è¡Œåˆå§‹åŒ–ã€‚</li><li>åŒæ—¶ <code>static readonly</code> å¯ä»¥ç†è§£ä¸ºæ˜¯æœ€ç®€å•çš„ä¸€ç§å•ä¾‹æ¨¡å¼å®ç°æ–¹å¼ã€‚</li><li><code>const</code>æ˜¯é™æ€å¸¸é‡ï¼Œ<code>readonly</code>æ˜¯åŠ¨æ€å¸¸é‡ã€‚<code>const</code>é«˜æ•ˆï¼Œ<code>readonly</code>çµæ´»ï¼ä½†å®é™…å¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸ç”¨ <code>static readonly</code> æ¥ä»£æ›¿ <code>const</code>, ä»¥å¹³è¡¡<code>const</code> åœ¨çµæ´»æ€§ä¸Šçš„ä¸è¶³</li></ul><h2 id="å çº¸äºŒé¢">å çº¸äºŒé¢</h2><h3 id="Used-Total- å’Œ -Reserved-Total">Used Total å’Œ Reserved Total</h3><p>åœ¨ Profiler å·¥å…·ä¸­æä¾›äº†ä¸¤ç§æ¨¡å¼ä¾›æˆ‘ä»¬ç›‘æµ‹å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œå³ç®€æ˜“æ¨¡å¼å’Œè¯¦ç»†æ¨¡å¼ã€‚åœ¨ç®€æ˜“æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ€»çš„å†…å­˜ï¼ˆtotalï¼‰åˆ—å‡ºäº†ä¸¤åˆ—ï¼Œå³ Used Totalï¼ˆä½¿ç”¨æ€»å†…å­˜ï¼‰å’Œ Reserved Totalï¼ˆé¢„å®šæ€»å†…å­˜ï¼‰ã€‚Used Total å’Œ Reserved å‡æ˜¯ç‰©ç†å†…å­˜ï¼Œå…¶ä¸­ Reserved æ˜¯ unity å‘ç³»ç»Ÿç”³è¯·çš„æ€»å†…å­˜ï¼ŒUnity åº•å±‚ä¸ºäº†ä¸ç»å¸¸å‘ç³»ç»Ÿç”³è¯·å¼€è¾Ÿå†…å­˜ï¼Œå¼€å¯äº†è¾ƒå¤§ä¸€å—å†…å­˜ä½œä¸ºç¼“å­˜ï¼Œå³æ‰€è°“çš„ Reserved å†…å­˜ï¼Œè€Œè¿è¡Œæ—¶ï¼Œunity æ‰€ä½¿ç”¨çš„å†…å­˜é¦–å…ˆæ˜¯å‘ Reserved ä¸­æ¥ç”³è¯·å†…å­˜ï¼Œå½“ä¸ä½¿ç”¨æ—¶ä¹Ÿæ˜¯å…ˆå‘ Reserved ä¸­é‡Šæ”¾å†…å­˜ï¼Œä»è€Œæ¥ä¿è¯æ¸¸æˆè¿è¡Œçš„æµç•…æ€§ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒUsed Total è¶Šå¤§ï¼Œåˆ™ Reserved Total è¶Šå¤§ï¼Œè€Œå½“ Used Total é™ä¸‹å»åï¼ŒReserved Total ä¹Ÿæ˜¯ä¼šéšä¹‹ä¸‹é™çš„ï¼ˆä½†å¹¶ä¸ä¸€å®šä¸ Used Total åŒæ­¥ï¼‰</p><h3 id="å¦‚ä½•å®ç°å†å²è®°å½•">å¦‚ä½•å®ç°å†å²è®°å½•</h3><h3 id="EditorWindow ç”Ÿå‘½å‘¨æœŸ"><code>EditorWindow</code>ç”Ÿå‘½å‘¨æœŸ</h3><center>    <img src="/2024/05/13/51/editor-window-life.png"></center><h3 id="Animation-Clip æ•°æ®ç»“æ„"><code>Animation Clip</code>æ•°æ®ç»“æ„</h3><h3 id="åç¨‹çš„åŸç†">åç¨‹çš„åŸç†</h3><h4 id="yield å’Œ IEnumerator ä»€ä¹ˆå…³ç³»"><code>yield</code>å’Œ <code>IEnumerator</code> ä»€ä¹ˆå…³ç³»</h4><p><code>yield</code>æ˜¯ C# çš„å…³é”®å­—ï¼Œå…¶å®å°±æ˜¯å¿«é€Ÿå®šä¹‰è¿­ä»£å™¨çš„è¯­æ³•ç³–ã€‚åªè¦æ˜¯ <code>yield</code> å‡ºç°åœ¨å…¶ä¸­çš„æ–¹æ³•å°±ä¼šè¢«ç¼–è¯‘å™¨è‡ªåŠ¨ç¼–è¯‘æˆä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¯¹äºè¿™æ ·çš„å‡½æ•°å¯ä»¥ç§°ä¹‹ä¸ºè¿­ä»£å™¨å‡½æ•°ã€‚è¿­ä»£å™¨å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„è¿­ä»£å™¨ç±»çš„ä¸€ä¸ªå¯¹è±¡</p><p>è¯•è¯•æƒ³è±¡å¦‚æœæ²¡æœ‰ <code>yield</code> å…³é”®å­—ï¼Œæˆ‘ä»¬æ¯å®šä¹‰ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå°±è¦åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç° <code>IEnumerator</code> æ¥å£ï¼Œæ¥å£åŒ…å«çš„å±æ€§ä¸æ–¹æ³•éƒ½è¦æ­£ç¡®çš„å®ç°ï¼Œæ˜¯ä¸æ˜¯å¾ˆéº»çƒ¦ï¼Ÿè€Œåˆ©ç”¨ <code>yield</code> å…³é”®å­—ï¼Œåªéœ€è¦ä¸‹é¢ç®€å•çš„å‡ è¡Œä»£ç ï¼Œå°±å¯ä»¥å¿«é€Ÿå®šä¹‰ä¸€ä¸ªè¿­ä»£å™¨ã€‚è¯¸å¦‚è¿­ä»£å™¨ç±»çš„åˆ›å»ºï¼Œ<code>IEnumerator</code>æ¥å£çš„å®ç°å·¥ä½œç¼–è¯‘å™¨é€šé€šå¸®ä½ åšäº†</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”±è¿­ä»£å™¨å‡½æ•°å®šä¹‰çš„è¿­ä»£å™¨</span></span><br><span class="line"><span class="function">IEnumerator <span class="title">Test</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    Debug.Log(<span class="string">&quot;Surprise&quot;</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Unity- åç¨‹æœºåˆ¶çš„å®ç°åŸç†">Unity åç¨‹æœºåˆ¶çš„å®ç°åŸç†</h4><p>åç¨‹æ˜¯ä¸€ç§æ¯”çº¿ç¨‹æ›´è½»é‡çº§çš„å­˜åœ¨ï¼Œåç¨‹å¯å®Œå…¨ç”±ç”¨æˆ·ç¨‹åºæ§åˆ¶è°ƒåº¦ã€‚åç¨‹å¯ä»¥é€šè¿‡ <code>yield</code> æ–¹å¼è¿›è¡Œè°ƒåº¦è½¬ç§»æ‰§è¡Œæƒï¼Œè°ƒåº¦æ—¶è¦èƒ½å¤Ÿä¿å­˜ä¸Šä¸‹æ–‡ï¼Œåœ¨è°ƒåº¦å›æ¥çš„æ—¶å€™è¦èƒ½å¤Ÿæ¢å¤ã€‚è¿™æ˜¯ä¸æ˜¯å’Œä¸Šé¢â€œåœä½â€ä»£ç ç„¶ååˆåŸä½æ¢å¤çš„æ‰§è¡Œæ•ˆæœå¾ˆåƒï¼Ÿæ²¡é”™ï¼ŒUnity å®ç°åç¨‹çš„åŸç†ï¼Œå°±æ˜¯é€šè¿‡ <code>yield return</code> ç”Ÿæˆçš„ <code>IEnumerator</code> å†é…åˆæ§åˆ¶ä½•æ—¶è§¦å‘ <code>MoveNext</code> æ¥å®ç°äº†æ‰§è¡Œæƒçš„è°ƒåº¦</p><p>å…·ä½“è€Œè¨€ï¼ŒUnity æ¯é€šè¿‡ <code>MonoBehaviour.StartCoroutine</code> å¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œå°±ä¼šè·å¾—ä¸€ä¸ª <code>IEnumerator</code>ï¼ˆ<code>StartCoroutine</code> çš„å‚æ•°å°±æ˜¯ <code>IEnumerator</code>ï¼Œå‚æ•°æ˜¯æ–¹æ³•åçš„é‡è½½ç‰ˆæœ¬ä¹Ÿä¼šé€šè¿‡åå°„æ‹¿åˆ°è¯¥æ–¹æ³•å¯¹åº”çš„<code>IEnumerator</code>ï¼‰ã€‚å¹¶åœ¨å®ƒçš„æ¸¸æˆå¾ªç¯ä¸­ï¼Œæ ¹æ®æ¡ä»¶åˆ¤æ–­æ˜¯å¦è¦æ‰§è¡Œ<code>MoveNext</code> æ–¹æ³•ã€‚è€Œè¿™ä¸ªæ¡ä»¶å°±æ˜¯æ ¹æ® <code>IEnumerator</code> çš„<code>Current</code>å±æ€§è·å¾—çš„ï¼Œå³ <code>yield return</code> è¿”å›çš„å€¼ã€‚</p><p>åœ¨å¯åŠ¨ä¸€ä¸ªåç¨‹æ—¶ï¼ŒUnity ä¼šå…ˆè°ƒç”¨å¾—åˆ°çš„ <code>IEnumerator</code> çš„<code>MoveNext</code>ä¸€æ¬¡ï¼Œä»¥æ‹¿åˆ° <code>IEnumerator</code> çš„<code>Current</code>å€¼ã€‚æ‰€ä»¥æ¯å¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œåç¨‹å‡½æ•°ä¼šç«‹å³æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ª yield return å¤„ç„¶åâ€œåœä½â€ã€‚</p><p>å¯¹äºä¸åŒçš„ <code>Current</code> ç±»å‹ï¼ˆä¸€èˆ¬æ˜¯ <code>YieldInstruction</code> çš„å­ç±»ï¼‰ï¼ŒUnity å·²åšå¥½äº†ä¸€äº›é»˜è®¤å¤„ç†ï¼Œæ¯”å¦‚ï¼š</p><ul><li>å¦‚æœ <code>Current</code> æ˜¯<code>null</code>ï¼Œå°±ç›¸å½“äºä»€ä¹ˆä¹Ÿä¸åšã€‚åœ¨ä¸‹ä¸€æ¬¡æ¸¸æˆå¾ªç¯ä¸­ï¼Œå°±ä¼šè°ƒç”¨ <code>MoveNext</code>ã€‚æ‰€ä»¥<code>yield return null</code> å°±èµ·åˆ°äº†ç­‰å¾…ä¸€å¸§çš„ä½œç”¨</li><li>å¦‚æœ <code>Current</code> æ˜¯<code>WaitForSeconds</code>ç±»å‹ï¼ŒUnity ä¼šè·å–å®ƒçš„ç­‰å¾…æ—¶é—´ï¼Œæ¯æ¬¡æ¸¸æˆå¾ªç¯ä¸­éƒ½ä¼šåˆ¤æ–­æ—¶é—´æ˜¯å¦åˆ°äº†ï¼Œåªæœ‰æ—¶é—´åˆ°äº†æ‰ä¼šè°ƒç”¨ <code>MoveNext</code>ã€‚æ‰€ä»¥<code>yield return WaitForSeconds</code> å°±èµ·åˆ°äº†ç­‰å¾…æŒ‡å®šæ—¶é—´çš„ä½œç”¨</li><li>å¦‚æœ <code>Current</code> æ˜¯<code>UnityWebRequestAsyncOperation</code>ç±»å‹ï¼Œå®ƒæ˜¯ <code>AsyncOperation</code> çš„å­ç±»ï¼Œè€Œ <code>AsyncOperation</code> æœ‰<code>isDone</code>å±æ€§ï¼Œè¡¨ç¤ºæ“ä½œæ˜¯å¦å®Œæˆï¼Œåªæœ‰ <code>isDone</code> ä¸º<code>true</code>æ—¶ï¼ŒUnity æ‰ä¼šè°ƒç”¨ M<code>oveNext</code>ã€‚å¯¹äº <code>UnityWebRequestAsyncOperation</code> è€Œè¨€ï¼Œåªæœ‰è¯·æ±‚å®Œæˆäº†ï¼Œæ‰ä¼šå°† <code>isDone</code> å±æ€§è®¾ç½®ä¸º<code>true</code>ã€‚</li></ul><p>ä¹Ÿå› æ­¤æˆ‘ä»¬æ‰å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„åŒæ­¥ä»£ç ï¼Œå®Œæˆæœ¬æ¥æ˜¯å¼‚æ­¥çš„ç½‘ç»œè¯·æ±‚æ“ä½œã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span>(UnityWebRequest webRequest = UnityWebRequest.Get(<span class="string">&quot;https://www.cnblogs.com/iwiniwin/p/13705456.html&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> webRequest.SendWebRequest();</span><br><span class="line">    <span class="keyword">if</span>(webRequest.isNetworkError)</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;Error &quot;</span> + webRequest.error);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;Received &quot;</span> + webRequest.downloadHandler.text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¸¸å¡">æ¸¸å¡</h2><h3 id="LoopScrollView">LoopScrollView</h3><h3 id="UI- æ¡†æ¶">UI æ¡†æ¶</h3><h3 id="è¡¨æ ¼åŠ è½½">è¡¨æ ¼åŠ è½½</h3><h2 id="è‰è‰ä¸">è‰è‰ä¸</h2><h3 id="C- å­—ç¬¦ä¸²ä¼˜åŒ–">C# å­—ç¬¦ä¸²ä¼˜åŒ–</h3><h3 id="å›¾ç‰‡å‹ç¼©">å›¾ç‰‡å‹ç¼©</h3><h2 id="å çº¸ä¸‰é¢">å çº¸ä¸‰é¢</h2><h3 id="C- å†…å­˜åˆ†é…">C# å†…å­˜åˆ†é…</h3><h3 id="å †å’Œæ ˆçš„è®¿é—®é€Ÿåº¦">å †å’Œæ ˆçš„è®¿é—®é€Ÿåº¦</h3><h3 id="C-GC">C# GC</h3><h3 id="Lua- å…ƒè¡¨">Lua å…ƒè¡¨</h3><h3 id="çº¢ç‚¹ç³»ç»Ÿ">çº¢ç‚¹ç³»ç»Ÿ</h3><h2 id="ç±³å“ˆæ¸¸ä¸€é¢">ç±³å“ˆæ¸¸ä¸€é¢</h2><h3 id="Top-K- é—®é¢˜">Top K é—®é¢˜</h3><h3 id="Lua- å’Œ -C- äº¤äº’">Lua å’Œ C# äº¤äº’</h3><h3 id="Rebatch- å’Œ -Rebuild- çš„ä½œç”¨">Rebatch å’Œ Rebuild çš„ä½œç”¨</h3><h3 id="å‰å‘æ¸²æŸ“å’Œå»¶è¿Ÿæ¸²æŸ“">å‰å‘æ¸²æŸ“å’Œå»¶è¿Ÿæ¸²æŸ“</h3><h2 id="ç½‘æ˜“">ç½‘æ˜“</h2><h3 id="C- æ„é€ å‡½æ•°å¯ä»¥æ˜¯è™šå‡½æ•°å—">C++ æ„é€ å‡½æ•°å¯ä»¥æ˜¯è™šå‡½æ•°å—</h3><h4 id="ä¸ºä»€ä¹ˆæ„é€ å‡½æ•°ä¸å¯ä»¥æ˜¯è™šå‡½æ•°">ä¸ºä»€ä¹ˆæ„é€ å‡½æ•°ä¸å¯ä»¥æ˜¯è™šå‡½æ•°</h4><h5 id="ä»å†…å­˜çš„è§’åº¦çœ‹">ä»å†…å­˜çš„è§’åº¦çœ‹</h5><p>è™šå‡½æ•°å¯¹åº”ä¸€ä¸ªè™šå‡½æ•°è¡¨ï¼Œè™šå‡½æ•°è¡¨æ˜¯å­˜å‚¨åœ¨å¯¹è±¡çš„å†…å­˜ç©ºé—´ä¸­çš„ã€‚è€Œè°ƒç”¨è™šå‡½æ•°ä½¿ç”¨è¿‡è°ƒç”¨è™šå‡½æ•°è¡¨æ¥å®ç°çš„ã€‚å¦‚æœæ„é€ å‡½æ•°æ˜¯è™šå‡½æ•°ï¼Œé‚£ä¹ˆå°±éœ€è¦é€šè¿‡è™šå‡½æ•°è¡¨æ¥è°ƒç”¨ï¼Œä½†æ˜¯å¯¹è±¡æ˜¯é€šè¿‡æ„é€ å‡½æ•°å®ä¾‹åŒ–çš„ï¼Œ<strong>åœ¨è°ƒç”¨æ„é€ å‡½æ•°ä¹‹å‰ï¼Œè™šå‡½æ•°è¡¨å†…å­˜ç©ºé—´è¿˜æ²¡æœ‰è¢«åˆ›å»ºï¼Œæ— æ³•æ‰¾åˆ°è™šè¡¨</strong>ã€‚æ‰€ä»¥æ„é€ å‡½æ•°ä¸èƒ½æ˜¯è™šå‡½æ•°</p><h5 id="ä»ä½¿ç”¨çš„è§’åº¦çœ‹">ä»ä½¿ç”¨çš„è§’åº¦çœ‹</h5><p>è™šå‡½æ•°æ˜¯é€šè¿‡æŒ‡å‘æ´¾ç”Ÿç±»çš„åŸºç±»æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œè®¿é—®æ´¾ç”Ÿç±»ä¸­åŒåè¦†ç›–æˆå‘˜å‡½æ•°ã€‚ä½†æ˜¯æ„é€ å‡½æ•°æ˜¯é€šè¿‡åˆ›å»ºå¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨çš„ï¼Œä¸å¯èƒ½é€šè¿‡çˆ¶ç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨å»è°ƒç”¨ï¼Œæ‰€ä»¥è§„å®šæ„é€ å‡½æ•°ä¸èƒ½æ˜¯è™šå‡½æ•°</p><h4 id="ä¸ºä»€ä¹ˆææ„å‡½æ•°å¯ä»¥æ˜¯è™šå‡½æ•°">ä¸ºä»€ä¹ˆææ„å‡½æ•°å¯ä»¥æ˜¯è™šå‡½æ•°</h4><p>ä¸€ä¸ªæ´¾ç”Ÿç±»çš„æŒ‡é’ˆå¯ä»¥å®‰å…¨åœ°è½¬åŒ–ä¸ºä¸€ä¸ªåŸºç±»çš„æŒ‡é’ˆã€‚è¿™æ ·åˆ é™¤ä¸€ä¸ªåŸºç±»çš„æŒ‡é’ˆçš„æ—¶å€™ï¼ŒC++ ä¸ç®¡è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªåŸºç±»å¯¹è±¡è¿˜æ˜¯ä¸€ä¸ªæ´¾ç”Ÿç±»çš„å¯¹è±¡ï¼Œè°ƒç”¨çš„éƒ½æ˜¯åŸºç±»çš„ææ„å‡½æ•°è€Œä¸æ˜¯æ´¾ç”Ÿç±»çš„ã€‚å¦‚æœä½ ä¾èµ–äºåŸºç±»çš„ææ„å‡½æ•°çš„ä»£ç æ¥é‡Šæ”¾èµ„æºï¼Œè€Œæ²¡æœ‰é‡è½½ææ„å‡½æ•°ï¼Œé‚£ä¹ˆä¼šæœ‰èµ„æºæ³„æ¼ã€‚<br>C++ ä¸æŠŠè™šææ„å‡½æ•°ç›´æ¥ä½œä¸ºé»˜è®¤å€¼çš„åŸå› æ˜¯è™šå‡½æ•°è¡¨çš„å¼€é”€ä»¥åŠå’Œ C è¯­è¨€çš„ç±»å‹çš„å…¼å®¹æ€§ã€‚æœ‰è™šå‡½æ•°çš„å¯¹è±¡æ€»æ˜¯åœ¨å¼€å§‹çš„ä½ç½®åŒ…å«ä¸€ä¸ªéšå«çš„è™šå‡½æ•°è¡¨æŒ‡é’ˆæˆå‘˜</p><h3 id="æ¸²æŸ“æµç¨‹ï¼ŒCPU- é˜¶æ®µçš„å‰”é™¤æ“ä½œæœ‰å“ªäº›">æ¸²æŸ“æµç¨‹ï¼ŒCPU é˜¶æ®µçš„å‰”é™¤æ“ä½œæœ‰å“ªäº›</h3><p>å‰”é™¤æœ‰è§†é”¥ä½“å‰”é™¤ï¼ˆFrustum Cullingï¼‰ã€å±‚çº§å‰”é™¤ï¼ˆLayer Culling Maskï¼‰ã€é®æŒ¡å‰”é™¤ï¼ˆOcclusion Cullingï¼‰ç­‰æ­¥éª¤ï¼Œç›®çš„æ˜¯å°†ä¸æƒ³è¢«æ‘„åƒæœºçœ‹åˆ°çš„ç‰©ä½“å‰”é™¤æ‰ï¼Œå‡å°‘ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ï¼Œæé«˜æ¸²æŸ“æ•ˆç‡</p><h4 id="è§†é”¥ä½“å‰”é™¤">è§†é”¥ä½“å‰”é™¤</h4><p>åœ¨ Unity ä¸­ï¼Œæ‘„åƒæœºçš„å¯è§†åŒºåŸŸæ˜¯ä¸€ä¸ªæ¨ªæ”¾çš„é‡‘å­—å¡”å½¢ç§°ä¸ºè§†é”¥ä½“ï¼Œç”±è¿‘è£é¢ã€è¿œè£é¢ã€è§†åœºè§’ä¸‰ä¸ªå‚æ•°æ§åˆ¶ï¼Œé€šè¿‡è®¡ç®—è¿™ä¸ªè§†é”¥ä½“ä¸åœºæ™¯ä¸­çš„æ¨¡å‹æ˜¯å¦ç›¸äº¤ï¼Œæ²¡æœ‰ç›¸äº¤å°±è¯´æ˜ä½äºå¯è§†åŒºåŸŸå¤–ï¼Œè¿™æ ·çš„æ¨¡å‹å°±åº”è¯¥è¿›è¡Œå‰”é™¤</p><center>    <img src="/2024/05/13/51/frustum-culling.jpg"></center><p>ç”±äºæ¨¡å‹ä¸€èˆ¬é¢æ•°è¾ƒå¤šï¼Œå› æ­¤ä¼šé‡‡ç”¨ç»™æ¨¡å‹åˆ›å»ºåŒ…å›´ä½“å†è®¡ç®—åŒ…å›´ä½“ä¸å¯è§†åŒºåŸŸæ˜¯å¦ç›¸äº¤çš„æ–¹å¼ç®€åŒ–è®¡ç®—ã€‚åŒ…å›´ä½“æœ‰å¤šç§è®¡ç®—æ–¹æ³•ï¼Œå¸¸ç”¨çš„æœ‰ OBBï¼ˆOriented Bounding Boxï¼Œæœ‰å‘åŒ…å›´ç›’ï¼‰ã€AABBï¼ˆAxis-Aligned Bounding Boxï¼Œè½´å¯¹é½åŒ…å›´ç›’ï¼‰ã€çƒå½¢åŒ…å›´ä½“ï¼ˆå¤–æ¥çƒï¼‰ç­‰ï¼Œå…¶ä¸­ AABB å› ä¸ºè®¡ç®—æ–¹ä¾¿è€Œæ›´ä¸ºå¸¸ç”¨</p><center>    <img src="/2024/05/13/51/obb.png"></center><h4 id="å±‚çº§å‰”é™¤">å±‚çº§å‰”é™¤</h4><p>Unity ä¸­çš„æ¨¡å‹å¯ä»¥è®¾ç½®è‡ªèº«æ‰€å¤„çš„å±‚çº§ï¼ˆLayerï¼‰ï¼Œè€Œæ‘„åƒæœºåˆ™å¯ä»¥è®¾ç½®éœ€è¦å‰”é™¤æ‰çš„å±‚çº§ï¼Œä»è€Œè·³è¿‡ç‰¹å®šç‰©ä½“çš„æ¸²æŸ“</p><center>    <img src="/2024/05/13/51/layer-maks-culling.jpg"></center><h4 id="é®æŒ¡å‰”é™¤">é®æŒ¡å‰”é™¤</h4><p>åœ¨æ¸²æŸ“æ—¶ï¼Œå¦‚æœç‰©ä½“æœ‰å‰åé¡ºåºå¹¶ä¸”åæ–¹çš„ç‰©ä½“å®Œå…¨è¢«å‰æ–¹ç‰©ä½“é®æŒ¡ä½ï¼Œæ­¤æ—¶åæ–¹ç‰©ä½“åœ¨æ‘„åƒæœºä¸­å®Œå…¨çœ‹ä¸è§ï¼Œä¹Ÿå°±æ²¡æœ‰å¿…è¦è¿›è¡Œè®¡ç®—ï¼Œå¯ä»¥è¿›è¡Œå‰”é™¤</p><center>    <img src="/2024/05/13/51/occlusion-culling.png"></center><h3 id="LRU- ç®—æ³•">LRU ç®—æ³•</h3><p>LRUï¼ˆLeast recently usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰æ˜¯ç¼“å­˜ç½®æ¢ç­–ç•¥ä¸­çš„ä¸€ç§å¸¸ç”¨çš„ç®—æ³•ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯â€œå¦‚æœæ•°æ®æœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„å‡ ç‡ä¹Ÿæ›´é«˜â€ã€‚å½“ç¼“å­˜é˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œæ–°çš„å…ƒç´ åŠ å…¥é˜Ÿåˆ—æ—¶ï¼Œéœ€è¦ä»ç°æœ‰é˜Ÿåˆ—ä¸­ç§»é™¤ä¸€ä¸ªå…ƒç´ ï¼ŒLRU ç­–ç•¥å°±æ˜¯å°†æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„å…ƒç´ ç§»é™¤ï¼Œä»è€Œè…¾å‡ºç©ºé—´ç»™æ–°çš„å…ƒç´ ã€‚</p><p>å½“å¯¹ key è¿›è¡Œè®¿é—®æ—¶ï¼ˆä¸€èˆ¬æœ‰æŸ¥è¯¢ï¼Œæ›´æ–°ï¼Œå¢åŠ ï¼Œåœ¨ <code>get()</code> å’Œ<code>set()</code>ä¸¤ä¸ªæ–¹æ³•ä¸­å®ç°å³å¯ï¼‰æ—¶ï¼Œå°†è¯¥ key æ”¾åˆ°é˜Ÿåˆ—çš„æœ€å‰ç«¯ï¼ˆæˆ–æœ€åç«¯ï¼‰å°±è¡Œäº†ï¼Œè¿™æ ·å°±å®ç°äº†å¯¹ key æŒ‰å…¶æœ€åä¸€æ¬¡è®¿é—®çš„æ—¶é—´é™åºï¼ˆæˆ–å‡åºï¼‰æ’åˆ—ï¼Œå½“å‘ç©ºé—´ä¸­å¢åŠ æ–°å¯¹è±¡æ—¶ï¼Œå¦‚æœç©ºé—´æ»¡äº†ï¼Œåˆ é™¤é˜Ÿå°¾ï¼ˆæˆ–é˜Ÿé¦–ï¼‰çš„å¯¹è±¡ã€‚</p><h4 id="æ™®é€šå®ç°">æ™®é€šå®ç°</h4><p>å€ŸåŠ©äºæ™®é€š dict å’Œ list æ¥å®ç°ï¼Œdict ä¿å­˜é”®å€¼å¯¹ï¼Œlist ä¿è¯æ’å…¥çš„æœ‰åºï¼ˆå€ŸåŠ©åˆ—è¡¨æ¥è®°å½•æ’å…¥çš„é¡ºåºï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸºäºæ™®é€š dict å’Œ list å®ç°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, size=<span class="number">5</span></span>):</span><br><span class="line">        self.size = size</span><br><span class="line">        self.cache = <span class="built_in">dict</span>()</span><br><span class="line">        self.key_list = []</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self.cache:</span><br><span class="line">            self.key_list.remove(key)</span><br><span class="line">            self.key_list.insert(<span class="number">0</span>, key)</span><br><span class="line">            <span class="keyword">return</span> self.cache[key]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set</span>(<span class="params">self, key, value</span>):</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self.cache:  <span class="comment"># æ›´æ–°</span></span><br><span class="line">            self.key_list.remove(key)  </span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(self.cache) == self.size:  <span class="comment"># åˆ é™¤æ’å…¥</span></span><br><span class="line">            old_key = self.key_list.pop()</span><br><span class="line">            self.cache.pop(old_key)</span><br><span class="line">        self.cache[key] = value       <span class="comment"># ä¸€èˆ¬æ’å…¥</span></span><br><span class="line">        self.key_list.insert(<span class="number">0</span>, key)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ hash è¡¨æ¥å®šä½ç»“ç‚¹ä½ç½®ï¼Œ<code>get()</code>å’Œ <code>set()</code> çš„æ—¶é—´å¤æ‚åº¦å‡ä¸º $O(1)$ï¼Œç©ºé—´å¤æ‚åº¦ä¸º $O(n)$</p><h4 id="å€ŸåŠ© OrderedDict">å€ŸåŠ©<code>OrderedDict</code></h4><p>python ä¸­æœ‰ä¸€ä¸ªæ ‡å‡†åº“çš„ç±»çš„<code>OrderedDict</code>ï¼ˆæœ‰åºå­—å…¸ï¼‰ï¼Œè¯¥ç±»æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ç”¨æ¥å®ç° LRU ç®—æ³•å°±ååˆ†ç®€å•ï¼š</p><ul><li><code>popitem(last=True)</code>ï¼šæœ‰åºå­—å…¸çš„ <code>popitem()</code> æ–¹æ³•ç§»é™¤å¹¶è¿”å›ä¸€ä¸ª (key, value) é”®å€¼å¯¹ã€‚ å¦‚æœ last å€¼ä¸ºçœŸï¼Œåˆ™æŒ‰ LIFO åè¿›å…ˆå‡ºçš„é¡ºåºè¿”å›é”®å€¼å¯¹ï¼Œå¦åˆ™å°±æŒ‰ FIFO å…ˆè¿›å…ˆå‡ºçš„é¡ºåºè¿”å›é”®å€¼å¯¹</li><li><code>move_to_end(key, last=True)</code>ï¼šå°†ç°æœ‰ key ç§»åŠ¨åˆ°æœ‰åºå­—å…¸çš„ä»»ä¸€ç«¯ã€‚ å¦‚æœ last ä¸ºçœŸå€¼ï¼ˆé»˜è®¤ï¼‰åˆ™å°†å…ƒç´ ç§»è‡³æœ«å°¾ï¼›å¦‚æœ last ä¸ºå‡å€¼åˆ™å°†å…ƒç´ ç§»è‡³å¼€å¤´ã€‚å¦‚æœ key ä¸å­˜åœ¨åˆ™ä¼šè§¦å‘ KeyError`</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict, defaultdict</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LRU</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, capacity=<span class="number">128</span></span>):</span><br><span class="line">        self.capacity = capacity    <span class="comment"># ç¼“å­˜å®¹é‡</span></span><br><span class="line">        self.cache = OrderedDict()  <span class="comment"># æœ‰åºå­—å…¸ç¼“å­˜</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, key, value</span>):</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self.cache:</span><br><span class="line">            <span class="comment"># è‹¥æ•°æ®å·²å­˜åœ¨ï¼Œè¡¨ç¤ºå‘½ä¸­ä¸€æ¬¡ï¼Œéœ€è¦æŠŠæ•°æ®ç§»åˆ°ç¼“å­˜é˜Ÿåˆ—æœ«ç«¯</span></span><br><span class="line">            self.cache.move_to_end(key)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.cache) &gt;= self.capacity:</span><br><span class="line">            <span class="comment"># è‹¥ç¼“å­˜å·²æ»¡ï¼Œåˆ™éœ€è¦æ·˜æ±°æœ€æ—©æ²¡æœ‰ä½¿ç”¨çš„æ•°æ®</span></span><br><span class="line">            self.cache.popitem(last=<span class="literal">False</span>)</span><br><span class="line">        <span class="comment"># å½•å…¥ç¼“å­˜</span></span><br><span class="line">        self.cache[key]=value</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># éå† key</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">travel</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> self.cache.keys():</span><br><span class="line">            <span class="built_in">print</span>(key)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self.cache:</span><br><span class="line">            val = self.cache.pop(key)</span><br><span class="line">            self.cache[key] = val</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            val = <span class="literal">None</span></span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> val</span><br></pre></td></tr></table></figure><h3 id="ç¼“å­˜ç®—æ³•">ç¼“å­˜ç®—æ³•</h3><h4 id="FIFO- ç®—æ³•">FIFO ç®—æ³•</h4><p>å¦‚æœä¸€ä¸ªæ•°æ®æœ€å…ˆè¿›å…¥ç¼“å­˜ï¼Œåˆ™åº”è¯¥æœ€æ—©æ·˜æ±°æ‰</p><ul><li><code>get(key)</code>ï¼šå¦‚æœ Cache ä¸­å­˜åœ¨è¯¥ keyï¼Œåˆ™è¿”å›å¯¹åº”çš„ value å€¼ï¼Œå¦åˆ™ï¼Œè¿”å› -1</li><li><code>set(key,value)</code>ï¼šå¦‚æœ Cache ä¸­å­˜åœ¨è¯¥ keyï¼Œåˆ™é‡ç½® value å€¼ï¼›å¦‚æœä¸å­˜åœ¨è¯¥ keyï¼Œåˆ™å°†è¯¥ key æ’å…¥ Cacheï¼Œè‹¥ Cache å·²æ»¡ï¼Œåˆ™æ·˜æ±°æœ€æ—©è¿›å…¥ Cache çš„æ•°æ®</li></ul><h4 id="LRUï¼šLeast-Recently-used">LRUï¼šLeast Recently used</h4><p>å¦‚æœæ•°æ®æœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„å‡ ç‡ä¹Ÿæ›´é«˜</p><h4 id="LFUï¼šLeast-Frequency-Used">LFUï¼šLeast Frequency Used</h4><p>å¦‚æœæ•°æ®è¿‡å»è¢«è®¿é—®å¤šæ¬¡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„é¢‘ç‡ä¹Ÿæ›´é«˜ã€‚æ³¨æ„ LFU å’Œ LRU çš„åŒºåˆ«ï¼ŒLRU çš„æ·˜æ±°è§„åˆ™æ˜¯åŸºäºè®¿é—®æ—¶é—´ï¼Œè€Œ LFU æ˜¯åŸºäºè®¿é—®æ¬¡æ•°</p><p>ä¸ºäº†èƒ½å¤Ÿæ·˜æ±°æœ€å°‘ä½¿ç”¨çš„æ•°æ®ï¼ŒLFU ç®—æ³•æœ€ç®€å•çš„ä¸€ç§è®¾è®¡æ€è·¯å°±æ˜¯ï¼šåˆ©ç”¨ä¸€ä¸ªæ•°ç»„å­˜å‚¨æ•°æ®é¡¹ï¼Œç”¨ hashmap å­˜å‚¨æ¯ä¸ªæ•°æ®é¡¹åœ¨æ•°ç»„ä¸­å¯¹åº”çš„ä½ç½®ï¼Œç„¶åä¸ºæ¯ä¸ªæ•°æ®é¡¹è®¾è®¡ä¸€ä¸ªè®¿é—®é¢‘æ¬¡ï¼Œå½“æ•°æ®é¡¹è¢«å‘½ä¸­æ—¶ï¼Œè®¿é—®é¢‘æ¬¡è‡ªå¢ï¼Œåœ¨æ·˜æ±°çš„æ—¶å€™æ·˜æ±°è®¿é—®é¢‘æ¬¡æœ€å°‘çš„æ•°æ®ã€‚è¿™æ ·ä¸€æ¥ï¼Œåœ¨æ’å…¥æ•°æ®å’Œè®¿é—®æ•°æ®çš„æ—¶å€™éƒ½èƒ½è¾¾åˆ° $O(1)$ çš„æ—¶é—´å¤æ‚åº¦ï¼Œåœ¨æ·˜æ±°æ•°æ®çš„æ—¶å€™ï¼Œé€šè¿‡é€‰æ‹©ç®—æ³•å¾—åˆ°åº”è¯¥æ·˜æ±°çš„æ•°æ®é¡¹åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ï¼Œå¹¶å°†è¯¥ç´¢å¼•ä½ç½®çš„å†…å®¹æ›¿æ¢ä¸ºæ–°æ¥çš„æ•°æ®å†…å®¹å³å¯ï¼Œè¿™æ ·çš„è¯ï¼Œæ·˜æ±°æ•°æ®çš„æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ã€‚<br>å¦å¤–è¿˜æœ‰ä¸€ç§å®ç°æ€è·¯å°±æ˜¯åˆ©ç”¨å°é¡¶å † +hashmapï¼Œå°é¡¶å †æ’å…¥ã€åˆ é™¤æ“ä½œéƒ½èƒ½è¾¾åˆ° $O(logn)$ æ—¶é—´å¤æ‚åº¦ï¼Œå› æ­¤æ•ˆç‡ç›¸æ¯”ç¬¬ä¸€ç§å®ç°æ–¹æ³•æ›´åŠ é«˜æ•ˆ</p><h2 id></h2><h3 id="Unity- èµ„æºç®¡ç†">Unity èµ„æºç®¡ç†</h3><p>åœ¨ Unity ä¸­ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œèµ„æºåŠ è½½æ–¹å¼ä¸»è¦åˆ†ä¸º <code>Resources</code> åŠ è½½å’Œ <code>AssetBundle</code> åŠ è½½ã€‚Unity æœ‰ä¸ªç‰¹æ®Šæ–‡ä»¶å¤¹ Resourcesï¼Œæ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„èµ„æºå¯ä»¥é€šè¿‡ <code>Resources.Load()</code> æ¥ç›´æ¥åŠ è½½ã€‚å³ <code>Resources</code> åŠ è½½èµ„æºæ–¹å¼ã€‚å½“è·å¾— <code>AssetBundle</code> ä¹‹åï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ <code>AssetBundle å¯¹åº”</code> çš„ API æ¥åŠ è½½èµ„æº</p><p>AB åŒ…å…¨å AssetBundleï¼ˆèµ„æºåŒ…ï¼‰ã€‚æ˜¯ä¸€ç§ Unity æä¾›çš„ç”¨äºå­˜æ”¾èµ„æºçš„åŒ…ã€‚é€šè¿‡å°†èµ„æºåˆ†å¸ƒåœ¨ä¸åŒçš„ AB åŒ…ä¸­å¯ä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘è¿è¡Œæ—¶çš„å†…å­˜å‹åŠ›ï¼Œå¹¶ä¸”å¯ä»¥æœ‰é€‰æ‹©åœ°åŠ è½½å†…å®¹</p><h4 id="ä¸ºä»€ä¹ˆè¦ç”¨ -AB- åŒ…">ä¸ºä»€ä¹ˆè¦ç”¨ AB åŒ…</h4><ol><li>çƒ­æ›´æ–°ï¼ˆè¦çƒ­æ›´æ–°éœ€è¦ç¡®ä¿ AB åŒ…æ‰“å‡ºæ¥çš„èµ„æºå…·æœ‰å”¯ä¸€æ€§ï¼Œä¸”ç›¸åŒèµ„æºçš„ AB åŒ…æ£€éªŒç ç›¸åŒï¼‰</li><li>Resources åŠ è½½è™½ç„¶ç®€å•æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šé—®é¢˜<ol><li>å¯¹å†…å­˜ç®¡ç†é€ æˆä¸€å®šçš„è´Ÿæ‹…</li><li>åœ¨æ‰“å¼€åº”ç”¨æ—¶åŠ è½½æ—¶é—´å¾ˆé•¿</li><li>Resources æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰èµ„æºç»Ÿä¸€åˆå¹¶åˆ°ä¸€ä¸ªåºåˆ—åŒ–æ–‡ä»¶ä¸­ï¼ˆå¯ä»¥çœ‹æˆç»Ÿä¸€æ‰“ä¸€ä¸ªå¤§åŒ…ï¼Œå·¨å‹ AB åŒ…æœ‰ä»€ä¹ˆé—®é¢˜å®ƒå°±æœ‰ä»€ä¹ˆé—®é¢˜ï¼‰ï¼Œå¯¹èµ„æºä¼˜åŒ–æœ‰ä¸€å®šçš„é™åˆ¶</li><li>ä¸å»ºè®®å¤§é‡ä½¿ç”¨ Resources</li></ol></li></ol><h4 id="è·å– -AB- åŒ…æ–¹æ³•">è·å– AB åŒ…æ–¹æ³•</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">AssetBundle.LoadFromFile(<span class="built_in">string</span> path)</span><br><span class="line">AssetBundle.LoadFromFileAsync(<span class="built_in">string</span> path)</span><br><span class="line">AssetBundle.LoadFromMemory(<span class="built_in">byte</span>[] binary)</span><br><span class="line">AssetBundle.LoadFromMemoryAsync(<span class="built_in">byte</span>[] binary)</span><br><span class="line">AssetBundle.LoadFromStream(Stream stream)</span><br><span class="line">AssetBundle.LoadFromStreamAsync(Stream stream)</span><br><span class="line">WWW.AssetBundle</span><br></pre></td></tr></table></figure><ul><li><code>LoadFromFile</code>æ˜¯ä»æ–‡ä»¶ä¸­åŠ è½½ AB åŒ…ï¼Œå®ƒä»ä¸€ä¸ªç»™å®šçš„è·¯å¾„æ¥åŠ è½½ AB åŒ…ã€‚å¦‚æœ AB åŒ…æ˜¯ LZ4 åŠ è½½æ–¹å¼ï¼Œå®ƒåªä¼šåŠ è½½ AB åŒ…çš„ Headerï¼Œä¹‹åéœ€è¦ä»€ä¹ˆèµ„æºå†åŠ è½½é‚£éƒ¨åˆ†çš„ AB åŒ… chunkã€‚æå¤§çš„å‡å°‘äº†å†…å­˜å ç”¨ã€‚<ul><li><code>LoadFromFileAsync</code>æ˜¯å®ƒçš„å¼‚æ­¥ç‰ˆæœ¬</li></ul></li><li><code>LoadFromMemory</code>æ˜¯ä»å†…å­˜ä¸­åŠ è½½ AB åŒ…ï¼Œå®ƒä»å†…å­˜ä¸­çš„ <code>byte[]</code> ä¸­åŠ è½½ AB åŒ…ã€‚å®ƒä¼šå®Œæ•´çš„æŠŠ AB åŒ…åŠ è½½å‡ºæ¥<ul><li><code>LoadFromMemoryAsync</code>æ˜¯å®ƒçš„å¼‚æ­¥ç‰ˆæœ¬</li></ul></li><li><code>LoadFromStream</code>æ˜¯ä»æµä¸­åŠ è½½ AB åŒ…ï¼Œå®ƒä»ä¸€ä¸ª Stream ä¸­åŠ è½½ AB åŒ…ã€‚è·Ÿ <code>LoadFromFile</code> ä¸€æ ·ï¼Œå¦‚æœ AB åŒ…æ˜¯ LZ4 åŠ è½½æ–¹å¼ï¼Œå®ƒä¹Ÿæ˜¯åªä¼šåŠ è½½ AB åŒ…çš„ Headerã€‚<ul><li><code>LoadFromStreamAsync</code>æ˜¯å®ƒçš„å¼‚æ­¥ç‰ˆæœ¬</li></ul></li><li>WWW æ˜¯ Unity ä¸­çš„è·Ÿç½‘ç»œç›¸å…³çš„ç±»ï¼Œå¯ä»¥é€šè¿‡è¯¥ç±»ä»ç½‘ç»œä¸­ä¸‹è½½èµ„æºï¼Œä¹‹ååŠ è½½æˆ AB åŒ…</li></ul><h4 id="åŠ è½½èµ„æºæ–¹æ³•">åŠ è½½èµ„æºæ–¹æ³•</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AssetBundle.LoadAsset(<span class="built_in">string</span> assetName, Type resType)</span><br><span class="line">AssetBundle.LoadAssetAsync(<span class="built_in">string</span> assetName, Type resType)</span><br></pre></td></tr></table></figure><h4 id="LZMA- å’Œ -LZ4">LZMA å’Œ LZ4</h4><p>LZMA æ˜¯æµå‹ç¼©æ–¹å¼ï¼ˆstream-basedï¼‰ã€‚æµå‹ç¼©å†å¤„ç†æ•´ä¸ªæ•°æ®å—æ—¶ä½¿ç”¨åŒä¸€ä¸ªå­—å…¸ï¼Œå®ƒæä¾›äº†æœ€å¤§å¯èƒ½çš„å‹ç¼©ç‡ï¼Œä½†æ˜¯åªæ”¯æŒé¡ºåºè¯»å–ã€‚æ‰€ä»¥åŠ è½½ AB åŒ…æ—¶ï¼Œéœ€è¦å°†æ•´ä¸ªåŒ…è§£å‹ï¼Œä¼šé€ æˆå¡é¡¿å’Œé¢å¤–å†…å­˜å ç”¨ã€‚</p><p>LZ4 æ˜¯å—å‹ç¼©æ–¹å¼ï¼ˆchunk-basedï¼‰ã€‚å—å‹ç¼©çš„æ•°æ®è¢«åˆ†ä¸ºå¤§å°ç›¸åŒçš„å—ï¼Œå¹¶è¢«åˆ†åˆ«å‹ç¼©ã€‚å¦‚æœéœ€è¦å®æ—¶è§£å‹éšæœºè¯»å–ï¼Œå—å‹ç¼©æ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚<code>LoadFromFile()</code>å’Œ <code>LoadFromStream()</code> éƒ½åªä¼šåŠ è½½ AB åŒ…çš„ Headerï¼Œç›¸å¯¹ <code>LoadFromMemory()</code> æ¥è¯´å¤§å¤§èŠ‚çœäº†å†…å­˜</p><h4 id="å†…å­˜å ç”¨">å†…å­˜å ç”¨</h4><p>AB åŒ…å†…çš„èµ„æºéœ€è¦é€šè¿‡ <code>AssetBundle.Load()</code> æ¥åŠ è½½åˆ°å†…å­˜ä¸­</p><ul><li>å¯¹äº GameObject æ¥è¯´ï¼Œé€šå¸¸æƒ…å†µä¸‹éœ€è¦å¯¹å…¶è¿›è¡Œæ”¹åŠ¨ï¼Œæ‰€ä»¥å®ƒæ˜¯å®Œå…¨å¤åˆ¶ä¸€ä»½è¯¥èµ„æºæ¥è¿›è¡Œçš„å®ä¾‹åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ AB åŒ…ä¸­çš„ GameObject ä»å†…å­˜ä¸­å¸è½½åï¼Œå®ä¾‹åŒ–çš„ GameObject ä¸ä¼šå› æ­¤ä¸¢å¤±ã€‚å¹¶ä¸”å¯¹å®ä¾‹åŒ–å¯¹è±¡çš„ä¿®æ”¹ä¸ä¼šå½±å“åˆ° GameObject èµ„æº</li><li>å¯¹äº Shader å’Œ Texture æ¥è¯´ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸éœ€è¦å¯¹å…¶è¿›è¡Œæ”¹åŠ¨ï¼Œæ‰€ä»¥å®ƒæ˜¯é€šè¿‡å¼•ç”¨æ¥è¿›è¡Œçš„å®ä¾‹åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ AB åŒ…ä¸­çš„ Shader å’Œ Texture èµ„æºä»å†…å­˜ä¸­å¸è½½åï¼Œå®ä¾‹åŒ–çš„ Shader å’Œ Texture ä¼šå‡ºç°èµ„æºä¸¢å¤±çš„æƒ…å†µã€‚å¹¶ä¸”å¯¹å®ä¾‹åŒ–å¯¹è±¡çš„ä¿®æ”¹ä¼šå½±å“åˆ° Shader å’Œ Texture èµ„æº</li><li>å¯¹äº Material å’Œ Mesh æ¥è¯´ï¼Œæœ‰æ—¶å€™å¯èƒ½éœ€è¦å¯¹å…¶è¿›è¡Œæ”¹åŠ¨ï¼Œæ‰€ä»¥å®ƒæ˜¯é€šè¿‡å¼•ç”¨ + å¤åˆ¶æ¥è¿›è¡Œçš„å®ä¾‹åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ AB åŒ…ä¸­çš„ Material å’Œ Mesh èµ„æºä»å†…å­˜ä¸­å¸è½½åï¼Œå®ä¾‹åŒ–çš„ Material å’Œ Mesh ä¼šå‡ºç°èµ„æºä¸¢å¤±çš„æƒ…å†µã€‚å¹¶ä¸”å¯¹å®ä¾‹åŒ–å¯¹è±¡çš„ä¿®æ”¹ä¸ä¼šå½±å“åˆ° Material å’Œ Mesh èµ„æº</li></ul><blockquote><p>AB åŒ…å…ˆè¦ä»ç¡¬ç›˜æˆ–è€…ç½‘ç»œä¸­åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åå°† AB åŒ…å†…çš„æ¯ä¸€ä»½èµ„æºåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå†ä¹‹ååœ¨å†…å­˜ä¸­å®ä¾‹åŒ–è¿™äº›èµ„æºã€‚æ¯ç§èµ„æºæœ‰å…¶è‡ªå·±ä¸åŒçš„å®ä¾‹åŒ–æ–¹å¼ï¼Œå¸è½½èµ„æºçš„æ—¶å€™éœ€è¦æ³¨æ„</p></blockquote><h4 id="AB- åŒ…å†…éƒ¨ç»“æ„">AB åŒ…å†…éƒ¨ç»“æ„</h4><ul><li><code>AssetBundleFileHeader</code>ï¼šè®°å½•äº†ç‰ˆæœ¬å·ã€å‹ç¼©ç­‰ä¸»è¦æè¿°ä¿¡æ¯</li><li><code>AssetFileHeader</code>ï¼šåŒ…å«ä¸€ä¸ªæ–‡ä»¶åˆ—è¡¨ï¼Œè®°å½•äº†æ¯ä¸ªèµ„æºçš„ nameã€offsetã€length ç­‰ä¿¡æ¯</li><li>Asset1ï¼š<ul><li><code>AssetHeader</code>ï¼šè®°å½•äº† <code>TypeTree</code> å¤§å°ã€æ–‡ä»¶å¤§å°ã€format ç­‰ä¿¡æ¯</li><li><code>TypeTree</code>ï¼ˆå¯é€‰ï¼‰ï¼šè®°å½•äº† <code>Asset</code> å¯¹è±¡çš„ class IDã€‚Unity å¯ä»¥ç”¨ class ID æ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¸€ä¸ªç±»ï¼ˆæ¯ä¸ª class å¯¹åº”äº†ä¸€ä¸ª IDï¼Œå¦‚ 0 æ˜¯ <code>Object</code> ç±»ï¼Œ1 æ˜¯ <code>GameObject</code> ç±»ç­‰ï¼Œå…·ä½“å¯åœ¨ Unity å®˜ç½‘ä¸ŠæŸ¥è¯¢ï¼‰</li><li><code>ObjectPath</code>ï¼šè®°å½•äº† path IDï¼ˆèµ„æºå”¯ä¸€ç´¢å¼• IDï¼‰ç­‰</li><li><code>AssetRef</code>ï¼šè®°å½•äº† AB åŒ…å¯¹å¤–éƒ¨èµ„æºå¯¹å¼•ç”¨æƒ…å†µ</li></ul></li><li>Asset2</li><li>â€¦</li></ul><h4 id="ä¾èµ–é—®é¢˜">ä¾èµ–é—®é¢˜</h4><p>ä¾èµ–é—®é¢˜ï¼Œé€šä¿—çš„è¯æ¥è¯´å°±æ˜¯ A åŒ…ä¸­æŸèµ„æºç”¨äº† B åŒ…ä¸­çš„æŸèµ„æºã€‚ç„¶è€Œå¦‚æœ A åŒ…åŠ è½½äº†ï¼ŒB åŒ…æ²¡æœ‰åŠ è½½ï¼Œè¿™å°±ä¼šå¯¼è‡´ A åŒ…ä¸­çš„èµ„æºå‡ºç°ä¸¢èµ„æºçš„ç°è±¡ã€‚åœ¨ Unity5.0 åï¼Œ<code>BuildAssetBundleOptions.CollectDependencies</code>æ°¸ä¹…å¼€å¯ï¼Œå³ Unity ä¼šè‡ªåŠ¨æ£€æµ‹ç‰©ä½“å¼•ç”¨çš„èµ„æºå¹¶ä¸”ä¸€å¹¶æ‰“åŒ…ï¼Œé˜²æ­¢èµ„æºä¸¢å¤±é—æ¼çš„é—®é¢˜å‡ºç°ã€‚å› ä¸ºè¿™ä¸ªç‰¹æ€§ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æŒ‡å®šæŸå…¬å…±èµ„æºçš„å­˜æ”¾åœ¨å“ªä¸ª AB åŒ…ä¸­ï¼Œè¿™ä¸ªå…¬å…±èµ„æºå°±ä¼šè¢«è‡ªåŠ¨æ‰“è¿›å¼•ç”¨å®ƒçš„ AB åŒ…ä¸­ï¼Œæ‰€ä»¥å‡ºç°å¤šä¸ªä¸åŒçš„ AB åŒ…ä¸­æœ‰é‡å¤çš„èµ„æºå­˜åœ¨çš„ç°è±¡ã€‚è¿™å°±æ˜¯èµ„æºå†—ä½™ã€‚</p><p>è¦é˜²æ­¢èµ„æºå†—ä½™ï¼Œå°±éœ€è¦æ˜ç¡®æŒ‡å‡ºèµ„æºå­˜æ”¾åœ¨å“ªä¸ª AB åŒ…ä¸­ï¼Œå½¢æˆä¾èµ–å…³ç³»ã€‚æ‰€ä»¥å¯¹äºä¸€äº›å…¬å…±èµ„æºï¼Œå»ºè®®å•ç‹¬å­˜æ”¾åœ¨ä¸€ä¸ª AB åŒ…ä¸­ã€‚åœ¨åŠ è½½çš„æ—¶å€™ï¼Œå¦‚æœ AB åŒ…ä¹‹é—´ç›¸äº’ä¾èµ–ï¼Œé‚£ä¹ˆåŠ è½½ä¸€ä¸ª AB åŒ…ä¸­çš„èµ„æºæ—¶ï¼Œå…ˆéœ€è¦åŠ è½½å‡ºå¦ä¸€ä¸ª AB åŒ…çš„èµ„æºã€‚è¿™æ ·å°±ä¼šå¯¼è‡´ä¸å¿…è¦çš„æ¶ˆè€—ã€‚æ‰€ä»¥è¯´å°½å¯èƒ½åœ°å‡å°‘ AB åŒ…ä¹‹é—´çš„ä¾èµ–ï¼Œå¹¶ä¸”å…¬å…±èµ„æºå°½é‡æå‰åŠ è½½å®Œæˆ</p><h4 id="ç»†ç²’åº¦é—®é¢˜">ç»†ç²’åº¦é—®é¢˜</h4><p>ç»†ç²’åº¦é—®é¢˜å³æ¯ä¸ª AB åŒ…åˆ†åˆ«æ”¾å…¥å¤šå°‘èµ„æºçš„é—®é¢˜ï¼Œä¸€ä¸ªå¥½çš„ç­–ç•¥è‡³å…³é‡è¦ã€‚åŠ è½½èµ„æºæ—¶ï¼Œå…ˆè¦åŠ è½½ AB åŒ…ï¼Œå†åŠ è½½èµ„æºã€‚å¦‚æœ AB åŒ…ä½¿ç”¨äº† LZMA æˆ– LZ4 å‹ç¼©ç®—æ³•ï¼Œè¿˜éœ€è¦å…ˆç»™ AB åŒ…è§£å‹ã€‚</p><ul><li>AB åŒ…æ•°é‡è¾ƒå¤šï¼ŒåŒ…å†…èµ„æºè¾ƒå°‘ï¼›AB åŒ…æ•°é‡è¾ƒå°‘ï¼ŒåŒ…å†…èµ„æºè¾ƒå¤š</li><li>åŠ è½½ä¸€ä¸ª AB åŒ…åˆ°å†…å­˜çš„æ—¶é—´çŸ­ï¼Œç©å®¶ä¸ä¼šæœ‰å¡é¡¿æ„Ÿï¼Œä½†æ¯ä¸ªèµ„æºå®é™…ä¸ŠåŠ è½½æ—¶é—´å˜é•¿ï¼›åŠ è½½ä¸€ä¸ª AB åŒ…åˆ°å†…å­˜çš„æ—¶é—´è¾ƒé•¿ï¼Œç©å®¶ä¼šæœ‰å¡é¡¿æ„Ÿï¼Œä½†ä¹‹ååŒ…å†…çš„æ¯ä¸ªèµ„æºåŠ è½½å¾ˆå¿«</li><li>çƒ­æ›´æ–°çµæ´»ï¼Œè¦æ›´æ–°ä¸‹è½½çš„åŒ…ä½“è¾ƒå°ï¼›çƒ­æ›´æ–°ä¸çµæ´»ï¼Œè¦æ›´æ–°ä¸‹è½½çš„åŒ…ä½“è¾ƒå¤§</li><li>IO æ¬¡æ•°è¿‡å¤šï¼Œå¢å¤§äº†ç¡¬ä»¶è®¾å¤‡è€—èƒ½å’Œå‘çƒ­å‹åŠ›ï¼›IO æ¬¡æ•°ä¸å¤šï¼Œç¡¬ä»¶å‹åŠ›å°</li></ul><p>ç®€å•ç­–ç•¥ï¼š</p><ul><li>ç»å¸¸æ›´æ–°å’Œä¸ç»å¸¸æ›´æ–°çš„å¯¹è±¡æ‹†åˆ†åˆ°ä¸åŒçš„ AB åŒ…ä¸­</li><li>åŒæ—¶åŠ è½½çš„å¯¹è±¡æ”¾åœ¨ä¸€ä¸ª AB åŒ…ä¸­</li><li>ä¸å¯èƒ½åŒæ—¶åŠ è½½çš„å¯¹è±¡æ‹†åˆ†åˆ°ä¸åŒçš„ AB åŒ…ä¸­</li><li>æ ¹æ®é¡¹ç›®é€»è¾‘åŠŸèƒ½æ¥åˆ†ç»„æ‰“ AB åŒ…</li><li>æ ¹æ®åŒä¸€ç±»å‹å¯¹è±¡æ¥åˆ†ç»„æ‰“ AB åŒ…</li><li>å…¬å…±èµ„æºå’Œéå…¬å…±èµ„æºæ‹†åˆ†åˆ°ä¸åŒçš„ AB åŒ…ä¸­</li></ul><h4 id="å¸è½½é—®é¢˜">å¸è½½é—®é¢˜</h4><ul><li>å½“è°ƒç”¨ <code>Resources.UnloadAsset()</code> æ—¶ï¼Œè™½ <code>Object</code> è¢«é”€æ¯ï¼Œä½† Instance ID è¢«ä¿ç•™ä¸”åŒ…å«æœ‰æ•ˆçš„ GUID å’Œ Local ID å¼•ç”¨</li><li>å½“è°ƒç”¨ <code>AssetBundle.Unload(true)</code> æ—¶ï¼Œä¸ä»… <code>Object</code> è¢«é”€æ¯ï¼Œè€Œä¸” Instance ID çš„ GUID å’Œ Local ID å¼•ç”¨å˜æ— æ•ˆ</li><li>å½“è°ƒç”¨ <code>AssetBundle.Unload(false)</code> æ—¶ï¼Œè™½ <code>Object ä¸è¢«</code> é”€æ¯ï¼Œä½† Instance ID çš„ GUID å’Œ Local ID å¼•ç”¨å˜æ— æ•ˆã€‚åœºæ™¯ä¸­çš„ç‰©ä½“ä¼šä¸è¯¥ AB åŒ…åˆ†ç¦»é“¾æ¥ã€‚å³è¯¥ç‰©ä½“çš„ Instance ID å¼•ç”¨çš„ GUID å’Œ Local ID ä¼šæ–­å¼€å¼•ç”¨ï¼Œæ— æ³•å†é€šè¿‡è¯¥ Instance ID æ‰¾åˆ° GUID å’Œ Local ID</li><li>å¦‚æœå†æ¬¡åŠ è½½è¯¥ AB åŒ…æ—¶ï¼Œåˆ†ç¦»äº†é“¾æ¥çš„ç‰©ä½“ä¸ä¼šå—è¯¥æ–°åŠ è½½çš„ AB åŒ…ç®¡ç†ã€‚å› æ­¤å¦‚æœä¸æ³¨æ„çš„è¯å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä¸å¯æ§çš„é—®é¢˜ã€‚Unity ä¸­æœ‰ <code>Resources.UnloadUnusedAssets()</code> æ–¹æ³•å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜</li></ul><h4 id="å„ç§ -ID">å„ç§ ID</h4><ul><li>åºåˆ—åŒ–åï¼Œèµ„æºç”¨ GUID å’Œ Local ID ç®¡ç†</li><li>GUID å¯¹åº” Assetï¼ŒGUID å­˜åœ¨ã€‚meta æ–‡ä»¶ä¸­ï¼Œæä¾›äº†æ–‡ä»¶ç‰¹å®šä½ç½®çš„æŠ½è±¡ï¼Œæ˜¯ä¸€ç§æ˜ å°„ï¼Œæ— éœ€å…³å¿ƒèµ„æºåœ¨ç£ç›˜ä¸Šçš„å­˜æ”¾ä½ç½®</li><li>Local ID å¯¹åº” Asset å†…çš„æ¯ä¸€ä¸ª Object</li><li>è™½ç„¶ GUID å’Œ Local ID æ¯”è¾ƒå¥½ç”¨ï¼Œä½†æ˜¯æ¯•ç«Ÿå› ä¸ºå­˜åœ¨ç£ç›˜ä¸Šï¼Œè¯»å–æ¯”è¾ƒè€—æ—¶ã€‚å› æ­¤ Unity ç¼“å­˜ä¸€ä¸ª Instance ID å¯¹åº” Objectï¼Œé€šè¿‡ Instance ID å¿«é€Ÿæ‰¾åˆ° Objectã€‚Instance ID æ˜¯ä¸€ç§å¿«é€Ÿè·å–å¯¹è±¡å®ä¾‹çš„ IDï¼ŒåŒ…å«ç€å¯¹ GUID å’Œ Local ID çš„å¼•ç”¨ã€‚è§£æ Instance ID å¯ä»¥å¿«é€Ÿè¿”å› Instance è¡¨ç¤ºçš„å·²åŠ è½½å¯¹è±¡ï¼Œå¦‚æœä¸ºåŠ è½½ç›®æ ‡å¯¹è±¡ï¼Œåˆ™å¯ä»¥å°†æ–‡ä»¶ GUID å’Œ Local ID è§£æä¸ºå¯¹è±¡æºæ•°æ®ï¼Œä»è€Œå…è®¸ Unity å³æ—¶åŠ è½½å¯¹è±¡ã€‚æ¯æ¬¡ AB åŒ…é‡æ–°åŠ è½½æ—¶ï¼Œéƒ½ä¼šä¸ºæ¯ä¸ªå¯¹è±¡åˆ›å»ºæ–°çš„ Instance ID</li></ul><h3 id="Lua- å¼±è¡¨">Lua å¼±è¡¨</h3><p>å¼±è¡¨æ˜¯ç”¨æ¥å‘Šè¯‰ Lua è™šæ‹Ÿæœºï¼Œè¢«å¼±è¡¨å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸åº”è¯¥é˜»æ­¢ä»–ä»¬è¢« gc å›æ”¶ã€‚ä¸å¼±è¡¨ç›¸å¯¹çš„æ˜¯å¼ºè¡¨ã€‚å¯¹äºå¼ºè¡¨æ¥è¯´ï¼Œæ‰€æœ‰è¢«å¼ºè¡¨å¼•ç”¨åˆ°çš„ gc å¯¹è±¡ï¼Œéƒ½ä¼šè¢«æ ‡è®°ï¼Œä»è€Œä¸ä¼šè¢« gc æœºåˆ¶å›æ”¶ï¼Œå“ªæ€•è¿™äº›å˜é‡å†ä¹Ÿæ²¡è¢«ä½¿ç”¨åˆ°ã€‚å› æ­¤ï¼Œå¯¹äºå¼ºè¡¨æ¥è¯´ï¼Œå¦‚æœä½ å¸Œæœ›è¢«å®ƒå¼•ç”¨çš„å¯¹è±¡èƒ½å¤Ÿè¢« gc å›æ”¶ï¼Œé‚£ä¹ˆä½ éœ€è¦å°†å®ƒçš„å€¼è®¾ç½®ä¸º nilã€‚å¯¹äºå¼±è¡¨æ¥è¯´ï¼Œä½†å‡¡è¢«è®¾ç½®ä¸ºå¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œå‡ä¸ä¼šè¢« gc æ ‡è®°ï¼Œå½“å†ä¹Ÿæ²¡æœ‰å…¶ä»–åœ°æ–¹å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œå®ƒä»¬ä¼šä»å¼±è¡¨ä¸­è¢«æ¸…é™¤</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">t = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨ä¸€ä¸ª table ä½œä¸º t çš„ key å€¼</span></span><br><span class="line">key1 = &#123;name = <span class="string">&quot;key1&quot;</span>&#125;</span><br><span class="line">t[key1] = <span class="number">1</span></span><br><span class="line">key1 = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆä½¿ç”¨ä¸€ä¸ª table ä½œä¸º t çš„ key å€¼</span></span><br><span class="line">key2 = &#123;name = <span class="string">&quot;key2&quot;</span>&#125;</span><br><span class="line">t[key2] = <span class="number">1</span></span><br><span class="line">key2 = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(key.name .. <span class="string">&quot;:&quot;</span> .. value)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- å¼ºåˆ¶è¿›è¡Œä¸€æ¬¡åƒåœ¾æ”¶é›†</span></span><br><span class="line"><span class="comment">-- æ­¤æ—¶ key1 å’Œ key2 è¡¨éƒ½è¢«ç½® nilï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¢«å¼ºåˆ¶å›æ”¶ï¼Œæ¢å¥è¯è¯´ï¼Œè™½ç„¶ key1 æœ¬èº«ä¸º nilï¼Œä½†æ˜¯ä»–å…ˆå‰æŒ‡å‘çš„å†…å®¹å¹¶æ²¡æœ‰è¢«åˆ é™¤ï¼Œå› ä¸ºè¿™ä¸ªå†…å®¹è¢«ä¿å­˜åœ¨äº† t ä¸­</span></span><br><span class="line"><span class="built_in">collectgarbage</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(key.name .. <span class="string">&quot;:&quot;</span> .. value)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">t = &#123;&#125;</span><br><span class="line"><span class="comment">-- ç»™ t è®¾ç½®ä¸€ä¸ªå…ƒè¡¨ï¼Œå¢åŠ __mode å…ƒæ–¹æ³•ï¼Œèµ‹å€¼ä¸º &quot;k&quot;</span></span><br><span class="line"><span class="built_in">setmetatable</span>(t, &#123;<span class="built_in">__mode</span> = <span class="string">&quot;k&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨ä¸€ä¸ª table ä½œä¸º t çš„ key å€¼</span></span><br><span class="line">key1 = &#123;name = <span class="string">&quot;key1&quot;</span>&#125;</span><br><span class="line">t[key1] = <span class="number">1</span></span><br><span class="line">key1 = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆä½¿ç”¨ä¸€ä¸ª table ä½œä¸º t çš„ key å€¼</span></span><br><span class="line">key2 = &#123;name = <span class="string">&quot;key2&quot;</span>&#125;</span><br><span class="line">t[key2] = <span class="number">1</span></span><br><span class="line">key2 = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(key.name .. <span class="string">&quot;:&quot;</span> .. value)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- å¼ºåˆ¶è¿›è¡Œä¸€æ¬¡åƒåœ¾æ”¶é›†</span></span><br><span class="line"><span class="built_in">collectgarbage</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(key.name .. <span class="string">&quot;:&quot;</span> .. value)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç åœ¨åˆ›å»ºäº†è¡¨ <code>t</code> åï¼Œç«‹å³å°† t è®¾ç½®ä¸ºå…ƒè¡¨ï¼Œå…ƒè¡¨é‡Œé¢æœ‰ä¸€ä¸ª <code>__mode</code> å­—æ®µï¼Œå€¼ä¸º <code>k</code>ï¼Œåœ¨æ‰§è¡Œ<code>collectgarbage()</code> ä¹‹å‰ï¼Œèƒ½å¤Ÿè¾“å‡º <code>t</code> ä¸­çš„å…ƒç´ ï¼Œä½†æ˜¯æ‰§è¡Œåƒåœ¾å›æ”¶ä¹‹åï¼Œå°±ä¸èƒ½å†æ¬¡è¾“å‡º <code>t</code> ä¸­çš„å…ƒç´ çš„ï¼Œè¿™æ˜¯å› ä¸ºå°†è¡¨è®¾ç½®ä¸ºå…ƒè¡¨åï¼Œé€šè¿‡ <code>__mode = &quot;k&quot;</code> å°†å…¶æŒ‡å®šä¸ºå¯¹é”®çš„å¼±å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦è¡¨ä¸­çš„æŸä¸ªé”®è¢«åƒåœ¾å›æ”¶ï¼Œ<code>t</code>ä¸­ä¼šåˆ é™¤è¿™ä¸ªé”®å¯¹åº”çš„å…ƒç´ </p><h4 id="å¼±è¡¨çš„ç”¨é€”">å¼±è¡¨çš„ç”¨é€”</h4><ul><li>ç¼“å­˜æœºåˆ¶æ·»åŠ è‡ªåŠ¨å›æ”¶åŠŸèƒ½<br>å½“å¤–éƒ¨é€šè¿‡ <code>getFromCache</code> è·å–åˆ° <code>tbl[key]</code> çš„å€¼ä¹‹åï¼Œå¦‚æœä¸€ç›´æŒæœ‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°±ä¼šä¸€ç›´åœ¨ <code>tbl</code> ç¼“å­˜ä¸­ï¼Œå¦‚æœå¤–éƒ¨ä¸å†å¼•ç”¨ <code>tbl[key]</code> å€¼æ—¶ï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨ä¸‹ä¸€è½® gc çš„æ—¶å€™ä» <code>tbl</code> è¢«æ¸…ç†ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸ç”¨å»å®ç°ç›¸å¯¹å¤æ‚çš„ LRU æœºåˆ¶ï¼Œæ¥å¯¹ <code>tbl</code> çš„å†…å­˜è¿›è¡Œé™åˆ¶å’Œå¤„ç†äº†</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> mt = &#123;<span class="built_in">__mode</span>=<span class="string">&quot;v&quot;</span>&#125;</span><br><span class="line"><span class="keyword">local</span> tbl = setmetable(&#123;&#125;, mt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">getFromCache</span><span class="params">(key)</span></span></span><br><span class="line">    <span class="keyword">if</span> tbl[key] <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> tbl[key]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    tbl[key] = loadFromDB(key)</span><br><span class="line">    <span class="keyword">return</span> tbl[key]</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li>å¼±è¡¨å®ç°é»˜è®¤å€¼</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> defaults = &#123;&#125;</span><br><span class="line"><span class="built_in">setmetatable</span>(defaults, &#123;<span class="built_in">__mode</span> = <span class="string">&quot;k&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">local</span> mt = &#123;<span class="built_in">__index</span> = <span class="function"><span class="keyword">function</span><span class="params">(t)</span></span> <span class="keyword">return</span> defaults[t]  <span class="keyword">end</span>&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setDefault</span><span class="params">(t, d)</span></span></span><br><span class="line">    defaults[t] = d</span><br><span class="line">    <span class="built_in">setmetatable</span>(t, mt)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> metas = &#123;&#125;</span><br><span class="line"><span class="built_in">setmetatable</span>(metas, &#123;<span class="built_in">__mode</span> = <span class="string">&quot;v&quot;</span>&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setDefault</span><span class="params">(t, d)</span></span></span><br><span class="line">    <span class="keyword">local</span> mt = metas[d]</span><br><span class="line">    <span class="keyword">if</span> mt == <span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">        mt = &#123;<span class="built_in">__index</span> = <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">return</span> d  <span class="keyword">end</span>&#125;</span><br><span class="line">        metas[d] = mt</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="built_in">setmetatable</span>(t, mt)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="C- å§”æ‰˜å’Œ event åŒºåˆ«">C# å§”æ‰˜å’Œ <code>event</code> åŒºåˆ«</h3><p>å§”æ‰˜ <code>delegate</code> å…¶å®å°±æ˜¯å‡½æ•°çš„æ¨¡ç‰ˆï¼Œè¿™ä¸ªæ¨¡ç‰ˆå¯ä»¥ç”¨æ¥æ”¾å…¥å„ç§æ ¼å¼å’Œä»–ç›¸åŒçš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¿™äº›çœŸå®å‡½æ•°çš„å¼•ç”¨<br>å½“å£°æ˜å§”æ‰˜æ—¶ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç±»ï¼Œå¹¶ä¸”ç»§æ‰¿è‡ª <code>MulticastDelegate</code>ï¼Œ<code>MulticastDelegate</code> ç»§æ‰¿è‡ª <code>Delegate</code>ã€‚å½“å¯¹å§”æ‰˜<code>+=</code> æ“ä½œæ—¶å€™å…¶å®æ˜¯è°ƒç”¨äº† <code>Delegate.Combine()</code> å‡½æ•°ï¼Œå½“å¯¹å§”æ‰˜ <code>-=</code> æ“ä½œæ—¶å€™å…¶å®æ˜¯è°ƒç”¨äº† <code>Delegate.Remove()</code> å‡½æ•°ï¼Œä¸€æ—¦æ‰§è¡Œ<code>Invoke</code>ï¼Œä¾¿è°ƒç”¨æ‰€æœ‰çš„å›è°ƒå‡½æ•°</p><p>äº‹ä»¶å°±æ˜¯å§”æ‰˜çš„ä¸€ç§ç‰¹æ®Šå°è£…ï¼Œäº‹ä»¶æœ¬èº«å…¶å®å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„å§”æ‰˜ã€‚å¦‚æœåŠ äº† <code>event</code> çš„æƒ…å†µä¸‹ï¼Œåœ¨å…¶ä»–ç±»ä¸­ä½¿ç”¨å¸¦ <code>event</code> å­—æ®µçš„å§”æ‰˜æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨ <code>=</code> èµ‹å€¼ç¬¦å·çš„ï¼Œåªèƒ½ä½¿ç”¨ <code>+=</code>ï¼Œæ³¨æ„è¿™é‡Œè¯´çš„æ˜¯å…¶ä»–ç±»ä¸­ï¼Œå¦‚æœç›´æ¥åœ¨å£°æ˜<code>event</code> çš„ç±»ä¸­è¿˜æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>=</code> èµ‹å€¼çš„ï¼Œå½“åœ¨å§”æ‰˜å£°æ˜çš„æ—¶å€™åŠ äº† <code>event</code> å­—æ®µä¹‹åï¼Œç›´æ¥èµ‹å€¼çš„æ“ä½œä¼šå˜æˆ <code>private</code> æƒé™ï¼Œé‚£ä¹ˆè‡ªç„¶åœ¨å…¶ä»–ç±»ä¸­å°±æ— æ³•ç›´æ¥èµ‹å€¼äº†ï¼Œ<code>+=</code>å’Œ <code>-=</code> é‡å†™å˜æˆäº† <code>add</code> å’Œ<code>remove</code>çš„æ–¹æ³•ï¼Œæ˜¯ <code>public</code> çš„ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å¤–éƒ¨è°ƒç”¨</p><h3 id="Lambda- è¡¨è¾¾å¼çš„æ•è·å˜é‡">Lambda è¡¨è¾¾å¼çš„æ•è·å˜é‡</h3><p>Lambda è¡¨è¾¾å¼å¯ä»¥æ•è·å…¶æ‰€åœ¨ä½œç”¨åŸŸä¸­çš„å˜é‡ã€‚è¿™äº›å˜é‡å°†ä½œä¸º Lambda è¡¨è¾¾å¼çš„å¤–éƒ¨å˜é‡ï¼Œåœ¨ Lambda è¡¨è¾¾å¼å†…éƒ¨è¢«å¼•ç”¨ã€‚ä½†æ˜¯ï¼ŒLambda è¡¨è¾¾å¼åªèƒ½æ•è·å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œè€Œä¸èƒ½æ•è·å€¼ç±»å‹çš„å˜é‡ï¼ˆé™¤éé˜€é—¨æ˜¯å±€éƒ¨å˜é‡å¹¶ä¸”è¢«æ ‡è®°ä¸º <code>readonly</code> æˆ–åœ¨ Lamda è¡¨è¾¾å¼ä¹‹å‰èµ‹å€¼ï¼‰</p><h3 id="Lua- ç©ºè¡¨å¤§å°">Lua ç©ºè¡¨å¤§å°</h3><blockquote><p><code>debug.tablemem(t)</code>å‡½æ•°ç”¨äºè·å– <code>table</code> è‡ªèº«å ç”¨å†…å­˜ç©ºé—´çš„å¤§å°ï¼Œè¯¥å‡½æ•°è¿”å›å››ä¸ªå­—æ®µï¼š<code>table</code>å ç”¨å†…å­˜å¤§å°ã€æ•°ç»„éƒ¨åˆ†é•¿åº¦ã€ä»¥ 2 ä¸ºåº•å“ˆå¸Œè¡¨éƒ¨åˆ†é•¿åº¦çš„å¯¹æ•°ã€å“ˆå¸Œè¡¨éƒ¨åˆ†æ˜¯å¦ä¸ºå‡èŠ‚ç‚¹ã€‚<a href="https://github.com/zhyingkun/lua-5.3.5/blob/master/liblua/libraries/ldblib.c"><code>debug.tablemem</code></a></p></blockquote><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> tbl = &#123;&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">debug</span>.tablemem(tbl)) <span class="comment">--&gt; 56   0   0   true</span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// luaobject.h</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> <span class="title">lua_Value</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">GCObject</span>* <span class="title">gc</span>;</span></span><br><span class="line">    <span class="type">void</span>* p;</span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line">    lua_Interger i;</span><br><span class="line">    lua_Number n;</span><br><span class="line">    lua_CFunction f;</span><br><span class="line">&#125; Value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">lua_TValue</span> &#123;</span></span><br><span class="line">    Value value_;</span><br><span class="line">    <span class="type">int</span> tt_;</span><br><span class="line">&#125; TValue;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lua Table</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> <span class="title">TKey</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        Value value_;</span><br><span class="line">        <span class="type">int</span> tt; <span class="comment">// ç”¨æ¥æ ‡è®° value_æ˜¯ä»€ä¹ˆç±»å‹</span></span><br><span class="line">        <span class="type">int</span> next;</span><br><span class="line">    &#125; nk;</span><br><span class="line">    TValue tvk;</span><br><span class="line">&#125; TKey;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    TKey key;</span><br><span class="line">    TValue value;</span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Table</span> &#123;</span></span><br><span class="line">    CommonHeader;               <span class="comment">// GC éƒ¨åˆ†</span></span><br><span class="line">    TValue* <span class="built_in">array</span>;              <span class="comment">// æ•°ç»„éƒ¨åˆ†</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> arraysize;     <span class="comment">// æ•°ç»„å¤§å°</span></span><br><span class="line">    Node* node;                 <span class="comment">// hash éƒ¨åˆ†</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> lsizenode;     <span class="comment">// hash å¤§å°ï¼Œå®é™…å¤§å°ä¸º 2&lt;sup&gt;lsizenode</span></span><br><span class="line">    Node* lastfree;             <span class="comment">// ç©ºé—²æŒ‡é’ˆ</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">GCObject</span>* <span class="title">gclist</span>;</span>    <span class="comment">// GC éƒ¨åˆ†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="C- å­—å…¸åŸç†">C# å­—å…¸åŸç†</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">int</span>[] buckets;  <span class="comment">// Hash æ¡¶</span></span><br><span class="line"><span class="keyword">private</span> Entry[] entries; <span class="comment">// Entry æ•°ç»„ï¼Œå­˜æ”¾å…ƒç´ </span></span><br></pre></td></tr></table></figure><p>å­—å…¸å†…éƒ¨æœ‰ä¸¤ä¸ªä¸»è¦çš„æ•°ç»„</p><ul><li><code>Entry</code>ç»“æ„ä½“æ•°ç»„ï¼šå…¶ä¸­å­˜å‚¨ hash å€¼ã€é”®å€¼å¯¹ã€å‘ç”Ÿå†²çªæŒ‡å‘çš„ä¸Šä¸€ä¸ª <code>Entry</code> ä½ç½®</li><li><code>buckets</code>æ•°ç»„ï¼šå­˜æ”¾å¯¹åº” <code>Entry</code> ä¸‹æ ‡</li></ul><h3 id="C- å˜é‡èµ‹å€¼">C# å˜é‡èµ‹å€¼</h3><ul><li>å€¼ç±»å‹å˜é‡çš„èµ‹å€¼ï¼š å€¼ç±»å‹å˜é‡ä¸­ä¿å­˜çš„æ˜¯å®é™…æ•°æ®ï¼Œåœ¨èµ‹å€¼çš„æ—¶å€™åªæ˜¯æŠŠæ•°æ®å¤åˆ¶ä¸€ä»½ï¼Œç„¶åèµ‹ç»™å¦ä¸€ä¸ªå˜é‡</li></ul><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> var1 = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">int</span> var2 = var1; <span class="comment">// ç¼–è¯‘å™¨ä¼šå…ˆå¤åˆ¶ var1 çš„å€¼ï¼Œç„¶åæŠŠå®ƒèµ‹ç»™ var2. å¾ˆæ˜æ˜¾ var2 çš„å€¼ä¹Ÿä¸º 2</span></span><br></pre></td></tr></table></figure><ul><li>å¼•ç”¨ç±»å‹å˜é‡çš„èµ‹å€¼ï¼š å¼•ç”¨ç±»å‹å˜é‡ä¸­ä¿å­˜çš„æ˜¯â€œæŒ‡å‘å®é™…æ•°æ®çš„å¼•ç”¨æŒ‡é’ˆâ€ã€‚åœ¨è¿›è¡Œèµ‹å€¼æ“ä½œçš„æ—¶å€™ï¼Œå®ƒå’Œå€¼ç±»å‹ä¸€æ ·ï¼Œä¹Ÿæ˜¯å…ˆæœ‰ä¸€ä¸ªå¤åˆ¶çš„æ“ä½œï¼Œä¸è¿‡å®ƒå¤åˆ¶çš„ä¸æ˜¯å®é™…çš„æ•°æ®ï¼Œè€Œæ˜¯å¼•ç”¨ï¼ˆçœŸå®æ•°æ®çš„å†…å­˜åœ°å€ï¼‰æ‰€ä»¥å¼•ç”¨ç±»å‹çš„å˜é‡åœ¨èµ‹å€¼çš„æ—¶å€™ï¼Œèµ‹ç»™å¦ä¸€å˜é‡çš„å®é™…ä¸Šæ˜¯å†…å­˜åœ°å€</li></ul><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">MyClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> MyStruct </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        MyClass objectA = <span class="keyword">new</span> MyClass();</span><br><span class="line">        MyClass objectB = objectA; <span class="comment">// å¼•ç”¨å˜é‡çš„èµ‹å€¼ èµ‹å€¼æ“ä½œå®Œæˆåï¼Œä¸¤ä¸ªå˜é‡éƒ½æŒ‡å‘åŒä¸€å†…å­˜åœ°å€ </span></span><br><span class="line">        objectA.val = <span class="number">10</span>; <span class="comment">// ç»™ objectA.val èµ‹å€¼ =10 ç”±äº objectB å’Œ objectA æŒ‡å‘åŒä¸€å†…å­˜åœ°å€ï¼Œæ‰€ä»¥ ojbectB.val çš„å€¼ä¹Ÿä¸º 10</span></span><br><span class="line">        objectB.val = <span class="number">20</span>; <span class="comment">// ç»™ objectB.val èµ‹å€¼ =20 ç”±äº objectB å’Œ objectA æŒ‡å‘åŒä¸€å†…å­˜åœ°å€ï¼Œæ‰€ä»¥ objectA.val çš„å€¼ä¹Ÿä¸º 20</span></span><br><span class="line">        MyStruct structA = <span class="keyword">new</span> MyStruct();</span><br><span class="line">        MyStruct structB = structA; <span class="comment">// ç»“æ„æ˜¯å€¼ç±»å‹ èµ‹å€¼æ“ä½œå®Œæˆåï¼Œä¸¤ä¸ªç»“æ„ä¸­çš„ç»“æ„ä¿¡æ¯ä¸€è‡´ã€‚æ³¨æ„æ˜¯â€œç»“æ„ä¸­çš„ä¿¡æ¯â€ä¸€è‡´ã€‚</span></span><br><span class="line">        structA.val = <span class="number">30</span>;</span><br><span class="line">        structB.val = <span class="number">40</span>;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;objectA.val=&#123;0&#125;&quot;</span>, objectA.val); <span class="comment">// è¾“å‡ºç»“æœæ˜¯ 20</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;objectB.val=&#123;0&#125;&quot;</span>, objectB.val); <span class="comment">// è¾“å‡ºç»“æœæ˜¯ 20</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;structA.val=&#123;0&#125;&quot;</span>, structA.val); <span class="comment">// è¾“å‡ºç»“æœæ˜¯ 30</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;structB.val=&#123;0&#125;&quot;</span>, structB.val); <span class="comment">// è¾“å‡ºç»“æœæ˜¯ 40</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Unity ä¸­å½±å“æ¸²æŸ“é¡ºåºçš„å› ç´ ">Unity ä¸­å½±å“æ¸²æŸ“é¡ºåºçš„å› ç´ </h3><center>    <img src="/2024/05/13/51/unity-render-order.png"></center><ul><li>Canvas<ul><li>ä¸åŒ Canvas ä¹‹é—´å¯ä»¥ç”¨ä»¥ä¸‹ä¸¤ä¸ªå±æ€§æ§åˆ¶æ¸²æŸ“å±‚çº§<ul><li>Sorting Layer</li><li>Order in Layer</li></ul></li></ul></li><li>Hierarchy ä¸­é¡ºåº<ul><li>åœ¨åŒä¸€ä¸ª Canvas ä¸­ï¼ŒHierarchy çš„é¡ºåºå†³å®šäº†æ§ä»¶çš„å±‚çº§å…³ç³»</li></ul></li></ul><h4 id="æ¨¡å‹æ·±åº¦çš„æ§åˆ¶">æ¨¡å‹æ·±åº¦çš„æ§åˆ¶</h4><ul><li>ç©ºé—´æ·±åº¦ï¼šå¯¹äº 3D ç‰©ä½“çš„æ˜¾ç¤ºå…ˆåå°±æ˜¯å®Œå…¨æŒ‰ç©ºé—´çš„å…ˆåæ¥çš„ï¼Œå½“ç„¶å¯ä»¥åœ¨ fragment shader ä¸­å…³é—­æ·±åº¦æµ‹è¯•ï¼Œæˆ–è¿›è¡Œå…¶ä»–å½±å“å¸§ç¼“å†²åŒºçš„æ“ä½œ</li><li>RenderQueueï¼šRenderQueue æ˜¯å¯¹ unity ä¸­æ‰€æœ‰å¯ä»¥æ¸²æŸ“çš„ç‰©ä½“éƒ½é€‚ç”¨</li></ul><h4 id="ç²’å­ç‰¹æ•ˆæ¸²æŸ“å±‚çº§çš„æ§åˆ¶">ç²’å­ç‰¹æ•ˆæ¸²æŸ“å±‚çº§çš„æ§åˆ¶</h4><ul><li>ç©ºé—´æ·±åº¦ï¼šå’Œ 3D æ¨¡å‹ä¸€è‡´</li><li>RenderQueueï¼šå’Œ 3D æ¨¡å‹ä¸€è‡´</li><li>Sorting Orderï¼šç²’å­ç³»ç»Ÿæœ¬èº«æ˜¯ä¸€ä¸ª Renderer ç»„ä»¶ï¼Œå®ƒæ¸²æŸ“çš„æ˜¯ä¸€ä¸ªä¸€ä¸ªç²¾çµï¼Œæ˜¯ä¸€ä¸ªä¸€ä¸ªç‰‡ï¼Œè¯¥å±æ€§æœ‰æ•ˆ</li></ul><h3 id="C- åƒåœ¾å›æ”¶">C# åƒåœ¾å›æ”¶</h3><h3 id="å¦‚ä½•è¿›è¡Œå†…å­˜ä¼˜åŒ–">å¦‚ä½•è¿›è¡Œå†…å­˜ä¼˜åŒ–</h3><h3 id="UI- å¦‚ä½•é™ä½ -Draw-Call">UI å¦‚ä½•é™ä½ Draw Call</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="é¢è¯•" scheme="https://silhouettesforyou.github.io/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
    <category term="Unity" scheme="https://silhouettesforyou.github.io/tags/Unity/"/>
    
    <category term="C#" scheme="https://silhouettesforyou.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>RO</title>
    <link href="https://silhouettesforyou.github.io/2024/05/09/50/"/>
    <id>https://silhouettesforyou.github.io/2024/05/09/50/</id>
    <published>2024-05-09T10:43:00.000Z</published>
    <updated>2024-06-04T13:26:16.274Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="å®¢æˆ·ç«¯è‡ªåŠ¨æˆ˜æ–— -AI">å®¢æˆ·ç«¯è‡ªåŠ¨æˆ˜æ–— AI</h2><h3 id="Behaviour-Designer- è¡Œä¸ºæ ‘æ’ä»¶">Behaviour Designer è¡Œä¸ºæ ‘æ’ä»¶</h3><h4 id="AI- çš„è§£å†³æ–¹æ¡ˆ">AI çš„è§£å†³æ–¹æ¡ˆ</h4><ul><li>ç¼–ç ï¼šååº”å‹ AI<ul><li>çŠ¶æ€æœº</li><li>è¡Œä¸ºæ ‘</li><li>åŸºäºè§„åˆ™çš„ç³»ç»Ÿ</li></ul></li><li>æ±‚è§£ï¼šåå•†è¡Œ AI<ul><li>A*</li><li>ç›®æ ‡å¯¼å‘å‹è¡ŒåŠ¨è®¡åˆ’ï¼ˆGOAPï¼‰</li><li>å±‚æ¬¡äººç‰©ç½‘è§„åˆ’ï¼ˆHTNï¼‰</li><li>è§„åˆ’å™¨</li></ul></li><li>å­¦ä¹ ï¼šæœºå™¨å­¦ä¹ <ul><li>æ¨¡ä»¿å­¦ä¹ </li><li>å¼ºåŒ–å­¦ä¹ </li></ul></li></ul><p>æ¸¸æˆä¸­å¸¸è§çš„ AI è§£å†³æ–¹æ¡ˆéƒ½æ˜¯ååº”å‹ AIï¼ŒRO ä¸­å¤§é‡ç”¨åˆ°ååº”å‹ AI çš„è¡Œä¸ºæ ‘ä½œä¸ºè§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸ªè¡Œä¸ºæ ‘æ’ä»¶å°±æ˜¯ Behaviour Designer</p><h3 id="Behaviour-Designer- ä¸­çš„ -Task">Behaviour Designer ä¸­çš„ Task</h3><p>ç®€å•è¡Œä¸ºæ ‘å®é™…ä¸Šå°±æ˜¯ Task çš„é›†åˆï¼ŒTask æœ‰å››ç§ä¸åŒçš„ç±»å‹ï¼š</p><ul><li>Action åŠ¨ä½œâ€”â€”ä»£è¡¨äº†æŸç§çŠ¶æ€ï¼Œæœ€åŸºæœ¬çš„ä»»åŠ¡</li><li>Conditional æ¡ä»¶â€”â€”ç”¨æ¥æ£€æµ‹æ˜¯å¦è¾¾åˆ°æŸç§æ¡ä»¶</li><li>Composite å¤åˆâ€”â€”åŒ…å«äº†ä¸€ç³»åˆ—å­ä»»åŠ¡åˆ—è¡¨çš„çˆ¶ä»»åŠ¡</li><li>Decorator ä¿®é¥°ç¬¦â€”â€”ä¹Ÿæ˜¯ä¸€ä¸ªçˆ¶ä»»åŠ¡ï¼Œå¹¶ä¸”åªèƒ½åŒ…å«ä¸€ä¸ªå­ä»»åŠ¡ï¼Œæ˜¯ç”¨æ¥ä¿®æ”¹å­ä»»åŠ¡çš„è¡Œä¸ºã€‚ä¾‹å¦‚å°†ä¸€ä¸ªå­ä»»åŠ¡è¿è¡Œ 10 æ¬¡ï¼ˆRepeaterï¼‰ï¼Œæˆ–è€…å¯¹å­ä»»åŠ¡çš„ç»“æœå–åï¼ˆInverterï¼‰</li></ul><h4 id="Action- å’Œ -Conditional- è‡ªå®šä¹‰ -Task">Action å’Œ Conditional è‡ªå®šä¹‰ Task</h4><p>ä¸€èˆ¬æƒ…å†µä¸‹åªä¼šåœ¨ Behaviour Designer ä¸­å®šä¹‰ Action å’Œ Conditionalï¼ŒComposite å’Œ Decorator ä½¿ç”¨æä¾›çš„å°±å¯ä»¥ï¼Œä¸‹é¢çš„ Action ä»£ç ç”±å·¥å…·è‡ªåŠ¨ç”Ÿæˆ</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">BehaviorDesigner.Runtime.Tasks.TaskDescriptionAttribute(<span class="string">"è¡€é‡å±æ€§æ¯”è¾ƒ"</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MAISelfCompareByHP</span> : <span class="title">BehaviorDesigner.Runtime.Tasks.Action</span></span><br><span class="line">{</span><br><span class="line">    [<span class="meta">BehaviorDesigner.Runtime.Tasks.TooltipAttribute(<span class="string">"æ˜¯å¦è‡ªå·±"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> BehaviorDesigner.Runtime.SharedBool is_self;</span><br><span class="line">    [<span class="meta">BehaviorDesigner.Runtime.Tasks.TooltipAttribute(<span class="string">"ç›®æ ‡"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> BehaviorDesigner.Runtime.SharedTransform target;</span><br><span class="line">    [<span class="meta">BehaviorDesigner.Runtime.Tasks.TooltipAttribute(<span class="string">"å€¼ç±»å‹ (hp è¡€é‡ ã€hp ç™¾åˆ†æ¯”ï¼‰"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> MoonClient.MAISelfCompareByHP.MHPValueType hp_value_type;</span><br><span class="line">    [<span class="meta">BehaviorDesigner.Runtime.Tasks.TooltipAttribute(<span class="string">"æ¯”è¾ƒç±»å‹"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> MoonClient.MNumberComparisonType hp_cmp_type;</span><br><span class="line">    [<span class="meta">BehaviorDesigner.Runtime.Tasks.TooltipAttribute(<span class="string">"å³å€¼"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> BehaviorDesigner.Runtime.SharedFloat right_value;</span><br><span class="line">    [<span class="meta">BehaviorDesigner.Runtime.Tasks.TooltipAttribute(<span class="string">"ä¿å­˜å·¦å€¼ç»“æœ"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> BehaviorDesigner.Runtime.SharedFloat store_left_value;</span><br><span class="line">    <span class="keyword">private</span> MoonClient.MAISelfCompareByHP node;</span><br><span class="line">    <span class="keyword">private</span> MEntity entity;</span><br><span class="line">    <span class="keyword">private</span> MoonClient.MAISelfCompareByHP.MNodeArgs args;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnAwake</span>()</span></span><br><span class="line">    {</span><br><span class="line">     entity = MEntityMgr.singleton.GetEntity(<span class="built_in">ulong</span>.Parse(Owner.gameObject.name));</span><br><span class="line">     <span class="keyword">if</span>(entity == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">     node = <span class="keyword">new</span> MoonClient.MAISelfCompareByHP();</span><br><span class="line">     args = <span class="keyword">new</span> MoonClient.MAISelfCompareByHP.MNodeArgs();</span><br><span class="line">      args.is_self = is_self.swigValue;</span><br><span class="line">      args.hp_value_type = hp_value_type;</span><br><span class="line">      args.hp_cmp_type = hp_cmp_type;</span><br><span class="line">      args.right_value = right_value.swigValue;</span><br><span class="line">      args.store_left_value = store_left_value.swigValue;</span><br><span class="line">     node.SetNodeArgs(args);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> TaskStatus <span class="title">OnUpdate</span>()</span></span><br><span class="line">    {</span><br><span class="line">     <span class="keyword">if</span>(entity == <span class="literal">null</span>) <span class="keyword">return</span> TaskStatus.Failure;</span><br><span class="line">     <span class="keyword">return</span> node.Update(entity) ? TaskStatus.Success : TaskStatus.Failure;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h4 id="å¸¸ç”¨çš„ -Parent-Tasks">å¸¸ç”¨çš„ Parent Tasks</h4><ul><li>Composite å¤åˆç±»å‹<ul><li>Sequence å°†å…¶æ‰€æœ‰å­èŠ‚ç‚¹ä¾æ¬¡æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰ä¸€ä¸ªè¿”å›â€œå®Œæˆâ€çŠ¶æ€åï¼Œå†è¿è¡Œå…ˆä¸€ä¸ªå­èŠ‚ç‚¹<br>[Image]<br>The sequence task is similar to an â€œandâ€ operation. It will return failure as soon as one of its child tasks return failure. If a child task returns success then it will sequentially run the next task. If all child tasks return success then it will return success.<br>å’Œâ€œandâ€æ“ä½œç¬¦é€»è¾‘ç±»ä¼¼ï¼Œä¸‹é¢çš„å­ä»»åŠ¡æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ‰§è¡Œï¼Œå¦‚æœæœ‰ä¸€ä¸ªå­ä»»åŠ¡è¿”å› falseï¼Œåç»­å­ä»»åŠ¡éƒ½ä¸æ‰§è¡Œï¼Œå¹¶ä¸”è¯¥ä»»åŠ¡ç›´æ¥è¿”å› false</li><li>Selector é€‰æ‹©å…¶å­èŠ‚ç‚¹çš„æŸä¸€ä¸ªæ‰§è¡Œ<br>[Image]<br>The selector task is similar to an â€œorâ€ operation. It will return success as soon as one of its child tasks return success. If a child task returns failure then it will sequentially run the next task. If no child task returns success then it will return failure.<br>å’Œâ€œorâ€æ“ä½œç¬¦é€»è¾‘ç±»ä¼¼ï¼Œè®©å­ä»»åŠ¡ä»å·¦åˆ°å³ä¾æ¬¡æ‰§è¡Œï¼Œå¦‚æœæœ‰ä¸€ä¸ªäººç‰©è¿”å› trueï¼Œåç»­æ‰€æœ‰äººç‰©å°±ä¸æ‰§è¡Œï¼Œè¯¥ä»»åŠ¡ç›´æ¥è¿”å› true</li><li>Parallel å°†å…¶æ‰€æœ‰å­èŠ‚ç‚¹éƒ½è¿è¡Œä¸€é</li></ul></li><li>Decorator è£…é¥°å™¨ç±»å‹<ul><li>Inverter</li><li>Repeater</li><li>Return Failure å’Œ Return Success</li></ul><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ReturnFailure.cs</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> TaskStatus <span class="title">Decorate</span>(<span class="params">TaskStatus status</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// Return failure even if the child task returned success.</span></span><br><span class="line">    <span class="keyword">if</span> (status == TaskStatus.Success) {</span><br><span class="line">        <span class="keyword">return</span> TaskStatus.Failure;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReturnSuccess.cs</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> TaskStatus <span class="title">Decorate</span>(<span class="params">TaskStatus status</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// Return success even if the child task returned failure.</span></span><br><span class="line">    <span class="keyword">if</span> (status == TaskStatus.Failure) {</span><br><span class="line">        <span class="keyword">return</span> TaskStatus.Success;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>æ— è®ºè¿”å›æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½æ˜¯è¿”å›ç›¸åº”ä»»åŠ¡å¯¹åº”çš„ç»“æœ<ul><li>Until Failure å’Œ Until Success</li><li>Random Probability</li></ul></li></ul><h3 id="å˜é‡ç›¸å…³">å˜é‡ç›¸å…³</h3><p>è¡Œä¸ºæ ‘çš„ä¼˜ç‚¹æ˜¯éå¸¸çµæ´»ï¼Œå› ä¸ºæ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯è§£è€¦åˆçš„ï¼Œä»»åŠ¡ä¹‹é—´æ˜¯ä¸äº’ç›¸ä¾èµ–çš„ã€‚ä½†æ˜¯æœ‰æ—¶å€™éœ€è¦æä¾›å½¼æ­¤å…±äº«çš„ä¿¡æ¯ï¼Œè¿™æ˜¯ä¼šç”¨åˆ°è¡Œä¸ºæ ‘æä¾›çš„å…±äº«å˜é‡ç±»å‹ã€‚åœ¨éœ€è¦çš„ Task ä¸­å®šä¹‰äº†æŸä¸ªç±»å‹ï¼Œéœ€è¦åœ¨è¡Œä¸ºæ ‘ä¸­åˆ›å»ºè¯¥ç±»å‹ï¼Œå¹¶åœ¨ Task ä¸­å¼•ç”¨è¯¥ç±»å‹</p><p>å±€éƒ¨å˜é‡å°±æ˜¯å½“å‰è¡Œä¸ºæ ‘å¯ä»¥å…±äº«çš„å˜é‡ï¼Œå…¨å±€å˜é‡å°±æ˜¯æ‰€æœ‰è¡Œä¸ºæ ‘éƒ½å¯ä»¥å…±äº«çš„å˜é‡ï¼ŒBehaviour Designer å†…ç½®çš„å…±äº«å˜é‡ç±»å‹æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">SharedAnimationCurve</span><br><span class="line">SharedBool</span><br><span class="line">SharedColor</span><br><span class="line">SharedFloat</span><br><span class="line">SharedGameObject</span><br><span class="line">SharedGameObjectList</span><br><span class="line">SharedInt</span><br><span class="line">SharedMaterial</span><br><span class="line">SharedObject</span><br><span class="line">SharedObjectList</span><br><span class="line">SharedQuaternion</span><br><span class="line">SharedRect</span><br><span class="line">SharedString</span><br><span class="line">SharedTransform</span><br><span class="line">SharedTransformList</span><br><span class="line">SharedVector2</span><br><span class="line">SharedVector3Int</span><br><span class="line">SharedVector3</span><br><span class="line">SharedVector3Int</span><br><span class="line">SharedVector4</span><br></pre></td></tr></table></figure><h3 id="Behaviour-Designer- ä¸­çš„å…±äº«å˜é‡çš„ç†è§£">Behaviour Designer ä¸­çš„å…±äº«å˜é‡çš„ç†è§£</h3><p>Behaviour Designer çš„å…±äº«å˜é‡æ˜¯ä¸€ç§é»‘æ¿ï¼ˆBlackboardï¼‰è®¾è®¡æ¨¡å¼<br>è¾“å…¥å†…å®¹çš„æ¥æºå–å†³äºè¡Œä¸ºæ ‘ç”¨åœ¨æ•´ä¸ª AI æ¶æ„çš„å“ªä¸€å±‚ï¼Œå¯ä»¥æ˜¯æ¸¸æˆä¸–ç•Œçš„ä¿¡æ¯ï¼Œæˆ–è€…æ˜¯ä¸Šå±‚æ¨¡å—çš„è¾“å‡ºã€‚è¾“å…¥çš„å½¢å¼ï¼Œå¯ä»¥æ˜¯åˆ†æ•£çš„ï¼ˆDecentralizedï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯é›†ä¸­çš„ï¼ˆCentralizedï¼‰ã€‚ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬åšä¸€ä¸ªæˆ˜å£«æ˜¯ç§»åŠ¨ï¼Œè¿˜æ˜¯æ”»å‡»çš„å†³ç­–ï¼Œè¿™æ˜¯å†³ç­–å±‚çš„è¡Œä¸ºï¼Œæ‰€ä»¥è¾“å…¥å†…å®¹å°±æ˜¯æ¸¸æˆä¸–ç•Œçš„ä¿¡æ¯ï¼Œå®ƒå¯èƒ½åŒ…æ‹¬æˆ˜å£«è‡ªèº«çŠ¶æ€ï¼ˆåœ¨æ¨¡å— A ä¸­ï¼‰ï¼Œæ•ŒäººçŠ¶æ€ï¼ˆåœ¨æ¨¡å— B ä¸­ï¼‰ï¼Œè£…å¤‡ç‰©å“æƒ…å†µï¼ˆåœ¨æ¨¡å— Cï¼‰ï¼Œåœ°å›¾åœºæ™¯æƒ…å†µï¼ˆåœ¨æ¨¡å— D ä¸­ï¼‰ç­‰ç­‰ï¼Œæ‰€ä»¥ï¼Œå½“æˆ‘ä»¬æœç´¢å’Œæ‰§è¡Œè¡Œä¸ºæ ‘æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä» 4 ä¸ªæ¨¡å—ä¸­è·å–ä¿¡æ¯æ¥å¸®åŠ©å†³ç­–ï¼Œè¿™æ ·çš„æ–¹å¼å°±æ˜¯æˆ‘ä¸Šé¢è¯´çš„åˆ†æ•£çš„æ–¹å¼ï¼Œå®ƒçš„å¥½å¤„æ˜¯è°ƒç”¨éå¸¸ç›´æ¥ï¼ˆå¯èƒ½æ˜¯ç”¨å¤šä¸ª Singleton æä¾›çš„æ¥å£ï¼‰ï¼Œæ²¡æœ‰æ•°æ®å†—ä½™ï¼Œç¼ºç‚¹æ˜¯ä½¿å¾—è¡Œä¸ºæ ‘å¯¹äºæ•°æ®çš„ä¾èµ–åº¦å¤ªåˆ†æ•£ã€‚</p><p>é›†ä¸­çš„æ–¹å¼çš„è¯ï¼Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ•°æ®ç»“æ„ä¸“é—¨ç”¨äºè¡Œä¸ºæ ‘çš„è¾“å…¥ï¼Œå°†ä¸Šé¢æåˆ°çš„éœ€è¦ç”¨åˆ°çš„æ•°æ®ï¼Œåœ¨è¿›è¡Œè¡Œä¸ºæ ‘å†³ç­–å‰ï¼Œå…ˆä»å„ä¸ªæ¨¡å—ä¸­æ”¶é›†åˆ°è¿™ä¸ªæ•°æ®ç»“æ„é‡Œï¼Œç„¶åå†é€’äº¤ç»™è¡Œä¸ºæ ‘ä½¿ç”¨ã€‚é›†ä¸­å¼çš„è¾“å…¥å‡å°‘äº†è¾“å…¥å’Œè¡Œä¸ºæ ‘ä¹‹é—´çš„æ¥å£æ•°é‡ï¼ˆåªå’Œé¢„å®šä¹‰çš„æ•°æ®ç»“æ„é€šä¿¡ï¼‰ï¼Œä½†ç¼ºç‚¹æ˜¯ï¼Œå­˜åœ¨æ•°æ®å†—ä½™ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é›†ä¸­å¼çš„æ•°æ®è¾“å…¥ä½¿å¾—è¡Œä¸ºæ ‘çš„è¡¨ç°æ›´åƒä¸€ä¸ªé»‘ç›’äº†ï¼ˆå¯ä»¥ä¼ªé€ æ•°æ®æ¥æµ‹è¯•è¡Œä¸ºæ ‘ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸€ç›´ä»¥æ¥æƒ³è¦çš„ã€‚å¯ä»¥å‚çœ‹ä¸‹é¢å¯¹äºä¸¤ç§æ–¹å¼çš„ç¤ºæ„å›¾ï¼š<br>åœ¨è¡Œä¸ºæ ‘çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå‘ç°æœ‰æ—¶å€™èŠ‚ç‚¹å’ŒèŠ‚ç‚¹é—´ï¼Œè¡Œä¸ºæ ‘å’Œè¡Œä¸ºæ ‘ä¹‹é—´ç¡®å®éœ€è¦æœ‰æ•°æ®å…±äº«ï¼Œæ¯”å¦‚å¯¹äºåºåˆ—ï¼ˆSequenceï¼‰èŠ‚ç‚¹æ¥è¯´ï¼Œå®ƒçš„æ‰§è¡Œè¡Œä¸ºæ˜¯ä¾æ¬¡æ‰§è¡Œæ¯ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œç›´ç™½ä¸€ç‚¹è¯´çš„è¯ï¼Œå°±æ˜¯æ‰§è¡Œå®Œä¸€ä¸ªå†æ‰§è¡Œä¸‹ä¸€ä¸ªã€‚ä¸€èˆ¬ç”¨åˆ°åºåˆ—çš„è¡Œä¸ºï¼Œå…¶å­èŠ‚ç‚¹é—´æ€»ä¼šæœ‰ä¸€äº›è”ç³»ï¼Œè¿™é‡Œå°±å¯èƒ½å­˜åœ¨èŠ‚ç‚¹é—´é€šä¿¡çš„é—®é¢˜ã€‚å†æ¯”å¦‚ï¼Œåœ¨ä¸€äº›å›¢é˜Ÿ AI çš„å†³ç­–è¿‡ç¨‹ä¸­ï¼Œå½“å‰ AI çš„è¡Œä¸ºæ ‘å†³ç­–å¯èƒ½éœ€è¦å‚è€ƒå…¶ä»– AI çš„å†³ç­–ç»“æœï¼Œæ‰€ä»¥è¿™æ ·å°±å­˜åœ¨äº†è¡Œä¸ºæ ‘ä¹‹é—´éœ€è¦é€šä¿¡çš„æƒ…å†µã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜ä¼šå®šä¹‰å¦ä¸€å—é»‘æ¿æ¥è´Ÿè´£è¡Œä¸ºæ ‘é—´å’ŒèŠ‚ç‚¹é—´çš„é€šä¿¡éœ€æ±‚ï¼Œç¤ºæ„å›¾å¦‚ä¸‹</p><h3 id="RO- ä¸­çš„ MShareData">RO ä¸­çš„<code>MShareData</code></h3><h4 id="å¯å…±äº«çš„å˜é‡ç±»å‹">å¯å…±äº«çš„å˜é‡ç±»å‹</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> MSharedDataType</span><br><span class="line">{</span><br><span class="line">    kSharedDataInt = <span class="number">0</span>,</span><br><span class="line">    kSharedDataBool,</span><br><span class="line">    kSharedDataFloat,</span><br><span class="line">    kSharedDataString,</span><br><span class="line">    kSharedDataVector,</span><br><span class="line">    kSharedDataTransform,</span><br><span class="line">    kSharedDataInt64,</span><br><span class="line">    kSharedDataTypeCount,</span><br><span class="line">};</span><br></pre></td></tr></table></figure><h4 id="AI- èŠ‚ç‚¹ä¸­å˜é‡åå’Œå€¼çš„å­˜å‚¨">AI èŠ‚ç‚¹ä¸­å˜é‡åå’Œå€¼çš„å­˜å‚¨</h4><p>ä¸»è¦ç”±è®°å½•å˜é‡åå¯¹åº”çš„å“ˆå¸Œå€¼ï¼ˆå…¶å®å°±æ˜¯è‡ªå¢å€¼ï¼‰å’Œå­˜å‚¨å„ä¸ªå˜é‡ç±»å‹çš„æ•°ç»„ï¼ˆç±»å‹å€¼æ•°ç»„ï¼‰å»ºç«‹èµ·æ¥çš„æ˜ å°„å…³ç³»ï¼Œè¿™äº›æ•°ç»„é‡Œä»¥å˜é‡åçš„å“ˆå¸Œå€¼ä½œä¸ºä¸‹æ ‡ï¼Œå­˜å‚¨ç›¸åº”çš„å€¼ï¼›ä¸»è¦çš„å˜é‡å¦‚ä¸‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­˜å‚¨å˜é‡åçš„å“ˆå¸Œå€¼ï¼Œæ¯ç§å˜é‡ç±»å‹åˆ†åˆ«è®°å½•ï¼Œè¯»å–æ—¶æ ¹æ®ä¸åŒçš„å˜é‡ç±»å‹è¯»å–ç›¸åº”çš„ç±»å‹å€¼æ•°ç»„</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">uint</span>&gt;[] name_hash_ =</span><br><span class="line">    <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">uint</span>&gt;[(<span class="built_in">int</span>)MSharedDataType.kSharedDataTypeCount];</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">uint</span>[] name_index_ =</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">uint</span>[(<span class="built_in">int</span>)MSharedDataType.kSharedDataTypeCount]; <span class="comment">//int å‹æ•°ç»„é‡Œé¢çš„å€¼é»˜è®¤åˆå§‹åŒ–ä¸º 0</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// å£°æ˜ç±»å‹å€¼æ•°ç»„</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">int</span> kMaxAIDataCount = <span class="number">150</span>; <span class="comment">// æ‰€æœ‰å˜é‡çš„æ•°é‡ä¸Šé™</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">float</span>[] float_var_;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">int</span>[] int_var_;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">long</span>[] long_var_;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">bool</span>[] bool_var_;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">ulong</span>[] trans_var_;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span>[] string_var_;</span><br><span class="line"><span class="keyword">private</span> Vector3[] vector3_var_;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* é»˜è®¤åˆå§‹åŒ– </span></span><br><span class="line"><span class="comment"> * bool --&gt; false</span></span><br><span class="line"><span class="comment"> * intã€float --&gt; 0</span></span><br><span class="line"><span class="comment"> * å…¶ä»–å€¼ç±»å‹ --&gt; è¯¥ç±»å‹å­—æ®µé»˜è®¤å€¼</span></span><br><span class="line"><span class="comment"> * å¼•ç”¨ç±»å‹ï¼ˆåŒ…æ‹¬ string) --&gt; null</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">float_var_ = <span class="keyword">new</span> <span class="built_in">float</span>[kMaxAIDataCount];</span><br><span class="line">int_var_ = <span class="keyword">new</span> <span class="built_in">int</span>[kMaxAIDataCount];</span><br><span class="line">long_var_ = <span class="keyword">new</span> <span class="built_in">long</span>[kMaxAIDataCount];</span><br><span class="line">bool_var_ = <span class="keyword">new</span> <span class="built_in">bool</span>[kMaxAIDataCount];</span><br><span class="line">trans_var_ = <span class="keyword">new</span> <span class="built_in">ulong</span>[kMaxAIDataCount];</span><br><span class="line">string_var_ = <span class="keyword">new</span> <span class="built_in">string</span>[kMaxAIDataCount];</span><br><span class="line">vector3_var_ = <span class="keyword">new</span> Vector3[kMaxAIDataCount];</span><br></pre></td></tr></table></figure><p>è¿è¡Œæ—¶é€šè¿‡ä»¥ä¸‹æ˜ å°„å…³ç³»è¯»å–å¯¹åº” AI èŠ‚ç‚¹ä¸­çš„å˜é‡å€¼</p><center>    <img src="/2024/05/09/50/type-map.png"></center><h4 id="PB- æ•°æ®">PB æ•°æ®</h4><h5 id="å®¢æˆ·ç«¯è¡Œä¸ºæ ‘çš„ -Node- ç”Ÿæˆ">å®¢æˆ·ç«¯è¡Œä¸ºæ ‘çš„ Node ç”Ÿæˆ</h5><ul><li>ä¸»è¦è§£æè¿è¡Œæ—¶ AI ä»£ç çš„æºæ–‡ä»¶ï¼Œéå† Assets/Scripts/MoonClient/AI/Node ç›®å½•ä¸‹æ‰€æœ‰ã€‚cs æ–‡ä»¶ï¼Œæºæ–‡ä»¶ä¸­æ¯ä¸ªç±»éƒ½ç»§æ‰¿è‡ª MAINodeAction æˆ–è€… MAINodeActionï¼Œæ ¹æ®åŸºç±»çš„ä¸åŒå¯¼å‡ºä¸åŒç±»å‹çš„èŠ‚ç‚¹<br>[Image]</li><li>æ ¹æ®ç±»ä¸­å®šä¹‰ MNodeArgs çš„æˆå‘˜å˜é‡æ·»åŠ  public æˆå‘˜å˜é‡ï¼Œæˆå‘˜å˜é‡çš„ç±»å‹æ ¹æ®ä¸‹é¢çš„å­—å…¸æ˜ å°„<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Dictionary&lt;Type, Type&gt; typeRemapDict = <span class="keyword">new</span> Dictionary&lt;Type, Type&gt;()</span><br><span class="line">{</span><br><span class="line">    {<span class="keyword">typeof</span>(<span class="built_in">int</span>), <span class="keyword">typeof</span>(SharedInt) },</span><br><span class="line">    {<span class="keyword">typeof</span>(<span class="built_in">long</span>), <span class="keyword">typeof</span>(SharedLong) },</span><br><span class="line">    {<span class="keyword">typeof</span>(<span class="built_in">ulong</span>), <span class="keyword">typeof</span>(SharedULong) },</span><br><span class="line">    {<span class="keyword">typeof</span>(<span class="built_in">float</span>), <span class="keyword">typeof</span>(SharedFloat) },</span><br><span class="line">    {<span class="keyword">typeof</span>(<span class="built_in">string</span>), <span class="keyword">typeof</span>(SharedString) },</span><br><span class="line">    {<span class="keyword">typeof</span>(<span class="built_in">bool</span>), <span class="keyword">typeof</span>(SharedBool) },</span><br><span class="line">    {<span class="keyword">typeof</span>(UnityEngine.Vector3), <span class="keyword">typeof</span>(SharedUnityVector3) },</span><br><span class="line">    {<span class="keyword">typeof</span>(ROGameLibs.Vector3), <span class="keyword">typeof</span>(SharedVector3) },</span><br><span class="line">    {<span class="keyword">typeof</span>(SWIGTYPE_p_Vector3), <span class="keyword">typeof</span>(SharedVector3) },</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> LIBS_EDITOR</span></span><br><span class="line">    {<span class="keyword">typeof</span>(SWIGTYPE_p_ROObject), <span class="keyword">typeof</span>(SharedTransform) },</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    {<span class="keyword">typeof</span>(MoonClient.MEntity), <span class="keyword">typeof</span>(SharedTransform) },</span><br><span class="line">    {<span class="keyword">typeof</span>(IntVector), <span class="keyword">typeof</span>(SharedIntList) },</span><br><span class="line">    {<span class="keyword">typeof</span>(LongVector), <span class="keyword">typeof</span>(SharedLongList) },</span><br><span class="line">    {<span class="keyword">typeof</span>(FloatVector), <span class="keyword">typeof</span>(SharedFloatList) },</span><br><span class="line">    {<span class="keyword">typeof</span>(StringVector), <span class="keyword">typeof</span>(SharedStringList) },</span><br><span class="line">    {<span class="keyword">typeof</span>(ULongVector), <span class="keyword">typeof</span>(SharedULongList) },</span><br><span class="line">};</span><br></pre></td></tr></table></figure></li><li>åŒæ—¶æ ¹æ®å±æ€§ NodeCommentï¼Œè®¾ç½®ç¼–è¾‘å™¨ä¸­å˜é‡çš„æ‚¬æµ®æ³¨é‡Š</li><li>å›ºå®šæ ¼å¼çš„ä»£ç æ®µ<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MoonClient.XXX node; <span class="comment">// XXX ä¸ºæºæ–‡ä»¶ç±»å</span></span><br><span class="line"><span class="keyword">private</span> MEntity entity;</span><br><span class="line"><span class="keyword">private</span> MoonClient.XXX.MNodeArgs args; <span class="comment">// XXX ä¸ºæºæ–‡ä»¶ç±»å</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnAwake</span>()</span></span><br><span class="line">{</span><br><span class="line">    entity = MEntityMgr.singleton.GetEntity(<span class="built_in">ulong</span>.Parse(Owner.  gameObject.name));</span><br><span class="line">    <span class="keyword">if</span>(entity == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    node = <span class="keyword">new</span> MoonClient.MAIAutoFollow();</span><br><span class="line">    args = <span class="keyword">new</span> MoonClient.MAIAutoFollow.MNodeArgs();</span><br><span class="line">    <span class="comment">// args.follow_target_radius = follow_target_radius.swigValue;</span></span><br><span class="line">    <span class="comment">// args.teleport_distance = teleport_distance.swigValue;</span></span><br><span class="line">    <span class="comment">// æºæ–‡ä»¶ä¸­ MNodeArgs çš„æˆå‘˜å˜é‡èµ‹å€¼</span></span><br><span class="line">    node.SetNodeArgs(args);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> TaskStatus <span class="title">OnUpdate</span>()</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span>(entity == <span class="literal">null</span>) <span class="keyword">return</span> TaskStatus.Failure;</span><br><span class="line">    <span class="keyword">return</span> node.Update(entity) ? TaskStatus.Success : TaskStatus.  Failure;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li></ul><h3 id="è¿è¡Œæ—¶ -AI">è¿è¡Œæ—¶ AI</h3><h4 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h4><ul><li>åˆå§‹åŒ– AI ç»„ä»¶ï¼šMPlayer::InitComponents</li><li>åˆå§‹åŒ–è¡Œä¸ºæ ‘ï¼šMAIComponent::InitBehaviorTree<ul><li>åˆå§‹åŒ–æ‰€æœ‰ç©å®¶é€šç”¨çš„ AI æ ‘ï¼šMAIBehaviorTree::Init<ul><li>åŠ è½½ PlayerAI/Player_Auto_AI.bytes æ–‡ä»¶ï¼šMAITreeManager::LoadFile</li><li>æ„é€  AI æ ‘ï¼šMAITreeManager::BuildAITree</li><li>é€’å½’æ„é€ èŠ‚ç‚¹ï¼šMAITreeManager::BuildOneNode<ul><li>æœªåˆå§‹åŒ–æ—¶ï¼Œåˆå§‹åŒ–æ‰€æœ‰èŠ‚ç‚¹ç±»å‹å¯¹è±¡çš„å§”æ‰˜ï¼šMAINodeFactory::CreateAINodeByName</li><li>åˆå§‹åŒ–å®Œæˆå³è°ƒç”¨ï¼Œè§£æ PB åˆå§‹åŒ–èŠ‚ç‚¹</li></ul></li></ul></li></ul></li></ul><h4 id="è°ƒç”¨é€»è¾‘">è°ƒç”¨é€»è¾‘</h4><ul><li>åœ¨ MAIComponent::Update æ¯æ¬¡ Update æ»¡è¶³ä¸€å®šæ¡ä»¶åéƒ½æ‰§è¡Œä¸€æ¬¡_behaviorTree.Tick(Entity)</li><li>æ¯æ¬¡ tick éƒ½ä» AINode çš„ RootNode é€’å½’åˆ°æ¯ä¸ªå­èŠ‚ç‚¹ï¼Œæ‰§è¡Œç›¸åº”ä¸šåŠ¡é€»è¾‘èŠ‚ç‚¹çš„ Update å‡½æ•°ä¸­çš„é€»è¾‘</li></ul><h4 id="å®¢æˆ·ç«¯å¦‚ä½•è¿›è¡Œè‡ªåŠ¨é‡Šæ”¾">å®¢æˆ·ç«¯å¦‚ä½•è¿›è¡Œè‡ªåŠ¨é‡Šæ”¾</h4><ul><li>ç­–åˆ’ä¼šåœ¨è¡Œä¸ºæ ‘ä¸­é…ç½®ä¸€äº›åˆ—çš„æ¡ä»¶ï¼ˆé¡ºåºæ‰§è¡Œæˆ–é€‰æ‹©æ‰§è¡Œï¼‰<ul><li>è‡ªåŠ¨è·Ÿéšçš„è·ç¦»</li><li>Entity ç±»å‹é™åˆ¶</li><li>æˆ˜æ–—åŠå¾„å¤§å°</li><li>å˜èº«æƒ…å†µ</li><li>â€¦</li></ul></li><li>ä¾æ¬¡éå†è£…é…åœ¨è‡ªåŠ¨æˆ˜æ–—æ§½ä½çš„æŠ€èƒ½ï¼ˆ1~6ï¼‰</li><li>å½“ç¬¬ i ä¸ªæ§½ä½æœ‰è£…é…æŠ€èƒ½æ—¶ï¼Œæ ¹æ®æŠ€èƒ½ id è¯»å–æŠ€èƒ½è¡¨ä¸­é…ç½®çš„<code>AITreeName</code></li><li>å°†æŸ¥è¯¢åˆ°çš„ <code>AITreeName</code> æ”¾ç½®åˆ° <code>tree_name</code> å…±äº«å˜é‡ä¸­</li><li>å†é€šè¿‡ <code>MAIDynamicTreeReference</code> è¯»å– <code>tree_name</code> ä¸­çš„å€¼ï¼Œå¹¶è¯»å–æ”¹èŠ‚ç‚¹æ ‘çš„ PBï¼Œåˆå¹¶åˆ°å½“å‰ <code>MAIDynamicTreeReference</code> çš„çˆ¶èŠ‚ç‚¹ä¸Š</li><li>è¯»å–åˆ°ç›¸å…³æŠ€èƒ½èŠ‚ç‚¹æ ‘åï¼Œæ ¹æ®ç­–åˆ’çš„é…ç½®æ¡ä»¶ï¼Œæ»¡è¶³åå¯é‡Šæ”¾<ul><li>æŠ€èƒ½æ˜¯å¦å­˜åœ¨</li><li>é‡Šæ”¾æŠ€èƒ½åï¼Œæ˜¯å¦å­˜åœ¨ä¸å¯å åŠ çš„ buff</li><li>â€¦</li></ul></li><li>é‡Šæ”¾æŠ€èƒ½ï¼šé€šè¿‡ <code>MWaitingDataMgr</code> æ·»åŠ å¯é‡Šæ”¾çš„æŠ€èƒ½åˆ°å¾…æ‰§è¡Œé˜Ÿåˆ—ä¸­ï¼Œæ¯æ¬¡ update èµ°æŠ€èƒ½é‡Šæ”¾é€»è¾‘</li></ul><h3 id="ç›¸å…³æ”¹è¿›">ç›¸å…³æ”¹è¿›</h3><p>çº¿ä¸Š bugï¼šæŸäº›èŒä¸šé‡Šæ”¾æŠ€èƒ½åï¼Œå·²ç»ä¸Šäº†ä¸å¯å åŠ çš„ buffï¼ˆbuff æ•ˆæœæ¶ˆå¤±ä¹‹å‰ä¸èƒ½å¤Ÿé‡å¤é‡Šæ”¾æ”¹æŠ€èƒ½ï¼‰ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çš„ AI ä¾ç„¶ä¼šç»§ç»­æŒç»­é‡Šæ”¾ï¼Œé€ æˆæŠ½æçš„è¡¨ç°ï¼ˆå¶ç°é—®é¢˜æ²¡æœ‰æŸ¥åˆ°å…·ä½“åŸå› ï¼‰<br>è§£å†³æ–¹æ¡ˆï¼šæ›´æ”¹ <code>MAICastSkill</code> èŠ‚ç‚¹ï¼Œé‡Šæ”¾æ¬¡æ•°è¶…è¿‡ä¸€å®šæ•°å€¼ï¼Œä¸å¯é‡Šæ”¾è¯¥æŠ€èƒ½</p><h2 id="é™„èº«">é™„èº«</h2><h3 id="éœ€æ±‚">éœ€æ±‚</h3><ul><li>æŠ€èƒ½ï¼šçµå–µé™„èº«</li><li>æŠ€èƒ½æè¿°ï¼šå–µå–µé™„èº«äºé€‰ä¸­çš„é˜Ÿå‹èº«ä¸Šï¼Œæ¯ç§’æ¶ˆè€— 5 ç‚¹è‡ªç„¶åŠ›é‡ï¼ŒæŒç»­ 20 ç§’ï¼Œè‡ªèº«å¤„äºæ— æ•ŒçŠ¶æ€ï¼Œä¸”å°†è‡ªèº« 10% çš„å…­ç»´å±æ€§é™„åŠ äºé™„èº«çš„é˜Ÿå‹</li></ul><h3 id="å®ç°æ–¹å¼">å®ç°æ–¹å¼</h3><ul><li>é‡Šæ”¾æŠ€èƒ½ä¸ºè§’è‰²æ·»åŠ  Buff</li><li>å®¢æˆ·ç«¯æ ¹æ® Buff çŠ¶æ€ç±»å‹è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯é™„èº« Buff çŠ¶æ€ç±»å‹<ul><li>é™„èº«ç›®æ ‡åªæœ‰ä¸€ä¸ªï¼Œå–æœåŠ¡å™¨å‘è¿‡æ¥çš„ç¬¬ä¸€ä¸ª Buff ç›¸å…³ç›®æ ‡ï¼ˆåŒºåˆ«äº Buff ç›®æ ‡ï¼‰çš„ uid</li><li>åœ¨ <code>MBuffComponent</code> ç»„ä»¶ä¸­è®°å½•è¯¥ uid</li><li>å¹¿æ’­ <code>StopMove</code> äº‹ä»¶ï¼Œè®©ç©å®¶æ— æ³•ç§»åŠ¨</li><li>è®¾ç½®ç©å®¶çš„ä½ç½®ã€æœå‘ä¸è¢«é™„èº«çš„ç©å®¶ä¸€è‡´</li></ul></li><li>å±è”½ç©å®¶çš„ç¢°æ’ä½“ï¼Œä½¿ç©å®¶å’Œè¢«é™„èº«çš„äººä¿æŒä¸€è‡´</li><li>åœ¨ <code>MHideComponent</code> ç»„ä»¶ä¸­ï¼Œå°†ç©å®¶è®¾ç½®ä¸ºåŠé€æ˜çŠ¶æ€</li><li>æ§åˆ¶ç§»åŠ¨<ul><li>å±è”½æ‘‡æ†å’Œç‚¹å‡»åœ°é¢çš„ç§»åŠ¨æ•ˆæœ</li><li>åœ¨ <code>MMoveComponent</code> ç»„ä»¶çš„ Update ä¸­ï¼Œæ¯å¸§è®¾ç½®ç©å®¶çš„ç§»åŠ¨è·ç¦»æ”¹ä¸ºå’Œè¢«é™„èº«çš„ç©å®¶åšå·®<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buffFollowTarget = Entity.BuffFollowTarget;</span><br><span class="line"><span class="keyword">if</span> (buffFollowTarget != <span class="literal">null</span>)</span><br><span class="line">{</span><br><span class="line">    Entity.AppendMove(buffFollowTarget.Position - Entity.Position);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">{</span><br><span class="line">    Entity.AppendMove(Entity.ServerPos - Entity.Position);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="Odin-OdinMenuTree">Odin OdinMenuTree</h2><h2 id="UI- æ¡†æ¶">UI æ¡†æ¶</h2><h3 id="Windows- ç”Ÿå‘½å‘¨æœŸ">Windows ç”Ÿå‘½å‘¨æœŸ</h3><ul><li>æ‰“å¼€ UIï¼šActive -&gt; BindEvents -&gt; OnActive -&gt; OnShow -&gt; AfterShow</li><li>å…³é—­ UIï¼šDeactive -&gt; UnBindEvents -&gt; OnHide -&gt; OnDeActive -&gt; AfterOnDeActive -&gt; ReleaseAll</li></ul><h3 id="UIBase"><code>UIBase</code></h3><ul><li><code>OnLoad</code>ï¼šåŠ è½½èµ„æº<ul><li><code>baseloadCallback</code>ï¼šèµ„æºåŠ è½½æˆåŠŸåçš„å›è°ƒ</li><li><code>Init</code>ï¼šåˆå§‹åŒ–</li></ul></li><li><code>OnBindPanel</code>ï¼šç»‘å®šé¢„åˆ¶</li><li><code>OnUnload</code>ï¼šé‡Šæ”¾èµ„æºï¼Œå…³é—­ç•Œé¢æˆ–è€…åˆ‡æ¢è¯­è¨€</li><li><code>Init</code>ï¼š<code>OnUnload</code>åè°ƒç”¨</li><li><code>Uninit</code>ï¼š<code>UnLoad</code>æˆ–å…³é—­æ¸¸æˆè¿›ç¨‹åè°ƒç”¨</li><li><code>OnActive</code>ï¼š<code>Active</code>åè°ƒç”¨</li><li><code>OnDeActive</code>ï¼š<code>DeActive</code>åè°ƒç”¨</li><li><code>OnShow</code></li><li><code>AfterShow</code>ï¼šå½“ä¸Šå±‚ç•Œé¢å®Œå…¨å…³é—­åè°ƒç”¨</li><li><code>OnHide</code></li><li><code>BindEvents</code>ï¼š<code>Active</code>åï¼Œ<code>OnActive</code>ä¹‹å‰è°ƒç”¨</li><li><code>Update</code></li><li><code>UpdateInput</code></li><li><code>OnLogout</code></li><li><code>OnReconnected</code></li></ul><h3 id="UIManager"><code>UIManager</code></h3><ul><li>UIManager æ‰“å¼€å…³é—­ç•Œé¢ä»¥ç»„çš„æ–¹å¼è¿›è¡Œå¤„ç†ã€‚<ul><li>æ‰€æœ‰çš„ç»„ä¿¡æ¯éƒ½ä¼šè¿›æ ˆè¿›è¡Œç®¡ç†ã€‚</li><li>ä¼šæ ¹æ®é…ç½®æ¥ç¡®å®šè¿™ä¸ªç»„é‡Œé¢æœ‰å“ªäº›ç•Œé¢</li><li>æ²¡åšé…ç½®çš„ç•Œé¢ä¼šæŠŠè¿™ä¸€ä¸ªç•Œé¢å½“æˆä¸€ç»„</li><li>æ”¯æŒé™æ€é…ç½®å’Œæ‰“å¼€ç•Œé¢æ—¶ä¼ é€’åŠ¨æ€é…ç½®</li></ul></li></ul><blockquote><ul><li><code>ActiveUI</code>æ‰“å¼€æŸä¸ª Window å‡½æ•°å…¥å£</li><li>é€šè¿‡ <code>require</code> æŒ‡å®š Window åå­—ï¼Œå¹¶è¿›è¡Œåˆå§‹åŒ–<code>UI[panelClassName].new()</code></li><li>ä¸ºå½“å‰ Window æ·»åŠ <code>groupName</code></li><li><code>_createUIPanelConfig</code> ç”Ÿæˆ UIPanel é…ç½®ï¼Œå¾—åˆ°ç•Œé¢çš„é…ç½®æ•°æ®</li><li><code>ActiveUIPanelInGroup</code> æ‰“å¼€ç•Œé¢æ—¶å¯¹æ ˆè¿›è¡Œå¤„ç†</li></ul></blockquote><h4 id="è®¾ç½® -UI- å±‚çº§ï¼ˆUILayerï¼‰">è®¾ç½® UI å±‚çº§ï¼ˆUILayerï¼‰</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">---@class UILayer</span></span><br><span class="line">UILayer = {</span><br><span class="line">    Normal = <span class="number">0</span>,   <span class="comment">-- 20</span></span><br><span class="line">    Function = <span class="number">1</span>, <span class="comment">-- 40</span></span><br><span class="line">    Tips = <span class="number">2</span>,     <span class="comment">-- 60</span></span><br><span class="line">    Guiding = <span class="number">3</span>,  <span class="comment">-- 80</span></span><br><span class="line">    Top = <span class="number">4</span>       <span class="comment">-- 100</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><h4 id="ç•Œé¢ç±»å‹ï¼ˆActiveTypeï¼‰">ç•Œé¢ç±»å‹ï¼ˆActiveTypeï¼‰</h4><ul><li><code>None</code>ï¼šä¸åšä»»ä½•å¤„ç†</li><li><code>Normal</code>ï¼šæ˜¾ç¤ºæ—¶ä¼šæŠŠè¿™ä¸ªç•Œé¢åŠ å…¥ä¸»ç•Œé¢ç»„ä¸­ï¼ˆNormalLayer -&gt; MainPanelsGroupGroupï¼Œæ— è§†è®¾ç½®çš„ UILayer æ”¾åˆ° NormalLayerï¼‰</li><li><code>Exclusive</code>ï¼šæ˜¾ç¤ºæ—¶ä¼šéšè—å‰é¢çš„ç»„ï¼ˆéšè— Normal Exclusive ç±»å‹ UIï¼ŒLayer æ— å…³ï¼‰</li><li><code>Standalone</code>ï¼šæ˜¾ç¤ºåä¸ä¼šè¢« Exclusive ç±»å‹éšè—</li></ul><h2 id="å‰§æœ¬è§£æ">å‰§æœ¬è§£æ</h2><h3 id="ä»£ç ç»“æ„">ä»£ç ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">clientcode\CSProject\MoonClient\CommandSystem:. </span><br><span class="line">â”‚  CommandBlock.cs åˆ›å»ºä»¥åŠæ‰§è¡Œ Block çš„æ–¹æ³•éƒ½ä¼šåœ¨è¿™é‡Œ</span><br><span class="line">â”‚  CommandBlockManager.cs ä¸Šä¸‹æ–‡ç¯å¢ƒç®¡ç†ï¼Œå˜é‡å‚¨å­˜</span><br><span class="line">â”‚  CommandBlockTriggerManager.cs è§¦å‘å™¨ç®¡ç†</span><br><span class="line">â”‚  CommandConst.cs æ‰€æœ‰ä¸å‘½ä»¤ç›¸å…³çš„å¸¸é‡éƒ½ä¼šè®°å½•åœ¨è¿™é‡Œ</span><br><span class="line">â”‚   </span><br><span class="line">â”œâ”€Attribute é™æ€è¯­æ³•æ£€æŸ¥</span><br><span class="line">â”‚      CommandArgsAttribute.cs </span><br><span class="line">â”‚      CommandCheckAttribute.cs </span><br><span class="line">â”‚       </span><br><span class="line">â”œâ”€Checker é™æ€è¯­æ³•æ£€æŸ¥</span><br><span class="line">â”‚      CommandBlockChecker.cs </span><br><span class="line">â”‚       </span><br><span class="line">â”œâ”€Commands C# å‘½ä»¤</span><br><span class="line">â”‚  â”‚  BaseCommand.cs </span><br><span class="line">â”‚  â”‚  LuaCommand.cs </span><br><span class="line">â”‚  â”‚   </span><br><span class="line">â”‚  â”œâ”€NPC </span><br><span class="line">â”‚  â”‚      ChangeEmotionCommand.cs </span><br><span class="line">â”‚  â”‚      .â€‹.. çœç•¥</span><br><span class="line">â”‚  â”‚       </span><br><span class="line">â”‚  â”œâ”€Other </span><br><span class="line">â”‚  â”‚      FindElfCommand.cs </span><br><span class="line">â”‚  â”‚      ShowModelAlarmCommand.cs </span><br><span class="line">â”‚  â”‚       </span><br><span class="line">â”‚  â””â”€System </span><br><span class="line">â”‚          AddLocalBuffCommand.cs </span><br><span class="line">â”‚          .â€‹.. çœç•¥</span><br><span class="line">â”‚           </span><br><span class="line">â”œâ”€Compile äºŒè¿›åˆ¶ç¼–è¯‘</span><br><span class="line">â”‚      CommandBlockBinaryCompiler.cs </span><br><span class="line">â”‚      CommandBlockParser.cs </span><br><span class="line">â”‚       </span><br><span class="line">â”œâ”€Data PB æ•°æ®ç»“æ„ä»¥åŠåŠ¨æ€å‚æ•°è§£æ</span><br><span class="line">â”‚      BaseArg.cs </span><br><span class="line">â”‚      BlockIndexArg.cs </span><br><span class="line">â”‚      BlockVarArg.cs </span><br><span class="line">â”‚      CommandBlockArg.cs </span><br><span class="line">â”‚      CommandBlockStringArg.cs </span><br><span class="line">â”‚      CommandData.cs </span><br><span class="line">â”‚      CommandLuaArg.cs </span><br><span class="line">â”‚      ExpressionArg.cs </span><br><span class="line">â”‚      FunctionArg.cs </span><br><span class="line">â”‚      ValueArg.cs </span><br><span class="line">â”‚       </span><br><span class="line">â”œâ”€Expression è¡¨è¾¾å¼è¯æ³•è§£æå™¨</span><br><span class="line">â”‚      EOFToken.cs </span><br><span class="line">â”‚      IdentifierToken.cs </span><br><span class="line">â”‚      Lexer.cs </span><br><span class="line">â”‚      LuaConverter.cs </span><br><span class="line">â”‚      NumberToken.cs </span><br><span class="line">â”‚      StringToken.cs </span><br><span class="line">â”‚      Token.cs </span><br><span class="line">â”‚       </span><br><span class="line">â””â”€Trigger è§¦å‘å™¨ç›¸å…³</span><br><span class="line">    â”‚  CommandTrigger.cs </span><br><span class="line">    â”‚   </span><br><span class="line">    â””â”€Event è§¦å‘å™¨äº‹ä»¶åŸ‹ç‚¹</span><br><span class="line">            BaseEvent.cs </span><br><span class="line">            OnCollectSuccEvent.cs </span><br><span class="line">            OnDamagedByPlayerEvent.cs </span><br><span class="line">            OnEnterDungeons.cs </span><br><span class="line">            OnExitDungeons.cs </span><br><span class="line">            OnKilledByPlayerEvent.cs </span><br><span class="line">            OnNpcCreateEvent.cs </span><br><span class="line">            OnNpcDestroyEvent.cs </span><br><span class="line">            OnStartCollectEvent.cs</span><br></pre></td></tr></table></figure><p>åœ¨ <code>ScriptHandle</code> å‡½æ•°è§£ææ¯ä¸€è¡Œå‰§æœ¬æ—¶ç¡®å®šæ˜¯ç”¨ C# ä¸­çš„ <code>BaseCommand</code> è¿˜æ˜¯ Lua ä¸­çš„ <code>LuaCommand</code> è¿›è¡Œè§£æ</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åªæœ‰åœ¨åˆ—å‡ºçš„ç±»å‹æˆ–è€… Lua ç±»å‹æ‰ä¼šé€šè¿‡æ± å­è¿›è¡Œå¤ç”¨</span></span><br><span class="line"><span class="keyword">if</span> (CommandConst.CommandTypeDict.TryGetValue(dacommandType, <span class="keyword">out</span> <span class="keyword">var</span> type))</span><br><span class="line">{</span><br><span class="line">    command = UUIDObjectPool.Get(type) <span class="keyword">as</span> BaseCommand;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">var</span> luaCommand = UUIDObjectPool.Get(<span class="keyword">typeof</span>(LuaCommand)) <span class="keyword">as</span> LuaCommand;</span><br><span class="line">    luaCommand?.SetCodeId(data.commandType);</span><br><span class="line">    command = luaCommand;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="è§£æç‰¹æ®Šè¡¨è¾¾å¼">è§£æç‰¹æ®Šè¡¨è¾¾å¼</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Arg æ•°å­— | ä»»æ„å­—ç¬¦ | LUA&lt;&lt; å‡½æ•°å &gt;&gt; | &lt;&lt; å‡½æ•°å &gt;&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> ArgsRegex = <span class="string">@"{{Arg(\d+?)}}|{{(.+?)}}|LUA&lt;&lt;(.+?)&gt;&gt;|&lt;&lt;(.+?)&gt;&gt;"</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> CommandBlockStringArg <span class="title">Init</span>(<span class="params"><span class="built_in">string</span> origin</span>)</span></span><br><span class="line">{</span><br><span class="line">    OriginString = origin;</span><br><span class="line">    <span class="keyword">if</span> (origin == <span class="literal">null</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    }</span><br><span class="line">    _formatString = origin;</span><br><span class="line">    <span class="built_in">int</span> argNum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> argMatch = Regex.Matches(_formatString, ArgsRegex);</span><br><span class="line">    <span class="keyword">foreach</span> (Match match <span class="keyword">in</span> argMatch)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> blockArgValue = match.Groups[<span class="number">1</span>].Value;</span><br><span class="line">        <span class="keyword">var</span> blockVarValue = match.Groups[<span class="number">2</span>].Value;</span><br><span class="line">        <span class="keyword">var</span> luaValue = match.Groups[<span class="number">3</span>].Value;</span><br><span class="line">        <span class="keyword">var</span> exprValue = match.Groups[<span class="number">4</span>].Value;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(blockArgValue))</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">int</span>.TryParse(blockArgValue, <span class="keyword">out</span> <span class="built_in">int</span> index))</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">var</span> arg = MCommonObjectPool&lt;BlockIndexArg&gt;.Get().Init(index);</span><br><span class="line">                _formatArgs.Add(arg);</span><br><span class="line">                _formatString = _formatString.Replace(match.Groups[<span class="number">0</span>].Value, <span class="string">$"{{<span class="subst">{argNum}</span>}}"</span>);</span><br><span class="line">                argNum++;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(blockVarValue))</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">var</span> arg = MCommonObjectPool&lt;BlockVarArg&gt;.Get().Init(blockVarValue);</span><br><span class="line">            _formatArgs.Add(arg);</span><br><span class="line">            _formatString = _formatString.Replace(match.Groups[<span class="number">0</span>].Value, <span class="string">$"{{<span class="subst">{argNum}</span>}}"</span>);</span><br><span class="line">            argNum++;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(luaValue))</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">var</span> arg = MCommonObjectPool&lt;CommandLuaArg&gt;.Get().Init(luaValue);</span><br><span class="line">            _formatArgs.Add(arg);</span><br><span class="line">            _formatString = _formatString.Replace(match.Groups[<span class="number">0</span>].Value, <span class="string">$"{{<span class="subst">{argNum}</span>}}"</span>);</span><br><span class="line">            argNum++;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(exprValue))</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">var</span> arg = MCommonObjectPool&lt;ExpressionArg&gt;.Get().Init(exprValue);</span><br><span class="line">            _formatArgs.Add(arg);</span><br><span class="line">            _formatString = _formatString.Replace(match.Groups[<span class="number">0</span>].Value, <span class="string">$"{{<span class="subst">{argNum}</span>}}"</span>);</span><br><span class="line">            argNum++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="UI-Renderer-Texture">UI Renderer Texture</h2><h3 id="ä½¿ç”¨ -URP- ç®¡çº¿è¿›è¡Œ -RT- æ¸²æŸ“">ä½¿ç”¨ URP ç®¡çº¿è¿›è¡Œ RT æ¸²æŸ“</h3><ul><li><code>CreatUIModelData</code>ï¼šRtModelAssistant[RT åŠ¨æ•ˆåŠ©æ‰‹] è¿›è¡Œæ¨¡å‹åˆ›å»º<ul><li><code>MModel.OriginData</code>è®¾ç½®ç›¸å…³æ•°æ®</li><li><code>Layer</code>è®¾ç½®ä¸º <code>ID_RTFACTORY</code>ï¼Œåªæ¸²æŸ“<code>ID_RTFACTORY</code> å±‚</li></ul></li><li><code>MUIRTData</code>ï¼šå®šä¹‰ RT æ¸²æŸ“è®¾ç½®æ•°æ®<ul><li><code>RawImage</code></li><li>ç›¸æœºä½ç½®</li><li>æè¾¹</li><li>é˜´å½±</li><li>åå°„</li><li>å¤§å°</li></ul></li><li><code>CreateRawImageRT</code><ul><li>åˆ›å»ºæ–°çš„ RawImage</li><li>åˆ›å»ºæ–°çš„ RTStageï¼Œç”¨äºç®¡ç† RT<ul><li><code>RTCamera.Init</code><ul><li>åŠ è½½ Camera é¢„åˆ¶ï¼ˆUIRTCameraï¼‰</li><li>Culling Mask</li><li>ä½ç½®</li><li>projectionMatrix</li><li>targetTexture</li><li>æ›¿ä»–<ul><li>é˜´å½±</li><li>åå°„</li></ul></li></ul></li></ul></li><li>RawImage ä¸ RTStage ç»‘å®š</li></ul></li><li>UIRTCameraï¼ˆé‡‡ç”¨ UniversalRenderPipelineAsset_RTRenderer ç®¡çº¿é…ç½®ï¼‰<ul><li>ç”±äºè®¾å®šäº† Culling Maskï¼Œç›¸æœºåªä¼šç…§åˆ°éœ€è¦æ¸²æŸ“çš„ç‰©ä½“</li></ul></li></ul><h4 id="è‡ªå®šä¹‰ MCBRTRendererFeature">è‡ªå®šä¹‰<code>MCBRTRendererFeature</code></h4><ul><li>è°ƒç”¨ <code>CreatUIModelData</code> æ—¶ä¼šå­˜å‚¨ Rt å’Œå¯¹å…¶åº”çš„æ¸²æŸ“æ•°æ®<code>RawImageRtDataDicAdd</code></li><li><code>UpdateRawImageRT</code> å¤„ç†æ¨¡å‹çš„ renders<ul><li>æ”¶é›†å…¨éƒ¨ renders</li><li>æ”¶é›†ä¸é€æ˜æè´¨çš„ renders</li></ul></li><li><code>UpdateRendererByRawImage</code> å¼€å§‹çœŸæ­£çš„æ¸²æŸ“<ul><li>æ¸²æŸ“ All Renders<ul><li>åˆå§‹åŒ–<code>CBRTData</code></li><li><code>RenderEx</code><ul><li>æ£€æŸ¥è®¾å¤‡æ˜¯å¦æ”¯æŒ<code>RenderTextureFormat.ARGB32</code></li><li>texture å¤§å°æ˜¯å¦ä¸ºæ­£æ•°</li><li><code>GetRenderTexture</code><ul><li><code>CameraMode</code> ç›¸æœºæ¨¡å¼</li><li><code>OutlineRenderer</code>Shader ä¼ å…¥ç›¸æœºä½ç½®å±æ€§æ ‡è®°<code>_CameraPos</code></li><li><code>data.pMatrix.m00 /= aspect;</code></li><li>åˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨å…±äº« RT <code>_sharedRT</code><ul><li><code>_sharedRT</code>ä¼šåœ¨ <code>Awake</code> æ—¶åˆå§‹åŒ–ä¸º <code>Vector2.one</code> çš„å¤§å°</li><li>ä¸ä½¿ç”¨å…±äº« RT æ—¶ï¼Œåˆ™ä¼šæ ¹æ®ä¼ å…¥çš„ <code>width</code> å’Œ<code>height</code>å¤§å°è·å– texture <code>RenderTexture.GetTemporary</code></li></ul></li><li>åˆ›å»ºæ¸²æŸ“é˜Ÿåˆ—</li><li>è®¾ç½®æè´¨çš„æ ‡è¯†ç¬¦å’Œ rt å…³è”</li></ul></li></ul></li></ul></li><li>æè¾¹ã€é˜´å½±ã€æè¾¹<ul><li>å› ä¸ºåœ¨åœºæ™¯ä¸­æ¨¡å‹çš„æè´¨å’Œ UI ä¸­ç”¨çš„æè´¨ä¸ä¸€æ ·æ‰€ä»¥éœ€è¦æ›¿æ¢ä¸€ä¸‹</li><li><code>MResLoader.singleton.CreateMatFromPool(MShaderUtil.EffectOutlineMaterialPath);</code></li><li>è®°å½•åˆ° <code>CBRTQuene</code> çš„<code>materialDict</code>ä¸­</li></ul></li></ul></li><li><code>MCBRTRenderPass</code>æ‰§è¡Œ URP ç®¡çº¿ä¸­çš„ <code>Excute</code> å‡½æ•°ï¼Œé€šè¿‡ <code>CommandBuff</code> è¿›è¡Œç»˜åˆ¶<ul><li>ä¸ä½¿ç”¨å…±äº« RT ç»˜åˆ¶ï¼Œç»˜åˆ¶å•ä¸ª RT<ul><li>è®¾ç½®æ¸²æŸ“ç›®æ ‡ <code>SetRenderTarget</code> texture ä¸ºåˆå§‹åŒ– CBRT é˜Ÿåˆ—æ—¶ä¼ å…¥çš„ texture</li><li>æ¸…é™¤æ¸²æŸ“çŠ¶æ€ <code>ClearRenderTarget</code></li><li>è°ƒç”¨ç»˜åˆ¶å‡½æ•° <code>DrawRenderers</code></li></ul></li><li>å¼€å¯äº†å…±äº« RT ç»˜åˆ¶çš„ä¼šç»§ç»­ç»˜åˆ¶å…±äº« RT<ul><li>è®¾ç½®æ¸²æŸ“ç›®æ ‡ <code>SetRenderTarget</code> texture ä¸º<code>_sharedRT</code></li><li>æ¸…é™¤æ¸²æŸ“çŠ¶æ€ <code>ClearRenderTarget</code></li><li>è°ƒç”¨ç»˜åˆ¶å‡½æ•° <code>DrawRenderers</code></li></ul></li></ul></li><li>ç»˜åˆ¶ <code>DrawRenderers</code><ul><li>è®¾ç½®è‡ªå®šä¹‰ MVP çŸ©é˜µ</li><li>æ ¹æ® Render çš„æè´¨ç”Ÿæˆ <code>CommandBuffer</code> åˆ—è¡¨</li><li>æ ¹æ® <code>renderQueue</code> å’Œ<code>CameraDistance</code>å¯¹ <code>CommandBuffer</code> åˆ—è¡¨è¿›è¡Œæ’åº</li><li>è°ƒç”¨ <code>DrawRenderer</code> è¿›è¡Œæ¸²æŸ“</li></ul></li><li>æ¯å¸§è¿›è¡Œ <code>_sharedRT</code> å¤§å°æ£€æµ‹ï¼Œè¶…å‡º 256 è¿›è¡Œæ‰©å®¹  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LateUpdate</span>()</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">//if (_temporaryCBRTs.Count &gt; _GCThreshold)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// å½“æ± ä¸­æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘æ¸…ç©ºç©ºé˜Ÿåˆ—ï¼Œæå‡ä¸€äº›æ€§èƒ½</span></span><br><span class="line">        ReleaseEmpty();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// åˆå¹¶ RT å›¾é›†</span></span><br><span class="line">    List&lt;CBRTQuene&gt; rtQuenes = MListPool&lt;CBRTQuene&gt;.Get();</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> rtQuene <span class="keyword">in</span> _CBRTQuenes)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (rtQuene.isValid &amp;&amp; rtQuene.isRTAltas &amp;&amp; rtQueneIsInActiveRawImage())</span><br><span class="line">        {</span><br><span class="line">            rtQuenes.Add(rtQuene);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (rtQuenes.Count == <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">        ResizeShareRT(Vector2.one);</span><br><span class="line">        MListPool&lt;CBRTQuene&gt;.Release(rtQuenes);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    rtQuenes.Sort((x, y) =&gt; y.clipRect.width.CompareTo(xclipRect.width));</span><br><span class="line">    <span class="comment">// clipRect è®¡ç®— x y</span></span><br><span class="line">    Vector2 targetSize = <span class="keyword">new</span> Vector2(<span class="number">256</span>, <span class="number">256</span>);</span><br><span class="line">    <span class="built_in">bool</span> loop = <span class="literal">true</span>; <span class="comment">// é‡æ–°è®¡ç®—</span></span><br><span class="line">    <span class="keyword">while</span> (loop)</span><br><span class="line">    {</span><br><span class="line">        Vector2 position = Vector2.zero;</span><br><span class="line">        <span class="built_in">float</span> nextX = <span class="number">0.0f</span>;</span><br><span class="line">        loop = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> rtQuene <span class="keyword">in</span> rtQuenes)</span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// ä¸€ä¸ª ClipRect.height é«˜è¶…å‡º yï¼Œåˆ™ y *= 2</span></span><br><span class="line">            <span class="keyword">if</span> (rtQuene.clipRect.height &gt; targetSize.y)</span><br><span class="line">            {</span><br><span class="line">                loop = <span class="literal">true</span>;</span><br><span class="line">                targetSize.y *= <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// é«˜è¶…å‡ºäº† yï¼Œåˆ™ä¸‹ä¸€åˆ—</span></span><br><span class="line">            <span class="keyword">if</span> (position.y + rtQuene.clipRect.height &gt;targetSize.y)</span><br><span class="line">            {</span><br><span class="line">                position.x = nextX;</span><br><span class="line">                position.y = <span class="number">0</span>;                        </span><br><span class="line">            }</span><br><span class="line">            rtQuene.clipRect.x = position.x;</span><br><span class="line">            rtQuene.clipRect.y = position.y;</span><br><span class="line">            nextX = Mathf.Max(nextX, position.x + rtQueneclipRect.width);</span><br><span class="line">            <span class="comment">// nextX è¶…å‡º x</span></span><br><span class="line">            <span class="keyword">if</span> (nextX &gt; targetSize.x)</span><br><span class="line">            {</span><br><span class="line">                loop = <span class="literal">true</span>;</span><br><span class="line">                <span class="comment">// å…ˆæ‰©å±• x</span></span><br><span class="line">                <span class="keyword">if</span> (targetSize.x &lt;= targetSize.y)</span><br><span class="line">                {</span><br><span class="line">                    targetSize.x += <span class="number">256</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// å†æ‰©å±• y</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                {</span><br><span class="line">                    targetSize.y += <span class="number">256</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            position.y += rtQuene.clipRect.height;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    ResizeShareRT(targetSize);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> rtQuene <span class="keyword">in</span> rtQuenes)</span><br><span class="line">    {</span><br><span class="line">        rtQuene.renderTexture = _sharedRT;</span><br><span class="line">        rtQuene.AltasComplete();</span><br><span class="line">    }</span><br><span class="line">    MListPool&lt;CBRTQuene&gt;.Release(rtQuenes);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li></ul><blockquote><p><a class="link" href="https://docs.unity3d.com/ScriptReference/RenderTexture.GetTemporary.html">RenderTexture.GetTemporary<i class="fas fa-external-link-alt"></i></a></p><p>Allocate a temporary render texture.</p><p>This function is optimized for when you need a quick RenderTexture to do some temporary calculations. Release it using ReleaseTemporary as soon as youâ€™re done with it, so another call can start reusing it if needed.</p><p>Internally Unity keeps a pool of temporary render textures, so a call to GetTemporary most often just returns an already created one (if the size and format matches). These temporary render textures are actually &gt; destroyed when they arenâ€™t used for a couple of frames.</p><p>If you are doing a series of post-processing â€œblitsâ€, itâ€™s best for performance to get and release a temporary render texture for each blit, instead of getting one or two render textures upfront and reusing them. &gt; This is mostly beneficial for mobile (tile-based) and multi-GPU systems: GetTemporary will internally do a DiscardContents call which helps to avoid costly restore operations on the previous render texture contents.</p><p>You can not depend on any particular contents of the RenderTexture you get from GetTemporary function. It might be garbage, or it might be cleared to some color, depending on the platform</p></blockquote><h2 id="TimeLine">TimeLine</h2><center>    <img src="/2024/05/09/50/cutscene.png"></center><h3 id="è¿è¡Œæ—¶">è¿è¡Œæ—¶</h3><h4 id="MCutSceneMgr"><code>MCutSceneMgr</code></h4><ul><li>å¤–éƒ¨è°ƒç”¨ <code>Play(int id, DirectoreWrapMode mode = DirectorWrapMode.Hold, Action endCallback = null, Action = startCallback = null)</code> è¿›è¡Œ CutScene æ’­æ”¾</li><li>æ ¹æ®è¡¨æ ¼é…ç½®çš„è·¯å¾„è¿›è¡Œ <strong> èµ„æº </strong> é¢„å¤„ç†<code>preAll</code><ul><li>æ’­æ”¾é»‘å± æ˜¾ç¤ºé»‘å± UI</li><li>è®¾ç½®æ’­æ”¾çŠ¶æ€ä¸º<code>CutSceneState.Prepare</code><ul><li>åˆ©ç”¨å¼•ç”¨è®¡æ•°æ¥å†³å®šæ‰€æœ‰èµ„æºæ˜¯å¦åŠ è½½å®Œæˆï¼Œå¼•ç”¨è®¡æ•°ä¸º 0 æ—¶è¡¨ç¤ºèµ„æºéƒ½åŠ è½½å¥½äº†</li><li>æ¯æ¬¡è¿›è¡Œèµ„æºåŠ è½½æˆ–é¢„åŠ è½½å¼•ç”¨è®¡æ•°åŠ  1ï¼Œåœ¨åŠ è½½å®Œæˆåçš„å›è°ƒå‡½æ•°ä¸­å¼•ç”¨è®¡æ•°å‡ 1</li><li>å¼•ç”¨è®¡æ•°åŒ…æ‹¬ï¼š<code>_necessaryLoadCount</code>ã€<code>_preloadFlag</code>ã€<code>_preloadRootCount</code></li><li>åŠ è½½å®Œæˆåå¯ä»¥è¿›è¡Œæ’­æ”¾</li></ul></li><li>æ¨¡å‹ã€ç‰¹æ•ˆç­‰ Root èŠ‚ç‚¹åˆå§‹åŒ–ï¼›æ‰©å±•åŠŸèƒ½åˆå§‹åŒ–</li><li>èµ„æºå¼‚æ­¥åŠ è½½ï¼ŒåŠ è½½çš„èµ„æºç±»å‹ä¸º<code>.playable</code></li><li>åŠ è½½ <code>.playable</code> èµ„æºæˆåŠŸåç»§ç»­é¢„åŠ è½½å„ç§æ ¹èŠ‚ç‚¹<ul><li><code>VcRoot</code></li><li><code>VcPathRoot</code></li><li><code>SpineRoot</code></li></ul></li><li>åŠ è½½ Track<ul><li>ç‰¹æ•ˆ</li><li>è§†é¢‘</li><li>å¤©æ°”</li><li>æ¨¡å‹</li><li>è™šæ‹Ÿç›¸æœº</li><li>Cinemachine</li><li>åŠ¨ç”»</li><li>Spine åŠ¨ç”»</li></ul></li></ul></li><li><code>Update</code>å‡½æ•°ä¸­æ¯å¸§æ‰§è¡Œ<ul><li>èµ„æºå…¨éƒ¨åŠ è½½å¥½ä¹‹åï¼ˆæ‰€æœ‰åŠ è½½èµ„æºç›¸å…³çš„å¼•ç”¨è®¡æ•°ä¸º 0ï¼‰ï¼Œè®¾ç½®æ’­æ”¾çŠ¶æ€ä¸º<code>CutSceneState.Ready</code></li><li>è®¾ç½®ç›¸æœºçš„è£å‰ªé®ç½©</li><li>è®¾ç½®æ’­æ”¾çŠ¶æ€ä¸º<code>CutSceneState.Play</code></li><li>è°ƒç”¨ CutScene æ’­æ”¾å¼€å§‹çš„å›è°ƒå‡½æ•°<code>_startAction</code></li><li>è°ƒç”¨ <code>PlayableDirector.Play()</code> è¿›è¡Œæ’­æ”¾</li><li>è°ƒç”¨æ‰©å±•åŠŸèƒ½çš„ <code>Update</code> å‡½æ•°</li><li>è°ƒç”¨ CutScene æ’­æ”¾ç»“æŸçš„å›è°ƒå‡½æ•°<code>_endCallback</code></li><li>æ£€æµ‹æ˜¯å¦å¯ä»¥æ›´æ–°ä¸‹ä¸€ä¸ª CutScene<ul><li>æ²¡æœ‰å¾ªç¯æ’­æ”¾æˆ–è€…æ­£åœ¨æ’­æ”¾ï¼Œå¯è¿›è¡Œä¸‹é¢çš„åˆ¤æ–­</li><li>è®¡ç®—å‰©ä½™æ—¶é•¿ <strong> çš„ç›¸åæ•°</strong> <code>remain = (float)(_playableDirector.time - _playableDirector.duration);</code></li><li><code>DirectorWrapMode</code>ä¸º <code>Hold</code> æ—¶ï¼Œ<code>remain &gt;= 0f</code>æ—¶ç«‹å³å‡†å¤‡ä¸‹ä¸€ä¸ª CutScene æ’­æ”¾</li><li><code>DirectorWrapMode</code>ä¸º <code>None</code> æ—¶ï¼Œä¸å¤ªæ¸…é™¤è¿™å—çš„é€»è¾‘äº†<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (MCommonFunctions.IsEqual(_playableDirector.time, <span class="number">0</span>))</span><br><span class="line">{</span><br><span class="line">    _cntZeroTime++;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span> (_cntZeroTime &lt;= <span class="number">1</span> &amp;&amp; (_playPath.Count &lt;= <span class="number">0</span> || !(Mathf.Abs(tmp) &lt;= <span class="number">0.1f</span>)) &amp;&amp; !(tmp &gt;= <span class="number">0f</span>)) <span class="keyword">return</span>;</span><br></pre></td></tr></table></figure></li><li>æ ¹æ®è¡¨æ ¼ä¸­çš„ CutScene é…ç½®ï¼Œå–ç¬¬äºŒä¸ªè·¯å¾„ä¸º <code>nextPath</code> ç»§ç»­èµ°èµ„æºåŠ è½½ç„¶åæ’­æ”¾çš„çš„æµç¨‹</li></ul></li></ul></li></ul><blockquote><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">public</span> <span class="built_in">enum</span> DirectorWrapMode</span><br><span class="line">&gt;{</span><br><span class="line">   <span class="comment">//</span></span><br><span class="line">   <span class="comment">// æ‘˜è¦ï¼š</span></span><br><span class="line">   <span class="comment">//     Hold the last frame when the playable time reaches it's duration.</span></span><br><span class="line">   Hold,</span><br><span class="line">   <span class="comment">//</span></span><br><span class="line">   <span class="comment">// æ‘˜è¦ï¼š</span></span><br><span class="line">   <span class="comment">//     Loop back to zero time and continue playing.</span></span><br><span class="line">   Loop,</span><br><span class="line">   <span class="comment">//</span></span><br><span class="line">   <span class="comment">// æ‘˜è¦ï¼š</span></span><br><span class="line">   <span class="comment">//     Do not keep playing when the time reaches the duration.</span></span><br><span class="line">   None</span><br><span class="line">&gt;}</span><br></pre></td></tr></table></figure></blockquote><h3 id="å…¶ä»–è¾…åŠ©ç±»">å…¶ä»–è¾…åŠ©ç±»</h3><ul><li><code>MCutsceneObject</code> ç»§æ‰¿è‡ª<code>MGameObject</code></li><li><code>MCutSceneHelper</code> å®šä¹‰åœ¨ Hierarchy ç»“æ„ä¸­æ˜¾ç¤ºçš„èŠ‚ç‚¹åç§°</li><li><code>MCutSceneData</code> åºåˆ—åŒ– CutScene äºŒè¿›åˆ¶<ul><li><code>List&lt;MCutSceneTrack&gt;</code> åºåˆ—åŒ–è½¨é“æ•°æ®<ul><li><code>CStrackType</code></li><li><code>MCutSceneModelData</code></li><li><code>MCutSceneCirtualCameraData</code></li><li><code>List&lt;MCutSceneAnimClip&gt;</code></li><li><code>List&lt;MCutSceneCirCamClip&gt;</code></li><li><code>MCutSceneSpineData</code></li></ul></li><li><code>MDollyCart</code> å¯ç†è§£ä¸ºè£…è½½è½¨é“æ‘‡è‡‚çš„â€œè½¨é“è½¦â€</li></ul></li></ul><h4 id="PlayableBehaviourã€PlayableAsset å’Œ TrackAsset"><code>PlayableBehaviour</code>ã€<code>PlayableAsset</code>å’Œ<code>TrackAsset</code></h4><ul><li><code>TrackAsset</code>ï¼šè½¨é“èµ„æºï¼Œç”¨æ¥åˆ›å»ºç‰‡æ®µå’Œ Playable æ··åˆå™¨ï¼Œæä¾›åºåˆ—åŒ–æ•°æ®ä¸ Binding</li><li><code>PlayableAsset</code>ï¼šç‰‡æ®µèµ„æºï¼Œç”¨æ¥åˆ›å»º Playable ä»¥åŠæä¾›åºåˆ—åŒ–æ•°æ®</li><li><code>PlayableBehaviour</code>ï¼šé€»è¾‘è¡Œä¸ºï¼Œç”¨æ¥å®ç° Playable å…·ä½“çš„ä¸šåŠ¡é€»è¾‘</li></ul><h2 id="èµ„æºç®¡ç†">èµ„æºç®¡ç†</h2><h3 id="RO- çš„èµ„æºæ‰“åŒ…æµç¨‹">RO çš„èµ„æºæ‰“åŒ…æµç¨‹</h3><p>æ‰€æœ‰å¯èƒ½è¢«æ‰“åŒ…çš„èµ„æºéƒ½ä¼šè¢«å½’ç±»åˆ°ä¸€ä¸ªä¸ªçš„ filter ç±»ä¸­</p><ul><li>ABDirï¼šå¤„ç†åçš„èµ„æºå­˜æ”¾çš„æ–‡ä»¶å¤¹ï¼ˆå‰ç¼€éƒ½æ˜¯ roab/ å¹³å°ï¼‰</li><li>AbTypeï¼šèµ„æºç±»å‹ã€‚ä¸€å…±ä¸‰å¤§ç±»å‹ï¼š<ul><li>ABï¼šéœ€è¦æ‰“æˆ AB çš„èµ„æº   åŸºç±»ä¸ºï¼š<code>ABBaseFilter</code></li><li>bytesï¼šåç¼€ä¸º robytes çš„èµ„æº   åŸºç±»ä¸ºï¼š<code>ABBaseFilter</code></li><li>ç›´æ¥ copy çš„èµ„æºï¼šéŸ³é¢‘ã€è§†é¢‘ã€Resources\QualitySetting å’Œ MiniStringPool ä¸­çš„ json æ–‡ä»¶åŸºç±»ä¸ºï¼š<code>ABCopyBaseFilter</code>ã€‚ä»–çš„åŸºç±»ä¸ºï¼š<code>ABBaseFilter</code></li></ul></li><li>Filtersï¼šå°†è¦å¤„ç†çš„èµ„æºåˆ—è¡¨ã€‚ æ‰€æœ‰çš„èµ„æºéƒ½ä¼šç”¨ ABFilter æ•°æ®ç»“æ„å­˜å‚¨</li></ul><h3 id="æ‰“ -AB- æµç¨‹">æ‰“ AB æµç¨‹</h3><ul><li>XbuildABï¼šæ‰“ AB çš„æ¥å£æ–‡ä»¶ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°æ‰“ AB çš„å„ä¸ªæ­¥éª¤</li><li>XABContainerï¼šç®¡ç†æ‰€æœ‰çš„ XABItem</li><li>XABItemï¼šAB çš„æœ€å°å•ä½ï¼Œä¸€ä¸ªå°çš„èµ„æºå¯¹åº”ä¸€ä¸ª XABItem å®ä¾‹ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„éƒ½ä¼šå¯¼å‡º</li></ul><p>æ­¥éª¤</p><ul><li>é€šè¿‡ XABContainer ç”Ÿæˆ filter ä¸­çš„æ–‡ä»¶å¯¹åº”çš„ XABItem ç±»ï¼Œåˆåˆ†ä¸ºä¸‰ç±»ï¼š<ul><li>æ™®é€š AB</li><li>Atlas å›¾é›†</li><li>Shaderï¼Œå°†æ‰€æœ‰ Shader æ‰“æˆäº†ä¸€ä¸ª ABï¼Œab åå­—ä¸º shader çš„è·Ÿæ–‡ä»¶å¤¹è·¯å¾„çš„ hash</li></ul></li><li>åˆ†æä¾èµ–<ul><li>åˆ†ææ­¥éª¤ä¸€ä¸­ç”Ÿæˆçš„æ‰€æœ‰ XABItem çš„ä¾èµ–å…³ç³»ï¼Œä»è€Œæ‰¾åˆ°æ‰€æœ‰å¯èƒ½è¢«æ‰“æˆ AB çš„èµ„æºï¼Œå¹¶è®°ä¸‹æ¥å…¶å‰åä¾èµ–å…³ç³»ï¼ˆæˆ‘ä¾èµ–äº†å“ªäº›ï¼Œå“ªäº›ä¾èµ–äº†æˆ‘ï¼Œè¦æ±‚ä¸èƒ½å¾ªç¯å¼•ç”¨ï¼‰</li><li>ç¡®å®šéœ€è¦å¯¼å‡ºçš„ AB åˆ—è¡¨ï¼Œæ˜¯å¦å¯¼å‡ºæ ¹æ®å¦‚ä¸‹è§„åˆ™<ul><li><code>Asset = 1</code>  // æ™®é€šç´ æï¼Œè¢«æ ¹ç´ æä¾èµ–çš„ï¼Œè·Ÿéšå…¶æ ¹ç´ æåˆ°ä¸€ä¸ª AB ä¸­</li><li><code>Root = 1 &lt;&lt; 1</code> // æ ¹ï¼Œåªæœ‰ filter ä¸­æŒ‡å®šçš„æ‰ä¼šæ˜¯æ ¹ï¼Œä¼šè¢«å•ç‹¬æ‰“æˆ AB</li><li><code>Standalone = 1 &lt;&lt; 2</code> // è¢«ä¸¤ä¸ªæˆ–è€…ç¦»ä¸¤ä¸ªä»¥ä¸Šç´ æå¼•ç”¨çš„ä¼šè¢«å•ç‹¬æ‰“æˆ AB</li></ul></li></ul></li><li>å¯¼å‡º AB<ul><li>å¯¼å‡ºçš„ AB åœ¨ roab è¿™ä¸ªå·¥ç¨‹ç›®å½•ä¸­</li><li>å…ˆæ‰“å›¾é›†çš„ ABï¼Œå†æ‰“éå›¾é›†çš„ã€‚å›¾é›†è¦<code>EditorSettings.spritePackerMode = SpritePackerMode.AlwaysOnAtlas</code>ï¼Œéå›¾é›†è¦è®¾ç½®ä¸º<code>SpritePackerMode.Disabled</code></li><li>å‹ç¼©ç®—æ³•é€‰äº† lz4, ç§»åŠ¨ç«¯ &amp;PC ç«¯å…³é—­ typetree, ä¸ºäº†çƒ­æ›´çš„éœ€è¦è®¾ç½®äº†<code>DeterministicAssetBundle</code></li><li>æ„å»º <code>AssetBundleBuild</code> çš„æ—¶å€™ï¼Œåœºæ™¯æ–‡ä»¶ä¸ç”¨è®°å½•æ‰€æœ‰ä¾èµ–ï¼ŒUnity ä¼šè‡ªåŠ¨åš</li></ul></li><li>å†™å…¥ dep.all æ–‡ä»¶<ul><li>AB ä¸­åŒ…å«çš„èµ„æºåˆ—è¡¨ã€‚å®é™…æµ‹ä¸‹æ¥ï¼Œåªæœ‰ shader æœ‰å¤šä¸ªï¼Œå…¶ä½™çš„éƒ½æ˜¯åªæœ‰ä¸€ä¸ª</li><li>AB çš„ hash å€¼</li><li>AB çš„ç±»å‹</li><li>éœ€è¦ä¾èµ–çš„ AB æ•°é‡åŠåˆ—è¡¨</li></ul></li><li>åˆ é™¤å†—ä½™çš„ ABï¼ˆç»™å¢é‡ bundle ä½¿ç”¨ï¼‰<ul><li>å…ˆä»å…¶ä»–ç›®å½•æ‹·è´ ABï¼ˆèµ„æºä¼šæœ‰åˆ é™¤çš„ï¼‰</li><li>å†æ‰“å¢é‡ AB</li><li>åˆ¤æ–­æ²¡æœ‰ç”¨çš„ AB éœ€è¦åˆ é™¤æ‰</li></ul></li><li>Bytes<ul><li>ç¿»è¯‘</li><li>å…¶ä»–é…ç½®æ–‡ä»¶</li><li>ç›´æ¥æ‹·è´</li></ul></li><li>è„šæœ¬<ul><li>é€šè¿‡ luajit å°†ã€‚lua æ–‡ä»¶å¤„ç†æˆäºŒè¿›åˆ¶æ–‡ä»¶</li></ul></li><li>å…¶ä»–èµ„æº</li></ul><blockquote><p><code>_analyze_step == 0</code>ï¼šå¼€å§‹åˆ†æ<br><code>_analyze_step == 1</code>ï¼šå­˜åœ¨å¾ªç¯ä¾èµ–ï¼ˆA â†’ B â†’ A æˆ– A â†’ B â†’ C â†’ Aï¼‰ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸<br><code>_analyze_step == 2</code>ï¼šå·²ç»åˆ†æè¿‡</p></blockquote><h2 id="è¯»è¡¨">è¯»è¡¨</h2><h3 id="è¯»å–æ•´è¡¨">è¯»å–æ•´è¡¨</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetTable</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> l_tables = {}</span><br><span class="line">    <span class="keyword">if</span> l_tablePtr ~= <span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">for</span> i=<span class="number">1</span>, l_tableSize <span class="keyword">do</span></span><br><span class="line">            <span class="built_in">table</span>.<span class="built_in">insert</span>(l_tables, GetRow(i))</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        logError(<span class="string">"SkillTable l_tablePtr is nil"</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> l_tables</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="è¯»å–ä¸€è¡Œ">è¯»å–ä¸€è¡Œ</h3><ul><li><code>ROGameLibs.TableDataLuaProxy:GetRowIDByINT</code></li></ul><h2 id="Hash">Hash</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;sumarry&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> ä¸æ–­åœ°ä¹˜ 33 ï¼ˆ(hash <span class="doctag">&lt;&lt; 5) + hashï¼‰</span></span></span><br><span class="line"><span class="doctag"><span class="comment">/// &lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">uint</span> <span class="title">GetHash</span>(<span class="params"><span class="built_in">string</span> str</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">uint</span> hash = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; str.Length; i++&gt;)</span><br><span class="line">    {</span><br><span class="line">        hash = (hash &lt;&lt; <span class="number">5</span>) + hash + str[i];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> hash;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="é¢è¯•" scheme="https://silhouettesforyou.github.io/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
    <category term="æˆ˜æ–—" scheme="https://silhouettesforyou.github.io/tags/%E6%88%98%E6%96%97/"/>
    
  </entry>
  
  <entry>
    <title>Life of a triangle</title>
    <link href="https://silhouettesforyou.github.io/2023/04/20/49/"/>
    <id>https://silhouettesforyou.github.io/2023/04/20/49/</id>
    <published>2023-04-20T14:01:48.000Z</published>
    <updated>2023-12-10T07:38:09.409Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><a class="link" href="https://developer.nvidia.com/content/life-triangle-nvidias-logical-pipeline">Life of a triangle<i class="fas fa-external-link-alt"></i></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="å›¾å½¢å­¦" scheme="https://silhouettesforyou.github.io/categories/%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
    
    <category term="Graphics" scheme="https://silhouettesforyou.github.io/tags/Graphics/"/>
    
    <category term="ç¿»è¯‘" scheme="https://silhouettesforyou.github.io/tags/%E7%BF%BB%E8%AF%91/"/>
    
    <category term="GPU" scheme="https://silhouettesforyou.github.io/tags/GPU/"/>
    
  </entry>
  
  <entry>
    <title>Lua è§£é‡Šå™¨æ„å»ºï¼šä»è™šæ‹Ÿæœºåˆ°ç¼–è¯‘å™¨</title>
    <link href="https://silhouettesforyou.github.io/2023/04/03/48/"/>
    <id>https://silhouettesforyou.github.io/2023/04/03/48/</id>
    <published>2023-04-03T11:36:58.000Z</published>
    <updated>2024-05-10T14:34:23.114Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h3 id="å¢é‡å¼æ ‡è®°æ¸…é™¤ç®—æ³•">å¢é‡å¼æ ‡è®°æ¸…é™¤ç®—æ³•</h3><p>æ•´ä¸ª GC æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå¤§è‡´ç»å†ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µ</p><ul><li><p><strong><font color="#FF6000">pause</font></strong> é˜¶æ®µ</p><p><font color="#FFA559">mainthread</font> å’Œ <font color="#FFA559">global table</font> åŒ…å« GC èµ·å§‹ç‚¹ï¼Œå› æ­¤è¦å°†å®ƒä»¬æ’å…¥åˆ° <font color="#2E4F4F">gray</font> é“¾è¡¨ä¸­ï¼Œå¹¶å°†å®ƒä»¬æ ‡è®°ä¸ºç°è‰²ï¼Œè¿›å…¥åˆ° <strong><font color="#FF6000">propagate</font></strong> é˜¶æ®µ</p></li><li><p><strong><font color="#FF6000">propagate</font></strong> é˜¶æ®µ</p><ul><li>ä¸æ–­ä» <font color="#2E4F4F">gray</font> é“¾è¡¨ä¸­å–å‡ºå¯¹è±¡ï¼Œç„¶åæŠŠå®ƒä»ç°è‰²å˜ä¸ºé»‘è‰²ï¼Œå†éå†å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œå¹¶å°†å…¶æ’å…¥åˆ° <font color="#2E4F4F">gray</font> é“¾è¡¨ä¸­</li><li><strong><font color="#FF6000">propagate</font></strong> é˜¶æ®µç´¯ç§¯éå†çš„å¯¹è±¡å¤§å°è¶…è¿‡ä¸€å®šçš„å­—èŠ‚æ•°ï¼Œæœ¬è½® GC ä¼šè¢«ç»ˆæ­¢ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡ GC æ­¥éª¤å¼€å§‹åç»§ç»­æ‰«æ <font color="#2E4F4F">gray</font> é“¾è¡¨ä¸­çš„å¯¹è±¡</li><li>å½“ <font color="#2E4F4F">gray</font> é“¾è¡¨ä¸ºç©ºæ—¶ï¼Œè¿›å…¥ <strong><font color="#FF6000">atomic</font></strong> é˜¶æ®µ</li></ul></li><li><p><strong><font color="#FF6000">atomic</font></strong> é˜¶æ®µ</p><ul><li>GC æ­¥éª¤åœ¨ <strong><font color="#FF6000">pause</font></strong> é˜¶æ®µæ˜¯å¯ä»¥è¢«ä¸­æ–­çš„ï¼Œå‡å¦‚æ–°å»ºçš„å¯¹è±¡è¢«æ ‡è®°ä¸ºé»‘è‰²çš„å¯¹è±¡å¼•ç”¨ï¼Œæœ¬è½® GC å°±ä¸ä¼šå¯¹å…¶è¿›è¡Œéå†å’Œæ ‡è®°ï¼Œåˆ° <strong><font color="#FF6000">sweep</font></strong> é˜¶æ®µå°±ä¼šè¢«å½“ä½œä¸å¯è¾¾çš„å¯¹è±¡è€Œæ¸…é™¤æ‰</li><li>éœ€è¦ä¸ºæ–°å»ºå¯¹è±¡è®¾ç½®å±éšœï¼ˆbarrierï¼‰<ul><li>å‘å‰è®¾ç½®å±éšœï¼šç›´æ¥å°†æ–°åˆ›å»ºçš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼Œæ”¾å…¥åˆ° <font color="#2E4F4F">gray</font> é“¾è¡¨ä¸­</li><li>å‘åè®¾ç½®å±éšœï¼šå°†é»‘è‰²å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼Œ <font color="#2E4F4F">grayagain</font> é“¾è¡¨ä¸­</li></ul></li><li>åŸå­æ‰§è¡Œ <strong><font color="#FF6000">atomic</font></strong> é˜¶æ®µ</li></ul></li><li><p><strong><font color="#FF6000">sweep</font></strong> é˜¶æ®µ</p><p>ä» allgc é“¾è¡¨ä¸­å»é™¤è‹¥å¹²ä¸ªå¯¹è±¡ï¼›å¦‚æœå·²ç»æ˜¯æœ¬è½® GC è¦è¢«æ¸…é™¤çš„ <font color="#E4DCCF"> ç™½è‰² </font>ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«æ¸…é™¤ï¼›å¦‚æœä¸æ˜¯ï¼Œåˆ™æ ‡è®°ä¸º<font color="#BACDDB"> å¦ä¸€ç§ç™½</font>ï¼Œä»¥ä¾›ä¸‹ä¸€è½® GC ä½¿ç”¨</p></li></ul><h3 id="Lua- è™šæ‹Ÿæœºçš„å­—ç¬¦ä¸²">Lua è™šæ‹Ÿæœºçš„å­—ç¬¦ä¸²</h3><ul><li>ä» Lua-5.2.1 å¼€å§‹ï¼Œå­—ç¬¦ä¸²å°±åˆ†ä¸ºé•¿å­—ç¬¦ä¸²åˆçŸ­å­—ç¬¦ä¸²ã€‚å…¶ä¸­çŸ­å­—ç¬¦ä¸²ä¼šè¿›è¡Œå……åˆ†çš„å“ˆå¸Œè¿ç®—ï¼Œå¹¶è¿›è¡Œå†…éƒ¨ä¼˜åŒ–å¤„ç†ï¼›é•¿å­—ç¬¦ä¸²ä¸ä¼šè¿›è¡Œå“ˆå¸Œè¿ç®—å’Œå†…éƒ¨åŒ–</li><li>å­—ç¬¦ä¸²å†…éƒ¨åŒ–çš„æœ¬è´¨å°±æ˜¯ä¸ºæ¯ä¸ªå­—ç¬¦ä¸²åˆ›å»ºå”¯ä¸€çš„å®ä¾‹</li><li>åœ¨ Lua ä¸­ï¼Œå­—ç¬¦ä¸² Body é•¿åº¦å°äºæˆ–ç­‰äº 40B çš„æ˜¯çŸ­å­—ç¬¦ä¸²ï¼Œå¤§äº 40B çš„æ˜¯é•¿å­—ç¬¦ä¸²ï¼›åœ¨ Lua-5.3 ä¸­ï¼ŒçŸ­å­—ç¬¦ä¸²çš„å¤§å°é™åˆ¶ç”± <code>LUAI_MAXSHORTLEN</code> å†³å®šï¼Œè¿™ä¸ªå®å®šä¹‰åœ¨ llimits.h ä¸­å®šä¹‰</li></ul><h3 id="Lua- è™šæ‹Ÿæœºçš„è¡¨">Lua è™šæ‹Ÿæœºçš„è¡¨</h3><h4 id="Lua- è¡¨çš„åŸºæœ¬æ•°æ®ç»“æ„">Lua è¡¨çš„åŸºæœ¬æ•°æ®ç»“æ„</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// luaobject.h</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> <span class="title">lua_Value</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">GCObject</span>* <span class="title">gc</span>;</span></span><br><span class="line">    <span class="type">void</span>* p;</span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line">    lua_Interger i;</span><br><span class="line">    lua_Number n;</span><br><span class="line">    lua_CFunction f;</span><br><span class="line">&#125; Value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">lua_TValue</span> &#123;</span></span><br><span class="line">    Value value_;</span><br><span class="line">    <span class="type">int</span> tt_;</span><br><span class="line">&#125; TValue;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lua Table</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> <span class="title">TKey</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        Value value_;</span><br><span class="line">        <span class="type">int</span> tt; <span class="comment">// ç”¨æ¥æ ‡è®° value_æ˜¯ä»€ä¹ˆç±»å‹</span></span><br><span class="line">        <span class="type">int</span> next;</span><br><span class="line">    &#125; nk;</span><br><span class="line">    TValue tvk;</span><br><span class="line">&#125; TKey;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    TKey key;</span><br><span class="line">    TValue value;</span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Table</span> &#123;</span></span><br><span class="line">    CommonHeader;               <span class="comment">// GC éƒ¨åˆ†</span></span><br><span class="line">    TValue* <span class="built_in">array</span>;              <span class="comment">// æ•°ç»„éƒ¨åˆ†</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> arraysize;     <span class="comment">// æ•°ç»„å¤§å°</span></span><br><span class="line">    Node* node;                 <span class="comment">// hash éƒ¨åˆ†</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> lsizenode;     <span class="comment">// hash å¤§å°ï¼Œå®é™…å¤§å°ä¸º 2&lt;sup&gt;lsizenode</span></span><br><span class="line">    Node* lastfree;             <span class="comment">// ç©ºé—²æŒ‡é’ˆ</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">GCObject</span>* <span class="title">gclist</span>;</span>    <span class="comment">// GC éƒ¨åˆ†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é”®å€¼çš„å“ˆå¸Œè¿ç®—">é”®å€¼çš„å“ˆå¸Œè¿ç®—</h4><p><code>Node</code>ç»“æ„çš„ <code>key</code> å¯ä»¥æ˜¯ä»»æ„ Lua ç±»å‹ã€‚<code>key</code>å€¼æ˜¯å¦‚ä½•å’Œå“ˆå¸Œè¡¨çš„ç´¢å¼•å¯¹åº”èµ·æ¥</p><ul><li>å¯¹ <code>key</code> è¿›è¡Œå“ˆå¸Œè¿ç®—</li><li>æ ¹æ®å¾—åˆ°çš„å“ˆå¸Œå€¼ï¼Œæ¢ç®—æˆè¡¨ç»“æ„ <code>node</code> æ•°ç»„çš„ç´¢å¼•å€¼<ul><li><code>index = hash_value &amp; (2^lsizenode - 1)</code></li></ul></li><li>æŸ¥æ‰¾å…ƒç´ <ul><li>è¢«æŸ¥æ‰¾çš„å…ƒç´  key æ˜¯ <code>int</code> ç±»å‹ï¼š<ul><li>key åœ¨æ•°ç»„èŒƒå›´ä¹‹å†…ï¼ˆåœ¨ <code>array</code> ä¸­æŸ¥æ‰¾ï¼‰ï¼Œè¿”å›<code>array[k - 1]</code></li><li>key ä¸åœ¨æ•°ç»„èŒƒå›´ä¹‹å†…ï¼Œè®¡ç®—å“ˆå¸Œå€¼ï¼ˆåœ¨ <code>node</code> é“¾è¡¨ä¸­æŸ¥æ‰¾ï¼‰</li></ul></li><li>è¢«æŸ¥æ‰¾çš„å…ƒç´  key ä¸æ˜¯ <code>int</code> ç±»å‹ï¼škey ä¸åœ¨æ•°ç»„èŒƒå›´ä¹‹å†…ï¼Œè®¡ç®—å“ˆå¸Œå€¼ï¼ˆåœ¨ <code>node</code> é“¾è¡¨ä¸­æŸ¥æ‰¾ï¼‰</li></ul></li></ul><h4 id="è°ƒæ•´è¡¨çš„å¤§å°">è°ƒæ•´è¡¨çš„å¤§å°</h4><ul><li><p><code>nums[i]</code>çš„å«ä¹‰ï¼šç»Ÿè®¡ $(2^{i - 1}, 2^i]$ åŒºé—´å†…ï¼Œæ‰€æœ‰æ•°ç»„ç´¢å¼•å€¼ã€å“ˆå¸Œè¡¨<code>key</code>ï¼ˆç±»å‹ä¸º<code>int</code>ï¼‰çš„å“ˆå¸Œå€¼ä½äºè¿™ä¸ªåŒºé—´çš„å…ƒç´ æ€»æ•°<code>n</code></p></li><li><p>åˆ¤æ–­æ–°æ’å…¥çš„å…ƒç´ çš„ <code>key</code> å€¼æ˜¯å¦ä¸ºæ•´æ•°ç±»å‹ï¼Œå¦‚æœæ˜¯åˆ™å¯¹åº”åŒºé—´æ€»æ•°å¢åŠ  1ï¼š<code>nums[i]++</code></p></li><li><p>å®Œæˆ <code>nums</code> çš„ç»Ÿè®¡åï¼Œæ ¹æ® <code>nums</code> è®¡ç®—æ–°çš„æ•°ç»„å¤§å°ã€‚åœ¨æ•°ç»„å¤§å°èŒƒå›´å†…ï¼Œ<font color="#FF6D60">å€¼ä¸ä¸º <code>nil</code> çš„å…ƒç´ è¦è¶…è¿‡æ•°ç»„å¤§å°çš„ä¸€åŠ</font>ï¼š</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> asize = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">    asize += nums[i];</span><br><span class="line">    <span class="keyword">if</span> (asize &gt; <span class="built_in">pow</span>(<span class="number">2</span>, i) / <span class="number">2</span>) &#123;</span><br><span class="line">        arraysize = <span class="built_in">pow</span>(<span class="number">2</span>, i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è®¡ç®—åœ¨æ•°ç»„å¤§å°èŒƒå›´å†…æœ‰æ•ˆå…ƒç´ çš„ä¸ªæ•°ï¼Œè®°ä¸º<code>array_used_num</code></p></li><li><p>å½“æ•°ç»„æ¯”åŸæ¥å¤§æ—¶ï¼Œ<font color="#FF6D60">æ‰©å±• </font> åŸæ¥çš„æ•°ç»„åˆ°æ–°çš„å¤§å°ï¼Œå¹¶å°†å“ˆå¸Œè¡¨ä¸­ <code>key</code> å€¼å°äºç­‰äº <code>arraysize</code>ï¼Œä¸”å¤§äº 0 çš„å…ƒç´ è½¬ç§»åˆ°æ•°ç»„ä¸­ï¼Œå¹¶å°†å“ˆå¸Œè¡¨å¤§å°è°ƒæ•´ä¸º $\lceil \log_2^{total - array_used_num} \rceil$ï¼ŒåŒæ—¶å¯¹æ¯ä¸ª<code>node</code> é‡æ–°å®šä½</p></li><li><p>å½“æ•°ç»„æ¯”åŸæ¥å°æ—¶ï¼Œ<font color="#FF6D60">ç¼©å° </font> åŸæ¥çš„æ•°ç»„åˆ°æ–°çš„å¤§å°ï¼Œå¹¶å°†æ•°ç»„ä¸­ <code>key</code> å€¼è¶…è¿‡æ•°ç»„å¤§å°çš„å…ƒç´ è½¬ç§»åˆ°å“ˆå¸Œè¡¨ä¸­ï¼Œå¹¶å°†å“ˆå¸Œè¡¨å¤§å°è°ƒæ•´ä¸º $\lceil \log_2^{total - array_used_num} \rceil$ï¼ŒåŒæ—¶å¯¹æ¯ä¸ª <code>node</code> é‡æ–°å®šä½</p></li></ul><h3 id="Lua- ä¸­çš„ä¸‰ç§å‡½æ•°ç±»åˆ«">Lua ä¸­çš„ä¸‰ç§å‡½æ•°ç±»åˆ«</h3><h4 id="Light-C-Function">Light C Function</h4><p>å¯ä»¥ç†è§£ä¸ºæ™®é€šçš„ C å‡½æ•°ï¼Œå¦‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">test_main</span><span class="params">(<span class="keyword">struct</span> lua_State* L)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> arg1 = (<span class="type">int</span>)luaL_tointeger(L, <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> arg2 = (<span class="type">int</span>)luaL_tointeger(L, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;test main arg1:%d arg2%d \n&quot;</span>, arg1, arg2);</span><br><span class="line">    lua_pushinteger(L, arg1 + arg2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦åœ¨ Lua è™šæ‹Ÿæœºä¸­è¿è¡Œ <code>test_main</code> å‡½æ•°ï¼Œéœ€è¦è°ƒç”¨<code>lua_pcall</code>ï¼Œå…¶å£°æ˜å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// L è¡¨ç¤º Lua çº¿ç¨‹</span></span><br><span class="line"><span class="comment">// narg è¡¨ç¤ºåœ¨ Lua çº¿ç¨‹é‡Œæ‰§è¡Œçš„å‡½æ•°æœ‰å¤šå°‘ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment">// nresult è¡¨ç¤ºåœ¨ Lua çº¿ç¨‹é‡Œæ‰§è¡Œçš„å‡½æ•°æœ‰å¤šå°‘ä¸ªè¿”å›å€¼</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">lua_pcall</span><span class="params">(<span class="keyword">struct</span> lau_State* L, <span class="type">int</span> narg, <span class="type">int</span> nresult)</span>;</span><br></pre></td></tr></table></figure><h4 id="C- é—­åŒ…">C é—­åŒ…</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ClosureHeader \ </span></span><br><span class="line">  CommonHeader; lu_byte nupvalues; GCObject* gclist</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">CClosure</span> &#123;</span></span><br><span class="line">    ClosureHeader;</span><br><span class="line">    lua_Function f;</span><br><span class="line">    TValue upvalue[<span class="number">1</span>]; <span class="comment">// upvalue åˆ—è¡¨</span></span><br><span class="line">&#125; CClosure;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ª C é—­åŒ…å’Œ Light C Function å‡½æ•°ç›¸æ¯”ï¼Œé™¤äº†å— GC æ‰˜ç®¡å¹¶ä¸”æ‹¥æœ‰ä¸Šå€¼åˆ—è¡¨å¤–ï¼Œå…¶ä»–åŠŸèƒ½å’Œ Light C Function å‡½æ•°å·®ä¸å¤š</p><h4 id="Lua- é—­åŒ…">Lua é—­åŒ…</h4><p>Lua é—­åŒ…æ˜¯å— Lua è™šæ‹Ÿæœºçš„ GC æ‰˜ç®¡çš„ï¼ŒLua è„šæœ¬ä»£ç ç»è¿‡ç¼–è¯‘ç”Ÿæˆçš„è™šæ‹ŸæŒ‡ä»¤ï¼Œä»¥åŠå…¶ä»–ä¸€äº›ç¼–è¯‘ç›¸å…³çš„ä¿¡æ¯ä¼šå­˜æ”¾åœ¨ LClosure ä¸­çš„ <code>Proto</code> ç±»å‹å˜é‡ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">LClosure</span> &#123;</span></span><br><span class="line">    ClosureHeader;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Proto</span>* <span class="title">p</span>;</span></span><br><span class="line">    UpVal* upvals[<span class="number">1</span>];</span><br><span class="line">&#125; LClosure;</span><br></pre></td></tr></table></figure><h3 id="Proto ç»“æ„"><code>Proto</code>ç»“æ„</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// common/luaobject.h</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Proto</span> &#123;</span></span><br><span class="line">    CommonHeader;</span><br><span class="line">    <span class="type">int</span> is_vararg;          <span class="comment">// æ ‡è®° Lua å‡½æ•°å‚æ•°åˆ—è¡¨æ˜¯å¦ä¸ºå¯å˜å‚ï¼Œ0 è¡¨ç¤ºå¦ï¼Œ1 è¡¨ç¤ºæ˜¯</span></span><br><span class="line">    <span class="type">int</span> nparam;             <span class="comment">// å½“ is_varrag ä¸º 0 æ—¶ç”Ÿæ•ˆï¼Œå®ƒè¡¨ç¤ºè¯¥å‡½æ•°å‚æ•°çš„æ•°é‡</span></span><br><span class="line">    Instruction* code;      <span class="comment">// Lua å‡½æ•°ç»è¿‡ç¼–è¯‘åï¼Œç”Ÿæˆçš„è™šæ‹ŸæœºæŒ‡ä»¤åˆ—è¡¨</span></span><br><span class="line">    <span class="type">int</span> sizecode;           <span class="comment">// æŒ‡æ˜ code åˆ—è¡¨çš„å¤§å°</span></span><br><span class="line">    TValue* k               <span class="comment">// å¸¸é‡åˆ—è¡¨ï¼Œå¦‚æ•°å€¼ã€å­—ç¬¦ä¸²ç­‰</span></span><br><span class="line">    <span class="type">int</span> sizek;              <span class="comment">// å¸¸é‡åˆ—è¡¨å¤§å°</span></span><br><span class="line">    LocVar* localvars;      <span class="comment">// local å˜é‡åˆ—è¡¨</span></span><br><span class="line">    <span class="type">int</span> sizelocvar;         <span class="comment">// local å˜é‡åˆ—è¡¨å¤§å°</span></span><br><span class="line">    Upvaldesc* upvalues;    <span class="comment">// upvalue ä¿¡æ¯åˆ—è¡¨ï¼Œä¸»è¦è®°å½• upvalue çš„åç§°ï¼Œä»¥åŠå…¶æ‰€åœ¨çš„åœ°å€ï¼Œå¹¶ä¸æ˜¯ upvalue å®é™…å€¼çš„åˆ—è¡¨</span></span><br><span class="line">    <span class="type">int</span> sizeupvalues;       <span class="comment">// upvalue åˆ—è¡¨å¤§å°</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Proto</span>** <span class="title">p</span>;</span>       <span class="comment">// å†…åµŒå®šä¹‰çš„å‡½æ•°åˆ—è¡¨</span></span><br><span class="line">    <span class="type">int</span> sizep;              <span class="comment">// proto åˆ—è¡¨é•¿åº¦</span></span><br><span class="line">    TString* source;        <span class="comment">// è„šæœ¬è·¯å¾„</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">GCObjects</span>* <span class="title">gclist</span>;</span></span><br><span class="line">    <span class="type">int</span> maxstacksize;       <span class="comment">// Proto æ‰€å¯¹åº”çš„ Lua å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå‡½æ•°æ ˆçš„æœ€å¤§å°ºå¯¸</span></span><br><span class="line">&#125; Proto;</span><br></pre></td></tr></table></figure><h3 id="ä¸Šå€¼ç”Ÿæˆè¿‡ç¨‹">ä¸Šå€¼ç”Ÿæˆè¿‡ç¨‹</h3><p>ä¸Šå€¼å®é™…ä¸Šæ˜¯å†ç¼–è¯‘æ—¶ç¡®å®šï¼ˆä½ç½®ä¿¡æ¯å’Œå¤–å±‚å‡½æ•°çš„å…³è”ç­‰ï¼‰ã€åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ã€‚ç”¨æ¥è¡¨ç¤ºä¸Šå€¼çš„æ•°æ®ç»“æ„æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ç¼–è¯‘æ—¶æœŸå­˜å‚¨ä¸Šå€¼ä¿¡æ¯çš„ <code>Upvaldesc</code>ï¼ˆè¿™ä¸ªç»“æ„å¹¶ä¸å­˜å‚¨ä¸Šå€¼çš„å®é™…å€¼ï¼Œåªæ˜¯ç”¨æ¥æ ‡è®°ä¸Šå€¼çš„ä½ç½®ä¿¡æ¯ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯åœ¨è¿è¡Œæ—¶å®é™…å­˜å‚¨ä¸Šå€¼çš„<code>UpVal</code> ç»“æ„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// luaobject.h</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Upvaldesc</span> &#123;</span></span><br><span class="line">    <span class="comment">// æœ¬å‡½æ•°çš„ä¸Šå€¼æ˜¯å¦æŒ‡å‘å¤–å±‚å‡½æ•°çš„æ ˆï¼ˆå¦‚æœä¸æ˜¯åˆ™æŒ‡å‘å¤–å±‚å‡½æ•°çš„æŸä¸ªä¸Šå€¼ï¼‰</span></span><br><span class="line">    <span class="type">int</span> in_stack;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šå€¼åœ¨å¤–å±‚å‡½æ•°ä¸­çš„ä½ç½®ï¼ˆæ ˆçš„ä½ç½®æˆ– upval åˆ—è¡¨ä¸­çš„ä½ç½®ï¼Œæ ¹æ® in_stack ç¡®å®šï¼‰</span></span><br><span class="line">    <span class="type">int</span> idx;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šå€¼çš„åç§°</span></span><br><span class="line">    TString* name; </span><br><span class="line">&#125; Upvaldescï¼›</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// luafunc.h</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Upval</span> &#123;</span></span><br><span class="line">    <span class="comment">// æŒ‡å‘å¤–å±‚å‡½æ•°çš„ local å˜é‡ï¼ˆå¼€æ”¾ä¸Šå€¼ï¼‰ï¼Œæˆ–è€…æŒ‡å‘è‡ªå·±ï¼ˆä¸Šå€¼å…³é—­æ—¶ï¼‰</span></span><br><span class="line">    TValue* v;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Upval å®ä¾‹è¢«å¼•ç”¨çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="type">int</span> refcount;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">UpVal</span>* <span class="title">next</span>;</span> .. ä¸‹ä¸€ä¸ªå¼€æ”¾ä¸Šå€¼</span><br><span class="line">            <span class="type">int</span> touched;</span><br><span class="line">        &#125; open;</span><br><span class="line">        Tvalue value;</span><br><span class="line">    &#125; u;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Lua è„šæœ¬çš„ç¼–è¯‘ä¿¡æ¯ä¼šè¢«å­˜å‚¨åˆ° Proto ç»“æ„å®ä¾‹ä¸­ï¼Œå½“ä¸€ä¸ª Lua å‡½æ•°çš„æŸä¸ªå˜é‡ä¸æ˜¯ <code>local</code> å˜é‡æ—¶ï¼Œå¦‚æœå¸Œæœ›è·å¾—å®ƒçš„å€¼ï¼Œå®é™…ä¸Šå°±è¦æŸ¥æ‰¾è¿™ä¸ªå˜é‡çš„ä½ç½®ï¼Œå¦‚æœåœ¨ <code>local</code> åˆ—è¡¨ä¸­æ‰¾ä¸åˆ°ï¼Œåˆ™è¿›å…¥ä¸€ä¸‹æµç¨‹ï¼š</p><ul><li>åˆ°è‡ªå·±çš„ <code>Upvaldesc</code> åˆ—è¡¨ä¸­ï¼Œæ ¹æ®å˜é‡åæŸ¥æ‰¾ï¼Œå¦‚æœå­˜åœ¨åˆ™ä½¿ç”¨å®ƒï¼Œå¦åˆ™è¿›è¡Œä¸‹ä¸€æ­¥ï¼›</li><li>åˆ°å¤–å±‚å‡½æ•°æŸ¥æ‰¾ <code>local</code> å˜é‡ï¼Œå¦‚æœæ‰¾åˆ°å®ƒå°±å°†å®ƒä½œä¸ºè‡ªå·±çš„ä¸Šå€¼ï¼Œå¦åˆ™æŸ¥æ‰¾å®ƒçš„ <code>Upvaldesc</code> è¡¨ï¼Œæ‰¾åˆ°å°±å°†å…¶ç”Ÿæˆä¸ºè‡ªå·±çš„ä¸Šå€¼ï¼Œå¦åˆ™è¿›å…¥æ›´å¤–å±‚å‡½æ•°ï¼Œé‡å¤è¿™ä¸€æ­¥ï¼›</li><li>å¦‚æœä¸€ç›´åˆ°é¡¶çº§å‡½æ•°éƒ½æ‰¾ä¸åˆ°ï¼Œé‚£ä¹ˆè¡¨ç¤ºè¿™ä¸ªä¸Šå€¼ä¸å­˜åœ¨ï¼Œæ­¤æ—¶éœ€è¦å» <code>_ENV</code> ä¸­æŸ¥æ‰¾</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="è¯»ä¹¦ç¬”è®°" scheme="https://silhouettesforyou.github.io/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="lua" scheme="https://silhouettesforyou.github.io/tags/lua/"/>
    
    <category term="æºç " scheme="https://silhouettesforyou.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>Unity æŠ€æœ¯ç¾æœ¯ - Shader ç¯‡</title>
    <link href="https://silhouettesforyou.github.io/2023/04/03/47/"/>
    <id>https://silhouettesforyou.github.io/2023/04/03/47/</id>
    <published>2023-04-03T02:58:25.000Z</published>
    <updated>2024-05-16T12:51:56.244Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h3 id="ç‰‡æ®µç€è‰²å™¨"> ç‰‡æ®µç€è‰²å™¨ </h3><h4 id="å›¾å…ƒã€ç‰‡å…ƒå’Œåƒç´ "> å›¾å…ƒã€ç‰‡å…ƒå’Œåƒç´  </h4><p> ç”Ÿæˆçš„å…ˆåé¡ºåºï¼šé¡¶ç‚¹ â†’ å›¾å…ƒ â†’ ç‰‡å…ƒ â†’ åƒç´  </p><h3 id="ShaderLab- æ¨¡æ¿">ShaderLab æ¨¡æ¿ </h3><ul><li>Standard Surface Shader è¡¨é¢ç€è‰²å™¨ </li><li>Unlit Shader ä¸å—å…‰ç…§ï¼ˆUnLightï¼‰</li><li>Image Effect Shader åå¤„ç† </li><li>Compute Shader</li><li>Ray Tracing Shader</li></ul><h3 id="SubShader">SubShader</h3><p>GPU ä¼šæ£€æŸ¥ç¬¬ä¸€ä¸ª SubShaderï¼Œå¦‚æœ SubShader ä¸æ”¯æŒï¼ˆæ˜¾å¡ç‰¹æ€§ç­‰ï¼‰ï¼Œä¼šæ£€æŸ¥ç¬¬äºŒä¸ª SubShaderï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ SubShader å°±ä¼šæ‰§è¡Œ FallBack ä¸­çš„ Shader ä»£ç  </p><h3 id="å¸¸ç”¨çš„ cginc"> å¸¸ç”¨çš„ cginc</h3><ul><li>HLSLSupport.cginc ç¼–è¯‘ CGRPOGRAM æ—¶è‡ªåŠ¨åŒ…å«æ­¤æ–‡ä»¶ï¼Œå…¶ä¸­å£°æ˜äº†å¾ˆå¤šé¢„å¤„ç†å™¨å®å¸®åŠ©å¤šå¹³å°å¼€å‘ </li><li>UnityShaderVariables.cginc ç¼–è¯‘ CGRPOGRAM æ—¶è‡ªåŠ¨åŒ…å«æ­¤æ–‡ä»¶ï¼Œå…¶ä¸­å£°æ˜äº†å¾ˆå¤šå„ç§å†…ç½®çš„å…¨å±€å˜é‡ </li><li>UnityCG.cginc éœ€è¦æ‰‹åŠ¨æ·»åŠ ï¼Œå…¶ä¸­å£°æ˜äº†å¾ˆå¤šå†…ç½®çš„å¸®åŠ©å‡½æ•°ä¸ç»“æ„ </li></ul><h3 id="æè´¨å±æ€§ Properties"> æè´¨å±æ€§ Properties</h3><h4 id="è¯­æ³•æ ¼å¼"> è¯­æ³•æ ¼å¼ </h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Attribute ä¸ºå±æ€§ </span></span><br><span class="line"><span class="comment">// _Name ä¸ºå˜é‡å </span></span><br><span class="line"><span class="comment">// Dispaly_Name ä¸ºå±•ç¤ºåœ¨æè´¨é¢æ¿ä¸Šçš„åå­— </span></span><br><span class="line"><span class="comment">// Type ä¸ºå˜é‡ç±»å‹ </span></span><br><span class="line"><span class="comment">/*********************</span></span><br><span class="line"><span class="comment"> *   &#123;</span></span><br><span class="line"><span class="comment"> *       color,</span></span><br><span class="line"><span class="comment"> *       int,</span></span><br><span class="line"><span class="comment"> *       float,</span></span><br><span class="line"><span class="comment"> *       vector,</span></span><br><span class="line"><span class="comment"> *       2D,</span></span><br><span class="line"><span class="comment"> *       3D,</span></span><br><span class="line"><span class="comment"> *       cube</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment">**********************/</span></span><br><span class="line"><span class="comment">// Default_Value ä¸ºé»˜è®¤å€¼ </span></span><br><span class="line">[Attribute]_Name(<span class="string">&quot;Display_Name&quot;</span>, Type) = Default_Value</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Properties</span><br><span class="line">&#123;</span><br><span class="line">    [HDR]_Color(<span class="string">&quot; é¢œè‰² &quot;</span>, color) = (<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    _Int(<span class="string">&quot; æ•´æ•° &quot;</span>, <span class="type">int</span>) = <span class="number">0.5</span></span><br><span class="line">    [PowerSlider(<span class="number">3</span>)]_Float(<span class="string">&quot; æµ®ç‚¹æ•° &quot;</span>, range(<span class="number">0</span>, <span class="number">10</span>)) = <span class="number">0.5</span></span><br><span class="line">    _Vector(<span class="string">&quot; å››ç»´å‘é‡ &quot;</span>, <span class="built_in">vector</span>) = (<span class="number">0.5</span>, <span class="number">2</span>, <span class="number">-1</span>, <span class="number">1</span>)</span><br><span class="line">    _2DTex(<span class="string">&quot;2D çº¹ç† &quot;</span>, <span class="number">2</span>D) = <span class="string">&quot;black&quot;</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ··åˆæ“ä½œ"> æ··åˆæ“ä½œ </h3><p> ç‰‡æ®µç€è‰²å™¨ï¼ˆæºé¢œè‰² * SrcFactorï¼‰ <font color="#2E4F4F"><strong>BlendOp</strong></font> å¸§ç¼“å†²åŒº Frame Bufferï¼ˆç›®æ ‡é¢œè‰² * DstFactorï¼‰</p><h3 id="Shader ä¸­çš„æ—¶é—´ -Time">Shader ä¸­çš„æ—¶é—´ <code>_Time</code></h3><p><code>_Time.xyzw</code></p><ul><li><code>_Time.x (t / 20)</code></li><li><code>_Time.y (t)</code></li><li><code>_Time.z (t * 2)</code></li><li><code>_Time.w (t * 3)</code></li></ul><h3 id="ç›¸å…³æœ¯è¯­"> ç›¸å…³æœ¯è¯­ </h3><h4 id="è²æ¶…å°”æ•ˆåº”"> è²æ¶…å°”æ•ˆåº” </h4><p> åœ¨çœŸå®ä¸–ç•Œä¸­ï¼Œé™¤äº†é‡‘å±ä¹‹å¤–ï¼Œå…¶å®ƒç‰©è´¨å‡æœ‰ä¸åŒç¨‹åº¦çš„â€œè²æ¶…å°”æ•ˆåº”â€ã€‚ç®€å•çš„è®²ï¼Œå°±æ˜¯è§†çº¿å‚ç›´äºè¡¨é¢æ—¶ï¼Œåå°„è¾ƒå¼±ï¼Œè€Œå½“è§†çº¿éå‚ç›´è¡¨é¢æ—¶ï¼Œå¤¹è§’è¶Šå°ï¼Œåå°„è¶Šæ˜æ˜¾ã€‚å¦‚æœä½ çœ‹å‘ä¸€ä¸ªåœ†çƒï¼Œé‚£åœ†çƒä¸­å¿ƒçš„åå°„è¾ƒå¼±ï¼Œé è¿‘è¾¹ç¼˜è¾ƒå¼ºã€‚ä¸è¿‡è¿™ç§è¿‡åº¦å…³ç³»è¢«æŠ˜å°„ç‡å½±å“ã€‚å¦‚æœä½ ç«™åœ¨æ¹–è¾¹ï¼Œä½å¤´çœ‹è„šä¸‹çš„æ°´ï¼Œä½ ä¼šå‘ç°æ°´æ˜¯é€æ˜çš„ï¼Œåå°„ä¸æ˜¯ç‰¹åˆ«å¼ºçƒˆï¼›å¦‚æœä½ çœ‹è¿œå¤„çš„æ¹–é¢ï¼Œä½ ä¼šå‘ç°æ°´å¹¶ä¸æ˜¯é€æ˜çš„ï¼Œä½†åå°„éå¸¸å¼ºçƒˆã€‚è¿™å°±æ˜¯â€œè²æ¶…å°”æ•ˆåº”â€</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="å›¾å½¢å­¦" scheme="https://silhouettesforyou.github.io/categories/%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
    
    <category term="Shader" scheme="https://silhouettesforyou.github.io/tags/Shader/"/>
    
    <category term="Unity" scheme="https://silhouettesforyou.github.io/tags/Unity/"/>
    
    <category term="è¯¾ç¨‹" scheme="https://silhouettesforyou.github.io/tags/%E8%AF%BE%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Unity Shader</title>
    <link href="https://silhouettesforyou.github.io/2022/11/25/46/"/>
    <id>https://silhouettesforyou.github.io/2022/11/25/46/</id>
    <published>2022-11-25T09:44:48.000Z</published>
    <updated>2023-12-10T07:38:09.404Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h3 id="é›¶æ•£çš„çŸ¥è¯†">é›¶æ•£çš„çŸ¥è¯†</h3><h4 id="æ™®é€šçº¹ç†ç»˜åˆ¶">æ™®é€šçº¹ç†ç»˜åˆ¶</h4><p>åœ¨ CG è¯­æ³•ä¸­ï¼Œå½“å±æ€§ä¸­å®šä¹‰äº†ä¸€ä¸ªçº¹ç†ç±»å‹çš„å˜é‡</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Properties &#123;</span><br><span class="line">    _MainTex(&quot;Main Texture&quot;, <span class="number">2</span>D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æƒ³è¦åœ¨ CGPROGRAM ä¸­å¼•ç”¨è¿™ä¸ªçº¹ç†ï¼Œå°±éœ€è¦å£°æ˜ä¸€ä¸ªé‡‡æ ·å™¨ï¼š</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">sampler2D</span> _MainTex;</span><br></pre></td></tr></table></figure><p>è€Œåœ¨ HLSL ä¸­ï¼Œ<code>sampler2D</code>è¿™ä¸ªå¯¹è±¡è¢«æ‹†åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå³çº¹ç†å¯¹è±¡å’Œé‡‡æ ·å™¨ï¼Œéœ€è¦åŒæ—¶å£°æ˜ä¸¤ä¸ªå˜é‡æ¥ä¿å­˜å®ƒä»¬ï¼š</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å£°æ˜ä¸»çº¹ç†å¹¶ä¸”ä¸ºä¸»çº¹ç†è®¾ç½®ä¸€ä¸ªé‡‡æ ·å™¨ï¼ˆè¿™æ˜¯ä¸€ç§å›ºå®šçš„æ ¼å¼ï¼‰</span></span><br><span class="line"><span class="comment">ä¸»çº¹ç†çš„å£°æ˜åŒå±æ€§çš„å£°æ˜ï¼Œæ³¨æ„ç±»å‹ä¸º TEXTURE2Dï¼Œé‡‡æ ·é€šè¿‡ SAMPLER æ¥å®šä¹‰ï¼Œæ‹¬å·ä¸­çš„åå­—ä¸ºé‡‡æ ·å™¨çš„å˜é‡åï¼Œ</span></span><br><span class="line"><span class="comment">å˜é‡åä¸º &lt;sampler_çº¹ç†å &gt;ï¼Œç”±äºè¿™é‡Œçš„çº¹ç†åä¸º MainTexï¼Œæ‰€ä»¥é‡‡æ ·å™¨ä¸º sampler_MainTex</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">TEXTURE2D(_MainTex);</span><br><span class="line">SAMPLER(sampler_MainTex);</span><br></pre></td></tr></table></figure><p>ä¹‹åéœ€è¦é€šè¿‡é‡‡æ ·å™¨å‡½æ•° <code>SAMPLE_TEXTURE2D</code> æ¥å¯¹å®ƒä»¬è¿›è¡Œé‡‡æ ·ï¼š</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">half4 albedo = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, i.uv);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="å›¾å½¢å­¦" scheme="https://silhouettesforyou.github.io/categories/%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
    
    <category term="Graphics" scheme="https://silhouettesforyou.github.io/tags/Graphics/"/>
    
    <category term="Shader" scheme="https://silhouettesforyou.github.io/tags/Shader/"/>
    
    <category term="Unity" scheme="https://silhouettesforyou.github.io/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity é¢è¯•</title>
    <link href="https://silhouettesforyou.github.io/2022/08/19/45/"/>
    <id>https://silhouettesforyou.github.io/2022/08/19/45/</id>
    <published>2022-08-19T09:20:05.000Z</published>
    <updated>2024-06-04T13:26:16.274Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="ä¸šåŠ¡">ä¸šåŠ¡</h2><h3 id="Unity- çš„è¿è¡Œæ—¶åº">Unity çš„è¿è¡Œæ—¶åº</h3><center>    <img src="/2022/08/19/45/monobehaviour-flowchart.svg"></center><h3 id="Unity- åƒåœ¾å›æ”¶æœºåˆ¶">Unity åƒåœ¾å›æ”¶æœºåˆ¶</h3><p>ç®€å•æ¥çœ‹ä¸‹ BDWGCï¼ˆå…¨ç§°ï¼šBoehm-Demers-Weiser conservative garbage collectorï¼‰ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ Boehm å›æ”¶å™¨ã€‚å…¶å®å®ƒé™¤äº†å›æ”¶ä¹‹å¤–è¿˜åšäº†å¾ˆå¤šåˆ†é…çš„å·¥ä½œï¼Œç”šè‡³è¿˜å¯ä»¥ç”¨æ¥æ£€æŸ¥å†…å­˜æ³„æ¼ã€‚</p><p>è€Œ Unity ç”¨çš„æ˜¯æ”¹è‰¯è¿‡çš„ BDWGCï¼Œå®ƒå±äºä¿å®ˆå¼å†…å­˜å›æ”¶ã€‚ç›®å‰ä¸»æµçš„å›æ”¶å™¨æœ‰å¦‚ä¸‹ä¸‰ç§ï¼š</p><ul><li>ä¿å®ˆå¼å›æ”¶ï¼ˆConservative GCï¼‰ï¼Œä»¥ Boehm ä¸ºä»£è¡¨ã€‚</li><li>åˆ†ä»£å¼å›æ”¶ï¼ˆGenerational GCï¼‰ï¼Œä»¥ SGenï¼ˆSimple Generational GCï¼‰ä¸ºä»£è¡¨ã€‚</li><li>å¼•ç”¨ï¼ˆè®¡æ•°ï¼‰å¼å†…å­˜å›æ”¶ï¼ˆReference Counting GCï¼‰ï¼Œä¾‹å¦‚ Java å°±æ˜¯ä½¿ç”¨çš„è¿™ç§ï¼Œä½†æ˜¯å®ƒæ˜¯ç»“åˆäº†ä¿å®ˆå¼çš„å¼•ç”¨å¼å†…å­˜å›æ”¶ã€‚<br>é‚£ä¹ˆä¸ºä»€ä¹ˆ Unity ä¸ç”¨åˆ†ä»£å¼çš„å‘¢ï¼Ÿåˆ†ä»£å¼çš„æ˜¯å¦æ›´å¥½å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œè™½ç„¶åˆ†ä»£å¼ç¡®å®æœ‰å¾ˆå¤šçš„ä¼˜ç‚¹ï¼Œä½†æ˜¯å®ƒä»¬éƒ½è¦ä»˜å‡ºé¢å¤–çš„ä»£ä»·ã€‚ä¾‹å¦‚åˆ†ä»£å¼çš„ GCï¼Œå®ƒè¦è¿›è¡Œå†…å­˜å—çš„ç§»åŠ¨ï¼Œä¸€å—å†…å­˜åœ¨é¢‘ç¹åˆ†é…åŒºé•¿æ—¶é—´ä¸åŠ¨çš„è¯ï¼Œä¼šè¢«ç§»åŠ¨åˆ°é•¿æ—¶åˆ†é…åŒºï¼Œé€ æˆé¢å¤–æ¶ˆè€—ã€‚å¦å¤–æ¯æ¬¡å›æ”¶çš„æ—¶å€™è¿˜è¦è¿›è¡Œä¸€ä¸ªè¯„ä¼°ï¼Œåˆ¤æ–­å½“å‰å†…å­˜æ˜¯å¦æ˜¯ä¸€ä¸ªæ´»è·ƒå†…å­˜ï¼Œè¿™äº›ä¸œè¥¿éƒ½ä¸æ˜¯å…è´¹çš„ï¼Œè€Œæ˜¯è¦æ¶ˆè€—é¢å¤–çš„ CPU æ€§èƒ½ã€‚å½“ç„¶ sGen ä¹Ÿæœ‰å®ƒçš„ä¼˜åŠ¿ï¼Œä¾‹å¦‚å®ƒæ˜¯å¯ç§»åŠ¨çš„ï¼Œå¯ä»¥è¿›è¡Œåˆå¹¶çš„ï¼ˆå¯ä»¥å‡å°‘å†…å­˜ç¢ç‰‡ï¼‰ç­‰ç­‰ã€‚ä½†æ˜¯åœ¨è®¡ç®—åŠ›æœ¬èº«å°±å¾ˆç´§å¼ çš„ç§»åŠ¨å¹³å°ä¸Šï¼Œå†èŠ±è´¹ CPU å»è®¡ç®—å†…å­˜çš„æ¬è¿å’Œç§»åŠ¨å®é™…ä¸Šæ˜¯ä¸åˆç®—çš„ï¼Œå¼•ç”¨è®¡æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„é—®é¢˜ï¼Œæ‰€ä»¥ unity è¿˜æ˜¯ä½¿ç”¨ç›¸å¯¹æ¯”è¾ƒä¿å®ˆçš„ Boehm å›æ”¶ã€‚</li></ul><h3 id="Unity- æ•°æ®æŒä¹…åŒ–ä½ ä½¿ç”¨è¿‡å“ªäº›ã€è¯´è¯´å®ƒä»¬ä¹‹é—´çš„ä¼˜ç¼ºç‚¹">Unity æ•°æ®æŒä¹…åŒ–ä½ ä½¿ç”¨è¿‡å“ªäº›ã€è¯´è¯´å®ƒä»¬ä¹‹é—´çš„ä¼˜ç¼ºç‚¹</h3><h4 id="PlayerPrefs">PlayerPrefs</h4><p>è¿™æ˜¯ Unity è‡ªå¸¦çš„è§£å†³æ–¹æ¡ˆï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶å­˜å‚¨äºæœ¬åœ°ï¼ŒAPI ç®€å•ï¼Œå°è£…äº†ç¹ççš„åºåˆ—åŒ–ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œä½†ä»–åªæ”¯æŒå‡ ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œ<code>string</code>ã€<code>int</code>ã€<code>float</code>ï¼Œæ¯”è¾ƒç®€å•çš„æ•°æ®å­˜è¯»å–åŠŸèƒ½çš„è¯ï¼Œç”¨è¿™ä¸ªä¼šæ¯”è¾ƒæ–¹ä¾¿ã€‚</p><h4 id="ScriptableObject">ScriptableObject</h4><p>ScriptableObject å¹¶ä¸ä¾èµ–äºæ¸¸æˆå¯¹è±¡ï¼ˆGameObjectï¼‰ï¼Œä¹Ÿä¸å—åœºæ™¯åŠ è½½å’Œå¸è½½çš„å½±å“ã€‚å®ƒçš„ç”Ÿå‘½å‘¨æœŸç”± Unity å¼•æ“ç®¡ç†</p><h4 id="åºåˆ—åŒ–ï¼šJsonã€XMLã€äºŒè¿›åˆ¶">åºåˆ—åŒ–ï¼šJsonã€XMLã€äºŒè¿›åˆ¶</h4><p>å…³äºåºåˆ—åŒ–ï¼š</p><ul><li>å¿…é¡»æ˜¯ <code>public</code> ç±»ï¼Œå…¶ä¸­çš„å­—æ®µæˆ–å±æ€§å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„</li><li>ç±»ä¸­çš„æ–¹æ³•ä¸ä¼šè¢«åºåˆ—åŒ–</li><li>æ„é€ å‡½æ•°ä¸å¯è¢«åºåˆ—åŒ–</li><li>ä¸å¯è¢«åºåˆ—åŒ–çš„æ•°æ®ç±»å‹ï¼š<ul><li>é™æ€ç±»æˆ–é™æ€æˆå‘˜</li><li>å§”æ‰˜</li><li>äº‹ä»¶</li><li>æŒ‡é’ˆ</li><li>ç´¢å¼•å™¨</li></ul></li></ul><p>Json æ˜¯å­—ç¬¦ä¸²æ–‡æœ¬ï¼Œå¯ä»¥å­˜å‚¨å¤æ‚ä¸€ç‚¹çš„å¯¹è±¡ï¼›XML ä¸€æ ·å¯ä»¥å­˜å‚¨å¤æ‚æ•°æ®å¯¹è±¡ï¼Œç›¸è¾ƒäº Json ä¼˜ç‚¹æ˜¯å¯è¯»æ€§è‰¯å¥½ï¼Œä½†æ•ˆç‡è¾ƒä½ï¼Œé€‚åˆå¤§é‡çš„æ•°æ®é…ç½®ï¼›äºŒè¿›åˆ¶å°±æ˜¯ 01 åºåˆ—ï¼Œåœ¨æ•°æ®å­˜å‚¨å’Œä¼ è¾“æ•ˆç‡ã€ç´§å‡‘æ€§å’Œé€Ÿåº¦ä¸Šå æœ‰ä¼˜åŠ¿ï¼ˆProtoBufã€MessagePackï¼‰</p><h4 id="å‡ ä¸ªå« -Serialize- çš„ç›¸å…³å±æ€§">å‡ ä¸ªå« Serialize çš„ç›¸å…³å±æ€§</h4><ul><li><code>Serializable</code>æ˜¯ä¸€ä¸ª C# ä¸­çš„ç‰¹æ€§ï¼Œå®ƒå‘Šè¯‰ç¼–è¯‘å™¨è¿™ä¸ªç±»æ˜¯å¯ä»¥è¢«åºåˆ—åŒ–</li><li><code>SerializeReference</code>æ˜¯ Unity 2019.3 å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œç”¨äºå¤„ç†å¤šæ€å¯¹è±¡çš„åºåˆ—åŒ–ï¼Œä½¿å¾—å¯ä»¥åœ¨ Inspector çª—å£ä¸­ä¸ºè¯¥å­—æ®µåˆ†é…ä»»æ„ç»§æ‰¿è‡ªåŒæ„çˆ¶ç±»çš„å¯¹è±¡</li><li><code>SerializeField</code>è¿™ä¸ªæ˜¯æŠŠ <code>private</code> å˜é‡æš´éœ²åˆ° Inspector ä¸­</li></ul><h2 id="C">C#</h2><h3 id="List- çš„åº•å±‚åŸç†ã€Dictionary- çš„åº•å±‚åŸç†">List çš„åº•å±‚åŸç†ã€Dictionary çš„åº•å±‚åŸç†</h3><h4 id="List- åº•å±‚å®ç°æµ…æ">List åº•å±‚å®ç°æµ…æ</h4><h5 id="Add"><code>Add</code></h5><p>åœ¨ <code>Add</code> å‰ï¼Œéƒ½ä¼šè°ƒç”¨ <code>EnsureCapacity</code> æ¥ä¿è¯æœ‰å……è¶³çš„ç©ºé—´å­˜æ”¾å…ƒç´ ï¼Œå¦‚æœå®¹é‡ä¸è¶³ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹ï¼Œæ¯æ¬¡å®¹é‡ä¸å¤Ÿçš„æ—¶å€™ï¼Œæ•´ä¸ªæ•°ç»„çš„å®¹é‡éƒ½ä¼šæ‰©å……ä¸€å€ï¼Œ<code>_defaultCapacity</code>æ˜¯å®¹é‡çš„é»˜è®¤å€¼ä¸º 4ã€‚å› æ­¤æ•´ä¸ªæ‰©å……çš„è·¯çº¿ä¸º 4ï¼Œ8ï¼Œ16ï¼Œ32ï¼Œ64ï¼Œ128ï¼Œ256ï¼Œ512ï¼Œ1024ï¼Œâ€¦â€¦ä»¥æ­¤ç±»æ¨</p><blockquote><p>List ä½¿ç”¨æ•°ç»„å½¢å¼ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„ï¼Œå¥½å¤„æ˜¯ä½¿ç”¨ç´¢å¼•æ–¹å¼æå–å…ƒç´ å¾ˆå¿«ï¼Œä½†åœ¨æ‰©å®¹çš„æ—¶å€™å°±ä¼šå¾ˆç³Ÿç³•ï¼Œæ¯æ¬¡ new æ•°ç»„éƒ½ä¼šé€ æˆå†…å­˜åƒåœ¾ï¼Œè¿™ç»™åƒåœ¾å›æ”¶ GC å¸¦æ¥äº†å¾ˆå¤šè´Ÿæ‹…</p></blockquote><h5 id="Insert"><code>Insert</code></h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Insert</span>(<span class="params"><span class="built_in">int</span> index, T item</span>)</span> {</span><br><span class="line">    <span class="comment">// Note that insertions at the end are legal.</span></span><br><span class="line">    <span class="keyword">if</span> ((<span class="built_in">uint</span>) index &gt; (<span class="built_in">uint</span>)_size) {</span><br><span class="line">        ThrowHelper.ThrowArgumentOutOfRangeException(ExceptionArgument.index, ExceptionResource.ArgumentOutOfRange_ListInsert);</span><br><span class="line">    }</span><br><span class="line">    Contract.EndContractBlock();</span><br><span class="line">    <span class="keyword">if</span> (_size == _items.Length) EnsureCapacity(_size + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (index &lt; _size) {</span><br><span class="line">        Array.Copy(_items, index, _items, index + <span class="number">1</span>, _size - index);</span><br><span class="line">    }</span><br><span class="line">    _items[index] = item;</span><br><span class="line">    _size++;            </span><br><span class="line">    _version++;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>æ’å…¥çš„å…³é”®å°±æ˜¯ <code>Array.Copy(_items, index, _items, index +1, _size - index)</code>ï¼ŒæŠŠæŒ‡å®šç´¢å¼•åŠ  1 åˆ°æ•°ç»„æœ«å°¾çš„å…ƒç´ å‘åç§»åŠ¨ï¼Œç„¶åèµ‹å€¼ï¼Œè¿™ä¸ªè·Ÿæ•°ç»„çš„æ’å…¥åˆ é™¤ä¸€æ ·ï¼Œéƒ½è¦èŠ±è´¹<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> çš„æ—¶é—´å»æŒªåŠ¨æ•°ç»„</p><h5 id="Remove"><code>Remove</code></h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Remove</span>(<span class="params">T item</span>)</span> {</span><br><span class="line">    <span class="built_in">int</span> index = IndexOf(item);</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) {</span><br><span class="line">        RemoveAt(index);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RemoveAt</span>(<span class="params"><span class="built_in">int</span> index</span>)</span> {</span><br><span class="line">    <span class="keyword">if</span> ((<span class="built_in">uint</span>)index &gt;= (<span class="built_in">uint</span>)_size) {</span><br><span class="line">        ThrowHelper.ThrowArgumentOutOfRangeException();</span><br><span class="line">    }</span><br><span class="line">    Contract.EndContractBlock();</span><br><span class="line">    _size--;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; _size) {</span><br><span class="line">        Array.Copy(_items, index + <span class="number">1</span>, _items, index, _size - index);</span><br><span class="line">    }</span><br><span class="line">    _items[_size] = <span class="literal">default</span>(T);</span><br><span class="line">    _version++;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>åˆ é™¤è·Ÿæ’å…¥ç›¸åï¼Œ<code>Array.Copy(_items, index +1, _items, index, _size - index)</code>ï¼Œç”¨<code>IndexOf</code>ï¼ˆéå†ï¼‰æ‰¾åˆ°æŒ‡å®šå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ï¼Œç„¶åç”¨æŒ‡å®šç´¢å¼•åŠ  1 åˆ°æ•°ç»„æœ«å°¾çš„å…ƒç´ å‘å‰ç§»åŠ¨ï¼Œè¦†ç›–ã€‚è¿™ä¸ªæ­¥éª¤ï¼Œè¢«åˆ é™¤å…ƒç´ åé¢çš„æ•°éƒ½è¦å¾€å‰ç§»åŠ¨ï¼Œæ—¶é—´å¤æ‚åº¦<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></p><blockquote><p>åœ¨ä½¿ç”¨ List çš„æ—¶å€™ï¼Œè¦æ³¨æ„ï¼Œå¦‚æœè¿‡äºé¢‘ç¹ä½¿ç”¨çš„è¯ï¼Œä¼šå¯¼è‡´æ•ˆç‡é™ä½ï¼Œä¹Ÿä¼šé€ æˆä¸å°‘å†…å­˜çš„å†—ä½™ï¼Œä½¿å¾—åƒåœ¾å›æ”¶ (GC) æ—¶æ‰¿æ‹…äº†æ›´å¤šçš„å‹åŠ›</p></blockquote><h5 id="ç´¢å¼•">ç´¢å¼•</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="keyword">this</span>[<span class="built_in">int</span> index] {</span><br><span class="line">    <span class="keyword">get</span> {</span><br><span class="line">        <span class="comment">// Following trick can reduce the range check by one</span></span><br><span class="line">        <span class="keyword">if</span> ((<span class="built_in">uint</span>) index &gt;= (<span class="built_in">uint</span>)_size) {</span><br><span class="line">            ThrowHelper.ThrowArgumentOutOfRangeException();</span><br><span class="line">        }</span><br><span class="line">        Contract.EndContractBlock();</span><br><span class="line">        <span class="keyword">return</span> _items[index]; </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span> {</span><br><span class="line">        <span class="keyword">if</span> ((<span class="built_in">uint</span>) index &gt;= (<span class="built_in">uint</span>)_size) {</span><br><span class="line">            ThrowHelper.ThrowArgumentOutOfRangeException();</span><br><span class="line">        }</span><br><span class="line">        Contract.EndContractBlock();</span><br><span class="line">        _items[index] = <span class="keyword">value</span>;</span><br><span class="line">        _version++;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h5 id="Clear"><code>Clear</code></h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Clear</span>()</span> {</span><br><span class="line">    <span class="keyword">if</span> (_size &gt; <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">        Array.Clear(_items, <span class="number">0</span>, _size); <span class="comment">// Don't need to doc this but we clear the elements so that the gc can reclaim the references.</span></span><br><span class="line">        _size = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    _version++;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p><code>Clear</code>æ¥å£åœ¨è°ƒç”¨æ—¶å¹¶ä¸ä¼šåˆ é™¤æ•°ç»„ï¼Œè€Œåªæ˜¯å°†æ•°ç»„ä¸­çš„å…ƒç´ æ¸…é›¶ï¼Œå¹¶è®¾ç½® <code>_size</code> ä¸º 0 è€Œå·²ï¼Œç”¨äºè™šæ‹Ÿåœ°è¡¨æ˜å½“å‰å®¹é‡ä¸º 0</p><h5 id="foreach"><code>foreach</code></h5><p>å·²ç»åœ¨ unity5.5 è§£å†³ä¹‹å‰ï¼Œ<code>foreach</code>æ¯æ¬¡è·å–è¿­ä»£å™¨æ—¶ï¼Œä¼šæ–°å»ºä¸€ä¸ª<code>Enumerator</code>ï¼Œå¦‚æœå¤§é‡ä½¿ç”¨è¿­ä»£å™¨çš„è¯å°±ä¼šé€ æˆå¤§é‡çš„åƒåœ¾å¯¹è±¡ï¼Œåœ¨ unity5.5 è§£å†³ä¹‹åå°±ä¸ä¼šäº§ç”Ÿé¢å¤–çš„ GC äº†</p><h5 id="Sort"><code>Sort</code></h5><p><code>Array.Sort</code>ä½¿ç”¨çš„æ˜¯å¿«é€Ÿæ’åºæ–¹å¼è¿›è¡Œæ’åºï¼ŒList çš„ <code>Sort</code> æ’åºçš„æ•ˆç‡ä¸º<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="9.26ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4092.9 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="msup" transform="translate(1918.7,0)"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"/><path data-c="6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" transform="translate(278,0)"/><path data-c="67" d="M329 409Q373 453 429 453Q459 453 472 434T485 396Q485 382 476 371T449 360Q416 360 412 390Q410 404 415 411Q415 412 416 414V415Q388 412 363 393Q355 388 355 386Q355 385 359 381T368 369T379 351T388 325T392 292Q392 230 343 187T222 143Q172 143 123 171Q112 153 112 133Q112 98 138 81Q147 75 155 75T227 73Q311 72 335 67Q396 58 431 26Q470 -13 470 -72Q470 -139 392 -175Q332 -206 250 -206Q167 -206 107 -175Q29 -140 29 -75Q29 -39 50 -15T92 18L103 24Q67 55 67 108Q67 155 96 193Q52 237 52 292Q52 355 102 398T223 442Q274 442 318 416L329 409ZM299 343Q294 371 273 387T221 404Q192 404 171 388T145 343Q142 326 142 292Q142 248 149 227T179 192Q196 182 222 182Q244 182 260 189T283 207T294 227T299 242Q302 258 302 292T299 343ZM403 -75Q403 -50 389 -34T348 -11T299 -2T245 0H218Q151 0 138 -6Q118 -15 107 -34T95 -74Q95 -84 101 -97T122 -127T170 -155T250 -167Q319 -167 361 -139T403 -75Z" transform="translate(778,0)"/></g><g data-mml-node="mi" transform="translate(1311,421.1) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g></g><g data-mml-node="mo" transform="translate(3703.9,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>ã€‚</p><h4 id="Dictionary- åº•å±‚å®ç°æµ…æ">Dictionary åº•å±‚å®ç°æµ…æ</h4><h5 id="Entry ç»“æ„ä½“"><code>Entry</code>ç»“æ„ä½“</h5><p>Dictionary ç§å­˜æ”¾æ•°æ®çš„æœ€å°å•ä½ï¼Œè°ƒç”¨ <code>Add(Key, Value)</code> æ–¹æ³•æ·»åŠ çš„å…ƒç´ éƒ½ä¼šè¢«å°è£…åœ¨è¿™æ ·çš„ä¸€ä¸ªç»“æ„ä½“ä¸­</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">struct</span> Entry {</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> hashCode;    <span class="comment">// é™¤ç¬¦å·ä½ä»¥å¤–çš„ 31 ä½ hashCode å€¼ï¼Œå¦‚æœè¯¥ Entry æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆä¸º -1</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> next;        <span class="comment">// ä¸‹ä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ä¸‹ä¸€ä¸ªå°±ä¸º -1</span></span><br><span class="line">    <span class="keyword">public</span> TKey key;        <span class="comment">// å­˜æ”¾å…ƒç´ çš„é”®</span></span><br><span class="line">    <span class="keyword">public</span> TValue <span class="keyword">value</span>;    <span class="comment">// å­˜æ”¾å…ƒç´ çš„å€¼</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>é™¤äº† Entry ç»“æ„ä½“å¤–ï¼Œè¿˜æœ‰å‡ ä¸ªå…³é”®çš„ç§æœ‰å˜é‡</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">int</span>[] buckets;<span class="comment">// Hash æ¡¶</span></span><br><span class="line"><span class="keyword">private</span> Entry[] entries;<span class="comment">// Entry æ•°ç»„ï¼Œå­˜æ”¾å…ƒç´ </span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">int</span> count;<span class="comment">// å½“å‰ entries çš„ index ä½ç½®</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">int</span> version;<span class="comment">// å½“å‰ç‰ˆæœ¬ï¼Œé˜²æ­¢è¿­ä»£è¿‡ç¨‹ä¸­é›†åˆè¢«æ›´æ”¹</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">int</span> freeList;<span class="comment">// è¢«åˆ é™¤ Entry åœ¨ entries ä¸­çš„ä¸‹æ ‡ indexï¼Œè¿™ä¸ªä½ç½®æ˜¯ç©ºé—²çš„</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">int</span> freeCount;<span class="comment">// æœ‰å¤šå°‘ä¸ªè¢«åˆ é™¤çš„ Entryï¼Œæœ‰å¤šå°‘ä¸ªç©ºé—²çš„ä½ç½®</span></span><br><span class="line"><span class="keyword">private</span> IEqualityComparer&lt;TKey&gt; comparer;<span class="comment">// æ¯”è¾ƒå™¨</span></span><br><span class="line"><span class="keyword">private</span> KeyCollection keys;<span class="comment">// å­˜æ”¾ Key çš„é›†åˆ</span></span><br><span class="line"><span class="keyword">private</span> ValueCollection values;<span class="comment">// å­˜æ”¾ Value çš„é›†åˆ</span></span><br></pre></td></tr></table></figure><h5 id="Add- æ“ä½œ">Add æ“ä½œ</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Add</span>(<span class="params">TKey key, TValue <span class="keyword">value</span></span>)</span> {</span><br><span class="line">    Insert(key, <span class="keyword">value</span>, <span class="literal">true</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Insert</span>(<span class="params">TKey key, TValue <span class="keyword">value</span>, <span class="built_in">bool</span> <span class="keyword">add</span></span>)</span>{</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(key == <span class="literal">null</span> ) {</span><br><span class="line">        ThrowHelper.ThrowArgumentNullException(ExceptionArgument.key);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (buckets == <span class="literal">null</span>) Initialize(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// é€šè¿‡ key è·å– hashCode</span></span><br><span class="line">    <span class="built_in">int</span> hashCode = comparer.GetHashCode(key) &amp; <span class="number">0x7FFFFFFF</span>;</span><br><span class="line">    <span class="comment">// è®¡ç®—å‡ºç›®æ ‡ bucket ä¸‹æ ‡</span></span><br><span class="line">    <span class="built_in">int</span> targetBucket = hashCode % buckets.Length;</span><br><span class="line"><span class="comment">// ç¢°æ’æ¬¡æ•°</span></span><br><span class="line">    <span class="built_in">int</span> collisionCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = buckets[targetBucket]; i &gt;= <span class="number">0</span>; i = entries[i].next) {</span><br><span class="line">        <span class="keyword">if</span> (entries[i].hashCode == hashCode &amp;&amp; comparer.Equals(entries[i].key, key)) {</span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯å¢åŠ æ“ä½œï¼Œéå†åˆ°äº†ç›¸åŒçš„å…ƒç´ ï¼Œé‚£ä¹ˆæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">add</span>) {</span><br><span class="line">ThrowHelper.ThrowArgumentException(ExceptionResource.Argument_AddingDuplicate);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// å¦‚æœä¸æ˜¯å¢åŠ æ“ä½œï¼Œé‚£å¯èƒ½æ˜¯ç´¢å¼•èµ‹å€¼æ“ä½œ dictionary["foo"] = "foo"</span></span><br><span class="line">            <span class="comment">// é‚£ä¹ˆèµ‹å€¼åç‰ˆæœ¬ ++ï¼Œé€€å‡º</span></span><br><span class="line">            entries[i].<span class="keyword">value</span> = <span class="keyword">value</span>;</span><br><span class="line">            version++;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æ¯éå†ä¸€ä¸ªå…ƒç´ ï¼Œéƒ½æ˜¯ä¸€æ¬¡ç¢°æ’</span></span><br><span class="line">        collisionCount++;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">int</span> index;</span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰è¢«åˆ é™¤çš„å…ƒç´ ï¼Œé‚£ä¹ˆå°†å…ƒç´ æ”¾åˆ°è¢«åˆ é™¤å…ƒç´ çš„ç©ºé—²ä½ç½®</span></span><br><span class="line">    <span class="keyword">if</span> (freeCount &gt; <span class="number">0</span>) {</span><br><span class="line">        index = freeList;</span><br><span class="line">        freeList = entries[index].next;</span><br><span class="line">        freeCount--;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰ entries å·²æ»¡ï¼Œé‚£ä¹ˆè§¦å‘æ‰©å®¹</span></span><br><span class="line">        <span class="keyword">if</span> (count == entries.Length)</span><br><span class="line">        {</span><br><span class="line">            Resize();</span><br><span class="line">            targetBucket = hashCode % buckets.Length;</span><br><span class="line">        }</span><br><span class="line">        index = count;</span><br><span class="line">        count++;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»™ entry èµ‹å€¼</span></span><br><span class="line">    entries[index].hashCode = hashCode;</span><br><span class="line">    entries[index].next = buckets[targetBucket];</span><br><span class="line">    entries[index].key = key;</span><br><span class="line">    entries[index].<span class="keyword">value</span> = <span class="keyword">value</span>;</span><br><span class="line">    buckets[targetBucket] = index;</span><br><span class="line">    <span class="comment">// ç‰ˆæœ¬å· ++</span></span><br><span class="line">    version++;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœç¢°æ’æ¬¡æ•°å¤§äºè®¾ç½®çš„æœ€å¤§ç¢°æ’æ¬¡æ•°ï¼Œé‚£ä¹ˆè§¦å‘ Hash ç¢°æ’æ‰©å®¹</span></span><br><span class="line">    <span class="keyword">if</span>(collisionCount &gt; HashHelpers.HashCollisionThreshold &amp;&amp; HashHelpers.IsWellKnownEqualityComparer(comparer)) </span><br><span class="line">    {</span><br><span class="line">        comparer = (IEqualityComparer&lt;TKey&gt;) HashHelpers.GetRandomizedEqualityComparer(comparer);</span><br><span class="line">        Resize(entries.Length, <span class="literal">true</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="Find- æ“ä½œ">Find æ“ä½œ</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯»æ‰¾ Entry å…ƒç´ çš„ä½ç½®</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">int</span> <span class="title">FindEntry</span>(<span class="params">TKey key</span>)</span> {</span><br><span class="line">    <span class="keyword">if</span>(key == <span class="literal">null</span>) {</span><br><span class="line">        ThrowHelper.ThrowArgumentNullException(ExceptionArgument.key);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (buckets != <span class="literal">null</span>) {</span><br><span class="line">        <span class="built_in">int</span> hashCode = comparer.GetHashCode(key) &amp; <span class="number">0x7FFFFFFF</span>; <span class="comment">// è·å– HashCodeï¼Œå¿½ç•¥ç¬¦å·ä½</span></span><br><span class="line">        <span class="comment">// int i = buckets[hashCode % buckets.Length] æ‰¾åˆ°å¯¹åº”æ¡¶ï¼Œç„¶åè·å– entry åœ¨ entries ä¸­ä½ç½®</span></span><br><span class="line">        <span class="comment">// i &gt;= 0; i = entries[i].next éå†å•é“¾è¡¨</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = buckets[hashCode % buckets.Length]; i &gt;= <span class="number">0</span>; i = entries[i].next) {</span><br><span class="line">            <span class="comment">// æ‰¾åˆ°å°±è¿”å›äº†</span></span><br><span class="line">            <span class="keyword">if</span> (entries[i].hashCode == hashCode &amp;&amp; comparer.Equals(entries[i].key, key)) <span class="keyword">return</span> i;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">internal</span> TValue <span class="title">GetValueOrDefault</span>(<span class="params">TKey key</span>)</span> {</span><br><span class="line">    <span class="built_in">int</span> i = FindEntry(key);</span><br><span class="line">    <span class="comment">// å¤§äºç­‰äº 0 ä»£è¡¨æ‰¾åˆ°äº†å…ƒç´ ä½ç½®ï¼Œç›´æ¥è¿”å› value</span></span><br><span class="line">    <span class="comment">// å¦åˆ™è¿”å›è¯¥ç±»å‹çš„é»˜è®¤å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (i &gt;= <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> entries[i].<span class="keyword">value</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">default</span>(TValue);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">TryGetValue</span>(<span class="params">TKey key, <span class="keyword">out</span> TValue <span class="keyword">value</span></span>)</span> {</span><br><span class="line">    <span class="built_in">int</span> i = FindEntry(key);</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">value</span> = entries[i].<span class="keyword">value</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">value</span> = <span class="literal">default</span>(TValue);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h5 id="Remove- æ“ä½œ">Remove æ“ä½œ</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Remove</span>(<span class="params">TKey key</span>)</span> {</span><br><span class="line">    <span class="keyword">if</span>(key == <span class="literal">null</span>) {</span><br><span class="line">        ThrowHelper.ThrowArgumentNullException(ExceptionArgument.key);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (buckets != <span class="literal">null</span>) {</span><br><span class="line">        <span class="comment">// 1. é€šè¿‡ key è·å– hashCode</span></span><br><span class="line">        <span class="built_in">int</span> hashCode = comparer.GetHashCode(key) &amp; <span class="number">0x7FFFFFFF</span>;</span><br><span class="line">        <span class="comment">// 2. å–ä½™è·å– bucket ä½ç½®</span></span><br><span class="line">        <span class="built_in">int</span> bucket = hashCode % buckets.Length;</span><br><span class="line">        <span class="comment">// last ç”¨äºç¡®å®šæ˜¯å¦å½“å‰ bucket çš„å•é“¾è¡¨ä¸­æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        <span class="built_in">int</span> last = <span class="number">-1</span>;</span><br><span class="line">        <span class="comment">// 3. éå† bucket å¯¹åº”çš„å•é“¾è¡¨</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = buckets[bucket]; i &gt;= <span class="number">0</span>; last = i, i = entries[i].next) {</span><br><span class="line">            <span class="keyword">if</span> (entries[i].hashCode == hashCode &amp;&amp; comparer.Equals(entries[i].key, key)) {</span><br><span class="line">                <span class="comment">// 4. æ‰¾åˆ°å…ƒç´ åï¼Œå¦‚æœ last&lt; 0ï¼Œä»£è¡¨å½“å‰æ˜¯ bucket ä¸­æœ€åä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆç›´æ¥è®© bucket å†…ä¸‹æ ‡èµ‹å€¼ä¸º entries[i].next å³å¯</span></span><br><span class="line">                <span class="keyword">if</span> (last &lt; <span class="number">0</span>) {</span><br><span class="line">                    buckets[bucket] = entries[i].next;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span> {</span><br><span class="line">                    <span class="comment">// 4.1 last ä¸å°äº 0ï¼Œä»£è¡¨å½“å‰å…ƒç´ å¤„äº bucket å•é“¾è¡¨ä¸­é—´ä½ç½®ï¼Œéœ€è¦å°†è¯¥å…ƒç´ çš„å¤´ç»“ç‚¹å’Œå°¾èŠ‚ç‚¹ç›¸è¿èµ·æ¥ï¼Œé˜²æ­¢é“¾è¡¨ä¸­æ–­</span></span><br><span class="line">                    entries[last].next = entries[i].next;</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// 5. å°† Entry ç»“æ„ä½“å†…æ•°æ®åˆå§‹åŒ–</span></span><br><span class="line">                entries[i].hashCode = <span class="number">-1</span>;</span><br><span class="line">                <span class="comment">// 5.1 å»ºç«‹ freeList å•é“¾è¡¨</span></span><br><span class="line">                entries[i].next = freeList;</span><br><span class="line">                entries[i].key = <span class="literal">default</span>(TKey);</span><br><span class="line">                entries[i].<span class="keyword">value</span> = <span class="literal">default</span>(TValue);</span><br><span class="line">                <span class="comment">// *6. å…³é”®çš„ä»£ç ï¼ŒfreeList ç­‰äºå½“å‰çš„ entry ä½ç½®ï¼Œä¸‹ä¸€æ¬¡ Add å…ƒç´ ä¼šä¼˜å…ˆ Add åˆ°è¯¥ä½ç½®</span></span><br><span class="line">                freeList = i;</span><br><span class="line">                freeCount++;</span><br><span class="line">                <span class="comment">// 7. ç‰ˆæœ¬å· +1</span></span><br><span class="line">                version++;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h5 id="Resize- æ“ä½œï¼ˆæ‰©å®¹ï¼‰">Resize æ“ä½œï¼ˆæ‰©å®¹ï¼‰</h5><p>ä¸¤ç§æƒ…å†µä¼šå‘ç”Ÿæ‰©å®¹æ“ä½œï¼š</p><ul><li><code>entries</code>æ•°ç»„æ»¡äº†ï¼Œæ²¡æœ‰åŠæ³•ç»§ç»­å­˜æ”¾æ–°çš„å…ƒç´ </li><li>Dictionary ä¸­å‘ç”Ÿçš„ç¢°æ’æ¬¡æ•°å¤ªå¤šï¼Œä¼šä¸¥é‡å½±å“æ€§èƒ½ï¼Œä¹Ÿä¼šè§¦å‘æ‰©å®¹æ“ä½œ</li></ul><blockquote><p>ç›®å‰ã€‚Net Framwork 4.7 ä¸­è®¾ç½®çš„ç¢°æ’æ¬¡æ•°é˜ˆå€¼ä¸º 100</p></blockquote><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Resize</span>()</span> {</span><br><span class="line">    Resize(HashHelpers.ExpandPrime(count), <span class="literal">false</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Resize</span>(<span class="params"><span class="built_in">int</span> newSize, <span class="built_in">bool</span> forceNewHashCodes</span>)</span> {</span><br><span class="line">    Contract.Assert(newSize &gt;= entries.Length);</span><br><span class="line">    <span class="comment">// 1. ç”³è¯·æ–°çš„ Buckets å’Œ entries</span></span><br><span class="line">    <span class="built_in">int</span>[] newBuckets = <span class="keyword">new</span> <span class="built_in">int</span>[newSize];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; newBuckets.Length; i++) newBuckets[i] = <span class="number">-1</span>;</span><br><span class="line">    Entry[] newEntries = <span class="keyword">new</span> Entry[newSize];</span><br><span class="line">    <span class="comment">// 2. å°† entries å†…å…ƒç´ æ‹·è´åˆ°æ–°çš„ entries æ€»</span></span><br><span class="line">    Array.Copy(entries, <span class="number">0</span>, newEntries, <span class="number">0</span>, count);</span><br><span class="line">    <span class="comment">// 3. å¦‚æœæ˜¯ Hash ç¢°æ’æ‰©å®¹ï¼Œä½¿ç”¨æ–° HashCode å‡½æ•°é‡æ–°è®¡ç®— Hash å€¼</span></span><br><span class="line">    <span class="keyword">if</span>(forceNewHashCodes) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; count; i++) {</span><br><span class="line">            <span class="keyword">if</span>(newEntries[i].hashCode != <span class="number">-1</span>) {</span><br><span class="line">                newEntries[i].hashCode = (comparer.GetHashCode(newEntries[i].key) &amp; <span class="number">0x7FFFFFFF</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 4. ç¡®å®šæ–°çš„ bucket ä½ç½®</span></span><br><span class="line">    <span class="comment">// 5. é‡å»º Hahs å•é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; count; i++) {</span><br><span class="line">        <span class="keyword">if</span> (newEntries[i].hashCode &gt;= <span class="number">0</span>) {</span><br><span class="line">            <span class="built_in">int</span> bucket = newEntries[i].hashCode % newSize;</span><br><span class="line">            newEntries[i].next = newBuckets[bucket];</span><br><span class="line">            newBuckets[bucket] = i;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    buckets = newBuckets;</span><br><span class="line">    entries = newEntries;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="Collection- ç‰ˆæœ¬æ§åˆ¶">Collection ç‰ˆæœ¬æ§åˆ¶</h5><p>è¿­ä»£è¿‡ç¨‹ä¸­ä¸å…è®¸é›†åˆå‡ºç°å˜åŒ–ï¼Œå¦åˆ™ä¼šæŠ›å‡º <font color="#FF6D60">System.InvalidOperationException:â€œCollection was modified; enumeration operation may not execute.â€</font> è¿™æ ·çš„å¼‚å¸¸</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">internal</span> <span class="title">Enumerator</span>(<span class="params">Dictionary&lt;TKey,TValue&gt; dictionary, <span class="built_in">int</span> getEnumeratorRetType</span>)</span> {</span><br><span class="line">    <span class="keyword">this</span>.dictionary = dictionary;</span><br><span class="line">    version = dictionary.version;</span><br><span class="line">    index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.getEnumeratorRetType = getEnumeratorRetType;</span><br><span class="line">    current = <span class="keyword">new</span> KeyValuePair&lt;TKey, TValue&gt;();</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">MoveNext</span>()</span> {</span><br><span class="line">    <span class="keyword">if</span> (version != dictionary.version) {</span><br><span class="line">        ThrowHelper.ThrowInvalidOperationException(ExceptionResource.InvalidOperation_EnumFailedVersion);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// Use unsigned comparison since we set index to dictionary.count+1 when the enumeration ends.</span></span><br><span class="line">    <span class="comment">// dictionary.count+1 could be negative if dictionary.count is Int32.MaxValue</span></span><br><span class="line">    <span class="keyword">while</span> ((<span class="built_in">uint</span>)index &lt; (<span class="built_in">uint</span>)dictionary.count) {</span><br><span class="line">        <span class="keyword">if</span> (dictionary.entries[index].hashCode &gt;= <span class="number">0</span>) {</span><br><span class="line">            current = <span class="keyword">new</span> KeyValuePair&lt;TKey, TValue&gt;(dictionary.entries[index].key, dictionary.entries[index].<span class="keyword">value</span>);</span><br><span class="line">            index++;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line">        index++;</span><br><span class="line">    }</span><br><span class="line">    index = dictionary.count + <span class="number">1</span>;</span><br><span class="line">    current = <span class="keyword">new</span> KeyValuePair&lt;TKey, TValue&gt;();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>åœ¨è¿­ä»£å™¨åˆå§‹åŒ–æ—¶ï¼Œå°±ä¼šè®°å½• <code>dictionary.version</code> ç‰ˆæœ¬å·ï¼Œä¹‹åæ¯ä¸€æ¬¡è¿­ä»£è¿‡ç¨‹éƒ½ä¼šæ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´å°†æŠ›å‡ºå¼‚å¸¸ã€‚è¿™æ ·å°±é¿å…äº†åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¿®æ”¹äº†é›†åˆï¼Œé€ æˆå¾ˆå¤šè¯¡å¼‚çš„é—®é¢˜</p><h3 id="è£…ä¿®æ‹†ç®±">è£…ä¿®æ‹†ç®±</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> x = <span class="number">1023</span>;</span><br><span class="line"><span class="built_in">object</span> o = x; <span class="comment">// è£…ç®±</span></span><br><span class="line"><span class="built_in">int</span> y = (<span class="built_in">int</span>) o; <span class="comment">// æ‹†ç®±</span></span><br></pre></td></tr></table></figure><p>è£…ç®±ï¼šå€¼ç±»å‹è½¬æ¢ä¸ºå¼•ç”¨å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯è½¬æ¢ä¸º System.Object ç±»å‹æˆ–å€¼ç±»å‹å®ç°çš„æ¥å£å¼•ç”¨ç±»å‹</p><ul><li>åœ¨å †ä¸­ç”³è¯·å†…å­˜ï¼Œå†…å­˜å¤§å°ä¸ºå€¼ç±»å‹çš„å¤§å°ï¼Œå†åŠ ä¸Šé¢å¤–å›ºå®šç©ºé—´ï¼ˆå¼•ç”¨ç±»å‹çš„æ ‡é…ï¼š<code>TypeHandle</code>å’ŒåŒæ­¥ç´¢å¼•å—ï¼‰</li><li>å°†å€¼ç±»å‹çš„å­—æ®µå€¼ï¼ˆ<code>x = 1023</code>ï¼‰æ‹·è´æ–°åˆ†é…çš„å†…å­˜ä¸­</li><li>è¿”å›æ–°å¼•ç”¨å¯¹è±¡çš„åœ°å€ï¼ˆç»™å¼•ç”¨å˜é‡<code>object o</code>ï¼‰</li></ul><p>æ‹†ç®±ï¼šå¼•ç”¨ç±»å‹è½¬æ¢ä¸ºå€¼ç±»å‹ï¼Œæ³¨æ„ï¼Œè¿™é‡Œçš„å¼•ç”¨ç±»å‹åªèƒ½æ˜¯è¢«è£…ç®±çš„å¼•ç”¨ç±»å‹å¯¹è±¡</p><ul><li>æ£€æŸ¥å®ä¾‹å¯¹è±¡ï¼ˆ<code>object o</code>ï¼‰æ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æ˜¯å¦ä¸º<code>null</code>ï¼Œåˆ¤æ–­å…¶è£…ç®±çš„ç±»å‹ä¸æ‹†ç®±çš„ç±»å‹ï¼ˆ<code>int</code>ï¼‰æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æ£€æµ‹ä¸åˆæ³•ï¼ŒæŠ›å‡ºå¼‚å¸¸</li><li>æŒ‡é’ˆè¿”å›ï¼Œå°±æ˜¯è·å–è£…ç®±å¯¹è±¡ï¼ˆ<code>object o</code>ï¼‰ä¸­å€¼ç±»å‹å­—æ®µå€¼çš„åœ°å€</li><li>å­—æ®µæ‹·è´ï¼ŒæŠŠè£…ç®±å¯¹è±¡ï¼ˆ<code>object o</code>ï¼‰ä¸­å€¼ç±»å‹å­—æ®µå€¼æ‹·è´åˆ°æ ˆä¸Šï¼Œæ„æ€å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å€¼ç±»å‹å˜é‡æ¥å­˜å‚¨æ‹†ç®±åçš„å€¼</li></ul><blockquote><ul><li>åªæœ‰å€¼ç±»å‹æ‰æœ‰è£…ç®±ã€æ‹†ç®±ä¸¤ä¸ªçŠ¶æ€ï¼Œè€Œå¼•ç”¨ç±»å‹ä¸€ç›´éƒ½åœ¨ç®±å­é‡Œ</li><li>ä¸€èˆ¬æ¥è¯´ï¼Œè£…ç®±çš„æ€§èƒ½å¼€é”€æ›´å¤§ï¼Œå› ä¸ºå¼•ç”¨å¯¹è±¡çš„åˆ†é…æ›´åŠ å¤æ‚ï¼Œæˆæœ¬ä¹Ÿæ›´é«˜ï¼Œå€¼ç±»å‹åˆ†é…åœ¨æ ˆä¸Šï¼Œåˆ†é…å’Œé‡Šæ”¾çš„æ•ˆç‡éƒ½å¾ˆé«˜ã€‚è£…ç®±è¿‡ç¨‹æ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¼•ç”¨ç±»å‹å¯¹è±¡å®ä¾‹ï¼Œæ‹†ç®±è¿‡ç¨‹éœ€è¦åˆ›å»ºä¸€ä¸ªå€¼ç±»å‹å­—æ®µï¼Œå¼€é”€æ›´ä½</li></ul></blockquote><h3 id="äº‹ä»¶å§”æ‰˜">äº‹ä»¶å§”æ‰˜</h3><p>å§”æ‰˜æ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒå®šä¹‰äº†æ–¹æ³•çš„ç±»å‹ï¼Œä½¿å¾—å¯ä»¥å°†æ–¹æ³•å½“ä½œå¦ä¸€ä¸ªæ–¹æ³•çš„å‚æ•°æ¥è¿›è¡Œä¼ é€’ï¼Œäº‹ä»¶æ˜¯ä¸€ç§ç‰¹æ®Šçš„å§”æ‰˜</p><h4 id="å§”æ‰˜">å§”æ‰˜</h4><p>å§”æ‰˜ï¼Œæ˜¯ä¸€ç§å­˜å‚¨å‡½æ•°å¼•ç”¨çš„ç±»å‹ã€‚å£°æ˜ä¸€ä¸ªå§”æ‰˜ä¸å£°æ˜å‡½æ•°ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºä¸åŒ…å«å‡½æ•°ä½“ï¼Œéœ€è¦ä½¿ç”¨å…³é”®å­—<code>delegate</code>ã€‚ä¸€ä¸ªå§”æ‰˜åŒ…å«å…¶å¯ä»¥å¼•ç”¨çš„å‡½æ•°ç­¾åï¼ˆè¿”å›ç±»å‹å’Œå‚æ•°åˆ—è¡¨ï¼‰</p><p>å¯¹äºå§”æ‰˜çš„åˆå§‹åŒ–èµ‹å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ç§è¯­æ³•ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•ä¸€</span></span><br><span class="line"><span class="function"><span class="built_in">delegate</span> <span class="built_in">double</span> <span class="title">ProcessDelegate</span>(<span class="params"><span class="built_in">double</span> arg1, <span class="built_in">double</span> arg2</span>)</span>;</span><br><span class="line">ProcessDelegate process;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•äºŒ</span></span><br><span class="line">process = <span class="keyword">new</span> ProcessDelegate(Multiply) <span class="comment">// double Multiply(double arg1, double arg2)</span></span><br><span class="line">process = Divide; <span class="comment">// double Divide(double arg1, double arg2)</span></span><br></pre></td></tr></table></figure><p>å§”æ‰˜å¯¹è±¡å¯ä½¿ç”¨ <code>+</code> è¿ç®—ç¬¦è¿›è¡Œåˆå¹¶ã€‚ä¸€ä¸ªåˆå¹¶å§”æ‰˜è°ƒç”¨å®ƒæ‰€åˆå¹¶çš„ä¸¤ä¸ªå§”æ‰˜ã€‚åªæœ‰ç›¸åŒç±»å‹çš„å§”æ‰˜å¯è¢«åˆå¹¶ã€‚<code>-</code>è¿ç®—ç¬¦å¯ç”¨äºä»åˆå¹¶çš„å§”æ‰˜ä¸­ç§»é™¤ç»„ä»¶å§”æ‰˜ã€‚è¿™æ ·å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªå§”æ‰˜è¢«è°ƒç”¨æ—¶è¦è°ƒç”¨çš„æ–¹æ³•çš„è°ƒç”¨åˆ—è¡¨ã€‚ä½†æ˜¯å¤šæ’­å§”æ‰˜çš„è°ƒç”¨é¡ºåºæ— æ³•ä¿è¯</p><h4 id="å§”æ‰˜çš„ç±»å‹ï¼šdelegateã€Actionã€Funcã€predicate">å§”æ‰˜çš„ç±»å‹ï¼š<code>delegate</code>ã€<code>Action</code>ã€<code>Func</code>ã€<code>predicate</code></h4><ul><li><code>delegate</code>ï¼šè‡³å°‘ 0 ä¸ªå‚æ•°ï¼Œè‡³å¤š 32 ä¸ªå‚æ•°ï¼Œå¯ä»¥æ— è¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šè¿”å›å€¼ç±»å‹</li><li><code>Action</code>ï¼šæ˜¯æ— è¿”å›å€¼çš„æ³›å‹å§”æ‰˜</li><li><code>Func</code>ï¼šæ˜¯æœ‰è¿”å›å€¼çš„æ³›å‹å§”æ‰˜</li><li><code>predicate</code>ï¼šæ˜¯è¿”å› bool å‹çš„æ³›å‹å§”æ‰˜</li></ul><h4 id="äº‹ä»¶">äº‹ä»¶</h4><p>äº‹ä»¶ç±»ä¼¼äºå¼‚å¸¸ï¼Œéƒ½ç”±å¯¹è±¡å¼•å‘ï¼ˆæˆ–æŠ›å‡ºï¼‰ï¼Œç„¶åé€šè¿‡æä¾›çš„ä»£ç è¿›è¡Œå¤„ç†ã€‚äº‹ä»¶éœ€è¦åœ¨å¤„ç†ä¹‹å‰è¿›è¡Œè®¢é˜…ï¼ˆ subscribe ï¼‰ï¼Œè¡¨ç¤ºæä¾›äº†åœ¨äº‹ä»¶å‘ç”Ÿæ—¶éœ€è¦æ‰§è¡Œçš„ä»£ç ï¼Œå³äº‹ä»¶å¤„ç†ç¨‹åºã€‚C# ä¸­çš„äº‹ä»¶ <code>event</code> å…³é”®å­—æ˜¯è¯­è¨€å±‚é¢çš„ <font color="#FF6D60"> è§‚å¯Ÿè€…æ¨¡å¼ </font> çš„å®ç°ï¼Œå°†äº‹ä»¶çš„å‘èµ·è€…ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰ä¸å¤„ç†è€…ï¼ˆè§‚å¯Ÿè€…ï¼‰çš„ä»£ç è§£è€¦ã€‚äº‹ä»¶å¤„ç†ç¨‹åºéœ€è¦è¢«åŒ¹é…äº‹ä»¶æ‰€è¦æ±‚çš„è¿”å›å€¼å’Œå‚æ•°ï¼Œè¿™ä¸ªé™åˆ¶ç”±å§”æ‰˜æ¥æŒ‡å®š</p><p>åœ¨ C# ä¸­ï¼Œäº‹ä»¶å°±åƒæ˜¯ä¸€ç§æœºåˆ¶ï¼Œåœ¨ç¨‹åºè¿è¡Œåˆ°ä¸€å®šé˜¶æ®µçš„æ—¶å€™æˆ–è€…é‡åˆ°æŸäº›çŠ¶å†µçš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘ä¸€ä¸ªäº‹ä»¶ã€‚ç„¶åå¦‚æœæœ‰å…¶ä»–ä»£ç è®¢é˜…äº†è¿™ä¸ªäº‹ä»¶ï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡Œè®¢é˜…çš„ä»£ç ã€‚æè¿°èµ·æ¥å¾ˆæŠ½è±¡ï¼Œç®€å•æ¥è®²å°±æ˜¯åœ¨ç±»å£°æ˜ä¸€ä¸ªå§”æ‰˜ï¼Œå¹¶æ ‡è®°è¿™ä¸ªå§”æ‰˜æ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œåœ¨å¦ä¸€ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œè¿™ä¸ªäº‹ä»¶ã€‚å…¶ä¸­ï¼Œè§¦å‘è¿™ä¸ªäº‹ä»¶çš„ç±»ç§°ä¸ºå‘å¸ƒè€…ï¼Œæ¥å—æˆ–è€…æ³¨å†Œäº†å¤„ç†æ–¹æ³•çš„ç±»ç§°ä¸ºè®¢é˜…è€…</p><p>å£°æ˜ä¸€ä¸ªäº‹ä»¶æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨<code>EventHandler</code>ï¼Œå¦ä¸€ç§æ˜¯è‡ªå·±å…ˆå®šä¹‰ä¸€ä¸ªå§”æ‰˜ï¼Œç„¶åç”¨è¿™ä¸ªå§”æ‰˜å®šä¹‰äº‹ä»¶</p><ul><li>ä½¿ç”¨ EventHandler</li></ul><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EventDemo</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> EventHandler HandlerEvent;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨è‡ªå®šä¹‰å§”æ‰˜</li></ul><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EventDemo</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">EventDelegate</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> EventDelegate DelegateEvent;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬äº‹ä»¶çš„å®šä¹‰çº¦å®šä¿—ç§°æ˜¯ä¸€ä¸ª <code>void</code> æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <code>sender</code> è¡¨ç¤ºäº‹ä»¶çš„å‘å¸ƒè€…ï¼Œé»˜è®¤æ˜¯ <code>object</code> ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ <code>EventArgs</code> ç±»å‹çš„äº‹ä»¶å˜é‡ï¼Œè¡¨ç¤ºè§¦å‘äº‹ä»¶æ—¶éœ€è¦è®¢é˜…è€…æ³¨æ„çš„å†…å®¹ï¼Œä¸€èˆ¬ç”¨æ¥ä¼ ä¸€äº›å‚æ•°ï¼›<code>EventArgs</code>åªæœ‰ä¸€ä¸ªé»˜è®¤æ„é€ æ–¹æ³•å’Œå‡ ä¸ªç»§æ‰¿è‡ª <code>Object</code> çš„æ–¹æ³•ã€‚æ‰€ä»¥åœ¨å¼€å‘ä¸­ï¼Œä¼šå®šä¹‰ä¸€ä¸ªäº‹ä»¶å˜é‡ç±»å‹ï¼Œä¸ºäº†ä¿æŒä¸€è‡´ä¼šç»§æ‰¿<code>EventArgs</code></p><h5 id="Demo">Demo</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EventDemo</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">EventDelegate</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> EventDelegate DelegateEvent;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Trigger</span>()</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (DelegateEvent != <span class="literal">null</span>)<span class="comment">// è§¦å‘äº‹ä»¶ï¼ŒæŒ‰éœ€åˆ¤æ–­äº‹ä»¶çš„è®¢é˜…è€…åˆ—è¡¨æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">        {</span><br><span class="line">            DelegateEvent(<span class="keyword">this</span>, <span class="keyword">new</span> EventArgs());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">EventDemo demo = <span class="keyword">new</span> EventDemo(); </span><br><span class="line">demo.DelegateEvent += (sender, eventArgs) =&gt;</span><br><span class="line">{</span><br><span class="line">    <span class="comment">// çœç•¥è®¢é˜…è€…çš„æ–¹æ³•å†…å®¹</span></span><br><span class="line">}</span><br><span class="line">demo.Trigger();<span class="comment">// è§¦å‘äº‹ä»¶</span></span><br></pre></td></tr></table></figure><p>å°†å…¶ä¸­çš„ <code>event</code> å»æ‰ï¼Œç¨‹åºä¾ç„¶æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜ã€‚äº‹ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å§”æ‰˜å®ä¾‹ï¼Œä¸ç”¨äº‹ä»¶ä¹Ÿæ²¡æœ‰å…³ç³»ã€‚å®é™…ä¸Šäº‹ä»¶åªæ˜¯å‰Šå¼±äº†å§”æ‰˜çš„åŠŸèƒ½ï¼Œ<code>event</code>åœ¨ç¼–è¯‘å™¨è§’åº¦ä¿æŠ¤äº†ç¨‹åºçš„å®‰å…¨ï¼Œå› ä¸ºåªèƒ½ä½¿ç”¨ <code>+=</code>ã€<code>-=</code> æ¥æ³¨å†Œäº‹ä»¶äº†ï¼Œè€Œä¸èƒ½ä½¿ç”¨ <code>=</code> ä¸ºäº‹ä»¶å…³è”æ–¹æ³•ã€‚ï¼ˆåœ¨å§”æ‰˜ä¸­è¿˜å¯ä»¥ä½¿ç”¨ <code>=</code> æ¥ç»‘å®šæ–¹æ³•ï¼Œä¸è¿‡ = æ˜¯ä¸€ç§ç ´åæ€§ä»£ç ï¼Œä¸ç®¡ä¹‹å‰æ˜¯å¦å·²ç»ç»‘å®šçš„æœ‰æ–¹æ³•äº†ï¼Œéƒ½ä¼šå°†å…¶æ¸…é™¤ï¼‰</p><h3 id="C- çš„å¼‚æ­¥å’Œ -Unity- çš„åç¨‹">C# çš„å¼‚æ­¥å’Œ Unity çš„åç¨‹</h3><h4 id="åç¨‹ -Coroutine-â€”â€”-font-color-FF6D60- ä¼ªå¼‚æ­¥ -font">åç¨‹ Coroutine â€”â€” <font color="#FF6D60">ä¼ªå¼‚æ­¥</font></h4><p>Unity å¼•æ“æ˜¯å•çº¿ç¨‹çš„ï¼ˆä¹Ÿå°±æ˜¯æœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼‰ã€‚ä¸ºäº†æ»¡è¶³å¼€å‘è€…çš„ç‰¹å®šçš„ <font color="#FF6D60"> å¼‚æ­¥ </font>ã€<font color="#FF6D60"> å¤šçº¿ç¨‹ </font> çš„å¼€å‘éœ€æ±‚ï¼ŒUnity ä¹Ÿæä¾›äº†ä¸€ä¸ª <font color="#FF6D60"> ä¼ªå¼‚æ­¥ </font> çš„è§£å†³æ€æƒ³â€”â€”åç¨‹ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåç¨‹ä¸æ˜¯çº¿ç¨‹ï¼Œä¹Ÿä¸æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œæœ¬è´¨ä¸Šå…¶å®è¿˜æ˜¯åœ¨ç”Ÿå‘½å‘¨æœŸçš„ <code>Update</code> ä¸­æ‰§è¡Œçš„</p><p>ä½¿ç”¨åç¨‹çš„å¥½å¤„å°±åœ¨äºï¼š</p><ul><li>å¤§å¤§å‡å°‘äº† <code>Update</code> å‡½æ•°çš„è‡ƒè‚¿</li><li>æ–¹ä¾¿å¼€å‘è€…å¯¹ä»£ç çš„é˜…è¯»å’Œç»´æŠ¤</li></ul><p>å¼Šç«¯ï¼š</p><ul><li>è¿è¡Œæ•ˆç‡æ²¡æœ‰å˜åŒ–</li><li>ä¸èƒ½è¿”å›å€¼ï¼Œåªèƒ½æ³¨å…¥å§”æ‰˜è°ƒç”¨</li></ul><h4 id="çº¿ç¨‹ -Thread-â€”â€”-font-color-FF6D60- çœŸå¼‚æ­¥ -font">çº¿ç¨‹ Thread â€”â€” <font color="#FF6D60">çœŸå¼‚æ­¥</font></h4><p>å¤šçº¿ç¨‹ï¼ˆThreadï¼‰æ˜¯ C# å¸¦æ¥çš„ç‰¹æ€§ã€‚<br>åœ¨ Unity ä¸­æ°å½“çš„ä½¿ç”¨å¤šçº¿ç¨‹ä¼šæé«˜ä¸€å®šçš„ç¨‹åºæ•ˆç‡ï¼Œä½¿ç”¨å¤šçº¿ç¨‹çš„åœºæ™¯ä¸€èˆ¬æ˜¯æ¶‰åŠåˆ°æ•°æ®çš„åŠ è½½å’Œé€»è¾‘å¤„ç†ï¼Œä¸å¦‚æ–‡ä»¶è¯»å†™ï¼Œç½‘ç»œé€šä¿¡ç­‰ã€‚</p><div class="admonition note"><p class="admonition-title">note</p><p>å­çº¿ç¨‹å†…ä¸å¯è®¿é—®æ¸¸æˆå¯¹è±¡æˆ–è€…ç»„ä»¶ä»¥åŠç›¸å…³çš„ Unity APIï¼Œå¦‚æœéœ€è¦ä¸ä¸»çº¿ç¨‹æ²Ÿé€šçš„è¯éœ€è¦è¿›è¡Œå›è°ƒ</p></div><h5 id="åˆ©ç”¨ async å’Œ await ç®€åŒ–å¤šçº¿ç¨‹å¼‚æ­¥è°ƒç”¨"><a href="https://learn.microsoft.com/zh-cn/dotnet/csharp/asynchronous-programming/task-asynchronous-programming-model#BKMK_WhatHappensUnderstandinganAsyncMethod">åˆ©ç”¨ <code>async</code> å’Œ<code>await</code>ç®€åŒ–å¤šçº¿ç¨‹å¼‚æ­¥è°ƒç”¨</a></h5><center>    <img src="/2022/08/19/45/navigation-trace-async-program.png"></center><h5 id="å®˜æ–¹å»ºè®®"><a class="link" href="https://learn.microsoft.com/zh-cn/dotnet/csharp/asynchronous-programming/async-scenarios?source=recommendations#important-info-and-advice">å®˜æ–¹å»ºè®®<i class="fas fa-external-link-alt"></i></a></h5><ul><li>ä¸¤è€…çš„åŠŸèƒ½æ˜¯æœ‰åŒºåˆ«çš„ï¼Œä½†æ˜¯ä¸€èˆ¬éƒ½æ˜¯è¢«æ­é…ä¸€èµ·ä½¿ç”¨</li><li><code>await</code>è¿ç®—ç¬¦é€šçŸ¥ç¼–è¯‘å™¨å¼‚æ­¥æ–¹æ³•ï¼šåœ¨ç­‰å¾…çš„å¼‚æ­¥è¿‡ç¨‹å®Œæˆåæ‰èƒ½ç»§ç»­é€šè¿‡è¯¥ç‚¹ã€‚ åŒæ—¶ï¼Œæ§åˆ¶è¿”å›è‡³å¼‚æ­¥æ–¹æ³•çš„è°ƒç”¨æ–¹ã€‚</li><li><code>async</code>å…³é”®å­—ä»…ç”¨äºä¿®é¥°æ–¹æ³•ä½“ï¼Œå¹¶ä¸”æ–¹æ³•ä½“ä¸­ä¸€å®šè¦æœ‰ <code>await</code> å…³é”®å­—å­˜åœ¨ï¼Œ<strong>å¦åˆ™å®ƒä»¬å°†æ°¸ä¸æš‚åœ</strong></li><li>å¯¹ <code>Task&lt;TResult&gt;</code> ç±»å‹å‰ä½¿ç”¨ <code>await</code> å…³é”®å­—ï¼Œä»£è¡¨å¯¹è¯¥ <code>Task</code> è¿›è¡Œå¼‚æ­¥ç­‰å¾…è¿”å›ç»“æœï¼Œå±Šæ—¶ä¼šè¢«æŒ‚èµ·ç›´åˆ°å¼‚æ­¥æ“ä½œå®Œæˆ</li></ul><h3 id="Coroutine- çš„åŸç†ã€Coroutine- åœ¨å“ªäº›åœºæ™¯ä¼šè¢«ç”¨åˆ°">Coroutine çš„åŸç†ã€Coroutine åœ¨å“ªäº›åœºæ™¯ä¼šè¢«ç”¨åˆ°</h3><p>A coroutine is a function that is executed partially and, presuming suitable conditions are met, will be resumed at some point in the future until its work is done.</p><p>å³åç¨‹æ˜¯ä¸€ä¸ªåˆ†éƒ¨æ‰§è¡Œï¼Œé‡åˆ°æ¡ä»¶ï¼ˆyield return è¯­å¥ï¼‰ä¼šæŒ‚èµ·ï¼Œç›´åˆ°æ¡ä»¶æ»¡è¶³æ‰ä¼šè¢«å”¤é†’ç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç </p><p>é€šè¿‡è®¾ç½® MonoBehaviour è„šæœ¬çš„ enabled å¯¹åç¨‹æ˜¯æ²¡æœ‰å½±å“çš„ï¼Œä½†å¦‚æœ <code>gameObject.SetActive(false)</code> åˆ™å·²ç»å¯åŠ¨çš„åç¨‹åˆ™å®Œå…¨åœæ­¢äº†ï¼Œå³ä½¿åœ¨ Inspector æŠŠ gameObject æ¿€æ´»è¿˜æ˜¯æ²¡æœ‰ç»§ç»­æ‰§è¡Œã€‚ä¹Ÿå°±è¯´åç¨‹è™½ç„¶æ˜¯åœ¨ MonoBehvaviour å¯åŠ¨çš„ï¼ˆStartCoroutineï¼‰ä½†æ˜¯åç¨‹å‡½æ•°çš„åœ°ä½å®Œå…¨æ˜¯è·Ÿ MonoBehaviour æ˜¯ä¸€ä¸ªå±‚æ¬¡çš„ï¼Œä¸å— MonoBehaviour çš„çŠ¶æ€å½±å“ï¼Œä½†è·Ÿ MonoBehaviour è„šæœ¬ä¸€æ ·å— gameObject æ§åˆ¶ï¼Œä¹Ÿåº”è¯¥æ˜¯å’Œ MonoBehaviour è„šæœ¬ä¸€æ ·æ¯å¸§â€œè½®è¯¢â€<code>yield</code>çš„æ¡ä»¶æ˜¯å¦æ»¡è¶³</p><h3 id="å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹">å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹</h3><blockquote><p>å€¼ç±»å‹å°†æ•°æ®å’Œå†…å­˜éƒ½ä¿å­˜åœ¨åŒä¸€ä½ç½®ï¼Œè€Œå¼•ç”¨ç±»å‹åˆ™ä¼šæœ‰ä¸€ä¸ªæŒ‡å‘å®é™…å†…å­˜åŒºåŸŸçš„æŒ‡é’ˆ</p></blockquote><ul><li><font color="#6DA9E4">å€¼ç±»å‹ </font>ï¼šå½“å°†ä¸€ä¸ª<code>int</code> ç±»å‹çš„å€¼èµ‹å€¼åˆ°å¦ä¸€ä¸ª <code>int</code> ç±»å‹çš„å€¼æ—¶ï¼Œå®ƒå®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå®Œå…¨ä¸åŒçš„å‰¯æœ¬ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæ”¹å˜äº†å…¶ä¸­æŸä¸€ä¸ªçš„å€¼ï¼Œå¦ä¸€ä¸ªä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚C# çš„æ‰€æœ‰å€¼ç±»å‹å‡éšå¼æ´¾ç”Ÿè‡ª<code>System.ValueType</code></li><li><font color="#6DA9E4">å¼•ç”¨ç±»å‹ </font>ï¼šå½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶ä¸”å°†æ­¤å¯¹è±¡èµ‹å€¼ç»™å¦å¤–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä»–ä»¬å½¼æ­¤éƒ½æŒ‡å‘äº†å†…å­˜ä¸­åŒä¸€å—åŒºåŸŸã€‚å› æ­¤ï¼Œå½“å°†<code>obj</code> èµ‹å€¼ç»™ <code>obj1</code> æ—¶ï¼Œä»–ä»¬éƒ½æŒ‡å‘äº†å †ä¸­çš„åŒä¸€å—åŒºåŸŸã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæ­¤æ—¶æ”¹å˜äº†å…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªéƒ½ä¼šå—åˆ°å½±å“</li></ul><h4 id="å“ªäº›æ˜¯å€¼ç±»å‹ï¼Œå“ªäº›æ˜¯å¼•ç”¨ç±»å‹">å“ªäº›æ˜¯å€¼ç±»å‹ï¼Œå“ªäº›æ˜¯å¼•ç”¨ç±»å‹</h4><ul><li>C# çš„å€¼ç±»å‹åŒ…æ‹¬ï¼šæ•°å€¼ç±»å‹ã€<code>bool</code>ã€ç”¨æˆ·å®šä¹‰çš„<code>struct</code>ï¼Œ<code>enum</code>ï¼Œå¯ç©ºç±»å‹</li><li>C# çš„å¼•ç”¨ç±»å‹åŒ…æ‹¬ï¼šæ•°ç»„ï¼Œ<code>class</code>ã€<code>interface</code>ã€<code>delegate</code>ï¼Œ<code>object</code>ï¼Œ<code>string</code></li></ul><h3 id="C- ä¸­ struct å’Œ class çš„åŒºåˆ«ï¼Œåˆ†åˆ«å­˜æ”¾åœ¨å“ªä¸ªå†…å­˜åŒº">C# ä¸­ <code>struct</code> å’Œ<code>class</code>çš„åŒºåˆ«ï¼Œåˆ†åˆ«å­˜æ”¾åœ¨å“ªä¸ªå†…å­˜åŒº</h3><ul><li><code>struct</code>æ˜¯å€¼ç±»å‹ï¼Œ<code>class</code>æ˜¯å¯¹è±¡ç±»å‹</li><li><code>struct</code>ä¸èƒ½è¢«ç»§æ‰¿ï¼Œ<code>class</code>å¯ä»¥è¢«ç»§æ‰¿</li><li><code>struct</code>é»˜è®¤çš„è®¿é—®æƒé™æ˜¯ <code>public</code>ï¼Œè€Œ<code>class</code> é»˜è®¤çš„è®¿é—®æƒé™æ˜¯<code>private</code></li><li><code>struct</code>æ€»æ˜¯æœ‰é»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œå³ä½¿æ˜¯é‡è½½é»˜è®¤æ„é€ å‡½æ•°ä»ç„¶ä¼šä¿ç•™ã€‚è¿™æ˜¯å› ä¸º <code>struct</code> çš„æ„é€ å‡½æ•°æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä½†æ˜¯å¦‚æœé‡è½½æ„é€ å‡½æ•°ï¼Œå¿…éœ€å¯¹ <code>struct</code> ä¸­çš„å˜é‡å…¨éƒ¨åˆå§‹åŒ–ã€‚å¹¶ä¸” <code>struct</code> çš„ç”¨é€”æ˜¯é‚£äº›æè¿°è½»é‡çº§çš„å¯¹è±¡ï¼Œä¾‹å¦‚ <code>Line</code>ï¼Œ<code>Point</code> ç­‰ï¼Œå¹¶ä¸”æ•ˆç‡æ¯”è¾ƒé«˜ã€‚<code>class</code>åœ¨æ²¡æœ‰é‡è½½æ„é€ å‡½æ•°æ—¶æœ‰é»˜è®¤çš„æ— å‚æ•°æ„é€ å‡½æ•°ï¼Œä½†æ˜¯ä¸€è¢«é‡è½½ï¼Œé»˜è®¤æ„é€ å‡½æ•°å°†è¢«è¦†ç›–</li><li><code>struct</code>çš„ new å’Œ <code>class</code> çš„ new æ˜¯ä¸åŒçš„ã€‚<code>struct</code>çš„ new å°±æ˜¯æ‰§è¡Œä¸€ä¸‹æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹å†å¯¹æ‰€æœ‰çš„å­—æ®µè¿›è¡Œæ‹·è´ã€‚è€Œ <code>class</code> åˆ™æ˜¯åœ¨å †ä¸Šåˆ†é…ä¸€å—å†…å­˜ç„¶åå†æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œ<code>struct</code>çš„å†…å­˜å¹¶ä¸æ˜¯åœ¨ <code>new</code> çš„æ—¶å€™åˆ†é…çš„ï¼Œè€Œæ˜¯åœ¨å®šä¹‰çš„æ—¶å€™åˆ†é…</li></ul><p>åœ¨ C# ä¸­ï¼Œç”¨ <code>struct</code> æˆ–<code>class</code>æ¥å£°æ˜ä¸€ä¸ªç±»å‹ä¸ºå€¼ç±»å‹ / å¼•ç”¨ç±»å‹ã€‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SomeType[] oneTypes = <span class="keyword">new</span> SomeType[<span class="number">100</span>];</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœ <code>SomeType</code> æ˜¯å€¼ç±»å‹ï¼Œåˆ™åªéœ€è¦ä¸€æ¬¡åˆ†é…ï¼Œå¤§å°ä¸º <code>SomeType</code> çš„ 100 å€</li><li>å¦‚æœ <code>SomeType</code> æ˜¯å¼•ç”¨ç±»å‹ï¼Œåˆšå¼€å§‹éœ€è¦ 100 æ¬¡åˆ†é…ï¼Œåˆ†é…åæ•°ç»„çš„å„å…ƒç´ å€¼ä¸º<code>null</code>ï¼Œç„¶åå†åˆå§‹åŒ– 100 ä¸ªå…ƒç´ ï¼Œç»“æœæ€»å…±éœ€è¦è¿›è¡Œ 101 æ¬¡åˆ†é…ã€‚è¿™å°†æ¶ˆè€—æ›´å¤šçš„æ—¶é—´ï¼Œé€ æˆæ›´å¤šçš„å†…å­˜ç¢ç‰‡ã€‚æ‰€ä»¥ï¼Œå¦‚æœç±»å‹çš„èŒè´£ä¸»è¦æ˜¯å­˜å‚¨æ•°æ®ï¼Œå€¼ç±»å‹æ¯”è¾ƒåˆé€‚</li></ul><h4 id="struct å’Œ class åº”ç”¨ä¸Šçš„åŒºåˆ«"><code>struct</code>å’Œ <code>class</code> åº”ç”¨ä¸Šçš„åŒºåˆ«</h4><ul><li>å€¼ç±»å‹é€‚åˆå­˜å‚¨ä¾› C# åº”ç”¨ç¨‹åºæ“ä½œçš„æ•°æ®</li><li>å¼•ç”¨ç±»å‹åº”è¯¥ç”¨äºå®šä¹‰åº”ç”¨ç¨‹åºçš„è¡Œä¸º</li></ul><h4 id="åˆ›å»ºå€¼ç±»å‹çš„å‰æ">åˆ›å»ºå€¼ç±»å‹çš„å‰æ</h4><ul><li>è¯¥ç±»å‹çš„ä¸»è¦èŒè´£ç”¨äºæ•°æ®å­˜å‚¨</li><li>è¯¥ç±»å‹çš„å…±æœ‰æ¥å£å®Œå…¨ç”±ä¸€äº›æ•°æ®æˆå‘˜å­˜å–å±æ€§å®šä¹‰</li><li>è¯¥ç±»å‹æ°¸è¿œä¸å¯èƒ½æœ‰å­ç±»</li><li>è¯¥ç±»å‹ä¸å…·æœ‰å¤šæ€è¡Œä¸º</li></ul><h3 id="å¯¹è±¡æ± é‡å¤ä¾èµ–å’Œå¾ªç¯ä¾èµ–çš„è¯æ€ä¹ˆå¤„ç†">å¯¹è±¡æ± é‡å¤ä¾èµ–å’Œå¾ªç¯ä¾èµ–çš„è¯æ€ä¹ˆå¤„ç†</h3><h3 id="Net- ä¸ -Mono- çš„å…³ç³»">.Net ä¸ Mono çš„å…³ç³»</h3><h4 id="Net">.Net</h4><p>.Net æ‹¥æœ‰è·¨è¯­è¨€ï¼Œè·¨å¹³å°æ€§</p><ul><li>è·¨è¯­è¨€ï¼šå°±æ˜¯åªè¦æ˜¯é¢å‘ .Net å¹³å°çš„ç¼–ç¨‹è¯­è¨€ï¼Œç”¨å…¶ä¸­ä¸€ç§è¯­è¨€ç¼–å†™çš„ç±»å‹å°±å¯ä»¥æ— ç¼çš„åœ¨å¦å¤–ä¸€ç§è¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åºä¸­äº’æ“ä½œã€‚</li><li>è·¨å¹³å°ï¼šä¸€æ¬¡ç¼–è¯‘ï¼Œä¸éœ€è¦ä»»ä½•ä»£ç ä¿®æ”¹ï¼Œåº”ç”¨ç¨‹åºå°±å¯ä»¥è¿è¡Œåœ¨ä»»æ„åœ¨ .Net å®ç°çš„å¹³å°ä¸Šè·‘ï¼Œå³ä»£ç ä¸ä¾èµ–äºæ“ä½œç³»ç»Ÿï¼Œä¹Ÿä¸ä¾èµ–ç¡¬ä»¶ç¯å¢ƒã€‚ä¸€ä¸ª .Net ç¨‹åºè¿è¡Œçš„æ ¸å¿ƒåœ¨äº .Net</li></ul><p>CLRï¼ˆå…¬å…±è¯­è¨€è¿è¡Œæ—¶ï¼Œæˆ–è€…ç§°ä¸º .Net è™šæ‹Ÿæœºï¼Œç±»ä¼¼ Java è™šæ‹Ÿæœºçš„æ¦‚å¿µï¼‰ï¼Œä¸ºäº†è®© .Net ç¨‹åºåœ¨å…¶ä»–å¹³å°ï¼ˆç›®å‰åªèƒ½åœ¨ .Net å¹³å°ï¼Œwindows ç³»ç»Ÿï¼‰ä¸Šè·‘ï¼Œå¾®è½¯å®˜æ–¹è¿˜æ¨å‡ºäº†åœ¨å…¶ä»–å¹³å°ä¸Š (MacOs,Linux) è·‘çš„<br>.Net çš„å®ç°ï¼Œå°±æ¨å‡ºäº†ã€‚Net Coreã€‚ç„¶è€Œï¼ŒUnity å¼•æ“éœ€æ±‚ä¹Ÿæ˜¯éœ€è¦è·¨å¹³å°ï¼Œæ”¯æŒå¤šè¯­è¨€ï¼ˆC#ï¼ŒJsï¼ŒBooï¼‰ã€‚å°±å‚è€ƒå¾®è½¯å¼€å‘ .Net Core çš„æ¦‚å¿µï¼Œäºæ˜¯ï¼Œæ¨å‡ºäº† Mono</p><center>    <img src="/2022/08/19/45/net-vs-mono.png"></center><h4 id="Mono">Mono</h4><center>    <img src="/2022/08/19/45/unity-mono.png"></center><ul><li>mcs ç¼–è¯‘å™¨ï¼šC#ç¼–è¯‘å™¨ï¼ŒC# ç¼–è¯‘ä¸º IL ä¸­é—´æŒ‡ä»¤</li><li>Unity è·¨å¹³å°çš„åŸç†ï¼šå°±æ˜¯ Mono è¿è¡Œæ—¶ç¼–è¯‘å™¨æ”¯æŒå°† IL ä»£ç è½¬ä¸ºå¯¹åº”å¹³å°åŸç”Ÿç ï¼ŒIL å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ CLI(Common Language Insfrastructure, é€šç”¨è¯­è¨€ç¯å¢ƒç»“æ„ï¼‰ä¸­è¿è¡Œï¼ŒIL çš„è¿è¡Œæ˜¯ä¾æ‰˜äº Mono è¿è¡Œæ—¶</li><li>IOS ä¸æ”¯æŒ jit ç¼–è¯‘åŸå› ï¼šæœºå™¨ç è¢«ç¦æ­¢æ˜ å°„åˆ°å†…å­˜ï¼Œå³å°å­˜äº†å†…å­˜çš„å¯æ‰§è¡Œæƒé™ï¼Œå˜ç›¸çš„å°é”äº† jit ç¼–è¯‘æ–¹å¼ï¼Œ<a class="link" href="https://www.cnblogs.com/murongxiaopifu/p/4278947.html">è¯¦æƒ…å‚è€ƒ<i class="fas fa-external-link-alt"></i></a></li><li>JIT ç¼–è¯‘ï¼šå°† IL ä»£ç è½¬ä¸ºå¯¹åº”å¹³å°åŸç”Ÿç å¹¶ä¸”å°†åŸç”Ÿç æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ä¸­æ‰§è¡Œã€‚JIT ç¼–è¯‘çš„æ—¶å€™ IL æ˜¯åœ¨ä¾æ‰˜ Mono è¿è¡Œæ—¶ï¼Œè½¬ä¸ºå¯¹åº”çš„åŸç”Ÿç ååœ¨ä¾æ‰˜æœ¬åœ°è¿è¡Œã€‚</li><li>AOTï¼ŒJITï¼ŒFull-AOt ä¸‰è€…å…³ç³»ï¼šæ³¨æ„ JITï¼ŒAOT ç¼–è¯‘å¹¶ä¸æ˜¯äº’æ–¥å…³ç³»ï¼Œä»–ä»¬å¯ä»¥å…±å­˜ã€‚Mono çš„ AOT æ¨¡å¼ä»ç„¶ä¼šä¿ç•™éƒ¨åˆ†ä»£ç åœ¨ç¨‹åºè¿è¡Œæ—¶é‡‡ç”¨ jit ç¼–è¯‘ï¼Œå› ä¸º ios è¢«ç¦æ­¢äº† jitï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMono æä¾›äº†ä¸€ä¸ªè¢«ç§°ä¸º Full-AOT çš„æ¨¡å¼ã€‚å³é¢„å…ˆå¯¹ç¨‹åºé›†ä¸­æ‰€æœ‰ IL ä»£ç è¿›è¡Œ AOT ç¼–è¯‘ç”Ÿæˆä¸€ä¸ªæœ¬åœ°ä»£ç æ˜ åƒï¼Œç„¶ååœ¨è¿è¡Œæ—¶ç›´æ¥åŠ è½½è¿™ä¸ªæ˜ åƒè€Œä¸å†ä½¿ç”¨ jit</li></ul><h3 id="C- ä¸­æŠ½è±¡ç±» abstract å’Œæ¥å£ interface çš„ç›¸åŒç‚¹ä¸åŒºåˆ«">C# ä¸­æŠ½è±¡ç±» <code>abstract</code> å’Œæ¥å£ <code>interface</code> çš„ç›¸åŒç‚¹ä¸åŒºåˆ«</h3><h4 id="ç›¸åŒç‚¹">ç›¸åŒç‚¹</h4><ul><li>éƒ½å¯ä»¥è¢«ç»§æ‰¿</li><li>éƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–</li><li>éƒ½å¯ä»¥åŒ…å«æ–¹æ³•å£°æ˜</li><li>æ´¾ç”Ÿç±»å¿…é¡»å®ç°æœªå®ç°çš„æ–¹æ³•</li></ul><h4 id="åŒºåˆ«">åŒºåˆ«</h4><ul><li>æŠ½è±¡åŸºç±»å¯ä»¥å®šä¹‰å­—æ®µã€å±æ€§ã€æ–¹æ³•å®ç°ã€‚æ¥å£åªèƒ½å®šä¹‰å±æ€§ã€ç´¢å¼•å™¨ã€äº‹ä»¶ã€å’Œæ–¹æ³•å£°æ˜ï¼Œä¸èƒ½åŒ…å«å­—æ®µã€‚</li><li>æŠ½è±¡ç±»æ˜¯ä¸€ä¸ªä¸å®Œæ•´çš„ç±»ï¼Œéœ€è¦è¿›ä¸€æ­¥ç»†åŒ–ï¼Œè€Œæ¥å£æ˜¯ä¸€ä¸ªè¡Œä¸ºè§„èŒƒã€‚å¾®è½¯çš„è‡ªå®šä¹‰æ¥å£æ€»æ˜¯åå¸¦ able å­—æ®µï¼Œè¯æ˜å…¶æ˜¯è¡¨è¿°ä¸€ç±»â€œæˆ‘èƒ½åšã€‚ã€‚ã€‚â€</li><li>æ¥å£å¯ä»¥è¢«å¤šé‡å®ç°ï¼ŒæŠ½è±¡ç±»åªèƒ½è¢«å•ä¸€ç»§æ‰¿</li><li>æŠ½è±¡ç±»æ›´å¤šçš„æ˜¯å®šä¹‰åœ¨ä¸€ç³»åˆ—ç´§å¯†ç›¸å…³çš„ç±»é—´ï¼Œè€Œæ¥å£å¤§å¤šæ•°æ˜¯å…³ç³»ç–æ¾ä½†éƒ½å®ç°æŸä¸€åŠŸèƒ½çš„ç±»ä¸­</li><li>æŠ½è±¡ç±»æ˜¯ä»ä¸€ç³»åˆ—ç›¸å…³å¯¹è±¡ä¸­æŠ½è±¡å‡ºæ¥çš„æ¦‚å¿µï¼Œå› æ­¤åæ˜ çš„æ˜¯äº‹ç‰©çš„å†…éƒ¨å…±æ€§ï¼›æ¥å£æ˜¯ä¸ºäº†æ»¡è¶³å¤–éƒ¨è°ƒç”¨è€Œå®šä¹‰çš„ä¸€ä¸ªåŠŸèƒ½çº¦å®šï¼Œ å› æ­¤åæ˜ çš„æ˜¯äº‹ç‰©çš„å¤–éƒ¨ç‰¹æ€§</li><li>æ¥å£åŸºæœ¬ä¸Šä¸å…·å¤‡ç»§æ‰¿çš„ä»»ä½•å…·ä½“ç‰¹ç‚¹, å®ƒä»…ä»…æ‰¿è¯ºäº†èƒ½å¤Ÿè°ƒç”¨çš„æ–¹æ³•</li><li>æ¥å£å¯ä»¥ç”¨äºæ”¯æŒå›è°ƒ, è€Œç»§æ‰¿å¹¶ä¸å…·å¤‡è¿™ä¸ªç‰¹ç‚¹</li><li>æŠ½è±¡ç±»å®ç°çš„å…·ä½“æ–¹æ³•é»˜è®¤ä¸ºè™šçš„ï¼Œä½†å®ç°æ¥å£çš„ç±»ä¸­çš„æ¥å£æ–¹æ³•å´é»˜è®¤ä¸ºéè™šçš„ï¼Œå½“ç„¶æ‚¨ä¹Ÿå¯ä»¥å£°æ˜ä¸ºè™šçš„</li><li>å¦‚æœæŠ½è±¡ç±»å®ç°æ¥å£ï¼Œåˆ™å¯ä»¥æŠŠæ¥å£ä¸­æ–¹æ³•æ˜ å°„åˆ°æŠ½è±¡ç±»ä¸­ä½œä¸ºæŠ½è±¡æ–¹æ³•è€Œä¸å¿…å®ç°ï¼Œè€Œåœ¨æŠ½è±¡ç±»çš„å­ç±»ä¸­å®ç°æ¥å£ä¸­æ–¹æ³•</li></ul><h2 id="æ¸²æŸ“">æ¸²æŸ“</h2><h3 id="æ¸²æŸ“æµç¨‹">æ¸²æŸ“æµç¨‹</h3><center>    <img src="/2022/08/19/45/renderer-flowchart.svg"></center><h3 id="DrawCall- æ˜¯ä»€ä¹ˆã€DrawCall- è¿‡é«˜ä¼šæœ‰ä»€ä¹ˆå½±å“">DrawCall æ˜¯ä»€ä¹ˆã€DrawCall è¿‡é«˜ä¼šæœ‰ä»€ä¹ˆå½±å“</h3><h4 id="ä»€ä¹ˆæ˜¯ -DrawCall">ä»€ä¹ˆæ˜¯ DrawCall</h4><p>DrawCall æœ¬èº«çš„å«ä¹‰å¾ˆç®€å•ï¼Œå°±æ˜¯ CPU è°ƒç”¨å›¾åƒç¼–ç¨‹æ¥å£ï¼Œå¦‚ OpenGL ä¸­çš„ <code>glDrawElements</code> å‘½ä»¤æˆ–è€… DirectX ä¸­çš„ <code>DrawlndexedPrimitive</code> å‘½ä»¤ï¼Œä»¥å‘½ä»¤ GPU è¿›è¡Œæ¸²æŸ“çš„æ“ä½œ</p><h4 id="ä¸ºä»€ä¹ˆ -DrawCall- è¿‡é«˜ä¼šå½±å“å¸§ç‡">ä¸ºä»€ä¹ˆ DrawCall è¿‡é«˜ä¼šå½±å“å¸§ç‡</h4><p>åœ¨æ¯æ¬¡è°ƒç”¨ DrawCall ä¹‹å‰ï¼Œ CPU éœ€è¦å‘ GPU å‘é€å¾ˆå¤šå†…å®¹ï¼ŒåŒ…æ‹¬æ•°æ®ã€çŠ¶æ€å’Œå‘½ä»¤ç­‰ã€‚åœ¨è¿™ä¸€é˜¶æ®µï¼Œ CPU éœ€è¦å®Œæˆå¾ˆå¤šå·¥ä½œï¼Œä¾‹å¦‚æ£€æŸ¥æ¸²æŸ“çŠ¶æ€ç­‰ã€‚è€Œä¸€æ—¦ CPU å®Œæˆäº†è¿™äº›å‡†å¤‡å·¥ä½œï¼Œ GPU å°±å¯ä»¥å¼€å§‹æœ¬æ¬¡çš„æ¸²æŸ“ã€‚GPU çš„æ¸²æŸ“èƒ½åŠ›æ˜¯å¾ˆå¼ºçš„ï¼Œæ¸²æŸ“ 200 ä¸ªè¿˜æ˜¯ 2000 ä¸ªä¸‰è§’ç½‘æ ¼é€šå¸¸æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå› æ­¤æ¸²æŸ“é€Ÿåº¦å¾€å¾€å¿«äº CPU æäº¤å‘½ä»¤çš„é€Ÿåº¦ã€‚å¦‚æœ DrawCall çš„æ•°é‡å¤ªå¤šï¼Œ CPU å°±ä¼šæŠŠå¤§é‡æ—¶é—´èŠ±è´¹åœ¨æäº¤ DrawCall ä¸Šï¼Œé€ æˆ CPU çš„è¿‡è½½</p><h4 id="DrawCall- ä¼˜åŒ–æ–¹æ¡ˆ">DrawCall ä¼˜åŒ–æ–¹æ¡ˆ</h4><ul><li>é™æ€åˆå¹¶</li><li>åŠ¨æ€åˆå¹¶</li><li>GPU Instancing</li><li>SRP Batcherï¼ˆæœ¬è´¨ä¸Š DrawCall ä¸ä¼šå‡å°‘ï¼Œå‡å°‘çš„æ˜¯ DrawCall æ•°æ®æ‹·è´ï¼‰</li></ul><div class="admonition warning"><p class="admonition-title">å…³äº DrawCall ç›¸å…³è¿˜éœ€è¦æ³¨æ„çš„é—®é¢˜</p><ul><li>å¦‚æœé™æ€æ‰¹å¤„ç†å‰æœ‰ä¸€äº›ç‰©ä½“å…±äº«äº†ç›¸åŒçš„ç½‘æ ¼ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªç‰©ä½“éƒ½ä¼šæœ‰ä¸€ä¸ªè¯¥ç½‘æ ¼çš„å¤åˆ¶å“ï¼ˆæœ¬æ¥ Unity åªä¼šä¿ç•™ä¸€ä»½ï¼Œä½†æ˜¯é™æ€æ‰¹å¤„ç†ä¼šç”Ÿæˆæ–°çš„ä¸€ä¸ªå¤§ç½‘æ ¼ï¼Œæ‰€ä»¥ä¼šä¿ç•™æ‰€æœ‰ç‰©ä½“çš„ç½‘æ ¼ï¼Œæœ€ååˆå¹¶ï¼‰ï¼Œå³ä¸€ä¸ªç½‘æ ¼ä¼šå˜æˆå¤šä¸ªç½‘æ ¼è¢«å‘é€ç»™ GPUï¼Œè¿™å›å¯¼è‡´ä¸€æ¬¡æ€§æäº¤è¿‡å¤§çš„æ•°æ®ï¼Œè™½ç„¶å¼•æ“æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸€èˆ¬æ˜¯ 65535 ä¸ªé¡¶ç‚¹</li><li>å¯¹äºé‚£äº› shader ç›¸åŒï¼Œçº¹ç†ä¸åŒå¯¼è‡´çš„ä¸åŒæè´¨æ— æ³•è¿›è¡Œæ‰¹å¤„ç†çš„ç‰©ä½“ï¼ˆæ¯”å¦‚é¡¹ç›®ä¸­çš„åœºæ™¯ç¯å¢ƒï¼Œåœ°é¢ï¼Œå¦‚æœéƒ½ä½¿ç”¨äº†æ¯”è¾ƒå¤æ‚çš„ Shaderï¼‰é€šè¿‡çº¹ç†åˆå¹¶çš„æ–¹æ³•æ¥ä½¿å¾—å®ƒä»¬å¯ä»¥è¢«é™æ€æ‰¹å¤„ç†ã€‚ä½†è¿™ä¼šå¼•å‘å¸¦å®½é—®é¢˜ï¼Œè¯¦ç»†åŸå› å…³ç³»åˆ° Bus æ€»çº¿å¸¦å®½çš„é—®é¢˜</li><li>ä¸€ä¸‹å­æäº¤å¤§é‡çš„ DrawCall å¯¼è‡´çš„å¡é¡¿é—®é¢˜ï¼Œè¿™ä¸ªå¯ä»¥é˜…è¯»ä¸‹ <a class="link" href="https://zhuanlan.zhihu.com/p/44116722">å¤šçº¿ç¨‹æ¸²æŸ“<i class="fas fa-external-link-alt"></i></a> ç›¸å…³çš„ã€‚ä¸»è¦æ˜¯å¯èƒ½æ˜¯å› ä¸ºï¼Œæäº¤æ¸²æŸ“ (<code>eglSwapBuffers</code>) ä¼šå¯¼è‡´é©±åŠ¨å±‚ä¸­ç¼“å­˜çš„æ¸²æŸ“æŒ‡ä»¤ç«‹å³æ‰§è¡Œï¼Œæ­¤æ—¶ CPU è¢«é˜»å¡ã€‚å¦‚æœåœ¨æäº¤æ¸²æŸ“æ—¶é©±åŠ¨å±‚ç¼“å­˜äº†å¤§é‡çš„æŒ‡ä»¤ï¼ŒCPU å°±ä¼šè¢«é˜»å¡å¾ˆé•¿æ—¶é—´ï¼›ä¹Ÿå¯èƒ½æ˜¯å› ä¸ºæäº¤å¤§é‡ DrawCall çš„æ—¶å€™å­˜åœ¨çº¹ç†çš„ Upload</li><li>CPU å®Œæˆä¸€æ¬¡ DrawCallï¼Œé™¤äº†éœ€è¦å‘ä¸€ä¸ª DrawCall çš„å‘½ä»¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦æŠŠå†…å­˜ä¸­é¡¶ç‚¹æ•°æ®ã€çº¹ç†è´´å›¾ã€Shader å‚æ•°é€šè¿‡ Bus æ€»çº¿æ‹·è´åˆ°å†…å­˜åˆ†é…ç»™ GPU çš„æ˜¾å­˜ä¹‹ä¸­ï¼Œæ³¨æ„è¿™æ˜¯æ‹·è´ï¼Œä¸æ˜¯æŒ‡é’ˆä¼ é€’ï¼Œé€Ÿåº¦ä¸å¿«ã€‚å¦‚æœä¸€æ¬¡ DrawCall ä¼ é€’çš„æ•°æ®è¿‡å¤§ï¼Œå¸¦å®½æˆä¸ºäº†ç“¶é¢ˆï¼Œé‚£å°±ä¼šå¤§å¤§å½±å“æ•ˆç‡ï¼ˆå…¶å®ƒçš„ DrawCall æ— æ³•å‡ºå‘ï¼ŒGPU åˆå¤„äºé—²ç½®ï¼‰ã€‚è¿™ç§æƒ…å†µæœ€æœ‰å¯èƒ½å‡ºç°åœ¨ä¸ºäº†å‡å°‘ DrawCallï¼Œç–¯ç‹‚çš„åˆå¹¶çº¹ç†ä¸Šã€‚åœ¨é¡¹ç›®ä¸­ï¼ŒUI çš„ DrawCall è°ƒç”¨å äº†å¾ˆå¤§ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¼šæœ€éš¾ä¼˜åŒ–çš„ã€‚ä¸ºäº†å‡å°‘ DrawCall , æŠŠ UI åˆå¹¶æˆå¤§çš„è´´å›¾ï¼ŒDrawCall ä¸‹é™äº†ï¼Œä½†æ˜¯å¸§ç‡å´ä¹Ÿä¸‹é™äº†ï¼Œå†…å­˜ä½¿ç”¨ä¹Ÿå¢åŠ äº†ï¼ŒåŸå› å°±æ˜¯è¿™ä¸ªã€‚åœ¨é¡¹ç›®ä¸­ï¼Œä¸ä¼šåŒæ—¶å‡ºç°çš„å…ƒç´ ä¸è¦æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œä¿è¯å•å¼ åˆå¹¶çº¹ç†ä¸å¤§äº 1024 ä¸€èˆ¬å°±ä¸ä¼šæœ‰é—®é¢˜äº†ï¼Œæœ€å¤§å°½é‡ä¸è¦è¶…è¿‡ 2048</li></ul></div><h3 id="LOD- æ˜¯ä»€ä¹ˆï¼Œä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆ">LOD æ˜¯ä»€ä¹ˆï¼Œä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆ</h3><p>LOD æŠ€æœ¯å³ Levels of Detail çš„ç®€ç§°ï¼Œæ„ä¸ºå¤šç»†èŠ‚å±‚æ¬¡ã€‚LOD æŠ€æœ¯æŒ‡æ ¹æ®ç‰©ä½“æ¨¡å‹çš„èŠ‚ç‚¹åœ¨ç°å®ç¯å¢ƒä¸­æ‰€å¤„çš„ä½ç½®å’Œé‡è¦åº¦ï¼Œå†³å®šç‰©ä½“æ¸²æŸ“çš„èµ„æºåˆ†é…ï¼Œé™ä½éé‡è¦ç‰©ä½“çš„é¢ç†Ÿå’Œç»†èŠ‚çš„ï¼Œä»è€Œè·å¾—é«˜æ•ˆç‡çš„æ¸²æŸ“è¿ç®—</p><ul><li>ä¼˜ç‚¹ï¼šå¯æ ¹æ®å…·ä½“åŠ¨æ€åœ°æ¸²æŸ“ä¸åŒç»†èŠ‚çš„æ¨¡å‹</li><li>ç¼ºç‚¹ï¼šåŠ é‡ç¾æœ¯çš„è´Ÿæ‹…ï¼Œè¦å‡†å¤‡ä¸åŒç»†èŠ‚çš„åŒä¸€æ¨¡å‹ï¼ŒåŒæ ·çš„ä¼šç¨å¾®å¢åŠ åŒ…ä½“å¤§å°</li></ul><h3 id="MipMap- æ˜¯ä»€ä¹ˆï¼Œä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆ">MipMap æ˜¯ä»€ä¹ˆï¼Œä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆ</h3><p>MipMapï¼Œåˆå«å¤šçº§æ¸è¿›è´´å›¾çº¹ç†æ˜ å°„ï¼Œæ ¹æ®æ¸²æŸ“ç‰©ä½“è·ç¦»ç›¸æœºçš„è¿œè¿‘ï¼Œé€‰ç”¨ä¸åŒå¤§å°çš„çº¹ç†è´´å›¾</p><ul><li>å¯ä»¥ä½¿å¾—è¿œå¤„çš„åƒç´ ä¸å‘ç”Ÿé—ªçƒ</li><li>å‡å°å¸¦å®½ï¼šå› ä¸ºåœ¨è¯»å–è´´å›¾çš„æ—¶å€™ï¼Œæ­£å¸¸çš„ UV åœ¨ 0~1 çš„åŒºé—´è¿ç»­è¯»å–ï¼ŒGPU ä¼šå°½é‡å°†è¿™ä¸ª Shader ä¸­è¯»å–è¿™å¼ è´´å›¾çš„æŒ‡ä»¤æ‹¼æ¥åœ¨ä¸€èµ·ï¼ŒGPU ä¼šå°†è´´å›¾ä¸­ç¬¬ä¸€ä¸ªè¯»å–æŒ‡ä»¤çš„ UV å€¼çš„å‘¨å›´çš„ä¸€å—åƒç´ è¯»å–åˆ° L2ï¼ŒL1 ç¼“å­˜ä¸­ï¼Œè¿™å°±æ˜¯è´´å›¾è¯»å–çš„é¢„æµ‹ç­–ç•¥ã€‚è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯ï¼šç”±äº UV è¿ç»­ï¼Œè¿™æ ·ä¼šæœ‰é«˜å‘½ä¸­ç‡ç›´æ¥è·å–æ‰€éœ€è¦ UV å€¼çš„é¢œè‰²ï¼Œè¦é‡‡æ ·çš„ä¸¤ä¸ª UV è·ç¦»å¾ˆè¿œæ—¶ï¼Œå½“å†…å­˜ä¸­ä¸å­˜åœ¨è¿™ä¸ªè´´å›¾çš„ UV ä½ç½®çš„å†…å­˜æ•°æ®ï¼Œé‚£ä¹ˆä¹…èŒèƒ½æ¸…ç©ºå½“å‰å·²ç»è¿›å…¥ç¼“å­˜çš„æ•°æ®ï¼Œé‡æ–°é‡‡æ ·å¯¹åº” UV çš„å‘¨å›´ä¸€å—åƒç´ å€¼ï¼Œå†æ¬¡æ”¾å…¥ L2ï¼ŒL1 ç¼“å­˜ä¸­ï¼Œè¿™å°±æ˜¯ <strong> ç¼“å­˜å‘½ä¸­ç‡é™ä½ </strong> é€ æˆçš„å¸¦å®½ä¸Šå‡</li></ul><p>ç¼ºç‚¹ï¼šä¼šå ç”¨å†…å­˜ï¼ˆå¤§çº¦ä¸º 1/3ï¼‰</p><h3 id="OverDraw- æ˜¯ä»€ä¹ˆï¼Œè¿‡é«˜ä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Œæ€ä¹ˆä¼˜åŒ– -OverDraw">OverDraw æ˜¯ä»€ä¹ˆï¼Œè¿‡é«˜ä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Œæ€ä¹ˆä¼˜åŒ– OverDraw</h3><p>Overdraw æ˜¯æŒ‡åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼ŒåŒä¸€åƒç´ è¢«å¤šæ¬¡ç»˜åˆ¶çš„ç°è±¡ã€‚å½“æ¸¸æˆä¸­æœ‰å¤§é‡çš„é€æ˜ç‰©ä½“å åŠ åœ¨ä¸€èµ·æ—¶ï¼ŒOverdraw å°±ä¼šå‘ç”Ÿã€‚è¿™æ˜¯å› ä¸ºåœ¨æ¸²æŸ“ç®¡çº¿ä¸­ï¼Œåƒç´ çš„é¢œè‰²è®¡ç®—æ˜¯åŸºäºèƒŒååƒç´ çš„é¢œè‰²è®¡ç®—çš„ã€‚å½“å¤šä¸ªé€æ˜ç‰©ä½“é‡å åœ¨ä¸€èµ·æ—¶ï¼Œæ¯ä¸ªåƒç´ éƒ½éœ€è¦è®¡ç®—å¤šæ¬¡ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</p><p>é€ æˆ Overdraw çš„åŸå› æœ‰å¾ˆå¤šï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯ä½¿ç”¨äº†è¿‡å¤šçš„é€æ˜æè´¨ã€‚é€æ˜æè´¨åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­éœ€è¦é¢å¤–çš„è®¡ç®—èµ„æºï¼Œå› æ­¤ä½¿ç”¨è¿‡å¤šçš„é€æ˜æè´¨ä¼šå¢åŠ  Overdraw çš„å‘ç”Ÿæ¦‚ç‡ã€‚å¦ä¸€ä¸ªåŸå› æ˜¯è¿‡åº¦ä½¿ç”¨ç²’å­ç³»ç»Ÿã€‚ç²’å­ç³»ç»Ÿåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿå¤§é‡çš„é€æ˜åƒç´ ï¼Œå› æ­¤è¿‡åº¦ä½¿ç”¨ç²’å­ç³»ç»Ÿä¹Ÿä¼šå¢åŠ  Overdraw çš„å‘ç”Ÿã€‚</p><p>ä¸ºäº†å‡å°‘ Overdraw å¯¹æ¸¸æˆæ€§èƒ½çš„å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–ä¸€äº›ä¼˜åŒ–æªæ–½ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥åˆå¹¶å¤šä¸ªé€æ˜ç‰©ä½“ä¸ºä¸€ä¸ªç‰©ä½“ã€‚é€šè¿‡å°†å¤šä¸ªé€æ˜ç‰©ä½“åˆå¹¶ä¸ºä¸€ä¸ªç‰©ä½“ï¼Œå¯ä»¥å‡å°‘ Overdraw çš„å‘ç”Ÿã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸é€æ˜çš„æè´¨æ›¿ä»£é€æ˜æè´¨ã€‚ä¸é€æ˜æè´¨ä¸éœ€è¦é¢å¤–çš„è®¡ç®—èµ„æºï¼Œå› æ­¤å¯ä»¥å‡å°‘ Overdraw çš„å‘ç”Ÿã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å‡å°‘ç²’å­ç³»ç»Ÿçš„ä½¿ç”¨æ¥å‡å°‘ Overdraw çš„å‘ç”Ÿã€‚</p><h2 id="å·¥å…·">å·¥å…·</h2><h3 id="TextMeshPro">TextMeshPro</h3><h4 id="UGUI- çš„ Text çš„æ–‡å­—æ˜¯å¦‚ä½•æ¸²æŸ“å‡ºæ¥">UGUI çš„ <code>Text</code> çš„æ–‡å­—æ˜¯å¦‚ä½•æ¸²æŸ“å‡ºæ¥</h4><p><code>Text</code>ç»§æ‰¿äº†<code>MaskableGraphic</code>, <code>ILayoutElement</code></p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnPopulateMesh</span>(<span class="params">VertexHelper toFill</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (font == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// We don't care if we the font Texture changes while we are doing our Update.</span></span><br><span class="line">    <span class="comment">// The end result of cachedTextGenerator will be valid for this instance.</span></span><br><span class="line">    <span class="comment">// Otherwise we can get issues like Case 619238.</span></span><br><span class="line">    m_DisableFontTextureRebuiltCallback = <span class="literal">true</span>;</span><br><span class="line"> </span><br><span class="line">    Vector2 extents = rectTransform.rect.size;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">var</span> settings = GetGenerationSettings(extents);</span><br><span class="line">    cachedTextGenerator.PopulateWithErrors(text, settings, gameObject);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Apply the offset to the vertices</span></span><br><span class="line">    IList&lt;UIVertex&gt; verts = cachedTextGenerator.verts;</span><br><span class="line">    <span class="built_in">float</span> unitsPerPixel = <span class="number">1</span> / pixelsPerUnit;</span><br><span class="line">    <span class="built_in">int</span> vertCount = verts.Count;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// We have no verts to process just return (case 1037923)</span></span><br><span class="line">    <span class="keyword">if</span> (vertCount &lt;= <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">        toFill.Clear();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    Vector2 roundingOffset = <span class="keyword">new</span> Vector2(verts[<span class="number">0</span>].position.x, verts[<span class="number">0</span>].position.y) * unitsPerPixel;</span><br><span class="line">    roundingOffset = PixelAdjustPoint(roundingOffset) - roundingOffset;</span><br><span class="line">    toFill.Clear();</span><br><span class="line">    <span class="keyword">if</span> (roundingOffset != Vector2.zero)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; vertCount; ++i)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">int</span> tempVertsIndex = i &amp; <span class="number">3</span>;</span><br><span class="line">            m_TempVerts[tempVertsIndex] = verts[i];</span><br><span class="line">            m_TempVerts[tempVertsIndex].position *= unitsPerPixel;</span><br><span class="line">            m_TempVerts[tempVertsIndex].position.x += roundingOffset.x;</span><br><span class="line">            m_TempVerts[tempVertsIndex].position.y += roundingOffset.y;</span><br><span class="line">            <span class="keyword">if</span> (tempVertsIndex == <span class="number">3</span>)</span><br><span class="line">                toFill.AddUIVertexQuad(m_TempVerts);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; vertCount; ++i)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">int</span> tempVertsIndex = i &amp; <span class="number">3</span>;</span><br><span class="line">            m_TempVerts[tempVertsIndex] = verts[i];</span><br><span class="line">            m_TempVerts[tempVertsIndex].position *= unitsPerPixel;</span><br><span class="line">            <span class="keyword">if</span> (tempVertsIndex == <span class="number">3</span>)</span><br><span class="line">                toFill.AddUIVertexQuad(m_TempVerts);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    m_DisableFontTextureRebuiltCal</span><br></pre></td></tr></table></figure><ul><li>é‡å†™ <code>Graphic</code> çš„<code>OnPopulateMesh</code>æ–¹æ³•ï¼Œä¼šåœ¨ <code>Graphic</code> çš„<code>Rebuild</code>æ–¹æ³•è¢«è°ƒç”¨ï¼Œä¸º <code>CanvasRenderer</code> çš„ Mesh æä¾›äº†é¡¶ç‚¹ä½ç½®ã€é¡¶ç‚¹é¢œè‰²ã€UV å’Œä¸‰è§’å½¢ä¿¡æ¯</li><li>æ ¹æ®ç”¨æˆ·è®¾ç½®ç”Ÿæˆäº†ä¸€ä¸ª <code>TextGenerationSettings</code> æ–‡æœ¬ç”Ÿæˆè®¾ç½®ï¼Œç„¶åè°ƒç”¨ <code>TextGenerator.PopulateWithErrors</code> ç”Ÿæˆ Mesh çš„é¡¶ç‚¹ã€é¡¶ç‚¹é¢œè‰²ã€UV å’Œä¸‰è§’å½¢ä¿¡æ¯</li><li>è®¡ç®—åç§»é‡ï¼ˆä¾‹å¦‚å·¦å¯¹é½éœ€è¦ç´§é å·¦è¾¹ï¼‰ï¼Œæœ€åéå† <code>TextGenerator</code> çš„é¡¶ç‚¹æ•°ç»„ï¼Œå°†å®ƒä»¬çš„ä½ç½®é™¤ä»¥<code>pixelsPerUnit</code>ï¼ˆæ¯å•å…ƒåƒç´ ï¼‰å¹¶åŠ ä¸Šåç§»é‡ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå¾—åˆ°çš„ç»“æœå¡«åˆ°<code>VertexHelper</code></li></ul><div class="admonition note"><p class="admonition-title">UI æ·»åŠ æ–‡æœ¬</p><ul><li>æ–‡æœ¬å­—å½¢æ˜¯ä½œä¸ºç‹¬ç«‹çš„é¢ç‰‡ (quad) è¿›è¡Œæ¸²æŸ“çš„ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½æ˜¯ä¸€ä¸ªé¢ç‰‡ã€‚è¿™äº›é¢ç‰‡é€šå¸¸éƒ½å«æœ‰å¤§é‡çš„ç©ºç™½åŒºåŸŸå›´ç»•ç€å­—å½¢ï¼Œç©ºç™½åŒºåŸŸçš„å¤§å°å–å†³äºå­—å½¢çš„å½¢çŠ¶ï¼Œåœ¨æ”¾ç½®æ–‡æœ¬æ—¶å¾ˆå®¹æ˜“å°±ä¼šæ— æ„ä¸­ç ´åå…¶ä»– UI å…ƒç´ çš„æ‰¹å¤„ç†</li><li>UI æ–‡æœ¬çš„ç½‘æ ¼é‡å»ºæ˜¯ä¸ªé‡ç‚¹é—®é¢˜ã€‚å½“ Text ç»„ä»¶å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¿…é¡»é‡æ–°è®¡ç®—ç”¨äºæ˜¾ç¤ºå®é™…æ–‡æœ¬çš„å¤šè¾¹å½¢ã€‚å½“ Text ç»„ä»¶æˆ–å®ƒçš„ä»»æ„çº§åˆ«çš„çˆ¶èŠ‚ç‚¹è¢«ç¦ç”¨æˆ–å¯ç”¨æ—¶ï¼Œä¹Ÿéœ€è¦è¿›è¡Œé‡æ–°è®¡ç®—</li></ul></div><h4 id="æ¸¸æˆä¸­çš„ -Text-Rendering">æ¸¸æˆä¸­çš„ Text Rendering</h4><h5 id="Bitmap-font- ä½å›¾å­—ä½“">Bitmap font ä½å›¾å­—ä½“</h5><p>æœ€ç®€å•ç›´æ¥çš„æ–¹å¼ï¼Œå°±æ˜¯æ¯ä¸ªå­—ç¬¦ä½¿ç”¨ä¸€å¼ å›¾ç‰‡æ¥è¡¨ç¤ºï¼Œæ‰“åŒ…æˆä¸€ä¸ªå›¾é›†ï¼Œç„¶åç”¨ä¸€ç§æ–¹å¼æ¥æè¿°å­—ç¬¦çš„ä½ç½®ã€‚ç”¨æ¥åšä¸€äº›å½©è‰² UI å­—ä½“ç›¸å½“æ–¹ä¾¿ï¼Œè¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ<font color="#FF6D60">å°±æ˜¯åªèƒ½æ”¯æŒå›ºå®šå¤§å°çš„å­—ä½“ï¼Œæ”¾å¤§åä¼šå‡ºç°æ¨¡ç³Š</font></p><h5 id="TTF-OTF- å­—ä½“">TTF OTF å­—ä½“</h5><p>ä¸åŒäºä½å›¾çš„å›¾ç‰‡æè¿°ï¼ŒTTF/OTF å­—ä½“ä½¿ç”¨è´å¡å°”æ›²çº¿æ¥æè¿°å­—å½¢ (glyph)ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ç¼©æ”¾å­—ä½“æ—¶ä¸ä¼šå¤±çœŸã€‚åœ¨æ¸²æŸ“æ—¶ï¼Œä¼šåŠ¨æ€ç”Ÿæˆéœ€è¦ç”¨åˆ°çš„å­—ç¬¦çš„å­—å½¢ä½å›¾å¹¶ç¼“å­˜èµ·æ¥ï¼Œä¸åŒå­—å·çš„å­—ç¬¦éœ€è¦ä¸åŒçš„ä½å›¾ã€‚ä»è´å¡å°”æ›²çº¿ç”Ÿæˆä½å›¾ï¼Œä¸€èˆ¬æ˜¯ç”¨ CPU æ¥è®¡ç®—ç”Ÿæˆï¼Œç°åœ¨ä¹Ÿæœ‰ä½¿ç”¨ GPU çš„ Computer Shader ç­‰æ¥ç”Ÿæˆçš„æ–¹å¼ã€‚è¿™ç§æ–¹å¼æ˜¯ç»å¤§å¤šæ•°æ–‡æ¡£ç­‰å„ç±»ç³»ç»Ÿä¸­çš„æ–‡æœ¬æ¸²æŸ“æ–¹å¼ï¼Œä¹Ÿæ˜¯æ¸¸æˆ UI ä¸­çš„é»˜è®¤é€‰é¡¹</p><p>ä½†æ˜¯åœ¨æ¸¸æˆçš„ 3D å¹³é¢ä¸­æ¸²æŸ“ä¸€äº›æ–‡å­—çš„æ—¶å€™ï¼Œä¼šå‡ºç°ä¸€äº›é—®é¢˜ã€‚å› ä¸ºç”Ÿæˆçš„ä½å›¾æ˜¯æŒ‰ç…§å±å¹•åƒç´ æ¥ç”Ÿæˆçš„ï¼ŒTexture ä¸­çš„ä¸€ä¸ªçº¹ç´  (texel) å¯¹åº”ä¸€ä¸ªåƒç´  (pixel)ã€‚åœ¨ 3D ç©ºé—´æ¸²æŸ“æ–‡å­—æ—¶ï¼Œå¯èƒ½ä¼šåœ¨ä¸åŒçš„è§’åº¦å’Œä¸åŒçš„è·ç¦»è§‚å¯Ÿæ–‡å­—ï¼Œå°±ä¼šå‡ºç°å¤±çœŸæŠ–åŠ¨çš„é—®é¢˜</p><h5 id="åŸºäº -SDF- ç»˜åˆ¶">åŸºäº SDF ç»˜åˆ¶</h5><p>åœ¨å­—ä½“ä½å›¾å›¾é›†çš„åŸºç¡€ä¸Šï¼Œè®¡ç®—æ¯ä¸ªåƒç´ ç‚¹åˆ°å‘¨å›´åƒç´ ç‚¹çš„è·ç¦»ï¼Œå¾—åˆ° SDF çš„å€¼ï¼Œç„¶åæ˜ å°„åˆ° 0~1 çš„èŒƒå›´ï¼Œç”Ÿæˆä¸€å¼  Alpha è´´å›¾ï¼Œ0.5 çš„å€¼ä»£è¡¨æ­£å¥½æ˜¯è¾¹ç¼˜ã€‚æ¸²æŸ“æ–‡æœ¬çš„æ—¶å€™ï¼Œå¯¹ Alpha=0.5 è¿›è¡Œ AlphaTestï¼Œå°±å¯ä»¥æ¸²æŸ“å‡ºæ–‡æœ¬ã€‚å¾—ç›Šäº Texture çš„åŒçº¿æ€§æ’å€¼ï¼Œå¯ä»¥å¾—åˆ°å¹³æ»‘è¾¹ç¼˜çš„æ–‡æœ¬</p><p>SDF æ¸²æŸ“æ–‡æœ¬çš„å¦ä¸€ä¸ªå·¨å¤§ä¼˜åŠ¿æ˜¯ï¼Œ, å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è°ƒæ•´æ¸²æŸ“çš„ shaderï¼Œå¾—åˆ°ä¸€äº›ç‰¹æ®Šçš„æ•ˆæœã€‚æ¯”å¦‚ï¼š</p><ul><li>AAï¼Œåœ¨æ–‡æœ¬è¾¹ç¼˜å¤„æ’å€¼ä¸€äº›é€æ˜åº¦è¿‡æ¸¡</li><li>Outlineï¼Œåˆ¤æ–­ alpha å€¼ï¼Œ0.5~1 æ­£å¸¸æ¸²æŸ“æ–‡æœ¬ï¼Œ 0.5-delta~0.5 æ¸²æŸ“æè¾¹è‰²</li><li>Glowï¼Œåˆ¤æ–­ alpha å€¼ï¼Œåœ¨ 0~0.5 å¤„æ’å€¼ä¸€ä¸ªå‘å…‰è‰²</li><li>Drop Shadowï¼Œ åœ¨ Pixel Shader ä¸­è¿›è¡Œ UV åç§»ï¼ŒäºŒæ¬¡æŸ¥æ‰¾ SDF Textureï¼Œå¾—åˆ°é˜´å½±</li></ul><h5 id="GPU- ç»˜åˆ¶å­—å½¢"><a class="link" href="https://zhuanlan.zhihu.com/p/143871184">GPU ç»˜åˆ¶å­—å½¢<i class="fas fa-external-link-alt"></i></a></h5><h4 id="TextMeshPro-2">TextMeshPro</h4><p>TextMeshPro æ–‡å­—æ¸²æŸ“æ’ä»¶æ˜¯åŸºäº SDFï¼ˆSigned Distance Functionï¼‰å®ç°çš„ã€‚ä½¿å…¶å¯ä»¥åœ¨ä»»æ„å°ºå¯¸å’Œåˆ†è¾¨ç‡ä¸‹æ¸…æ™°çš„æ¸²æŸ“æ–‡æœ¬ã€‚ä½¿ç”¨ä¸€ç³»åˆ—è‡ªå®šä¹‰çš„ç€è‰²å™¨æ¥æå‡ SDF æ–‡æœ¬æ¸²æŸ“çš„èƒ½åŠ›åï¼ŒTextMeshPro å¯ä»¥ç®€å•çš„é€šè¿‡ä¿®æ”¹æè´¨å±æ€§æ¥åŠ¨æ€åœ°æ”¹å˜è§†è§‰æ•ˆæœï¼Œä¾‹å¦‚ï¼Œæ”¾å¤§ã€å¤–è¾¹æ¡†ã€è½¯é˜´å½±ç­‰ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡åˆ›å»ºæè´¨é¢„è®¾æ¥ä¿å­˜è¿™äº›æ•ˆæœï¼Œåœ¨ä»¥åé‡æ–°è°ƒç”¨</p><h5 id="SDF-Signed-Distance-Function">SDF Signed Distance Function</h5><p>In mathematics and its applications, the signed distance function (or oriented distance function) is the orthogonal distance of a given point <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.294ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 572 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"/></g></g></g></svg></mjx-container> to the boundary of a set <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.633ex" height="1.593ex" role="img" focusable="false" viewbox="0 -704 722 704"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="3A9" d="M55 454Q55 503 75 546T127 617T197 665T272 695T337 704H352Q396 704 404 703Q527 687 596 615T666 454Q666 392 635 330T559 200T499 83V80H543Q589 81 600 83T617 93Q622 102 629 135T636 172L637 177H677V175L660 89Q645 3 644 2V0H552H488Q461 0 456 3T451 20Q451 89 499 235T548 455Q548 512 530 555T483 622T424 656T361 668Q332 668 303 658T243 626T193 560T174 456Q174 380 222 233T270 20Q270 7 263 0H77V2Q76 3 61 89L44 175V177H84L85 172Q85 171 88 155T96 119T104 93Q109 86 120 84T178 80H222V83Q206 132 162 199T87 329T55 454Z"/></g></g></g></svg></mjx-container> in a metric space, with the sign determined by whether or not <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.294ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 572 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"/></g></g></g></svg></mjx-container> is in the interior of <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.633ex" height="1.593ex" role="img" focusable="false" viewbox="0 -704 722 704"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="3A9" d="M55 454Q55 503 75 546T127 617T197 665T272 695T337 704H352Q396 704 404 703Q527 687 596 615T666 454Q666 392 635 330T559 200T499 83V80H543Q589 81 600 83T617 93Q622 102 629 135T636 172L637 177H677V175L660 89Q645 3 644 2V0H552H488Q461 0 456 3T451 20Q451 89 499 235T548 455Q548 512 530 555T483 622T424 656T361 668Q332 668 303 658T243 626T193 560T174 456Q174 380 222 233T270 20Q270 7 263 0H77V2Q76 3 61 89L44 175V177H84L85 172Q85 171 88 155T96 119T104 93Q109 86 120 84T178 80H222V83Q206 132 162 199T87 329T55 454Z"/></g></g></g></svg></mjx-container>. The function has positive values at points <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.294ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 572 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"/></g></g></g></svg></mjx-container> inside <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.633ex" height="1.593ex" role="img" focusable="false" viewbox="0 -704 722 704"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="3A9" d="M55 454Q55 503 75 546T127 617T197 665T272 695T337 704H352Q396 704 404 703Q527 687 596 615T666 454Q666 392 635 330T559 200T499 83V80H543Q589 81 600 83T617 93Q622 102 629 135T636 172L637 177H677V175L660 89Q645 3 644 2V0H552H488Q461 0 456 3T451 20Q451 89 499 235T548 455Q548 512 530 555T483 622T424 656T361 668Q332 668 303 658T243 626T193 560T174 456Q174 380 222 233T270 20Q270 7 263 0H77V2Q76 3 61 89L44 175V177H84L85 172Q85 171 88 155T96 119T104 93Q109 86 120 84T178 80H222V83Q206 132 162 199T87 329T55 454Z"/></g></g></g></svg></mjx-container>, it decreases in value as <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.294ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 572 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"/></g></g></g></svg></mjx-container> approaches the boundary of <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.633ex" height="1.593ex" role="img" focusable="false" viewbox="0 -704 722 704"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="3A9" d="M55 454Q55 503 75 546T127 617T197 665T272 695T337 704H352Q396 704 404 703Q527 687 596 615T666 454Q666 392 635 330T559 200T499 83V80H543Q589 81 600 83T617 93Q622 102 629 135T636 172L637 177H677V175L660 89Q645 3 644 2V0H552H488Q461 0 456 3T451 20Q451 89 499 235T548 455Q548 512 530 555T483 622T424 656T361 668Q332 668 303 658T243 626T193 560T174 456Q174 380 222 233T270 20Q270 7 263 0H77V2Q76 3 61 89L44 175V177H84L85 172Q85 171 88 155T96 119T104 93Q109 86 120 84T178 80H222V83Q206 132 162 199T87 329T55 454Z"/></g></g></g></svg></mjx-container> where the signed distance function is zero, and it takes negative values outside of <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.633ex" height="1.593ex" role="img" focusable="false" viewbox="0 -704 722 704"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="3A9" d="M55 454Q55 503 75 546T127 617T197 665T272 695T337 704H352Q396 704 404 703Q527 687 596 615T666 454Q666 392 635 330T559 200T499 83V80H543Q589 81 600 83T617 93Q622 102 629 135T636 172L637 177H677V175L660 89Q645 3 644 2V0H552H488Q461 0 456 3T451 20Q451 89 499 235T548 455Q548 512 530 555T483 622T424 656T361 668Q332 668 303 658T243 626T193 560T174 456Q174 380 222 233T270 20Q270 7 263 0H77V2Q76 3 61 89L44 175V177H84L85 172Q85 171 88 155T96 119T104 93Q109 86 120 84T178 80H222V83Q206 132 162 199T87 329T55 454Z"/></g></g></g></svg></mjx-container>.</p><p>SDFï¼Œåˆå¯ä»¥ç§°ä¸ºå®šå‘è·ç¦»å‡½æ•°ï¼ˆoriented distance functionï¼‰ï¼Œåœ¨åº¦é‡ç©ºé—´ä¸­çš„ä¸€ä¸ªæœ‰é™åŒºåŸŸ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.633ex" height="1.593ex" role="img" focusable="false" viewbox="0 -704 722 704"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="3A9" d="M55 454Q55 503 75 546T127 617T197 665T272 695T337 704H352Q396 704 404 703Q527 687 596 615T666 454Q666 392 635 330T559 200T499 83V80H543Q589 81 600 83T617 93Q622 102 629 135T636 172L637 177H677V175L660 89Q645 3 644 2V0H552H488Q461 0 456 3T451 20Q451 89 499 235T548 455Q548 512 530 555T483 622T424 656T361 668Q332 668 303 658T243 626T193 560T174 456Q174 380 222 233T270 20Q270 7 263 0H77V2Q76 3 61 89L44 175V177H84L85 172Q85 171 88 155T96 119T104 93Q109 86 120 84T178 80H222V83Q206 132 162 199T87 329T55 454Z"/></g></g></g></svg></mjx-container> å†…ç»™å®šä¸€ä¸ªç‚¹ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.294ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 572 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"/></g></g></g></svg></mjx-container>ï¼Œç¡®å®š<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.294ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 572 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"/></g></g></g></svg></mjx-container> åˆ°<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.633ex" height="1.593ex" role="img" focusable="false" viewbox="0 -704 722 704"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="3A9" d="M55 454Q55 503 75 546T127 617T197 665T272 695T337 704H352Q396 704 404 703Q527 687 596 615T666 454Q666 392 635 330T559 200T499 83V80H543Q589 81 600 83T617 93Q622 102 629 135T636 172L637 177H677V175L660 89Q645 3 644 2V0H552H488Q461 0 456 3T451 20Q451 89 499 235T548 455Q548 512 530 555T483 622T424 656T361 668Q332 668 303 658T243 626T193 560T174 456Q174 380 222 233T270 20Q270 7 263 0H77V2Q76 3 61 89L44 175V177H84L85 172Q85 171 88 155T96 119T104 93Q109 86 120 84T178 80H222V83Q206 132 162 199T87 329T55 454Z"/></g></g></g></svg></mjx-container>è¾¹ç•Œçš„è·ç¦»ï¼Œå¹¶æ ¹æ® <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.294ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 572 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"/></g></g></g></svg></mjx-container> æ˜¯å¦åœ¨ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.633ex" height="1.593ex" role="img" focusable="false" viewbox="0 -704 722 704"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="3A9" d="M55 454Q55 503 75 546T127 617T197 665T272 695T337 704H352Q396 704 404 703Q527 687 596 615T666 454Q666 392 635 330T559 200T499 83V80H543Q589 81 600 83T617 93Q622 102 629 135T636 172L637 177H677V175L660 89Q645 3 644 2V0H552H488Q461 0 456 3T451 20Q451 89 499 235T548 455Q548 512 530 555T483 622T424 656T361 668Q332 668 303 658T243 626T193 560T174 456Q174 380 222 233T270 20Q270 7 263 0H77V2Q76 3 61 89L44 175V177H84L85 172Q85 171 88 155T96 119T104 93Q109 86 120 84T178 80H222V83Q206 132 162 199T87 329T55 454Z"/></g></g></g></svg></mjx-container> å†…éƒ¨ç¡®å®šè·ç¦»çš„ç¬¦å·ï¼š<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.294ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 572 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"/></g></g></g></svg></mjx-container>åœ¨ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.633ex" height="1.593ex" role="img" focusable="false" viewbox="0 -704 722 704"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="3A9" d="M55 454Q55 503 75 546T127 617T197 665T272 695T337 704H352Q396 704 404 703Q527 687 596 615T666 454Q666 392 635 330T559 200T499 83V80H543Q589 81 600 83T617 93Q622 102 629 135T636 172L637 177H677V175L660 89Q645 3 644 2V0H552H488Q461 0 456 3T451 20Q451 89 499 235T548 455Q548 512 530 555T483 622T424 656T361 668Q332 668 303 658T243 626T193 560T174 456Q174 380 222 233T270 20Q270 7 263 0H77V2Q76 3 61 89L44 175V177H84L85 172Q85 171 88 155T96 119T104 93Q109 86 120 84T178 80H222V83Q206 132 162 199T87 329T55 454Z"/></g></g></g></svg></mjx-container> å†…éƒ¨ä¸ºæ­£ï¼Œä½äºå¤–éƒ¨ä¸ºè´Ÿï¼Œä½äºè¾¹ç•Œä¸Š SDF ä¸º 0</p><div class="admonition note"><p class="admonition-title">å¯¹åº”æ–‡æœ¬æ¸²æŸ“</p><p>SDF è®°å½•ç€å½“å‰åƒç´ ç‚¹è·ç¦»æŸä¸€ä¸ªåŒºåŸŸçš„æœ€å°è·ç¦»ï¼Œè¿™ä¸ªåŒºåŸŸ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.633ex" height="1.593ex" role="img" focusable="false" viewbox="0 -704 722 704"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="3A9" d="M55 454Q55 503 75 546T127 617T197 665T272 695T337 704H352Q396 704 404 703Q527 687 596 615T666 454Q666 392 635 330T559 200T499 83V80H543Q589 81 600 83T617 93Q622 102 629 135T636 172L637 177H677V175L660 89Q645 3 644 2V0H552H488Q461 0 456 3T451 20Q451 89 499 235T548 455Q548 512 530 555T483 622T424 656T361 668Q332 668 303 658T243 626T193 560T174 456Q174 380 222 233T270 20Q270 7 263 0H77V2Q76 3 61 89L44 175V177H84L85 172Q85 171 88 155T96 119T104 93Q109 86 120 84T178 80H222V83Q206 132 162 199T87 329T55 454Z"/></g></g></g></svg></mjx-container> å¯ä»¥ç†è§£ä¸ºæ–‡å­—ï¼Œå°±æ˜¯è¯´å¯ä»¥å‡è®¾åƒç´ å€¼ä¸º 0 çš„ç‚¹åœ¨åŒºåŸŸå†…ï¼Œåƒç´ å€¼ä¸º 255 çš„ç‚¹åœ¨åŒºåŸŸå¤–</p></div><h5 id="SDF- ç”Ÿæˆç®—æ³•">SDF ç”Ÿæˆç®—æ³•</h5><h6 id="Saito- çš„ç®—æ³•">Saito çš„ç®—æ³•</h6><p>æ¬§å‡ é‡Œå¾—è·ç¦»è½¬æ¢ (Euclidean Distance Transform, EDT) ç®€å•çš„è¯´å³æ˜¯ä»¥æœ€å¸¸ç”¨çš„æ¬§å‡ é‡Œå¾—è·ç¦»ä½œä¸º<br>è·ç¦»åº¦é‡ï¼Œæ‰¾åˆ°æ¯ä¸€ä¸ªå‰æ™¯ç‚¹åˆ°æœ€è¿‘çš„èƒŒæ™¯ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œæ˜¯å°†äºŒç»´å›¾ç‰‡è½¬ä¸ºä¸¤ä¸ªä¸€ç»´å‘é‡</p><p>ä¸€äº›åŸºæœ¬å®šä¹‰ï¼š</p><ul><li>èƒŒæ™¯ç‚¹ä¸º 0ï¼Œé»‘è‰²</li><li>å‰æ™¯ç‚¹ä¸º 1ï¼Œç™½è‰²</li></ul><p><strong>step1ï¼š1-D Transformation</strong></p><p>ä»ä¸Šåˆ°ä¸‹ï¼Œè®¡ç®—æ¯ä¸€è¡Œä¸­å‰æ™¯ç‚¹åˆ°æœ¬è¡ŒèƒŒæ™¯ç‚¹è·ç¦»æœ€è¿‘çš„å¹³æ–¹ï¼Œå¾—åˆ°ä¸­é—´ç»“æœ<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.778ex" height="1.645ex" role="img" focusable="false" viewbox="0 -705 786 727"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43A" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"/></g></g></g></svg></mjx-container></p><center>    <img src="/2022/08/19/45/saito-1-d-transformation.png"></center><p>å¦‚ä¸‹å›¾ï¼Œï¼ˆaï¼‰ä¸ºåŸå›¾ï¼ˆbï¼‰ä¸ºåŒä¸€è¡Œçš„è·ç¦»å¹³æ–¹å›¾ï¼Œå³<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.778ex" height="1.645ex" role="img" focusable="false" viewbox="0 -705 786 727"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43A" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"/></g></g></g></svg></mjx-container>ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="100.452ex" height="2.149ex" role="img" focusable="false" viewbox="0 -750 44400 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="merror" data-mjx-error="Missing or unrecognized delimiter for \left" title="Missing or unrecognized delimiter for \left"><rect data-background="true" width="44400" height="950" y="-200"/><title>Missing or unrecognized delimiter for \left</title><g data-mml-node="mtext" style="font-family: serif;"><text data-variant="-explicitFont" transform="scale(1,-1)" font-size="884px">  G(i, j) = \mathop{min}\limits_y \left{(j - y)^2 | F(i, y) = 0 \right}  </text></g></g></g></g></svg></mjx-container></p><p><strong>step2ï¼š2-D Transformation</strong></p><p>ä»å·¦åˆ°å³ï¼Œå¯¹æ¯ä¸€åˆ—ï¼Œå¯¹ä¸­é—´ç»“æœ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.778ex" height="1.645ex" role="img" focusable="false" viewbox="0 -705 786 727"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43A" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"/></g></g></g></svg></mjx-container> è¿›è¡Œæ“ä½œï¼Œè®¡ç®—æœ¬åˆ—èƒŒæ™¯ç‚¹ä¸æœ¬è¡ŒèƒŒæ™¯ç‚¹è·ç¦»å¹³æ–¹å’Œçš„æœ€å°å€¼ï¼Œå¾—åˆ°è·ç¦»å›¾ï¼ˆDistance Mapï¼‰<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.009ex" height="1.545ex" role="img" focusable="false" viewbox="0 -683 888 683"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43B" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 219 683Q260 681 355 681Q389 681 418 681T463 682T483 682Q499 682 499 672Q499 670 497 658Q492 641 487 638H485Q483 638 480 638T473 638T464 637T455 637Q416 636 405 634T387 623Q384 619 355 500Q348 474 340 442T328 395L324 380Q324 378 469 378H614L615 381Q615 384 646 504Q674 619 674 627T617 637Q594 637 587 639T580 648Q580 650 582 660Q586 677 588 679T604 682Q609 682 646 681T740 680Q802 680 835 681T871 682Q888 682 888 672Q888 645 876 638H874Q872 638 869 638T862 638T853 637T844 637Q805 636 794 634T776 623Q773 618 704 340T634 58Q634 51 638 51Q646 48 692 46H723Q729 38 729 37T726 19Q722 6 716 0H701Q664 2 567 2Q533 2 504 2T458 2T437 1Q420 1 420 10Q420 15 423 24Q428 43 433 45Q437 46 448 46H454Q481 46 514 49Q520 50 522 50T528 55T534 64T540 82T547 110T558 153Q565 181 569 198Q602 330 602 331T457 332H312L279 197Q245 63 245 58Q245 51 253 49T303 46H334Q340 38 340 37T337 19Q333 6 327 0H312Q275 2 178 2Q144 2 115 2T69 2T48 1Q31 1 31 10Q31 12 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"/></g></g></g></svg></mjx-container></p><center>    <img src="/2022/08/19/45/saito-2-d-transformation.png"></center><p>å¦‚ä¸‹å›¾ï¼ˆ4 å³ä½¿æœ€è¿‘è·ç¦»çš„å¹³æ–¹ï¼‰</p><h6 id="8ssedt">8ssedt</h6><p>è®¾å®šåƒç´ ç‚¹å€¼ä¸º 0 è¡¨ç¤ºç©ºï¼Œ1 è¡¨ç¤ºä¸ºç‰©ä½“ï¼Œé‚£ä¹ˆå¯¹äºä»»ä½•ä¸€ä¸ªåƒç´ ç‚¹ï¼Œæˆ‘ä»¬è¦æ‰¾è·ç¦»å®ƒæœ€è¿‘çš„ç›®æ ‡åƒç´ ç‚¹ï¼Œå°±æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li><p>åƒç´ ç‚¹å€¼ä¸º 1ï¼šè‡ªèº«å°±æ˜¯ç›®æ ‡ç‚¹ï¼Œæ‰€ä»¥è·ç¦»ä¸º 0ã€‚</p></li><li><p>åƒç´ ç‚¹å€¼ä¸º 0ï¼šç›®æ ‡ç‚¹åº”è¯¥åœ¨è‡ªå·±çš„å››å‘¨ï¼Œä½†å¯èƒ½æ˜¯ä¸Šä¸‹å·¦å³ä»»æ„ä¸€æ–¹å‘</p><ul><li>å‡å¦‚å½“å‰åƒç´ ç‚¹å‘¨å›´æœ€è¿‘çš„æŸä¸ªåƒç´ ï¼ˆä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘è·ç¦»ä¸º 1 çš„åƒç´ ï¼‰æ­£å¥½ä¸º 1ï¼Œé‚£è¿™ä¸ªåƒç´ ç‚¹çš„ SDF å°±åº”è¯¥ä¸º 1ï¼Œå› ä¸ºä¸ä¼šæœ‰æ›´è¿‘çš„æƒ…å†µäº†ï¼Œå…¶æ¬¡å°±æ˜¯å·¦ä¸Šã€å·¦ä¸‹ã€å³ä¸Šã€å³ä¸‹å››ä¸ªç‚¹ï¼Œå¦‚æœæœ‰ä¸º 1 çš„ç‚¹ï¼Œé‚£è¯¥åƒç´ ç‚¹çš„ SDF å€¼å°±åº”è¯¥ä¸º<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.225ex;" xmlns="http://www.w3.org/2000/svg" width="3.061ex" height="2.398ex" role="img" focusable="false" viewbox="0 -960.5 1353 1060"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msqrt"><g transform="translate(853,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g></g><g data-mml-node="mo" transform="translate(0,100.5)"><path data-c="221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z"/></g><rect width="500" height="60" x="853" y="840.5"/></g></g></g></svg></mjx-container>ã€‚ä»¥æ­¤ç±»æ¨ï¼Œå¦‚æœçŸ¥é“äº†å½“å‰åƒç´ ç‚¹å‘¨å›´æ‰€æœ‰åƒç´ çš„ SDF å€¼ï¼Œé‚£ä¹ˆè¯¥åƒç´ ç‚¹çš„ SDF å€¼ä¸€å®šä¸ºï¼š</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// near è¡¨ç¤ºé™„è¿‘åƒç´ ç‚¹</span></span><br><span class="line"><span class="comment">// cur è¡¨ç¤ºå½“å‰åƒç´ </span></span><br><span class="line"><span class="comment">// near.SDF è¡¨ç¤º near çš„ SDF å€¼</span></span><br><span class="line"><span class="comment">// Distance è¡¨ç¤ºä¸¤ç‚¹ä¹‹é—´è·ç¦»</span></span><br><span class="line"><span class="built_in">min</span>(near.SDF + <span class="built_in">Distance</span>(cur, near))</span><br></pre></td></tr></table></figure></li></ul><p><a class="link" href="http://www.codersnotes.com/notes/signed-distance-fields/">æºç <i class="fas fa-external-link-alt"></i></a></p><p><a class="link" href="https://www.jianshu.com/p/58271568781d">æºç ç¼–è¯‘ä¼˜åŒ–<i class="fas fa-external-link-alt"></i></a></p><h2 id="åŠ¨ç”»ç³»ç»Ÿ">åŠ¨ç”»ç³»ç»Ÿ</h2><h3 id="éª¨éª¼åŠ¨ç”»çš„åŸç†">éª¨éª¼åŠ¨ç”»çš„åŸç†</h3><h4 id="åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</h4><p>ç»™ä¸€ä¸ªæ¨¡å‹åŠ ä¸Šéª¨éª¼å‰ï¼Œä¸€èˆ¬è¦æ±‚è¿™ä¸ªæ¨¡å‹æ‘†æˆ T å­—å‹ï¼Œæ‰æ–¹ä¾¿åŠ¨ä½œå¸ˆåŠ éª¨éª¼å’ŒåšåŠ¨ä½œã€‚æ­¤æ—¶ï¼ŒåŠ éª¨éª¼æ“ä½œè¢«ç§°ä¸ºéª¨éª¼ç»‘å®š (Skeleton Binding)ï¼›æˆ–è€…ä»æ¨¡å‹è§’åº¦è®²å«åšï¼Œæ¨¡å‹è’™çš® (Model Skinning) åˆ°éª¨éª¼</p><p>è¿™ä¸ªåˆå§‹éª¨éª¼æ‘†ä½ï¼Œå°±æ˜¯ç»‘å®šå§¿åŠ¿ (Bind Poses)ã€‚ä½†è¦æ³¨æ„ï¼Œç»‘å®šå§¿åŠ¿æœ¬èº«åªè®°å½•äº†éª¨éª¼å„ä¸ªå…³èŠ‚çš„å§¿åŠ¿ä¿¡æ¯ï¼Œå¹¶ä¸åŒ…æ‹¬è’™çš®ä¿¡æ¯ã€‚è’™çš®ä¿¡æ¯æ˜¯å­˜å‚¨äºæ¨¡å‹æ•°æ®é‡Œçš„ï¼Œå› ä¸ºæ‰€è°“è’™çš®ï¼Œå³æ˜¯è®©æ¯ä¸€ä¸ªé¡¶ç‚¹ç»‘å®šè‡³ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="5.894ex" height="1.532ex" role="img" focusable="false" viewbox="0 -666 2605.3 677"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(666.7,0)"><path data-c="22EF" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250ZM525 250Q525 274 542 292T585 310Q609 310 627 294T646 251Q646 226 629 208T586 190T543 207T525 250ZM972 250Q972 274 989 292T1032 310Q1056 310 1074 294T1093 251Q1093 226 1076 208T1033 190T990 207T972 250Z"/></g><g data-mml-node="mi" transform="translate(2005.3,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g></g></g></svg></mjx-container> ä¸ªå…³èŠ‚ï¼Œè¿™ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g></g></g></svg></mjx-container> ä¸ªå…³èŠ‚è¿åŠ¨çš„æ—¶å€™ï¼Œä¼šå½±å“åˆ°è¯¥é¡¶ç‚¹çš„å½“å‰ä½ç½®</p><h4 id="å±€éƒ¨å…³èŠ‚å§¿åŠ¿ -Local-Joint-Poses">å±€éƒ¨å…³èŠ‚å§¿åŠ¿ Local Joint Poses</h4><p>å…³èŠ‚å§¿åŠ¿åˆ†ä¸ºå±€éƒ¨å…³èŠ‚å§¿åŠ¿å’Œå…¨å±€å…³èŠ‚å§¿åŠ¿ï¼Œå±€éƒ¨å…³èŠ‚å§¿åŠ¿æ˜¯ç›¸å¯¹ç›´å±çˆ¶å…³èŠ‚è€Œè¨€çš„ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªç»“æ„ä½“è¡¨ç¤ºï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">JointPose</span> {</span><br><span class="line">    Quaternion rot; <span class="comment">// R å…³èŠ‚æ—‹è½¬ä¿¡æ¯</span></span><br><span class="line">    Vector3 trans; <span class="comment">// T å…³èŠ‚ä½ç§»ä¿¡æ¯</span></span><br><span class="line">    Vector3 scale; <span class="comment">// S å…³èŠ‚ç¼©æ”¾ä¿¡æ¯</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªå…³èŠ‚åªéœ€è¦å­˜ä¸€ç»„ RTS ä¿¡æ¯ã€‚è¿™ 3 ä¸ªä¿¡æ¯å¯åˆ†åˆ«è½¬æ¢æˆ 3 ä¸ªçŸ©é˜µï¼Œå¹¶ä¸”å¯ä»¥åˆå¹¶æˆä¸€ä¸ªçŸ©é˜µã€‚åˆå¹¶åçš„çŸ©é˜µå°±è¢«ç§°ä¸ºå…³èŠ‚ä»¿å°„å˜æ¢çŸ©é˜µ<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="2.299ex" height="2.211ex" role="img" focusable="false" viewbox="0 -683 1016.3 977.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="mi" transform="translate(675,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></g></svg></mjx-container>ï¼š<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -2.249ex;" xmlns="http://www.w3.org/2000/svg" width="15.897ex" height="5.63ex" role="img" focusable="false" viewbox="0 -1494.2 7026.5 2488.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="mi" transform="translate(675,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g><g data-mml-node="mo" transform="translate(1294.1,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mrow" transform="translate(2349.9,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="5B" d="M247 -949V1450H516V1388H309V-887H516V-949H247Z"/></g><g data-mml-node="mtable" transform="translate(528,0)"><g data-mml-node="mtr" transform="translate(0,744.2)"><g data-mml-node="mtd"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D446" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"/></g><g data-mml-node="mi" transform="translate(646,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g><g data-mml-node="msub" transform="translate(987.3,0)"><g data-mml-node="mi"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"/></g><g data-mml-node="mi" transform="translate(792,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g><g data-mml-node="mtd" transform="translate(3120.7,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd" transform="translate(581.2,0)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g><g data-mml-node="mtd" transform="translate(3120.7,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g></g><g data-mml-node="mo" transform="translate(4148.7,0) translate(0 -0.5)"><path data-c="5D" d="M11 1388V1450H280V-949H11V-887H218V1388H11Z"/></g></g></g></g></svg></mjx-container><br>ä¸€ä¸ªéª¨éª¼ï¼Œå°±æ˜¯æ‰€æœ‰å…³èŠ‚ä»¿å°„å˜æ¢çš„é›†åˆï¼š<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.996ex;" xmlns="http://www.w3.org/2000/svg" width="17.476ex" height="3.04ex" role="img" focusable="false" viewbox="0 -903.7 7724.2 1343.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="TeXAtom" transform="translate(839.5,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"/></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mi" transform="translate(990,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"/></g><g data-mml-node="mi" transform="translate(1456,0)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"/></g><g data-mml-node="mi" transform="translate(1754,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"/></g><g data-mml-node="mi" transform="translate(2220,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="mi" transform="translate(2581,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"/></g><g data-mml-node="mi" transform="translate(3066,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g></g></g><g data-mml-node="mo" transform="translate(3759.5,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msub" transform="translate(4815.3,0)"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="mi" transform="translate(675,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g><g data-mml-node="msubsup" transform="translate(5831.6,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z"/></g><g data-mml-node="TeXAtom" transform="translate(311,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(888,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mn" transform="translate(1666,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g><g data-mml-node="TeXAtom" transform="translate(311,-295.9) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mn" transform="translate(1190,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g></g></g></g></g></svg></mjx-container><br>å³ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Skeleton</span> {</span><br><span class="line">    <span class="type">size_t</span> jointCount; <span class="comment">// å…³èŠ‚æ•°é‡</span></span><br><span class="line">    JointPose* local Poses; <span class="comment">// å¤šä¸ªå±€éƒ¨å…³èŠ‚å§¿åŠ¿</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>æŠŠ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="2.299ex" height="2.211ex" role="img" focusable="false" viewbox="0 -683 1016.3 977.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="mi" transform="translate(675,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></g></svg></mjx-container> åº”ç”¨åˆ°å…³èŠ‚ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.462ex;" xmlns="http://www.w3.org/2000/svg" width="0.932ex" height="1.957ex" role="img" focusable="false" viewbox="0 -661 412 865"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></svg></mjx-container> çš„å±€éƒ¨åæ ‡ç³»çš„æŸä¸ªç‚¹æˆ–å‘é‡ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="1.944ex" height="1.668ex" role="img" focusable="false" viewbox="0 -443 859.3 737.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></g></svg></mjx-container>ï¼Œå°±èƒ½æŠŠå®ƒå˜æ¢åˆ°çˆ¶å…³èŠ‚<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="1.138ex" height="1.439ex" role="img" focusable="false" viewbox="0 -442 503 636"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g></g></g></svg></mjx-container> çš„åæ ‡ç³»ï¼š<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="9.35ex" height="2.211ex" role="img" focusable="false" viewbox="0 -683 4132.9 977.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,-150) scale(0.707)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g></g><g data-mml-node="mo" transform="translate(1201.5,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msub" transform="translate(2257.2,0)"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g><g data-mml-node="msub" transform="translate(3116.6,0)"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="mi" transform="translate(675,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></g></svg></mjx-container></p><blockquote><p>å‡è®¾æœ‰ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="12.127ex" height="2.363ex" role="img" focusable="false" viewbox="0 -750 5360.2 1044.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g><g data-mml-node="mo" transform="translate(1137.1,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mo" transform="translate(2192.9,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(2581.9,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g><g data-mml-node="mo" transform="translate(3081.9,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"/></g><g data-mml-node="mn" transform="translate(3526.6,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g><g data-mml-node="mo" transform="translate(4026.6,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"/></g><g data-mml-node="mn" transform="translate(4471.2,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g><g data-mml-node="mo" transform="translate(4971.2,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>ï¼Œè¡¨ç¤ºå…³èŠ‚<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.462ex;" xmlns="http://www.w3.org/2000/svg" width="0.932ex" height="1.957ex" role="img" focusable="false" viewbox="0 -661 412 865"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></svg></mjx-container> çš„å±€éƒ¨åæ ‡ç³»çš„åœ†ç‚¹ï¼Œ<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="2.299ex" height="2.211ex" role="img" focusable="false" viewbox="0 -683 1016.3 977.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="mi" transform="translate(675,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></g></svg></mjx-container>æ˜¯ä¸€ä¸ªå¹³ç§»çŸ©é˜µ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="9.428ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4167.3 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(389,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000,0)"/></g><g data-mml-node="mo" transform="translate(1889,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"/></g><g data-mml-node="mn" transform="translate(2333.7,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g><g data-mml-node="mo" transform="translate(2833.7,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"/></g><g data-mml-node="mn" transform="translate(3278.3,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g><g data-mml-node="mo" transform="translate(3778.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>ï¼Œé‚£ä¹ˆ<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="4.244ex" height="2.211ex" role="img" focusable="false" viewbox="0 -683 1875.7 977.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="mi" transform="translate(675,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g><g data-mml-node="msub" transform="translate(1016.3,0)"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></g></svg></mjx-container> çš„ç»“æœå°±æ˜¯ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="9.428ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4167.3 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(389,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000,0)"/></g><g data-mml-node="mo" transform="translate(1889,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"/></g><g data-mml-node="mn" transform="translate(2333.7,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g><g data-mml-node="mo" transform="translate(2833.7,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"/></g><g data-mml-node="mn" transform="translate(3278.3,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g><g data-mml-node="mo" transform="translate(3778.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>ï¼Œå³<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.65ex;" xmlns="http://www.w3.org/2000/svg" width="2.09ex" height="1.652ex" role="img" focusable="false" viewbox="0 -443 923.7 730.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,-150) scale(0.707)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g></g></g></g></svg></mjx-container> è¡¨ç¤ºçˆ¶å…³èŠ‚ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="1.138ex" height="1.439ex" role="img" focusable="false" viewbox="0 -442 503 636"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g></g></g></svg></mjx-container> åæ ‡ç³»ä¸‹çš„åæ ‡<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="9.428ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4167.3 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(389,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000,0)"/></g><g data-mml-node="mo" transform="translate(1889,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"/></g><g data-mml-node="mn" transform="translate(2333.7,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g><g data-mml-node="mo" transform="translate(2833.7,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"/></g><g data-mml-node="mn" transform="translate(3278.3,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g><g data-mml-node="mo" transform="translate(3778.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></p><p>å¯ä»¥å®šä¹‰å­å…³èŠ‚ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.462ex;" xmlns="http://www.w3.org/2000/svg" width="0.932ex" height="1.957ex" role="img" focusable="false" viewbox="0 -661 412 865"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></svg></mjx-container> åˆ°çˆ¶å…³èŠ‚çš„å˜æ¢ä¸º $(P_{C \rightarrow P})<em>j<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="52.036ex" height="2.149ex" role="img" focusable="false" viewbox="0 -750 23000 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">ã€‚</text></g></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">è¿™ </text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> æ ·</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">å½¢ </text></g><g data-mml-node="mi" transform="translate(4000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> å¼</text></g><g data-mml-node="mi" transform="translate(5000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">ä¸ </text></g><g data-mml-node="mi" transform="translate(6000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> å¤ª</text></g><g data-mml-node="mi" transform="translate(7000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">å¥½ </text></g><g data-mml-node="mi" transform="translate(8000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> çœ‹</text></g><g data-mml-node="mi" transform="translate(9000,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ï¼Œ</text></g><g data-mml-node="mi" transform="translate(10000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">å¯ </text></g><g data-mml-node="mi" transform="translate(11000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> ä»¥</text></g><g data-mml-node="mi" transform="translate(12000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">æ¢ </text></g><g data-mml-node="mi" transform="translate(13000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> ä¸€</text></g><g data-mml-node="mi" transform="translate(14000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">ç§ </text></g><g data-mml-node="mi" transform="translate(15000,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ï¼Œ</text></g><g data-mml-node="mi" transform="translate(16000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> å…ˆ</text></g><g data-mml-node="mi" transform="translate(17000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">å®š </text></g><g data-mml-node="mi" transform="translate(18000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> ä¹‰</text></g><g data-mml-node="mi" transform="translate(19000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">ä¸€ </text></g><g data-mml-node="mi" transform="translate(20000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> ä¸ª</text></g><g data-mml-node="mi" transform="translate(21000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">å‡½ </text></g><g data-mml-node="mi" transform="translate(22000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> æ•°</text></g></g></g></svg></mjx-container>p(j)<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="2.149ex" role="img" focusable="false" viewbox="0 -750 1000 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ï¼Œ</text></g></g></g></svg></mjx-container>p(j)<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="9.05ex" height="2.149ex" role="img" focusable="false" viewbox="0 -750 4000 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">è¿” </text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> å›</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">å…³ </text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> èŠ‚</text></g></g></g></svg></mjx-container>j<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="20.362ex" height="2.149ex" role="img" focusable="false" viewbox="0 -750 9000 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">çš„ </text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> çˆ¶</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">å…³ </text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> èŠ‚</text></g><g data-mml-node="mi" transform="translate(4000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">ç´¢ </text></g><g data-mml-node="mi" transform="translate(5000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> å¼•</text></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(6000,0)"><g data-mml-node="mo"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">ã€‚</text></g></g><g data-mml-node="mi" transform="translate(7000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">é‚£ </text></g><g data-mml-node="mi" transform="translate(8000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> ä¹ˆ</text></g></g></g></svg></mjx-container>(P</em>{C \rightarrow P})<em>j<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="9.05ex" height="2.149ex" role="img" focusable="false" viewbox="0 -750 4000 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">å¯ </text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> ä»¥</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">å†™ </text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif"> æˆ</text></g></g></g></svg></mjx-container>P</em>{j \rightarrow p(j)}$</p></blockquote><h4 id="å…¨å±€å…³èŠ‚å§¿åŠ¿ -Global-Joint-Poses">å…¨å±€å…³èŠ‚å§¿åŠ¿ Global Joint Poses</h4><p>å±€éƒ¨å…³èŠ‚å§¿åŠ¿æ˜¯ä¸€ç§åŸå§‹ä¿¡æ¯ï¼Œå®é™…ä¸Šå†æ¸²æŸ“è’™çš®åŠ¨ç”»å‰ï¼Œéœ€è¦åšé¢„å¤„ç†ï¼ŒæŠŠå±€éƒ¨å…³èŠ‚å§¿åŠ¿è½¬æ¢æˆå…¨å±€å…³èŠ‚å§¿åŠ¿ã€‚å…¨å±€å…³èŠ‚å§¿åŠ¿å˜æ¢ï¼ŒæŒ‡çš„æ˜¯æŠŠå…³èŠ‚å§¿åŠ¿ï¼Œç”¨æ¨¡å‹ç©ºé—´åæ ‡ç³»è¡¨ç¤ºã€‚é¦–å…ˆå®šä¹‰<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="9.424ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4165.6 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g><g data-mml-node="mo" transform="translate(503,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(892,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g><g data-mml-node="mo" transform="translate(1392,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(2058.8,0)"><path data-c="2261" d="M56 444Q56 457 70 464H707Q722 456 722 444Q722 430 706 424H72Q56 429 56 444ZM56 237T56 250T70 270H707Q722 262 722 250T707 230H70Q56 237 56 250ZM56 56Q56 71 72 76H706Q722 70 722 56Q722 44 707 36H70Q56 43 56 56Z"/></g><g data-mml-node="mi" transform="translate(3114.6,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g></svg></mjx-container>ï¼Œå³æ ¹å…³èŠ‚çš„çˆ¶èŠ‚ç‚¹ä¸ºæ¨¡å‹ç©ºé—´</p><p>æ¯ä¸ªå…³èŠ‚ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.462ex;" xmlns="http://www.w3.org/2000/svg" width="0.932ex" height="1.957ex" role="img" focusable="false" viewbox="0 -661 412 865"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></svg></mjx-container> çš„å…¨å±€å…³èŠ‚å§¿åŠ¿å˜æ¢ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.699ex" height="1.545ex" role="img" focusable="false" viewbox="0 -683 751 683"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g></g></g></svg></mjx-container>ï¼Œå¯ä»¥ç”¨åˆšæ‰çš„<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.8ex;" xmlns="http://www.w3.org/2000/svg" width="6.608ex" height="2.345ex" role="img" focusable="false" viewbox="0 -683 2920.6 1036.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="TeXAtom" transform="translate(675,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g><g data-mml-node="mo" transform="translate(1915,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(2304,0)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(2716,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></g></g></svg></mjx-container> æ¥è¡¨ç¤ºï¼š</p><blockquote><p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.375ex;" xmlns="http://www.w3.org/2000/svg" width="24.139ex" height="1.92ex" role="img" focusable="false" viewbox="0 -683 10669.6 848.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="TeXAtom" transform="translate(675,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mo" transform="translate(500,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1500,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g><g data-mml-node="mo" transform="translate(2806.6,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msub" transform="translate(3862.4,0)"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="TeXAtom" transform="translate(675,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mo" transform="translate(500,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mn" transform="translate(1500,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g><g data-mml-node="msub" transform="translate(6001.6,0)"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="TeXAtom" transform="translate(675,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(500,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mn" transform="translate(1500,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g></g></g><g data-mml-node="msub" transform="translate(8140.8,0)"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="TeXAtom" transform="translate(675,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g><g data-mml-node="mo" transform="translate(500,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1500,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g></g></g></svg></mjx-container></p></blockquote><p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -3.006ex;" xmlns="http://www.w3.org/2000/svg" width="18.259ex" height="6.9ex" role="img" focusable="false" viewbox="0 -1720.9 8070.6 3049.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="TeXAtom" transform="translate(675,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g><g data-mml-node="mo" transform="translate(2744.4,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="munderover" transform="translate(3800.2,0)"><g data-mml-node="mo"><path data-c="220F" d="M220 812Q220 813 218 819T214 829T208 840T199 853T185 866T166 878T140 887T107 893T66 896H56V950H1221V896H1211Q1080 896 1058 812V-311Q1076 -396 1211 -396H1221V-450H725V-396H735Q864 -396 888 -314Q889 -312 889 -311V896H388V292L389 -311Q405 -396 542 -396H552V-450H56V-396H66Q195 -396 219 -314Q220 -312 220 -311V812Z"/></g><g data-mml-node="TeXAtom" transform="translate(96.3,-1084.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(1123,0)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g><g data-mml-node="mn" transform="translate(462.2,1150) scale(0.707)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(5244.8,0)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/></g><g data-mml-node="TeXAtom" transform="translate(675,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1345,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g><g data-mml-node="mo" transform="translate(1848,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(2237,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(2582,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></g></g></g></svg></mjx-container></p><p>å¯¹æ¯ä¸ªå…³èŠ‚éƒ½åšä¸€éè¿™ä¸ªå…¬å¼ï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªå…¨å±€å…³èŠ‚å§¿åŠ¿æ•°ç»„ã€‚ç„¶åå¯ä»¥å†™å…¥<code>SkeletonPose</code>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SkeletonPose</span> {</span><br><span class="line">    <span class="type">size_t</span> jointCount; <span class="comment">// å…³èŠ‚æ•°é‡</span></span><br><span class="line">    JointPose* localPoses; <span class="comment">// å¤šä¸ªå±€éƒ¨å…³èŠ‚å§¿åŠ¿</span></span><br><span class="line">    Matrix4x4* globalPoses; <span class="comment">// å¤šä¸ªå…¨å±€å…³èŠ‚å§¿åŠ¿</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>å…¨å±€å…³èŠ‚å§¿åŠ¿çš„å­˜å‚¨ï¼Œå¹¶ä¸åªé™å®šäºç”¨ RTSï¼Œè€Œæ˜¯æ—¢å¯ä»¥ç”¨ RTS ä¹Ÿå¯ä»¥ç”¨çŸ©é˜µã€‚å› ä¸ºå®æ—¶æ¸²æŸ“é‡ŒçŸ©é˜µæ›´é€šç”¨å¿«é€Ÿï¼Œæ‰€ä»¥å¾—å­˜æˆçŸ©é˜µ</p><h4 id="ç»‘å®šå§¿åŠ¿çŸ©é˜µï¼ˆBind-Poses-Matrixï¼‰ã€ç»‘å®šå§¿åŠ¿é€†çŸ©é˜µï¼ˆInversed-Bind-Poses-Matrixï¼‰">ç»‘å®šå§¿åŠ¿çŸ©é˜µï¼ˆBind Poses Matrixï¼‰ã€ç»‘å®šå§¿åŠ¿é€†çŸ©é˜µï¼ˆInversed Bind Poses Matrixï¼‰</h4><p>å®šä¹‰çŸ©é˜µ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="5.845ex" height="2.211ex" role="img" focusable="false" viewbox="0 -683 2583.6 977.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g></g></g></svg></mjx-container> ä¸ºå…³èŠ‚ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.462ex;" xmlns="http://www.w3.org/2000/svg" width="0.932ex" height="1.957ex" role="img" focusable="false" viewbox="0 -661 412 865"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></svg></mjx-container> åœ¨æ¨¡å‹ç©ºé—´çš„å…¨å±€ç»‘å®šå§¿åŠ¿çŸ©é˜µã€‚æ ¹æ®ä¸Šæ–‡ï¼Œ<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="6.943ex" height="2.211ex" role="img" focusable="false" viewbox="0 -683 3068.6 977.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="msub" transform="translate(485,0)"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g></g></g></svg></mjx-container>å¯ä»¥æŠŠ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.097ex" height="1.027ex" role="img" focusable="false" viewbox="0 -443 485 454"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g></g></g></svg></mjx-container> ä»å…³èŠ‚ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.462ex;" xmlns="http://www.w3.org/2000/svg" width="0.932ex" height="1.957ex" role="img" focusable="false" viewbox="0 -661 412 865"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></svg></mjx-container> çš„å±€éƒ¨ç©ºé—´å˜æ¢åˆ°æ¨¡å‹ç©ºé—´</p><p>åè¿‡æ¥ï¼Œè¦æŠŠä¸€ä¸ªç‚¹ï¼ˆæ¨¡å‹çš„ä»»æ„ä¸€ä¸ªé¡¶ç‚¹ï¼‰æˆ–å‘é‡ï¼Œå˜æ¢åˆ°å…³èŠ‚ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.462ex;" xmlns="http://www.w3.org/2000/svg" width="0.932ex" height="1.957ex" role="img" focusable="false" viewbox="0 -661 412 865"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></svg></mjx-container> çš„ç©ºé—´ï¼Œå°±æ˜¯ï¼š<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="11.557ex" height="2.666ex" role="img" focusable="false" viewbox="0 -883.9 5108.3 1178.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(485,0)"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"/></g><g data-mml-node="mo" transform="translate(760,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="msub" transform="translate(1149,0)"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g><g data-mml-node="msup" transform="translate(3732.6,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="TeXAtom" transform="translate(422,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="11.557ex" height="2.552ex" role="img" focusable="false" viewbox="0 -833.9 5108.3 1128.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(485,0)"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"/></g><g data-mml-node="mo" transform="translate(760,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="msub" transform="translate(1149,0)"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g><g data-mml-node="msup" transform="translate(3732.6,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="TeXAtom" transform="translate(422,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g></g></g></svg></mjx-container>å°±æ˜¯ç»‘å®šå§¿åŠ¿é€†çŸ©é˜µï¼Œä¹Ÿå¯ä»¥å†™æˆï¼š<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="18.7ex" height="2.666ex" role="img" focusable="false" viewbox="0 -883.9 8265.4 1178.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="msub" transform="translate(389,0)"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g><g data-mml-node="msup" transform="translate(2972.6,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="TeXAtom" transform="translate(422,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g><g data-mml-node="mo" transform="translate(4626.1,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msub" transform="translate(5681.8,0)"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g><g data-mml-node="mo" transform="translate(1051,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(2051,0)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></g></g></svg></mjx-container><br>å†å®šä¹‰ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.679ex;" xmlns="http://www.w3.org/2000/svg" width="2.966ex" height="2.593ex" role="img" focusable="false" viewbox="0 -846 1311.2 1145.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msubsup"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,363) scale(0.707)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="mi" transform="translate(518,-300) scale(0.707)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g></g></svg></mjx-container> ä¸ºæ¨¡å‹ä»»æ„é¡¶ç‚¹ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.097ex" height="1.027ex" role="img" focusable="false" viewbox="0 -443 485 454"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g></g></g></svg></mjx-container> åœ¨ç»‘å®šå§¿åŠ¿çš„æ¨¡å‹ç©ºé—´åæ ‡ï¼Œè€Œ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.7ex;" xmlns="http://www.w3.org/2000/svg" width="2.966ex" height="2.663ex" role="img" focusable="false" viewbox="0 -867.7 1311.2 1177"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msubsup"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,369.2) scale(0.707)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"/></g><g data-mml-node="mi" transform="translate(518,-309.4) scale(0.707)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g></g></svg></mjx-container> ä¸ºå½“å‰å§¿åŠ¿çš„æ¨¡å‹ç©ºé—´åæ ‡ã€‚å¦‚æœè¦æ±‚ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.679ex;" xmlns="http://www.w3.org/2000/svg" width="2.966ex" height="2.593ex" role="img" focusable="false" viewbox="0 -846 1311.2 1145.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msubsup"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,363) scale(0.707)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="mi" transform="translate(518,-300) scale(0.707)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g></g></svg></mjx-container> åœ¨å…³èŠ‚ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.462ex;" xmlns="http://www.w3.org/2000/svg" width="0.932ex" height="1.957ex" role="img" focusable="false" viewbox="0 -661 412 865"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></svg></mjx-container> çš„å±€éƒ¨ç©ºé—´åæ ‡<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="1.944ex" height="1.668ex" role="img" focusable="false" viewbox="0 -443 859.3 737.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></g></svg></mjx-container>ï¼Œåˆ™å…¬å¼ä¸ºï¼š<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="29.594ex" height="2.693ex" role="img" focusable="false" viewbox="0 -896 13080.7 1190.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g><g data-mml-node="mo" transform="translate(1137.1,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msubsup" transform="translate(2192.9,0)"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,413) scale(0.707)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="mi" transform="translate(518,-250) scale(0.707)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g><g data-mml-node="msub" transform="translate(3504.1,0)"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g><g data-mml-node="mo" transform="translate(1051,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(2051,0)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g><g data-mml-node="mo" transform="translate(6365.4,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msubsup" transform="translate(7421.2,0)"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,413) scale(0.707)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="mi" transform="translate(518,-250) scale(0.707)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g><g data-mml-node="mo" transform="translate(8732.4,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="msub" transform="translate(9121.4,0)"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g><g data-mml-node="msup" transform="translate(11705,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="TeXAtom" transform="translate(422,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g></g></g></svg></mjx-container><br>ç„¶åå†ä¹˜ä»¥å½“å‰å§¿åŠ¿çš„å§¿åŠ¿çŸ©é˜µ<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.719ex" height="1.645ex" role="img" focusable="false" viewbox="0 -705 760 727"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"/></g></g></g></svg></mjx-container>ï¼ˆä¸æ˜¯ç»‘å®šå§¿åŠ¿ï¼‰ï¼Œå¾—åˆ°å½“å‰å§¿åŠ¿çš„æ¨¡å‹ç©ºé—´åæ ‡<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.7ex;" xmlns="http://www.w3.org/2000/svg" width="2.966ex" height="2.663ex" role="img" focusable="false" viewbox="0 -867.7 1311.2 1177"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msubsup"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,369.2) scale(0.707)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"/></g><g data-mml-node="mi" transform="translate(518,-309.4) scale(0.707)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g></g></svg></mjx-container>ï¼š<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="13.673ex" height="2.728ex" role="img" focusable="false" viewbox="0 -911.5 6043.7 1205.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msubsup"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,413) scale(0.707)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"/></g><g data-mml-node="mi" transform="translate(518,-265.5) scale(0.707)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g><g data-mml-node="mo" transform="translate(1588.9,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msub" transform="translate(2644.7,0)"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g><g data-mml-node="msub" transform="translate(3504.1,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"/></g><g data-mml-node="TeXAtom" transform="translate(748,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g></g></g></svg></mjx-container></p><h4 id="è’™çš®çŸ©é˜µ -Skinning-Matrix">è’™çš®çŸ©é˜µ Skinning Matrix</h4><p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="68.946ex" height="2.728ex" role="img" focusable="false" viewbox="0 -911.5 30474.3 1205.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msubsup"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,413) scale(0.707)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"/></g><g data-mml-node="mi" transform="translate(518,-265.5) scale(0.707)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g><g data-mml-node="mo" transform="translate(1588.9,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msub" transform="translate(2644.7,0)"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g><g data-mml-node="msub" transform="translate(3504.1,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"/></g><g data-mml-node="TeXAtom" transform="translate(748,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g><g data-mml-node="mo" transform="translate(6321.4,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msubsup" transform="translate(7377.2,0)"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,413) scale(0.707)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="mi" transform="translate(518,-250) scale(0.707)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g><g data-mml-node="mo" transform="translate(8688.4,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="msub" transform="translate(9077.4,0)"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g><g data-mml-node="msup" transform="translate(11661,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="TeXAtom" transform="translate(422,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g><g data-mml-node="msub" transform="translate(13036.7,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"/></g><g data-mml-node="TeXAtom" transform="translate(748,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g><g data-mml-node="mo" transform="translate(15854,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msubsup" transform="translate(16909.8,0)"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/></g><g data-mml-node="mi" transform="translate(518,413) scale(0.707)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="mi" transform="translate(518,-250) scale(0.707)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g><g data-mml-node="msub" transform="translate(18221,0)"><g data-mml-node="mi"><path data-c="1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"/></g><g data-mml-node="mi" transform="translate(882,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g><g data-mml-node="mspace" transform="translate(19444.3,0)"/><g data-mml-node="msub" transform="translate(19444.3,0)"><g data-mml-node="mi"><path data-c="1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"/></g><g data-mml-node="mi" transform="translate(882,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g><g data-mml-node="mo" transform="translate(20945.4,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msub" transform="translate(22001.2,0)"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="mi" transform="translate(792,-150) scale(0.707)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g><g data-mml-node="mo" transform="translate(23586.4,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="msub" transform="translate(23975.4,0)"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g><g data-mml-node="msup" transform="translate(26559,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="TeXAtom" transform="translate(422,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g><g data-mml-node="msub" transform="translate(27934.7,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"/></g><g data-mml-node="TeXAtom" transform="translate(748,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g></g></g></svg></mjx-container></p><p><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="2.768ex" height="2.211ex" role="img" focusable="false" viewbox="0 -683 1223.3 977.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"/></g><g data-mml-node="mi" transform="translate(882,-150) scale(0.707)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></g></svg></mjx-container>å°±æ˜¯å…³èŠ‚ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.462ex;" xmlns="http://www.w3.org/2000/svg" width="0.932ex" height="1.957ex" role="img" focusable="false" viewbox="0 -661 412 865"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></svg></mjx-container> çš„è’™çš®çŸ©é˜µäº†ï¼šæŠŠç»‘å®šå§¿åŠ¿æ¨¡å‹ç©ºé—´ä¸‹çš„é¡¶ç‚¹ï¼Œå…ˆè½¬æ¢åˆ°ç»‘å®šå§¿åŠ¿å…³èŠ‚ç©ºé—´ï¼Œç„¶åå†è½¬æ¢åˆ°å½“å‰å§¿åŠ¿æ¨¡å‹ç©ºé—´</p><p>ozz-animation ä¸­ç®— <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.011ex" height="1.545ex" role="img" focusable="false" viewbox="0 -683 889 683"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"/></g></g></g></svg></mjx-container> çŸ©é˜µçš„ä»£ç ç‰‡æ®µï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; models.<span class="built_in">Count</span>(); ++j) {</span><br><span class="line">    skinning_matirces[j] = models[j] * mesh.inverse_bind_poses[j];</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p><code>models[j]</code>å°±æ˜¯å½“å‰å§¿åŠ¿å½“å‰æ—¶åˆ»ç¬¬ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.462ex;" xmlns="http://www.w3.org/2000/svg" width="0.932ex" height="1.957ex" role="img" focusable="false" viewbox="0 -661 412 865"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g></g></g></svg></mjx-container> çš„å…³èŠ‚çš„ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="5.746ex" height="2.261ex" role="img" focusable="false" viewbox="0 -705 2539.6 999.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"/></g><g data-mml-node="TeXAtom" transform="translate(748,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g></g></g></svg></mjx-container>ï¼›<code>mesh.inverse_bind_poses[j]</code> å°±æ˜¯<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="9.838ex" height="2.552ex" role="img" focusable="false" viewbox="0 -833.9 4348.3 1128.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="msub" transform="translate(389,0)"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"/></g><g data-mml-node="mo" transform="translate(412,0)"><path data-c="2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(1412,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"/></g></g></g><g data-mml-node="msup" transform="translate(2972.6,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="TeXAtom" transform="translate(422,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g></g></g></svg></mjx-container>ï¼Œè¿™ä¸ªé€†çŸ©é˜µæ˜¯é¢„å…ˆç®—å¥½çš„ï¼Œæ¯”è¿è¡Œæ—¶å†ç®—é€†çŸ©é˜µè¦å¿«å¾—å¤šï¼Œä¸€èˆ¬çš„è’™çš®åŠ¨ç”»å¼•æ“éƒ½æ˜¯è¿™æ ·åš</p><h3 id="Animation- å’Œ -Animator">Animation å’Œ Animator</h3><ul><li>Animatorï¼šåŠ¨ç”»æ§åˆ¶å™¨ï¼Œæ§åˆ¶ Mecanim åŠ¨ç”»ç³»ç»Ÿçš„æ¥å£ï¼Œç”¨æ¥ç®¡ç†å¤šä¸ªåŠ¨ç”»ï¼›</li><li>Animationï¼šç”¨äºæ’­æ”¾åŠ¨ç”»ï¼Œè€ç‰ˆä¸­å•ç‹¬çš„ä¸€ä¸ª Animation ä¹Ÿå¯ä»¥å®ŒæˆåŠ¨ç”»çš„æ’­æ”¾å’Œåˆ‡æ¢ï¼Œä¸è¿‡çŠ¶æ€åˆ‡æ¢ä¹‹ç±»çš„éœ€è¦ç¨‹åºä»£ç æ§åˆ¶ã€‚åœ¨æ–°ç‰ˆä¸­ï¼ŒçŠ¶æ€ç®¡ç†éƒ¨åˆ†äº¤ç»™äº† Animatorï¼›</li><li>AnimationClipï¼šåŠ¨ç”»å‰ªè¾‘ç‰‡æ®µï¼Œå‚¨å­˜åŸºäºå…³é”®å¸§çš„åŠ¨ç”»ï¼Œæ˜¯ç”¨äº Animation æ¥æ’­æ”¾åŠ¨ç”»ï¼›</li><li>AnimationStateï¼šåŠ¨ç”»çŠ¶æ€ï¼Œç”¨æ¥æ”¹å˜å•ä¸€åŠ¨ç”»çš„æ’­æ”¾é€Ÿåº¦ã€æƒé‡ã€æ—¶é—´ã€å±‚çº§ã€æ’­æ”¾ Modeï¼Œä»¥åŠæ··åˆæ¨¡å¼ï¼›</li><li>AnimationEventï¼šåŠ¨ç”»äº‹ä»¶ï¼Œç”¨äºæŸç§æ¡ä»¶ä¸‹è§¦å‘è‡ªå®šä¹‰å‡½æ•°ï¼›</li><li>StateMachineBehaviourï¼š åŠ¨ç”»çŠ¶æ€æœºç®¡ç†å™¨æ‹“å±•ç±»ï¼Œè„šæœ¬ç»§æ‰¿äº†è¯¥ç±»ä¹‹åï¼Œç»‘å®šåˆ° Animator ä¸ŠæŸ State ä¸Šé¢ã€‚å½“çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥é‡è½½å“åº”å‡½æ•°ã€‚ç±»ä¼¼ è§¦å‘å™¨çš„å“åº”å‡½æ•°ï¼›</li></ul><h3 id="Animator- çš„æ€§èƒ½ç¼ºé™·">Animator çš„æ€§èƒ½ç¼ºé™·</h3><p>ä»€ä¹ˆæ˜¯ Animator Overrideã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸ªå¤šä¸ªä¸åŒçš„è§’è‰²ï¼Œä»–ä»¬éƒ½æœ‰ç›¸åŒçš„åŠ¨ä½œï¼Œä¾‹å¦‚å¾…æœºï¼Œè·‘æ­¥ï¼Œæ”»å‡»ç­‰ç­‰ï¼Œå¹¶ä¸”è§¦å‘æ¡ä»¶ä¹Ÿéƒ½ç›¸åŒã€‚ä½†æ˜¯ä¸ºäº†åŒºåˆ†è§’è‰²ï¼Œä»–ä»¬ç›¸åŒçš„åŠ¨ä½œå¯¹åº”çš„åŠ¨ç”»å¾€å¾€éƒ½ä¸ç›¸åŒï¼Œä¾‹å¦‚ä¸‹å›¾ä¸åŒçš„è·‘æ­¥åŠ¨ç”»ï¼š</p><center>    <viedo src="animator-override.mp4"></viedo></center><p>Unity ä¼šå°è¯•æŠŠ AnimatorController é‡Œæ‰€æœ‰çš„ State åˆå¹¶åˆ°ä¸€ä¸ªåä¸º Animationset çš„æ•°æ®ç»“æ„ä¸­ã€‚è¿™æ„å‘³ç€æ‰€æœ‰çš„ AnimationClip å†ä¹˜ä¸Šæ‰€æœ‰ Clip é‡Œæ‰€ç”¨çš„æ›²çº¿éƒ½è¦ç»è¿‡ä¸€ç³»åˆ—çš„è¿ç®—ã€‚å› æ­¤æˆ‘ä»¬çš„ State å’Œ AnimationClip è¶Šå¤šè¶Šå¤æ‚ï¼Œè¿™ä¸ªè¿ç®—çš„è€—æ—¶ä¹Ÿä¼šå¢åŠ ï¼Œå¯¼è‡´æ€§èƒ½é—®é¢˜</p><h2 id="Lua">Lua</h2><h3 id="Lua- å¦‚ä½•å®ç°é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§">Lua å¦‚ä½•å®ç°é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§</h3><h4 id="é¢å‘å¯¹è±¡çš„å®ç°">é¢å‘å¯¹è±¡çš„å®ç°</h4><ul><li><font color="#6DA9E4">ç±» </font>ï¼šè¿™æ˜¯å¯¹è±¡çš„å…ƒè¡¨ï¼Œåœ¨è®¿é—®ä¸åˆ°å¯¹è±¡çš„å­—æ®µæ—¶ï¼Œä¼šè§¦å‘ç±»çš„<code>index</code>ï¼Œè€Œ<code>index</code> å¯ä»¥è®¾ä¸ºç±»è‡ªå·±ï¼Œè¿™æ ·å°±å˜æˆè®¿é—®ç±»çš„å­—æ®µã€‚é€šå¸¸æˆ‘ä»¬æŠŠå¯¹è±¡çš„åŠŸèƒ½å‡½æ•°æ”¾åœ¨ç±»ä¸­ï¼Œè®©è¯¥ç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½å…±äº«ä¸€å¥—å‡½æ•°</li><li><font color="#6DA9E4">ç±»çš„å…ƒè¡¨</font>ï¼šè¿™ä¸ªè¡¨æ˜¯ä¸ºäº†å®ç°ç»§æ‰¿ï¼Œç±»ä¹Ÿæ‰¾ä¸åˆ°å­—æ®µæ—¶ï¼Œä¼šè§¦å‘ç±»çš„å…ƒè¡¨çš„<code>__index</code>ï¼Œè¿™é‡Œä¼šå–å‡ºçˆ¶ç±»å¹¶ç»§ç»­è®¿é—®ï¼Œå¦‚æ­¤å¾ªç¯ï¼Œä¸€ç›´åˆ°çˆ¶ç±»ä¸ºç©ºä¸ºæ­¢ã€‚</li><li><font color="#6DA9E4">å¯¹è±¡</font>ï¼šè¿™å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„<code>table</code>ï¼ŒæŠŠå®ƒçš„å…ƒè¡¨è®¾ä¸ºæŒ‡å®šçš„ç±»ï¼Œé‚£ä¹ˆå®ƒå°±è¢«ç§°ä¸ºè¯¥ç±»çš„å¯¹è±¡</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- rtl.lua</span></span><br><span class="line"><span class="keyword">local</span> rtl = {}</span><br><span class="line"><span class="keyword">local</span> ksuper = {}   <span class="comment">-- ä½œä¸ºæŸ¥æ‰¾çˆ¶ç±»çš„ key</span></span><br><span class="line"><span class="comment">-- å®šä¹‰ä¸€ä¸ªç±»ï¼Œsuper æ˜¯çˆ¶ç±»ï¼Œä¸º nil è¡¨ç¤ºæ²¡æœ‰çˆ¶ç±»</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rtl.class</span><span class="params">(super)</span></span></span><br><span class="line">    <span class="keyword">local</span> klass = {}        <span class="comment">-- è¿™å°±æ˜¯ä»£è¡¨ç±»çš„ table</span></span><br><span class="line">    klass[ksuper] = super   <span class="comment">-- æŠŠçˆ¶ç±» table ä¿å­˜èµ·æ¥</span></span><br><span class="line">    klass.<span class="built_in">__index</span> = klass   <span class="comment">-- __index è®¾ä¸ºè‡ªå·±</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> _class_metatable = rtl._class_metatable   <span class="comment">-- è¿™æ˜¯ç±»çš„å…ƒè¡¨ï¼Œæ‰€æœ‰ç±»éƒ½è®¾ç½®åŒä¸€ä¸ªå…ƒè¡¨</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> _class_metatable <span class="keyword">then</span></span><br><span class="line">        _class_metatable = {</span><br><span class="line">            <span class="built_in">__index</span> = <span class="function"><span class="keyword">function</span> <span class="params">(t, k)</span></span></span><br><span class="line">                <span class="comment">-- å–å¾—ç±»çš„çˆ¶ç±»</span></span><br><span class="line">                <span class="keyword">local</span> super = <span class="built_in">rawget</span>(t, ksuper)</span><br><span class="line">                <span class="keyword">if</span> super <span class="keyword">then</span></span><br><span class="line">                    <span class="comment">-- ç„¶åç»§ç»­è®¿é—® kï¼Œå¦‚æœæ‰¾ä¸åˆ°è¿˜ä¼šè§¦å‘è¿™ä¸ª__indexï¼Œä¸€ç›´å¾€ä¸Šè¿½æº¯</span></span><br><span class="line">                    <span class="keyword">return</span> super[k]</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span>,</span><br><span class="line"></span><br><span class="line">            <span class="built_in">__call</span> = <span class="function"><span class="keyword">function</span> <span class="params">(cls, ...)</span></span></span><br><span class="line">                <span class="comment">-- åˆ›å»ºç±»çš„å¯¹è±¡ï¼Œcls å°±æ˜¯ç±»</span></span><br><span class="line">                <span class="keyword">local</span> obj = {}</span><br><span class="line">                <span class="comment">-- å°† cls è®¾ä¸º obj çš„å…ƒè¡¨ï¼Œæ‰¾ä¸åˆ° obj çš„å­—æ®µæ—¶ï¼Œå°±ä¼šè§¦å‘ klass.__index</span></span><br><span class="line">                <span class="comment">-- è€Œ__index æŒ‡å‘ kclass è‡ªå·±ï¼Œæ‰€ä»¥ç›¸å½“äºåœ¨ kclass ä¸Šè®¿é—®å­—æ®µã€‚</span></span><br><span class="line">                <span class="built_in">setmetatable</span>(obj, cls)</span><br><span class="line">                <span class="comment">-- çº¦å®š_init ä¸ºç±»çš„æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥è¿™é‡Œä¼šè°ƒç”¨æ„é€ å‡½æ•°</span></span><br><span class="line">                <span class="keyword">local</span> _init = cls._init</span><br><span class="line">                <span class="keyword">if</span> _init <span class="keyword">then</span></span><br><span class="line">                    _init(obj, ...)</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="comment">-- æœ€åè¿”å›è¿™ä¸ªå¯¹è±¡</span></span><br><span class="line">                <span class="keyword">return</span> obj</span><br><span class="line">            <span class="keyword">end</span>  </span><br><span class="line">        }</span><br><span class="line">        rtl._class_metatable = _class_metatable</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- è®¾ç½®ç±»çš„å…ƒè¡¨</span></span><br><span class="line">    <span class="built_in">setmetatable</span>(klass, _class_metatable) </span><br><span class="line">    <span class="comment">-- æœ€åè¿”å›ç±»</span></span><br><span class="line">    <span class="keyword">return</span> klass</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">return</span> rtl</span><br></pre></td></tr></table></figure><h4 id="é¡¹ç›®ä¸­çš„å¤šç»§æ‰¿å®ç°">é¡¹ç›®ä¸­çš„å¤šç»§æ‰¿å®ç°</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">class</span><span class="params">(classname, ...)</span></span></span><br><span class="line">    <span class="keyword">local</span> cls = {__cname = classname}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> supers = {...}</span><br><span class="line">    <span class="keyword">for</span> _, super <span class="keyword">in</span> <span class="built_in">ipairs</span>(supers) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> superType = <span class="built_in">type</span>(super)</span><br><span class="line">        <span class="built_in">assert</span>(superType == <span class="string">"nil"</span> <span class="keyword">or</span> superType == <span class="string">"table"</span> <span class="keyword">or</span> superType == <span class="string">"function"</span>,</span><br><span class="line">            <span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"class() - create class \"%s\"with invalid super class type \"%s\""</span>,</span><br><span class="line">                classname, superType))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> superType == <span class="string">"function"</span> <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">assert</span>(cls.__create == <span class="literal">nil</span>,</span><br><span class="line">                <span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"class() - create class \"%s\" with more than one creating function"</span>,</span><br><span class="line">                    classname));</span><br><span class="line">            <span class="comment">-- if super is function, set it to __create</span></span><br><span class="line">            cls.__create = super</span><br><span class="line">        <span class="keyword">elseif</span> superType == <span class="string">"table"</span> <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">if</span> super[<span class="string">".isclass"</span>] <span class="keyword">then</span></span><br><span class="line">                <span class="comment">-- super is native class</span></span><br><span class="line">                <span class="built_in">assert</span>(cls.__create == <span class="literal">nil</span>,</span><br><span class="line">                    <span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"class() - create class \"%s\" with more than one creating function or native class"</span>,</span><br><span class="line">                        classname));</span><br><span class="line">                cls.__create = <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">return</span> super:<span class="built_in">create</span>() <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="comment">-- super is pure lua class</span></span><br><span class="line">                cls.__supers = cls.__supers <span class="keyword">or</span> {}</span><br><span class="line">                cls.__supers[#cls.__supers + <span class="number">1</span>] = super</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> cls.super <span class="keyword">then</span></span><br><span class="line">                    <span class="comment">-- set first super pure lua class as class.super</span></span><br><span class="line">                    cls.super = super</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">error</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"class() - create class \"%s\" with invalid super type"</span>,</span><br><span class="line">                        classname), <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    cls.<span class="built_in">__index</span> = cls</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cls.__supers <span class="keyword">or</span> #cls.__supers == <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">setmetatable</span>(cls, {<span class="built_in">__index</span> = cls.super})</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">setmetatable</span>(cls, {<span class="built_in">__index</span> = <span class="function"><span class="keyword">function</span><span class="params">(_, key)</span></span></span><br><span class="line">            <span class="keyword">local</span> supers = cls.__supers</span><br><span class="line">            <span class="keyword">for</span> i = <span class="number">1</span>, #supers <span class="keyword">do</span></span><br><span class="line">                <span class="keyword">local</span> super = supers[i]</span><br><span class="line">                <span class="keyword">if</span> super[key] <span class="keyword">then</span> <span class="keyword">return</span> super[key] <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span>})</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cls.ctor <span class="keyword">then</span></span><br><span class="line">        <span class="comment">-- add default constructor</span></span><br><span class="line">        cls.ctor = <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    cls.new = <span class="function"><span class="keyword">function</span><span class="params">(...)</span></span></span><br><span class="line">        <span class="keyword">local</span> instance</span><br><span class="line">        <span class="keyword">if</span> cls.__create <span class="keyword">then</span></span><br><span class="line">            instance = cls.__create(...)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            instance = {}</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        setmetatableindex(instance, cls)</span><br><span class="line">        instance.class = cls</span><br><span class="line">        instance:ctor(...)</span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    cls.<span class="built_in">create</span> = <span class="function"><span class="keyword">function</span><span class="params">(_, ...)</span></span></span><br><span class="line">        <span class="keyword">return</span> cls.new(...)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cls</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> setmetatableindex_</span><br><span class="line">setmetatableindex_ = <span class="function"><span class="keyword">function</span><span class="params">(t, index)</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(t) == <span class="string">"userdata"</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">local</span> peer = tolua.getpeer(t)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> peer <span class="keyword">then</span></span><br><span class="line">            peer = {}</span><br><span class="line">            tolua.setpeer(t, peer)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        setmetatableindex_(peer, index)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">local</span> mt = <span class="built_in">getmetatable</span>(t)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> mt <span class="keyword">then</span> mt = {} <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> mt.<span class="built_in">__index</span> <span class="keyword">then</span></span><br><span class="line">            mt.<span class="built_in">__index</span> = index</span><br><span class="line">            <span class="built_in">setmetatable</span>(t, mt)</span><br><span class="line">        <span class="keyword">elseif</span> mt.<span class="built_in">__index</span> ~= index <span class="keyword">then</span></span><br><span class="line">            setmetatableindex_(mt, index)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">setmetatableindex = setmetatableindex_</span><br></pre></td></tr></table></figure><h2 id="UI">UI</h2><h3 id="ä»€ä¹ˆæ˜¯å›¾é›†ã€å›¾é›†çš„ä½œç”¨">ä»€ä¹ˆæ˜¯å›¾é›†ã€å›¾é›†çš„ä½œç”¨</h3><ul><li><p>æ‰€è°“å›¾é›†å°±æ˜¯å°†å¾ˆå¤šé›¶ç¢çš„ 2 ç»´å°å›¾æ•´åˆæˆä¸€å¼ å¤§å›¾</p></li><li><p>å›¾é›†çš„ä½œç”¨</p><ul><li><p>æå‡æ•ˆç‡ï¼šå›¾ç‰‡å°ºå¯¸ä¸º 2 çš„æ¬¡å¹‚æ—¶ï¼ŒGPU å¤„ç†èµ·æ¥ä¼šå¿«å¾ˆå¤šï¼Œå°å›¾è‡ªå·±æ˜¯åšä¸åˆ°æ¯å¼ å›¾éƒ½æ˜¯ 2 çš„æ¬¡å¹‚çš„ï¼Œä½†æ‰“æˆä¸€å¼ å¤§å›¾å°±å¯ä»¥</p></li><li><p>UI çš„åˆæ‰¹ç†å‡å°‘ DrawCallï¼šæ‰“æˆå›¾é›†åï¼ŒCPU åœ¨ä¼ é€èµ„æºä¿¡æ¯ç»™ GPU æ—¶ï¼Œåªéœ€è¦ä¼ ä¸€å¼ å¤§å›¾å°±å¯ä»¥äº†ï¼Œå› ä¸º GPU å¯ä»¥åœ¨è¿™å¼ å›¾ä¸­çš„ä¸åŒåŒºåŸŸè¿›è¡Œé‡‡æ ·ï¼Œç„¶åæ‹¼å‡ºå¯¹åº”çš„ç•Œé¢</p><blockquote><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸€ä¸ª UI ç•Œé¢éœ€è¦ç”¨åŒä¸€ä¸ªå›¾é›†çš„åŸå› </p></blockquote></li><li><p>é¿å…æµªè´¹èµ„æºï¼šæ‰“æˆå›¾é›†åæŠŠå›¾ç‰‡ä¸Šçš„ç©ºé—´å°½é‡åˆ©ç”¨å¾—å……å®ä¸€ç‚¹</p></li></ul></li></ul><h3 id="è€ç‰ˆçš„ -Sprite-Packer- å’Œæ–°ç‰ˆçš„ -Sprite-Altas- çš„åŒºåˆ«">è€ç‰ˆçš„ Sprite Packer å’Œæ–°ç‰ˆçš„ Sprite Altas çš„åŒºåˆ«</h3><ul><li>Sprite Packerï¼š2017.3 åŠä¹‹å‰ä½¿ç”¨çš„å›¾é›†æ–¹æ¡ˆï¼Œé€šè¿‡å¯¹ Sprite æ‰“ Tag çš„æ–¹å¼ï¼Œæ¥è‡ªåŠ¨ç”Ÿæˆå›¾é›†ã€‚å¯ä»¥è‡ªå®šä¹‰æ‰“å›¾é›†çš„ç­–ç•¥</li><li>Sprite Altasï¼š2017.4 æ–°å‡ºçš„å›¾é›†æ–¹æ¡ˆï¼Œç”¨æ¥æ›¿ä»£ Sprite Packerã€‚Sprite Packer å’Œ Sprite Atlas ä¸èƒ½å…±å­˜ï¼ŒUnity çš„ Sprite Packer Mode ä¸­çš„å•é€‰æ€§å†³å®šäº†è¿™ä¸ªä¸èƒ½å…±å­˜çš„æ€§è´¨</li><li>Sprite Atlas é’ˆå¯¹ Sprite Packer å›¾é›†æ‰“åŒ…ç³»ç»Ÿåœ¨æ€§èƒ½å’Œæ˜“ç”¨æ€§ä¸Šçš„ä¸è¶³ï¼Œè¿›è¡Œäº†å…¨é¢æ”¹å–„</li></ul><h3 id="UGUI- çš„ä¼˜åŒ–ã€å®ç°è¿‡æœ€å¤æ‚çš„ -UI- é¢æ¿æ˜¯ä»€ä¹ˆã€ç®€è¿°ä¸€ä¸‹è‡ªå·±é¡¹ç›®ä¸­å®ç°çš„ -UI- æ¡†æ¶">UGUI çš„ä¼˜åŒ–ã€å®ç°è¿‡æœ€å¤æ‚çš„ UI é¢æ¿æ˜¯ä»€ä¹ˆã€ç®€è¿°ä¸€ä¸‹è‡ªå·±é¡¹ç›®ä¸­å®ç°çš„ UI æ¡†æ¶</h3><h4 id="æ€§èƒ½æ¶ˆè€—çš„å…³é”®ç‚¹">æ€§èƒ½æ¶ˆè€—çš„å…³é”®ç‚¹</h4><p>unity å°† UI çš„æ¸²æŸ“åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼Œå¯¹ mesh çš„æ“ä½œç§°ä¸º Rebatchï¼Œå¯¹ material å’Œ layout çš„æ“ä½œç§°ä¸º Rebuildï¼Œæ‰€ä»¥æ€§èƒ½æ¶ˆè€—ä¹Ÿæ˜¯åœ¨è¿™ä¸¤ä¸ªéƒ¨åˆ†ã€‚</p><h5 id="Rebatch- çš„å†…éƒ¨å®ç°">Rebatch çš„å†…éƒ¨å®ç°</h5><p>Rebatch å‘ç”Ÿåœ¨ C++ å±‚é¢ï¼Œæ˜¯æŒ‡ Canvas åˆ†æ UI èŠ‚ç‚¹ç”Ÿæˆæœ€ä¼˜æ‰¹æ¬¡çš„è¿‡ç¨‹ï¼ŒèŠ‚ç‚¹æ•°é‡è¿‡å¤šä¼šå¯¼è‡´ç®—æ³•ï¼ˆè´ªå¿ƒç­–ç•¥ï¼‰è€—æ—¶è¾ƒé•¿ã€‚å¯¹åº” SetVerticesDirtyï¼Œå½“ä¸€ä¸ª canvas ä¸­åŒ…å«çš„ mesh å‘ç”Ÿæ”¹å˜æ—¶å°±è§¦å‘ï¼Œä¾‹å¦‚ SetActiveã€transform çš„æ”¹å˜ã€ é¢œè‰²æ”¹å˜ã€æ–‡æœ¬å†…å®¹æ”¹å˜ç­‰ç­‰ï¼Œcanvas ç‹¬ç«‹å¤„ç†ï¼Œäº’ç›¸ä¸å½±å“ã€‚æ¶ˆè€—åœ¨å¯¹ meshes æŒ‰ç…§æ·±åº¦å’Œé‡å æƒ…å†µæ’åºã€å…±äº«æè´¨çš„æ£€æµ‹ç­‰ã€‚</p><p>Batch ä»¥ Canvas ä¸ºå•ä½ï¼ŒåŒä¸€ä¸ª Canvas ä¸‹çš„ UI å…ƒç´ æœ€ç»ˆéƒ½ä¼šè¢« Batch åˆ°ä¸€ä¸ª Mesh ä¸­ã€‚Batch å‰ï¼ŒUGUI æ ¹æ® UI æè´¨ä»¥åŠæ¸²æŸ“é¡ºåºé‡æ’ï¼Œåœ¨ä¸æ”¹å˜æ¸²æŸ“ç»“æœçš„å‰æä¸‹ï¼Œå°½å¯èƒ½å°†ç›¸åŒæè´¨çš„ UI å…ƒç´ åˆå¹¶åœ¨åŒä¸€ä¸ª SubMesh ä¸­ï¼Œä»¥å‡å°‘ DCã€‚Batch åªåœ¨ UI å…ƒç´ å‘ç”Ÿå˜åŒ–æ—¶è¿›è¡Œï¼Œåˆæˆçš„ Mesh è¶Šå¤§ï¼Œè€—æ—¶è¶Šå¤§ã€‚é‡å»ºå¯¹ Canvas ä¸‹æ‰€æœ‰ ui å…ƒç´ ç”Ÿæ•ˆï¼Œä¸è®ºæ˜¯å¦ä¿®æ”¹è¿‡ã€‚</p><p>5.2 ä¹‹ååº•å±‚æ˜¯å¤šçº¿ç¨‹çš„ï¼Œè€ƒè™‘åˆ°ç°åœ¨æ‰‹æœºä¸Šéƒ½æ˜¯å¤šæ ¸ï¼Œè¿™éƒ¨åˆ†æ¶ˆè€—å¯èƒ½ä¼šå°å¾ˆå¤šã€‚ä¸è¿‡å¯¹äºå¤æ‚çš„ UIï¼Œè¿˜æ˜¯å¤šæ³¨æ„ä¸€äº›æ›´å¥½ã€‚</p><h5 id="é’ˆå¯¹ -Rebatch- çš„ä¼˜åŒ–æ–¹æ³•">é’ˆå¯¹ Rebatch çš„ä¼˜åŒ–æ–¹æ³•</h5><ul><li>Canvas åŠ¨é™åˆ†ç¦»ï¼Œåˆç†åˆ’åˆ†ï¼ŒæŒ‰æ¸¸æˆç±»å‹å’Œ UI æ•°é‡åˆ’åˆ†ï¼Œå¤ªå¤šä¹Ÿæœ‰é¢å¤–æ¶ˆè€—ã€‚</li><li>å‡å°‘èŠ‚ç‚¹å±‚æ¬¡å’Œæ•°é‡ï¼Œåˆæ‰¹è®¡ç®—é‡å°ï¼Œé€Ÿåº¦å¿«ã€‚</li><li>ä½¿ç”¨ç›¸åŒæè´¨è´´å›¾çš„ UI å°½é‡ä¿æŒæ·±åº¦ç›¸åŒï¼Œè¿™æ ·å¯¹åˆæ‰¹ç®—æ³•å‹å¥½ï¼Œé€Ÿåº¦å¿«ã€‚</li><li>ä¿®æ”¹ Image çš„ Color å±æ€§ï¼ŒåŸç†æ˜¯ä¿®æ”¹é¡¶ç‚¹è‰²ï¼Œä¼šå¼•èµ·ç½‘æ ¼ Rebatchï¼ŒåŒæ—¶è§¦å‘ Canvas.SendWillRenderCanvasesã€‚å¥½å¤„åœ¨äºä¿®æ”¹é¡¶ç‚¹è‰²æè´¨ä¸å˜ï¼Œæ²¡æœ‰é¢å¤– DCã€‚ä¿®æ”¹ shader é¢œè‰²ä¸ä¼šé‡ç»˜ï¼Œæè´¨ä¸å˜ï¼Œæ²¡æœ‰ Rebatchã€‚</li></ul><h5 id="Rebuild- çš„è§¦å‘åŸå› ">Rebuild çš„è§¦å‘åŸå› </h5><p>Rebuild å‘ç”Ÿåœ¨ C# å±‚é¢ï¼Œæ˜¯æŒ‡ UGUI åº“ä¸­ layout ç»„ä»¶è°ƒæ•´ RectTransform å°ºå¯¸ã€Graphic ç»„ä»¶æ›´æ–° Materialï¼Œä»¥åŠ Mask æ‰§è¡Œ Cull çš„è¿‡ç¨‹ï¼Œè€—æ—¶å’Œå‘ç”Ÿå˜åŒ–çš„èŠ‚ç‚¹æ•°é‡åŸºæœ¬å‘ˆçº¿æ€§ç›¸å…³ã€‚</p><p>åªæœ‰ LayoutGroup çš„ç›´æ¥å­èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ˜¯ Graphic ç±»å‹çš„ï¼ˆæ¯”å¦‚ Image å’Œ Textï¼‰ä¼šè§¦å‘ SetLayoutDirtyã€‚</p><p>Graphic æ”¹å˜çš„åŸå› åŒ…æ‹¬ï¼ŒåŸºæœ¬çš„å¤§å°ã€æ—‹è½¬ä»¥åŠæ–‡å­—çš„å˜åŒ–ã€å›¾ç‰‡çš„ä¿®æ”¹ç­‰ç­‰ï¼Œå¯¹åº” SetMaterialDirtyã€‚</p><h5 id="é’ˆå¯¹ -Rebuild- çš„ä¼˜åŒ–æ–¹æ³•">é’ˆå¯¹ Rebuild çš„ä¼˜åŒ–æ–¹æ³•</h5><ul><li>å°‘ç”¨ layoutï¼Œç®€å•çš„å¸ƒå±€ RectTransform ä»£æ›¿</li><li>Canvas åŠ¨é™åˆ†ç¦»ï¼ŒæŒ‰é¡¹ç›®ç±»å‹å»è§„åˆ’ã€‚</li></ul><h4 id="é’ˆå¯¹ç»„ä»¶çš„ä¼˜åŒ–">é’ˆå¯¹ç»„ä»¶çš„ä¼˜åŒ–</h4><ul><li>ä¸è¦ç”¨ç©ºçš„ Imageï¼Œåªæ¥æ”¶äº‹ä»¶ä¸æ˜¾ç¤ºçš„å¯¹è±¡ï¼Œç»§æ‰¿ Graphicï¼Œå¡«å……æ•°æ®å‡½æ•°å†™æˆç©ºçš„ã€‚</li><li>ä¸æ˜¾ç¤ºçš„å¯¹è±¡ï¼Œä¸è¦ SetActiveï¼Œè®¾ç½® Canvas Group çš„ alpha ä¸º 0ï¼Œscale ä¸º 0ï¼Œè¿™æ · vbo ä¸ä¼šè¢«æ¸…é™¤ã€‚æˆ–æ˜¯ canvasRenderer.cull ä¸º trueã€‚</li><li>ä¸éœ€è¦å“åº”äº‹ä»¶çš„ï¼Œå–æ¶ˆ RaycastTargetã€‚æ·»åŠ å·¥å…·ï¼Œä»£ç è®¾ç½® Image å’Œ text é»˜è®¤å–æ¶ˆã€‚</li><li>Canvas æ¸²æŸ“æ¨¡å¼ä¸º World Space æˆ– Screen Space Cameraï¼Œå§‹ç»ˆåˆ†åˆ«è®¾ç½®äº‹ä»¶æ‘„åƒæœºå’Œæ¸²æŸ“æ‘„åƒæœºéå¸¸é‡è¦ï¼Œæ²¡æœ‰è®¾ç½®ä¼šé€šè¿‡ FindWithTag æŸ¥æ‰¾ä¸»æ‘„åƒæœºã€‚</li><li>å°‘ç”¨ Maskï¼Œç”¨ RectMask2D ä»£æ›¿ã€‚</li><li>TextMeshPro ä»£æ›¿åŸç”Ÿ textã€‚</li><li>å­—ä½“ OutLine å¤šç»˜åˆ¶ 4 æ¬¡ã€‚PixelPerfect æœ‰æ¶ˆè€—ï¼Œæ»‘åŠ¨æ¶ˆè€—æ›´å¤§ã€‚</li><li>Font.CacheFontForTextï¼šç”ŸæˆåŠ¨æ€å­—ä½“ Font Textureï¼Œä¸€æ¬¡æ€§æ‰“å¼€ UI ç•Œé¢ä¸­çš„æ–‡å­—è¶Šå¤šï¼Œå¼€é”€è¶Šå¤§ã€‚å¦‚æœå½“å‰ Font Texture ä¸èƒ½å®¹ä¸‹æ¥ä¸‹æ¥çš„æ–‡å­—ï¼Œæ‰©å¤§ textureï¼Œæ€§èƒ½å½±å“å¤§ã€‚</li></ul><h4 id="é€šç”¨ç­–ç•¥">é€šç”¨ç­–ç•¥</h4><ul><li>å‹ç¼©å›¾ç‰‡ï¼Œé™ä½å†…å­˜ï¼ŒåŠ¨æ€åŠ è½½é‡Šæ”¾å’Œç¼“å­˜ã€‚</li><li>å›¾é›†ç®¡ç†ï¼Œå‡å°‘ DrawCallï¼ŒåŠ è½½å‹åŠ›ï¼Œè¿™éƒ¨åˆ†æŒ‰æ¸¸æˆç±»å‹ä¸åŒç­–ç•¥ä¸åŒã€‚ä¸€ä¸ªç®€å•çš„è§„åˆ™æ˜¯ä¸€ä¸ª UI åªä¾èµ–è‡ªèº«ä¸€ä¸ªå›¾é›†ï¼ŒåŠ ä¸Šé€šç”¨å›¾é›†ï¼Œå®é™…åšçš„æ—¶å€™å›¾é›†è¿˜è¦å¤šèŠ±æ—¶é—´æ£€æµ‹ï¼Œæ˜¯ä¸ªæŒç»­è°ƒä¼˜çš„äº‹ã€‚</li><li>ç‰¹å®šæ¡ä»¶ä¸‹ç”¨å¤§å›¾ç‰‡ä»£æ›¿å¤šä¸ªå°å›¾ç»„åˆï¼Œå‡å°‘ OverDrawã€‚</li><li>è¡€æ¡ã€é£˜å­—ç­‰å®æ—¶åˆ·æ–°çš„æ³¨æ„æ€§èƒ½ï¼Œå®¹æ˜“å‡ºç°ç“¶é¢ˆã€‚å¯ä»¥å‡å°‘å¯è§æ•°é‡ï¼Œé™ä½è¿œå¤„åˆ·æ–°é¢‘ç‡ç­‰ã€‚</li><li>gameobject éšè—æ–¹æ³•ï¼Œenable æœ‰å¾ˆå¤§æ¶ˆè€—ï¼Œåº•å±‚å¤„ç†å¾ˆå¤šä¸œè¥¿ï¼Œç§»åŠ¨åæ ‡æˆ–æ˜¯è®¾ç½® layerã€‚</li><li>ç®€åŒ– UI ç»“æ„ï¼Œç©ºçš„èŠ‚ç‚¹è¶Šå°‘è¶Šå¥½ï¼Œå±‚çº§è¶Šå°‘è¶Šå¥½ï¼Œä¸ç”¨çš„èŠ‚ç‚¹åŠæ—¶åˆ é™¤ã€‚å› ä¸º UI ä¸€èˆ¬ä¿®æ”¹è¾ƒå¤šï¼Œå¾ˆå®¹æ˜“æŠŠä¸æ˜¾ç¤ºçš„éšè—ï¼Œä¾ç„¶æœ‰ä¸€å®šæ¶ˆè€—ã€‚</li><li>åŠ¨æ€å›¾é›†ï¼Œç”¨åœ¨å›¾ç‰‡æ•°é‡å¤šï¼Œä¸èƒ½åˆæˆä¸€ä¸ªå¤§å›¾é›†çš„æƒ…å†µã€‚</li><li>ç•Œé¢ä¸Šå°‘æŒ‚ç²’å­ç‰¹æ•ˆï¼ŒåŠ¨æ€åŠ è½½ã€‚</li><li>å…¨å± UI æ—¶å…³é—­åœºæ™¯ç›¸æœºã€‚</li></ul><h3 id="UGUI- çš„ç†è§£ï¼Œç®€å•èŠèŠä½ å¯¹ -Image- å’Œ -RawImage- çš„ç†è§£">UGUI çš„ç†è§£ï¼Œç®€å•èŠèŠä½ å¯¹ Image å’Œ RawImage çš„ç†è§£</h3><ul><li>Imageï¼š ä½¿ç”¨çº¹ç†ï¼ˆTextureï¼‰ä½œä¸ºå›¾åƒæºï¼Œæ”¯æŒç€è‰²å’Œ alpha æ··åˆç­‰é«˜çº§åŠŸèƒ½<ul><li>Maskï¼š å¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ª Image æˆ– Shape æ§ä»¶ä½œä¸ºé®ç½©ï¼Œåˆ›å»ºæ›´å¤æ‚çš„å›¾åƒå½¢çŠ¶ã€‚</li><li>Alpha æ··åˆï¼š å¯ä»¥è®¾ç½®å›¾åƒçš„é€æ˜åº¦ï¼Œä½¿å®ƒä¸èƒŒæ™¯æ··åˆæˆ–å åŠ ã€‚</li><li>è£å‰ªï¼š å¯ä»¥è£å‰ªå›¾åƒï¼Œåªæ˜¾ç¤ºçº¹ç†çš„ä¸€éƒ¨åˆ†ã€‚</li></ul></li><li>RawImageï¼š ä½¿ç”¨åŸå§‹åƒç´ æ•°æ®ä½œä¸ºå›¾åƒæºï¼Œä¸æä¾›ç€è‰²æˆ– alpha æ··åˆåŠŸèƒ½ï¼Œä½†æ€§èƒ½æ›´ä½³<ul><li>æ€§èƒ½ä¼˜åŒ–ï¼š ç”±äºä¸è¿›è¡Œç€è‰²æˆ–æ··åˆï¼Œå› æ­¤ RawImage æ§ä»¶æ€§èƒ½æ›´å¥½ï¼Œéå¸¸é€‚åˆå¤„ç†å¤§é‡å›¾åƒæˆ–é«˜åˆ†è¾¨ç‡çº¹ç†</li><li>åƒç´ å®Œç¾ï¼š RawImage æ§ä»¶æ˜¾ç¤ºå›¾åƒçš„åŸå§‹åƒç´ ï¼Œæ²¡æœ‰ä»»ä½•å¹³æ»‘æˆ–æŠ—é”¯é½¿ï¼Œå› æ­¤éå¸¸é€‚åˆåƒç´ è‰ºæœ¯æˆ–å¤å¤æ¸¸æˆ</li></ul></li></ul><h4 id="é®æŒ¡ -Mask">é®æŒ¡ Mask</h4><h5 id="RectMask2D">RectMask2D</h5><p>åªèƒ½é®æŒ¡çŸ©å½¢èŒƒå›´ï¼Œç±»ä¼¼ NGUIpanel çš„è£å‰ªæ–¹å¼ã€‚è¿™ç§æ–¹å¼ä¸å¢åŠ  DrawCallï¼Œæ¯” Mask æ€§èƒ½é«˜äº›ï¼Œä½†æ˜¯åªèƒ½é®æŒ¡çŸ©å½¢åŒºåŸŸã€‚</p><p>Shader éƒ¨åˆ†ï¼Œå®šä¹‰ <code>UNITY_UI_CLIP_RECT</code>ï¼Œ<code>color.a *= UnityGet2DClipping(IN.worldPosition.xy, _ClipRect);</code> å®ç°è£å‰ªï¼›ä»£ç éƒ¨åˆ†ï¼Œè°ƒç”¨ <code>CanvasRenderer</code> çš„<code>EnableRectClipping</code>æ–¹æ³•ï¼Œä¼ é®æŒ¡åŒºåŸŸï¼Œåº•å±‚è®¾ç½®ç»™<code>_ClipRect</code></p><p>RectMask2D èŠ‚ç‚¹ä¸‹çš„ Maskable ç»„ä»¶ï¼Œæ³¨å†Œåˆ° <code>ClipperRegistry</code> ç±»ï¼Œåº•å±‚æ§åˆ¶å¯¹åº”çš„ Shader æ‰“å¼€å®å®šä¹‰</p><h5 id="Mask">Mask</h5><p>åŸç†è®¾ç½®æ¨¡æ¿ç¼“å†²å€¼ï¼Œé€šè¿‡æµ‹è¯•çš„åƒç´ æ˜¾ç¤ºï¼Œä»è€Œåªåœ¨æŒ‡å®šèŒƒå›´å†…æ˜¾ç¤ºå›¾åƒã€‚é€æ˜åº¦ä¸º 0 çš„åŒºåŸŸä¸æ˜¾ç¤ºã€‚å°†æ¸²æŸ“åˆ† 3 ä¸ªæ­¥éª¤ï¼Œ* æ¸²æŸ“ Maskï¼Œè®¾ç½®æ¨¡æ¿ç¼“å†²çš„å€¼</p><ul><li>æ¸²æŸ“æ¨¡æ¿ä¸‹çš„å¯¹è±¡ï¼Œåˆ¤æ–­æ¨¡æ¿ç¼“å†²å€¼ï¼Œç›¸åŒæ‰æ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯åœ¨æ ¹èŠ‚ç‚¹å®šä¹‰çš„åŒºåŸŸå†…æ¸²æŸ“</li><li>æœ€åå°†æ¨¡æ¿ç¼“å†²åŒºè®¾ç½®ä¸º 0</li></ul><p>ç¼ºç‚¹</p><ul><li>æ‰“ä¹±åˆæ‰¹</li><li>åœ†å½¢è¾¹ç¼˜é”¯é½¿æ˜æ˜¾ï¼ŒåŸå› æ˜¯å¹¶ä¸æ”¯æŒè¾¹ç¼˜æ¸å˜ï¼Œåªæœ‰æ˜¾ç¤ºå’Œä¸æ˜¾ç¤ºä¸¤ä¸ªçŠ¶æ€</li><li>é®æŒ¡æ•ˆæœåªæ˜¯æ˜¾ç¤ºï¼Œç‚¹å‡»é€»è¾‘è¿˜æ˜¯å®Œæ•´çš„åŒºåŸŸï¼Œä¸€èˆ¬å¸¸ç”¨çš„ï¼Œæ‰©å±•ä¸€ä¸ªå›¾å½¢æ›´å¥½ï¼Œæ¯”å¦‚åœ†å½¢</li></ul><h3 id="UGUI- çš„é‡ç»˜é¡ºåºæ˜¯æ€æ ·çš„">UGUI çš„é‡ç»˜é¡ºåºæ˜¯æ€æ ·çš„</h3><p>CanvasUpdateRegistry è´Ÿè´£é©±åŠ¨ï¼Œä¹Ÿå°±æ˜¯é€šçŸ¥éœ€è¦æ¸²æŸ“çš„ UI ç»„ä»¶ï¼Œä¸ºä»€ä¹ˆç”¨é€šçŸ¥çš„æ–¹å¼è€Œä¸æ˜¯ UI è‡ªå·±å¤„ç†å‘¢ï¼ŒUGUI çš„å¤„ç†æµç¨‹æ˜¯è¿™æ ·çš„ï¼ŒUI è‡ªå·±è®°å½•æ˜¯å¦éœ€è¦é‡æ–°æ¸²æŸ“ï¼Œæ³¨å†Œäº‹ä»¶ç»™ registryï¼Œregistry åœ¨è¦æ¸²æŸ“çš„æ—¶å€™è§¦å‘äº‹ä»¶ï¼ŒUI å†å»æäº¤æ•°æ®ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œé¦–å…ˆ UI å„ç§æ•°æ®ä¼šåœ¨ä¸€å¸§å†…å¤šæ¬¡æ”¹å˜ï¼Œè‚¯å®šä¸èƒ½æ¯æ¬¡æ”¹å˜éƒ½å‘æ¸²æŸ“äº‹ä»¶ï¼Œä¸€å¸§å¤„ç†ä¸€æ¬¡æ•ˆç‡æ¯”è¾ƒé«˜ã€‚å†ä¸€ä¸ªå¦‚æœä¸å‘äº‹ä»¶ï¼Œé‚£å°±å¿…ç„¶è¦åœ¨ update é‡Œå†™é€»è¾‘ï¼Œæ¯”ç»Ÿä¸€äº‹ä»¶è¦éº»çƒ¦äº›ã€‚</p><p>UI ç»„ä»¶çš„åŸºç±»æ˜¯ Graphicï¼ŒGraphic æ ¸å¿ƒåŠŸèƒ½æ˜¯ç»„ç»‡ mesh å’Œ material ç„¶åä¼ ç»™åº•å±‚ï¼Œä¹Ÿå°±æ˜¯ CanvasRenderer ç±»ã€‚</p><p>CanvasRenderer è¿æ¥ç”»å¸ƒå’Œæ¸²æŸ“ç»„ä»¶ï¼Œé€šè¿‡ CanvasRenderer æŠŠç½‘æ ¼ç»˜åˆ¶åˆ° Canvas ä¸Šï¼ŒCR å¹¶ä¸æ˜¯ç›´æ¥æ¸²æŸ“ï¼Œè€Œæ˜¯äº¤ç»™ Canvasï¼ŒCanvas è¿˜è¦åšåˆæ‰¹ç­‰æ“ä½œ</p><p>CanvasRenderer è¿™ä¸ªåå­—æœ‰ç‚¹è¯¯å¯¼ï¼Œå¹¶ä¸æ˜¯å¯¹åº” Canvasï¼Œè€Œæ˜¯å¯¹åº” Graphicã€‚é‡è¦çš„æ¥å£æœ‰ä¸¤ä¸ªï¼ŒSetMesh å’Œ SetMaterialã€‚ä¸€æ¬¡è®¾ç½®åï¼Œå¦‚æœæ²¡æœ‰æ”¹å˜ï¼Œä¸éœ€è¦é‡å¤è®¾ç½®ï¼Œåº•å±‚æœ‰ç¼“å­˜ï¼Œmesh å’Œ material å¯ä»¥åˆ†å¼€è®¾ç½®ã€‚</p><p>æ¯ä¸ª Graphic çš„ CanvasRenderer ä¿å­˜äº†å½“å‰å…ƒç´ çš„ mesh å’Œ materialï¼Œä½†å¹¶ä¸ä¼šæ¯ä¸ª Graphic ä¸€ä¸ª drawcallï¼Œcanvas ä¼šå¯¹èŠ‚ç‚¹ä¸‹çš„ Graphic è¿›è¡Œåˆæ‰¹ï¼Œæ‰€ä»¥ä¸€ä¸ª Graphic è®¾ç½® dirtyï¼Œæ•´ä¸ª canvas éƒ½éœ€è¦é‡æ–°è®¡ç®—åˆæ‰¹ï¼Œè¿™ä¸ªæ¶ˆè€—æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œåˆç†åˆ†é… canvasï¼Œå¯¹æ€§èƒ½å½±å“è¾ƒå¤§ï¼Œè¿™æ˜¯ç•Œé¢æ¸²æŸ“æ€§èƒ½è¦æ³¨æ„çš„åœ°æ–¹ã€‚</p><center>    <img src="/2022/08/19/45/UGUI-renderer.jpg"></center><h4 id="é‡ç»˜è§¦å‘æ¡ä»¶">é‡ç»˜è§¦å‘æ¡ä»¶</h4><ul><li><code>enable</code>ï¼Œ<code>disable</code>ï¼Œ<code>validate</code>éƒ½ä¼šè§¦å‘</li><li><code>SetVerticesDirty</code></li><li>MeshEffect æœ‰å˜åŒ–</li><li>shadow å±æ€§æ”¹ç‰ˆ</li><li>transform å¤§å°æ”¹å˜</li><li>image ç±»å‹æ”¹å˜ï¼Œå±‚çº§æ”¹å˜ï¼Œå¡«å……æ–¹å¼æ”¹å˜</li><li>RawImageï¼štexture æ”¹å˜ï¼ŒuvRect æ”¹å˜ï¼Œè§¦å‘åŠ¨ç”»æ•ˆæœ</li><li>text å†…å®¹æ”¹å˜ï¼Œå¼€å…³ richtexï¼Œç­‰ç­‰å¾ˆå¤šï¼Œtext æ˜¯æœ€é¢‘ç¹ dirty çš„</li><li><code>SetMaterialDirty</code></li><li>material æ›¿æ¢</li><li>Image è§¦å‘åŠ¨ç”»</li><li>æ˜¾ç¤º maskï¼Œè®¾ç½®æ˜¯å¦å¼€å¯ mask</li><li>transform å±‚çº§å˜åŒ–</li><li>canvas å±‚çº§å˜åŒ–</li><li>é‡æ–°è®¡ç®— mask</li><li>RawImage æ›¿æ¢ textureï¼Œä½¿è§¦å‘åŠ¨ç”»</li><li>åŒæ—¶ dirtyï¼ŒåŒ…æ‹¬ layoutã€transform å±‚çº§æ”¹å˜</li><li>Sprite æ›¿æ¢ï¼Œæ”¹å˜å›¾ç‰‡å¤§å°ï¼Œæ›¿æ¢å›¾é›†</li><li>å­—ä½“æ”¹å˜ï¼Œå­—ä½“å›¾é›†å˜åŒ–</li></ul><h3 id="NGUI- å’Œ -UGUI- åŒºåˆ«">NGUI å’Œ UGUI åŒºåˆ«</h3><ul><li>UGUI åœ¨éœ€è¦é‡ç»˜æ—¶è§¦å‘äº‹ä»¶ï¼ŒNGUI åœ¨ update æ¯å¸§æ£€æµ‹ï¼Œç•Œé¢å¤æ‚çš„æƒ…å†µä¸‹ä¼šæœ‰ä¸€å®šé¢å¤–æ¶ˆè€—</li><li>åˆæ‰¹ï¼ŒNGUI å¼€æºï¼Œä¿®æ”¹æ–¹ä¾¿ï¼Œä¹Ÿæ›´å¥½æŸ¥é—®é¢˜ã€‚UGUI åªæ˜¯ä¼ æ•°æ®åˆ°åº•å±‚ï¼Œè§„åˆ™åªèƒ½æ˜¯æµ‹è¯•å’ŒçŒœã€‚ä¸è¿‡åˆæ‰¹çš„åŸç†åŸºæœ¬ç›¸åŒï¼Œæ€§èƒ½ä¸Š UGUI æ›´å¥½ï¼Œåº•å±‚ä¸ç”¨ C#ï¼Œåœ¨è¯­è¨€å±‚é¢æ•ˆç‡å°±æ›´é«˜äº›ã€‚</li><li>é‡ç»˜ï¼Œåœ¨ NGUI å’Œ UGUI éƒ½æ˜¯ä¸ªæ€§èƒ½æ¶ˆè€—ç‚¹ï¼Œè¦æ³¨æ„ã€‚</li><li>å±‚çº§ï¼ŒUGUI æŒ‰èŠ‚ç‚¹é¡ºåºï¼Œè°ƒæ•´èµ·æ¥å®¹æ˜“ä¸€ç‚¹ï¼ŒNGUI è¦ç‚¹å¼€æ‰èƒ½çœ‹åˆ° depthï¼Œæœ‰ç‚¹éº»çƒ¦</li><li>è£å‰ªï¼ŒNGUI é€šè¿‡åˆ‡æ¢ shaderï¼Œå¤šåˆ›å»ºä¸€ä¸ª material å®ç°çš„ï¼Œè¦å¤šä¸€ä¸ª shaderï¼Œæ²¡æœ‰ UGUI æ–¹ä¾¿ï¼Œè€Œä¸” UGUI2D çš„æ–¹å¼æ›´é«˜æ•ˆï¼Œä¸è¿‡ NGUI æ”¯æŒè£å‰ªè¾¹ç¼˜æ¨¡ç³Šï¼ŒUGUI è¦è‡ªå·±å®ç°ã€‚</li><li>å›¾é›†ï¼ŒNGUI çš„å›¾é›†æ¯”è¾ƒå¯æ§ï¼ŒUGUI é»˜è®¤çš„å›¾é›†ä¸å¯æ§ï¼Œä¸€èˆ¬è¿˜è¦ç”¨å…¶ä»–æ–¹æ¡ˆå®ç°</li></ul><h3 id="å¯¹ -UI- è¿›è¡Œ -SetActive- è¿™ä¸ªæ“ä½œä¸ºä»€ä¹ˆè¦é¿å…é¢‘ç¹è¿›è¡Œï¼Œå…·ä½“åšäº†äº›ä»€ä¹ˆå†…å®¹ï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ä»£æ›¿å®ƒ">å¯¹ UI è¿›è¡Œ SetActive è¿™ä¸ªæ“ä½œä¸ºä»€ä¹ˆè¦é¿å…é¢‘ç¹è¿›è¡Œï¼Œå…·ä½“åšäº†äº›ä»€ä¹ˆå†…å®¹ï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ä»£æ›¿å®ƒ</h3><ul><li>C# å±‚åˆ° Native å±‚çš„ç©¿æ¢­è°ƒç”¨é€Ÿåº¦æ¯” C# å±‚å†…çš„é€Ÿåº¦æ…¢ã€‚</li><li>UI å…ƒç´ çš„å˜åŒ–å¯¼è‡´æ‰€åœ¨çš„ Canvas å˜åŒ–ï¼Œè§¦å‘å‡½æ•° <code>Canvas.SendWillRenderCanvases()</code> ä¸<code>Canvas.BuildBatch()</code>é€ æˆé«˜è€—æ—¶</li><li>UI å…ƒç´ çš„ç½‘æ ¼é¡¶ç‚¹æ•°ç»„æ”¹å˜ä¼šé€ æˆå †å†…å­˜åˆ†é…ï¼Œè§¦å‘ GCï¼Œå¯¼è‡´è€—æ—¶ï¼ˆä¸è¿‡å¯¹ UI å…ƒç´ è¿›è¡Œä½ç½®ç§»åŠ¨ä¸ä¼šé€ æˆå †å†…å­˜åˆ†é…ï¼‰</li></ul><p>å› æ­¤ï¼Œä¼˜åŒ–ä¹Ÿå¯ä»¥ä»ä»¥ä¸‹å‡ ç‚¹è€ƒè™‘ï¼š</p><ul><li>åœ¨ C# å±‚è®¾ç½®å˜é‡æ¥æ ‡è¯†ç›¸åº”çš„ GO å¤„äº Active è¿˜æ˜¯é Active çŠ¶æ€ï¼Œé¿å…å¯¹ Active çš„å¯¹è±¡è¿›è¡Œ SetActive(true)ï¼Œé¿å…å¯¹é Active çš„å¯¹è±¡è¿›è¡Œ SetActive(false)ã€‚å¯¹ Active è¿›è¡Œ SetActive(true) æ—¶ï¼Œâ€œåº•å±‚â€ä¼šè¿›è¡Œåˆ¤æ–­ï¼Œä½†è°ƒç”¨çš„æ—¶å€™ï¼Œå°±å·²ç»æ˜¯ä» C# å±‚è°ƒç”¨åº•å±‚ï¼Œå¯¼è‡´å¼€é”€è¾ƒé«˜ã€‚åœ¨ C# å±‚åˆ¤æ–­å¥½ï¼Œå°±é¿å…äº†è®©åº•å±‚åˆ¤æ–­ã€‚</li><li>å°†è¦é¢‘ç¹å˜åŒ–çš„ UI å…ƒç´ ä¸ä¸é¢‘ç¹å˜åŒ–çš„ UI å…ƒç´ æ”¾åœ¨ä¸åŒçš„ Canvas ä¸­ï¼Œå‡å°‘ UI å…ƒç´ å˜åŒ–æ—¶çš„è€—æ—¶ã€‚</li><li>é€šè¿‡å°† UI å…ƒç´ çš„åæ ‡ç§»åŠ¨åˆ° Canvas çš„èŒƒå›´ä¹‹å¤–çš„æ–¹æ³•æ¥æ˜¾ç¤ºä¸éšè—ï¼Œé¿å… SetActive çš„è€—æ—¶ä»¥åŠ SendWillRenderCanvases çš„è€—æ—¶ã€‚</li><li>ç»æµ‹è¯•ï¼Œå¯¹ Component è¿›è¡Œ <code>enabled = false</code> çš„æ“ä½œæ¯”å¯¹ GO è¿›è¡Œ <code>SetActive(false)</code> çš„æ“ä½œè€—æ—¶ä½ã€‚</li><li>é€šè¿‡æ·»åŠ  CanvasGroup ç»„ä»¶è®¾ç½®é€æ˜åº¦çš„æ–¹å¼æ¥è¿›è¡Œæ˜¾ç¤ºä¸éš</li></ul><h3 id="Canvas- çš„ä¸‰ç§æ¨¡å¼">Canvas çš„ä¸‰ç§æ¨¡å¼</h3><h4 id="æ¸²æŸ“æ¨¡å¼">æ¸²æŸ“æ¨¡å¼</h4><p>åœ¨ Unity3D ä¸­ï¼ŒCanvas ç»„ä»¶æœ‰ä¸‰ç§ä¸åŒçš„æ¸²æŸ“æ¨¡å¼ï¼šScreen Space - Overlayã€Screen Space - Camera å’Œ World Spaceã€‚ä¸åŒçš„æ¸²æŸ“æ¨¡å¼é€‚ç”¨äºä¸åŒçš„åœºæ™¯å’Œéœ€æ±‚ã€‚</p><ul><li>Screen Space - Overlay æ˜¯æœ€å¸¸ç”¨çš„æ¸²æŸ“æ¨¡å¼ï¼Œå®ƒå°† UI å…ƒç´ æ¸²æŸ“åœ¨å±å¹•ä¸Šï¼Œå¹¶ä¸”æ€»æ˜¯ä½äºæ‰€æœ‰å…¶ä»–å¯¹è±¡çš„å‰é¢ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒUI å…ƒç´ çš„ä½ç½®æ˜¯ä»¥å±å¹•åˆ†è¾¨ç‡ä¸ºåŸºå‡†çš„ï¼Œä¸å—ç›¸æœºçš„å½±å“ã€‚è¿™ç§æ¨¡å¼é€‚ç”¨äºæ¸¸æˆä¸­çš„å¸¸é©» UIï¼Œä¾‹å¦‚èœå•ã€è¡€æ¡ç­‰</li><li>Screen Space - Camera æ¨¡å¼å°† UI å…ƒç´ æ¸²æŸ“åœ¨ç›¸æœºçš„å‰é¢ï¼Œå¹¶ä¸”ä¼šå—ç›¸æœºçš„è§†é‡å’Œä½ç½®çš„å½±å“ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒUI å…ƒç´ çš„ä½ç½®æ˜¯ä»¥ç›¸æœºä¸ºåŸºå‡†çš„ï¼Œå¯ä»¥éšç€ç›¸æœºçš„ç§»åŠ¨è€Œç§»åŠ¨ã€‚è¿™ç§æ¨¡å¼é€‚ç”¨äºéœ€è¦ UI å…ƒç´ éšç€ç›¸æœºç§»åŠ¨çš„åœºæ™¯ï¼Œä¾‹å¦‚ç¬¬ä¸€äººç§°å°„å‡»æ¸¸æˆä¸­çš„å‡†å¿ƒ</li><li>World Space æ¨¡å¼å°† UI å…ƒç´ æ¸²æŸ“åœ¨ 3D ä¸–ç•Œä¸­çš„æŸä¸ªä½ç½®ï¼Œå¹¶ä¸”ä¼šå—åˆ°åœºæ™¯ä¸­å…¶ä»– 3D å¯¹è±¡çš„é®æŒ¡å’Œå…‰ç…§çš„å½±å“ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒUI å…ƒç´ çš„ä½ç½®æ˜¯ä»¥åœºæ™¯ä¸­çš„ 3D åæ ‡ä¸ºåŸºå‡†çš„ã€‚è¿™ç§æ¨¡å¼é€‚ç”¨äºéœ€è¦å°† UI å…ƒç´ ä¸åœºæ™¯ä¸­çš„ 3D å¯¹è±¡è¿›è¡Œäº¤äº’çš„åœºæ™¯ï¼Œä¾‹å¦‚åœ¨æ¸¸æˆä¸­æ˜¾ç¤º NPC çš„å¯¹è¯æ¡†</li></ul><h4 id="å±å¹•é€‚é…">å±å¹•é€‚é…</h4><p>åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šï¼Œå±å¹•çš„å°ºå¯¸å’Œåˆ†è¾¨ç‡å„ä¸ç›¸åŒï¼Œä¸ºäº†èƒ½å¤Ÿåœ¨ä¸åŒè®¾å¤‡ä¸Šæ­£ç¡®æ˜¾ç¤º UI å…ƒç´ ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œå±å¹•é€‚é…ã€‚åœ¨ Canvas ç»„ä»¶ä¸­ï¼Œæœ‰ä¸¤ç§å¸¸ç”¨çš„å±å¹•é€‚é…æ–¹å¼ï¼šConstant Pixel Size å’Œ Scale With Screen Size</p><ul><li>Constant Pixel Size æ˜¯ä¸€ç§å›ºå®šåƒç´ å¤§å°çš„é€‚é…æ–¹å¼ï¼Œå³ UI å…ƒç´ çš„å¤§å°ä¸ä¼šéšç€å±å¹•å°ºå¯¸çš„å˜åŒ–è€Œå˜åŒ–ã€‚åœ¨è¿™ç§é€‚é…æ–¹å¼ä¸‹ï¼ŒUI å…ƒç´ çš„å¤§å°æ˜¯ä»¥åƒç´ ä¸ºå•ä½çš„ï¼Œå¯¹äºä¸åŒçš„å±å¹•å°ºå¯¸ï¼ŒUI å…ƒç´ çš„å¤§å°ä¼šæœ‰æ‰€å˜åŒ–ã€‚è¿™ç§é€‚é…æ–¹å¼é€‚ç”¨äºéœ€è¦ä¿æŒ UI å…ƒç´ å¤§å°ä¸å˜çš„åœºæ™¯ï¼Œä¾‹å¦‚æ¸¸æˆä¸­çš„æŒ‰é’®</li><li>Scale With Screen Size æ˜¯ä¸€ç§æ ¹æ®å±å¹•å°ºå¯¸è¿›è¡Œç¼©æ”¾çš„é€‚é…æ–¹å¼ï¼Œå³ UI å…ƒç´ çš„å¤§å°ä¼šéšç€å±å¹•å°ºå¯¸çš„å˜åŒ–è€Œå˜åŒ–ã€‚åœ¨è¿™ç§é€‚é…æ–¹å¼ä¸‹ï¼ŒUI å…ƒç´ çš„å¤§å°æ˜¯ä»¥ç™¾åˆ†æ¯”ä¸ºå•ä½çš„ï¼Œå¯¹äºä¸åŒçš„å±å¹•å°ºå¯¸ï¼ŒUI å…ƒç´ çš„å¤§å°ä¼šæŒ‰ç…§æ¯”ä¾‹è¿›è¡Œç¼©æ”¾ã€‚è¿™ç§é€‚é…æ–¹å¼é€‚ç”¨äºéœ€è¦æ ¹æ®å±å¹•å°ºå¯¸è¿›è¡Œè‡ªé€‚åº”çš„åœºæ™¯ï¼Œä¾‹å¦‚æ¸¸æˆä¸­çš„èƒŒæ™¯å›¾åƒ</li></ul><h2 id="èµ„æºç®¡ç†">èµ„æºç®¡ç†</h2><h3 id="èµ„æºç®¡ç†æ¨¡å—">èµ„æºç®¡ç†æ¨¡å—</h3><h4 id="AssetBundle- çš„åŸç†">AssetBundle çš„åŸç†</h4><h4 id="å¦‚ä½•ä» -Bundle- åŠ è½½ä¸€ä»½èµ„æºåˆ° -Game- é‡Œé¢ï¼Œéœ€è¦ç»è¿‡å‡ æ¬¡æˆ–è€…å‡ ä¸ªå†…å­˜åŒº">å¦‚ä½•ä» Bundle åŠ è½½ä¸€ä»½èµ„æºåˆ° Game é‡Œé¢ï¼Œéœ€è¦ç»è¿‡å‡ æ¬¡æˆ–è€…å‡ ä¸ªå†…å­˜åŒº</h4><h4 id="å¦‚ä½•ç®¡ç† -AB- åŒ…">å¦‚ä½•ç®¡ç† AB åŒ…</h4><h4 id="å¦‚ä½•å®‰å…¨å¸è½½ -AB- åŒ…æˆ–è€… -Asset">å¦‚ä½•å®‰å…¨å¸è½½ AB åŒ…æˆ–è€… Asset</h4><h4 id="å¦‚ä½•è§£å†³ä¾èµ–">å¦‚ä½•è§£å†³ä¾èµ–</h4><p>Unity ä¼šè‡ªåŠ¨æ”¶é›†å¹¶åˆ†æå…¶ä¾èµ–çš„èµ„æºï¼Œå¦‚æœè¯¥èµ„æºä¾èµ–çš„æŸä¸ªèµ„æºæ²¡æœ‰è¢«æ˜¾å¼æŒ‡å®šæ‰“åŒ…åˆ° ab ä¸­ï¼Œå°±å°†å…¶ä¾èµ–çš„è¿™ä¸ªèµ„æºæ‰“åŒ…è¿›è¯¥èµ„æºæ‰€åœ¨çš„ ab é‡Œï¼›å¦‚æœå·²ç»è¢«æŒ‡å®šæ‰“åŒ…è¿›å…¶ä»– ab é‡Œï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ª ab ä¹‹é—´å°±ä¼šæ„æˆä¾èµ–å…³ç³»ï¼ŒåŠ è½½ ab æ—¶ï¼Œå…ˆåŠ è½½å…¶ä¾èµ–çš„ ab å³å¯ã€‚</p><p>è¿™ä¸€å¥—ä¾èµ–ç®¡ç†æœºåˆ¶ä½¿ç”¨æ–¹ä¾¿çš„åŒæ—¶ä¹Ÿä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœä¸¤ä¸ª ab A å’Œ B ä¸­çš„ä¸€äº›èµ„æºéƒ½ä¾èµ–äº†ä¸€ä¸ªæ²¡æœ‰è¢«æŒ‡å®šè¦æ‰“åŒ…çš„èµ„æº Cï¼Œé‚£ä¹ˆ C å°±ä¼šåŒæ—¶è¢«æ‰“è¿› ab A å’Œ B ä¸­ï¼Œé€ æˆèµ„æºçš„å†—ä½™ï¼Œå¢å¤§ ab å’Œå®‰è£…åŒ…çš„ä½“ç§¯ã€‚è€Œè¿™ä¸ªè¢« Aï¼ŒB ä¾èµ–çš„èµ„æº C åˆå¯ä»¥åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯ Assets ä¸‹å¤–éƒ¨å¯¼å…¥çš„èµ„æºï¼Œå³å¼€å‘è€…å¯¼å…¥æˆ–åˆ›å»ºçš„èµ„æºï¼›å¦ä¸€ç§åˆ™æ˜¯ Unity å†…ç½®çš„èµ„æºï¼Œä¾‹å¦‚å†…ç½®çš„ Shaderï¼ŒDefault-Material å’Œ UGUI ä¸€äº›ç»„ä»¶å¦‚ Image ç”¨çš„ä¸€äº›çº¹ç†èµ„æºç­‰ç­‰ã€‚å› æ­¤è¦è§£å†³èµ„æºå†—ä½™çš„é—®é¢˜ï¼Œå°±è¦åˆ†åˆ«å¯¹è¿™ä¸¤ç§è¢«ä¾èµ–çš„èµ„æºè¿›è¡Œå¤„ç†ã€‚</p><h5 id="å¤„ç†è¢«ä¾èµ–çš„å¤–éƒ¨èµ„æº">å¤„ç†è¢«ä¾èµ–çš„å¤–éƒ¨èµ„æº</h5><p>å¯¹äºæ²¡æœ‰è¢«æŒ‡å®šæ‰“åŒ…çš„å¤–éƒ¨èµ„æºï¼Œå¦‚æœå¤šä¸ª ab åŒ…ä¾èµ–äº†å®ƒï¼Œæ‰“åŒ…æ—¶è¯¥èµ„æºå°±ä¼šè¢«å¤šæ¬¡æ‰“åŒ…è¿›ä¾èµ–å®ƒçš„ ab åŒ…ä¸­ï¼Œé€ æˆå†—ä½™ã€‚è§£å†³æ–¹æ¡ˆå°±æ˜¯å°†è¿™äº›è¢«å¤šä¸ª ab åŒ…ä¾èµ–çš„èµ„æºæ‰“åŒ…åˆ°ä¸€ä¸ªå…¬å…± ab åŒ…ä¸­ã€‚å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ä½¿ç”¨ <code>EditorUtility.CollectDependencies()</code> å¾—åˆ° ab ä¾èµ–çš„æ‰€æœ‰èµ„æºçš„è·¯å¾„</li><li>ç»Ÿè®¡èµ„æºè¢«æ‰€æœ‰ ab å¼•ç”¨çš„æ¬¡æ•°ï¼Œå°†è¢«å¤šä¸ª ab å¼•ç”¨çš„èµ„æºæ‰“åŒ…ä¸ºå…¬å…± ab åŒ…</li></ul><blockquote><p><code>EditorUtility.CollectDependencies()</code>æ”¶é›†åˆ°çš„èµ„æºåŒ…å«äº†è„šæœ¬ï¼Œdll å’Œç¼–è¾‘å™¨èµ„æºï¼Œè¿™äº›èµ„æºæ— éœ€æ‰“è¿› ab ä¸­</p></blockquote><h5 id="å¤„ç†è¢«ä¾èµ–çš„å†…éƒ¨èµ„æº">å¤„ç†è¢«ä¾èµ–çš„å†…éƒ¨èµ„æº</h5><h2 id="æ€§èƒ½ä¼˜åŒ–">æ€§èƒ½ä¼˜åŒ–</h2><h3 id="ä½¿ç”¨è¿‡å“ªäº›æ€§èƒ½åˆ†æå·¥å…·ã€æ€§èƒ½ä¸»è¦æ˜¯åœ¨è€ƒè™‘å“ªæ–¹é¢çš„å› ç´ å½±å“">ä½¿ç”¨è¿‡å“ªäº›æ€§èƒ½åˆ†æå·¥å…·ã€æ€§èƒ½ä¸»è¦æ˜¯åœ¨è€ƒè™‘å“ªæ–¹é¢çš„å› ç´ å½±å“</h3><h4 id="Unity-Profiler">Unity Profiler</h4><p><strong>Unity Profiler</strong> æ˜¯ Unity ä¸­æœ€å¸¸ç”¨çš„å®˜æ–¹æ€§èƒ½åˆ†æå·¥å…·ï¼Œåœ¨ä½¿ç”¨ Unity å¼€å‘æ¸¸æˆçš„è¿‡ç¨‹ä¸­ï¼Œå€ŸåŠ© Profiler æ¥åˆ†æ CPUã€GPU åŠå†…å­˜ä½¿ç”¨çŠ¶å†µæ˜¯è‡³å…³é‡è¦çš„</p><p><img src="/2022/08/19/45/profiler.png" alt="image-20221021152916209"></p><h3 id="åˆæ‰¹çš„åŸç†ï¼Œåˆæ‰¹æœ‰å“ªäº›ï¼ŒåŒºåˆ«æ˜¯ä»€ä¹ˆ">åˆæ‰¹çš„åŸç†ï¼Œåˆæ‰¹æœ‰å“ªäº›ï¼ŒåŒºåˆ«æ˜¯ä»€ä¹ˆ</h3><p>åˆæ‰¹ï¼Œä¹Ÿå¯ä»¥å«åšæ‰¹é‡æ¸²æŸ“ã€‚åˆæ‰¹å°±æ˜¯é€šè¿‡å‡å°‘ CPU å‘ GPU å‘é€æ¸²æŸ“å‘½ä»¤ï¼ˆDrawCallï¼‰çš„æ¬¡æ•°ï¼Œä»¥åŠå‡å°‘ GPU åˆ‡æ¢æ¸²æŸ“çŠ¶æ€çš„æ¬¡æ•°ï¼Œå°½é‡è®© GPU ä¸€æ¬¡å¤šåšä¸€äº›äº‹æƒ…ï¼Œæ¥æå‡é€»è¾‘çº¿å’Œæ¸²æŸ“çº¿çš„æ•´ä½“æ•ˆç‡ã€‚ä½†å‚ä¸åˆæ‰¹æœ‰ä¸ªå‰æï¼Œå°±æ˜¯å‚ä¸åˆæ‰¹çš„æè´¨å¿…é¡»ç›¸åŒ</p><h4 id="é™æ€åˆæ‰¹">é™æ€åˆæ‰¹</h4><p>å¯¹æ ‡è®°ä¸º <code>static</code> çš„ Mesh è‡ªåŠ¨åˆæ‰¹ã€‚ä»¥ç©ºé—´æ¢æ—¶é—´çš„ç­–ç•¥æ¥æå‡æ¸²æŸ“æ•ˆç‡ã€‚ä»¥å­˜å‚¨æ›´å¤šç½‘æ ¼æ•°æ®ä¸ºä»£ä»·çš„</p><p>å¦‚æœåœ¨ä½¿ç”¨ç›¸åŒæè´¨çƒçš„æ¡ä»¶ä¸‹ï¼Œåœ¨ Build çš„æ—¶å€™ Unity ä¼šè‡ªåŠ¨åœ°æå–è¿™äº›å…±äº«æè´¨çš„é™æ€æ¨¡å‹çš„ Vertex Buffer å’Œ Index Bufferã€‚æ ¹æ®å…¶æ‘†æ”¾åœ¨åœºæ™¯ä¸­çš„ä½ç½®ç­‰æœ€ç»ˆçŠ¶æ€ä¿¡æ¯ï¼Œå°†è¿™äº›æ¨¡å‹çš„é¡¶ç‚¹æ•°æ®å˜æ¢åˆ°ä¸–ç•Œç©ºé—´ä¸‹ï¼Œå­˜å‚¨åœ¨æ–°æ„å»ºçš„å¤§ Vertex Buffer å’Œ Index Buffer ä¸­ï¼Œå¹¶ä¸”è®°å½•æ¯ä¸€ä¸ªå­æ¨¡å‹çš„ Index Buffer æ•°æ®åœ¨æ„å»ºçš„å¤§ Index Buffer ä¸­çš„èµ·å§‹ (start0) åŠç»“æŸ (end0) ä½ç½®</p><center>    <img src="/2022/08/19/45/static-batching.png"></center><p>åœ¨åç»­çš„ç»˜åˆ¶è¿‡ç¨‹ä¸­ï¼Œä¸€æ¬¡æ€§æäº¤æ•´ä¸ªåˆå¹¶æ¨¡å‹çš„é¡¶ç‚¹æ•°æ®ï¼Œæ ¹æ®å¼•æ“çš„åœºæ™¯ç®¡ç†ç³»ç»Ÿåˆ¤æ–­å„ä¸ªå­æ¨¡å‹çš„å¯è§æ€§ã€‚ç„¶åè®¾ç½®ä¸€æ¬¡æ¸²æŸ“çŠ¶æ€ï¼Œè°ƒç”¨å¤šæ¬¡ DrawCall åˆ†åˆ«ç»˜åˆ¶æ¯ä¸€ä¸ªå­æ¨¡å‹ã€‚æ‰€ä»¥å…¶å® Static Batching æ˜¯ä¸å‡å°‘ DrawCall çš„æ•°é‡ï¼ˆä½†æ˜¯åœ¨ç¼–è¾‘å™¨æ—¶ç”±äºè®¡ç®—æ–¹æ³•åŒºåˆ« DrawCall æ•°é‡æ˜¯ä¼šæ˜¾ç¤ºå‡å°‘äº†çš„ï¼‰ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬é¢„å…ˆæŠŠæ‰€æœ‰çš„å­æ¨¡å‹çš„é¡¶ç‚¹å˜æ¢åˆ°äº†ä¸–ç•Œç©ºé—´ä¸‹ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæ—¶ CPU ä¸éœ€è¦å†æ¬¡æ‰§è¡Œé¡¶ç‚¹å˜æ¢æ“ä½œï¼ŒèŠ‚çº¦äº†å°‘é‡çš„è®¡ç®—èµ„æºï¼Œå¹¶ä¸”è¿™äº›å­æ¨¡å‹å…±äº«æè´¨ï¼Œæ‰€ä»¥åœ¨å¤šæ¬¡ DrawCall è°ƒç”¨ä¹‹é—´å¹¶æ²¡æœ‰æ¸²æŸ“çŠ¶æ€çš„åˆ‡æ¢ï¼Œæ¸²æŸ“ APIï¼ˆCommand Bufferï¼‰ä¼šç¼“å­˜ç»˜åˆ¶å‘½ä»¤ï¼Œèµ·åˆ°äº†æ¸²æŸ“ä¼˜åŒ–çš„ç›®çš„ ã€‚</p><p>ä½†é™æ€åˆå¹¶æœ‰ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹å°±æ˜¯æ‰“åŒ…ä¹‹åä¼šå¯¼è‡´åº”ç”¨ä½“ç§¯å¢å¤§ï¼Œåº”ç”¨è¿è¡Œæ—¶æ‰€å ç”¨çš„å†…å­˜ä½“ç§¯ä¹Ÿä¼šå¢å¤§ã€‚ä¾‹å¦‚ï¼Œåœ¨èŒ‚å¯†çš„æ£®æ—çº§åˆ«å°†æ ‘æ ‡è®°ä¸ºé™æ€ä¼šä¸¥é‡å½±å“å†…å­˜ï¼Œå› ä¸ºåœºæ™¯ä¸­æ‰€æœ‰å¼•ç”¨ç›¸åŒæ¨¡å‹çš„ GameObject éƒ½å¿…é¡»å°†æ¨¡å‹é¡¶ç‚¹ä¿¡æ¯å¤åˆ¶ï¼Œå¹¶ç»è¿‡è®¡ç®—å˜åŒ–åˆ°æœ€ç»ˆåœ¨ä¸–ç•Œç©ºé—´ä¸­ï¼Œå­˜å‚¨åœ¨æœ€ç»ˆç”Ÿæˆçš„ Vertex Buffer ä¸­ï¼Œè¿™ä¸ªæ—¶å€™çš„ vertex Buffer ä¼šç‰¹åˆ«å¤§</p><center>    <img src="/2022/08/19/45/static-batching-flow.png"></center><h4 id="åŠ¨æ€åˆæ‰¹">åŠ¨æ€åˆæ‰¹</h4><p>å°†æ•°ä»½ Mesh çš„æ•°æ®å¤åˆ¶ç²˜è´´åˆ°ä¸€èµ·ï¼Œä¹Ÿå°±æ˜¯å®æ—¶çš„ï¼Œæ¯ä¸€å¸§éƒ½åˆå¹¶ï¼Œä½†ä¸é€‚ç”¨äºç½‘æ ¼æ•°æ®å¤ªå¤šçš„ç‰©ä½“ï¼ˆæ¯”å¦‚çƒï¼‰</p><p>åœ¨è¿›è¡Œåœºæ™¯ç»˜åˆ¶ä¹‹å‰å°†æ‰€æœ‰çš„å…±äº«åŒä¸€æè´¨çš„æ¨¡å‹çš„é¡¶ç‚¹ä¿¡æ¯å˜æ¢åˆ°ä¸–ç•Œç©ºé—´ä¸­ï¼Œç„¶åé€šè¿‡ä¸€æ¬¡ DrawCall ç»˜åˆ¶å¤šä¸ªæ¨¡å‹ï¼Œè¾¾åˆ°åˆæ‰¹çš„ç›®çš„ã€‚æ¨¡å‹é¡¶ç‚¹å˜æ¢çš„æ“ä½œæ˜¯ç”± CPU å®Œæˆçš„ï¼Œæ‰€ä»¥è¿™ä¼šå¸¦æ¥ä¸€äº› CPU çš„æ€§èƒ½æ¶ˆè€—ã€‚å¹¶ä¸”è®¡ç®—çš„æ¨¡å‹é¡¶ç‚¹æ•°é‡ä¸å®œå¤ªå¤šï¼Œå¦åˆ™ CPU ä¸²è¡Œè®¡ç®—è€—è´¹çš„æ—¶é—´å¤ªé•¿ä¼šé€ æˆåœºæ™¯æ¸²æŸ“å¡é¡¿ï¼Œæ‰€ä»¥ Dynamic Batching åªèƒ½å¤„ç†ä¸€äº›å°æ¨¡å‹ã€‚æ‰€ä»¥ä»…ä»…åœ¨åˆæ‰¹æ“ä½œçš„æ€§èƒ½æ¶ˆè€—å°äºä¸åˆæ‰¹ï¼ŒDynamic Batching æ‰ä¼šæœ‰æ„ä¹‰ï¼Œè™½ç„¶åœ¨å†…å­˜å ç”¨å’Œå‘å¸ƒçš„ç¨‹åºä½“ç§¯æ–¹é¢è¦ä¼˜äº Static Batchingã€‚</p><p>æ— æ³•å‚åŠ  Dynamic Batching çš„æƒ…å†µï¼š</p><ul><li>ç‰©ä»¶ Mesh å¤§äºç­‰äº 900 ä¸ªé¢</li><li>ä»£ç åŠ¨æ€æ”¹å˜æè´¨å˜é‡åä¸ç®—åŒä¸€ä¸ªæè´¨ï¼Œä¼šä¸å‚ä¸åˆæ‰¹</li><li>å¦‚æœä½ çš„ç€è‰²å™¨ä½¿ç”¨é¡¶ç‚¹ä½ç½®ï¼Œæ³•çº¿å’Œ UV å€¼ä¸‰ç§å±æ€§ï¼Œé‚£ä¹ˆä½ åªèƒ½æ‰¹å¤„ç† 300 é¡¶ç‚¹ä»¥ä¸‹çš„ç‰©ä½“ï¼›å¦‚æœä½ çš„ç€è‰²å™¨éœ€è¦ä½¿ç”¨é¡¶ç‚¹ä½ç½®ï¼Œæ³•çº¿ï¼ŒUV0ï¼ŒUV1 å’Œåˆ‡å‘é‡ï¼Œé‚£ä½ åªèƒ½æ‰¹å¤„ç† 180 é¡¶ç‚¹ä»¥ä¸‹çš„ç‰©ä½“ï¼Œå¦åˆ™éƒ½æ— æ³•å‚ä¸åˆæ‰¹</li></ul><center>    <img src="/2022/08/19/45/dynamic-batching-flow.png"></center><h4 id="åŠ¨æ€åˆæ‰¹ä¸é™æ€åˆæ‰¹çš„åŒºåˆ«">åŠ¨æ€åˆæ‰¹ä¸é™æ€åˆæ‰¹çš„åŒºåˆ«</h4><ol><li>åŠ¨æ€åˆæ‰¹ä¸ä¼šåˆ›å»ºå¸¸é©»å†…å­˜çš„â€œåˆå¹¶åç½‘æ ¼â€ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸ä¼šåœ¨è¿è¡Œæ—¶é€ æˆå†…å­˜çš„æ˜¾è‘—å¢é•¿ï¼Œä¹Ÿä¸ä¼šå½±å“æ‰“åŒ…æ—¶çš„åŒ…ä½“å¤§å°ï¼›</li><li>åŠ¨æ€åˆæ‰¹åœ¨ç»˜åˆ¶å‰ä¼šå…ˆå°†é¡¶ç‚¹è½¬æ¢åˆ°ä¸–ç•Œåæ ‡ç³»ä¸‹ï¼Œç„¶åå†å¡«å……è¿›é¡¶ç‚¹ã€ç´¢å¼•ç¼“å†²åŒºï¼›é™æ€åˆæ‰¹åå­ç½‘æ ¼ä¸æ¥å—ä»»ä½•å˜æ¢æ“ä½œï¼Œä»…æ‰‹åŠ¨åˆæ‰¹åçš„ Root èŠ‚ç‚¹å¯è¢«æ“ä½œï¼Œå› æ­¤é™æ€åˆæ‰¹çš„é¡¶ç‚¹ã€ç´¢å¼•ç¼“å†²åŒºä¸­çš„ä¿¡æ¯ä¸ä¼šè¢«ä¿®æ”¹ï¼ˆRoot çš„å˜æ¢ä¿¡æ¯åˆ™ä¼šé€šè¿‡ Constant Buffer ä¼ å…¥ï¼‰ï¼›</li><li>å› ä¸º 2 çš„åŸå› ï¼ŒåŠ¨æ€åˆæ‰¹çš„ä¸»è¦å¼€é”€åœ¨äºéå†é¡¶ç‚¹è¿›è¡Œç©ºé—´å˜æ¢æ—¶çš„å¯¹ CPU æ€§èƒ½çš„å¼€é”€ï¼›é™æ€åˆæ‰¹æ²¡æœ‰è¿™ä¸ªæ“ä½œï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰è¿™ä¸ªå¼€é”€ï¼›</li><li>åŠ¨æ€åˆæ‰¹ä½¿ç”¨æ ¹æ®æ¸²æŸ“å™¨ç±»å‹åˆ†é…çš„å…¬å…±ç¼“å†²åŒºï¼Œè€Œé™æ€åˆæ‰¹ä½¿ç”¨è‡ªå·±ä¸“ç”¨çš„ç¼“å†²åŒºã€‚</li></ol><h2 id="URP">URP</h2><h3 id="SetPassCall- å’Œ -DrawCall">SetPassCall å’Œ DrawCall</h3><p>è¦æƒ³ CPU å’Œ GPU æ—¢å¯ä»¥å¹¶è¡Œåˆå¯ä»¥ç‹¬ç«‹å·¥ä½œï¼Œè¦ä½¿ç”¨ä¸€ä¸ªå‘½ä»¤ç¼“å†²åŒºï¼ˆCommand Bufferï¼‰ã€‚å‘½ä»¤ç¼“å†²åŒºåŒ…å«äº†ä¸€ä¸ªå‘½ä»¤é˜Ÿåˆ—ï¼Œå½“ CPU éœ€è¦æ¸²æŸ“ä¸€äº›å¯¹è±¡æ—¶ï¼Œå®ƒä¼šé€šè¿‡å›¾åƒç¼–ç¨‹æ¥å£å‘å‘½ä»¤ç¼“å†²åŒºæ·»åŠ å‘½ä»¤ï¼Œå½“ GPU å®Œæˆä¸Šæ¬¡çš„æ¸²æŸ“ä»»åŠ¡åï¼Œå®ƒä¼šä»å‘½ä»¤é˜Ÿåˆ—è¯»å–ä¸€ä¸ªå‘½ä»¤å¹¶æ‰§è¡Œå®ƒï¼Œæ·»åŠ å’Œè¯»å–çš„è¿‡ç¨‹æ˜¯ç›¸äº’ç‹¬ç«‹çš„</p><p>å‘½ä»¤ç¼“å†²åŒºæœ‰å¾ˆå¤šç§ç±»å‹ï¼Œè€Œ Draw Call å°±æ˜¯å…¶ä¸­ä¸€ç§ï¼Œå…¶å®ƒå‘½ä»¤è¿˜æœ‰ Set Pass Call ç­‰ç­‰ã€‚Set Pass Call ä»£è¡¨äº†å¸¸è¯´çš„æ”¹å˜æ¸²æŸ“çŠ¶æ€ï¼Œå½“åˆ‡æ¢æè´¨æˆ–è€…åˆ‡æ¢åŒä¸€æè´¨ä¸­ Shader çš„ä¸åŒ Pass è¿›è¡Œæ¸²æŸ“æ—¶éƒ½ä¼šè§¦å‘ä¸€æ¬¡ Set Pass Callã€‚æ¯”å¦‚æ¸²æŸ“ 1000 ä¸ªç›¸åŒçš„ç‰©ä½“å’Œæ¸²æŸ“ 1000 ä¸ªä¸åŒçš„ç‰©ä½“ï¼Œè™½ç„¶ä¸¤è€… Draw Call éƒ½æ˜¯ 1000ï¼Œä½†æ˜¯å‰è€…çš„ Set Pass Call ä¸º 1ï¼Œåè€…è¿˜æ˜¯ 1000ã€‚åˆ‡æ¢æ¸²æŸ“çŠ¶æ€å¾€å¾€æ¯” Draw Call æ›´è€—æ—¶ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ URP ä¸å†æ”¯æŒå¤š Pass çš„åŸå› </p><p>æ¯æ¬¡è°ƒç”¨ Draw Call ä¹‹å‰ï¼ŒCPU éƒ½è¦å‘ GPU å‘é€å¾ˆå¤šå†…å®¹ï¼ŒåŒ…æ‹¬æ•°æ®ã€çŠ¶æ€å’Œå‘½ä»¤ç­‰ã€‚åœ¨è¿™ä¸€é˜¶æ®µ CPU éœ€è¦å®Œæˆå¾ˆå¤šå·¥ä½œï¼Œä¾‹å¦‚æ£€æŸ¥æ¸²æŸ“çŠ¶æ€ç­‰ã€‚ä¸€æ—¦ CPU å®Œæˆäº†è¿™äº›å‡†å¤‡å·¥ä½œï¼ŒGPU å°±å¯ä»¥å¼€å§‹æœ¬æ¬¡æ¸²æŸ“ï¼ŒGPU çš„æ¸²æŸ“èƒ½åŠ›å¾ˆå¼ºï¼Œæ¸²æŸ“é€Ÿåº¦å¾€å¾€æ¯” CPU çš„æäº¤å‘½ä»¤é€Ÿåº¦å¿«ï¼Œå¦‚æœ Draw Call æ•°é‡è¿‡å¤šï¼ŒCPU å°±ä¼šæŠŠæœºä¼šæŠŠå¤§é‡æ—¶é—´èŠ±è´¹åœ¨æäº¤ Draw Call ä¸Šï¼Œé€ æˆ CPU è¿‡è½½ï¼Œæ¸¸æˆå¸§ç‡å˜ä½</p><p>æ—©æœŸ Unity åªæ”¯æŒåŠ¨æ€æ‰¹å¤„ç†å’Œé™æ€æ‰¹å¤„ç†ï¼Œåæ¥æœ‰æ”¯æŒäº† GPU Instancingï¼Œæœ€å SRP å‡ºç°æ—¶æ”¯æŒäº†ä¸€ç§æ–°çš„æ‰¹å¤„ç†æ–¹å¼â€”â€”SRP Batcher</p><h3 id="SRP-Batcher">SRP Batcher</h3><p>SRP Batcher ä¸­å°† CPU æ”¶é›†ä¸æäº¤ GPU éƒ¨åˆ†çœç•¥ï¼Œå¹¶ä¸æ˜¯å®Œå…¨çœç•¥è€Œæ˜¯ä¸éœ€è¦æ¯å¸§éƒ½ç»™ GPU ä¼ é€’æ•°æ®ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰å‘ç”Ÿå˜åŒ–å®ƒä»¬å°†è¢«ä¿å­˜åœ¨ GPU å†…å­˜ä¸­ï¼Œè¿™æ ·æ¯å¸§åªéœ€è¦æƒŠé†’ç»‘å®šæ•°æ®å°±è¡Œï¼Œä»è€ŒèŠ‚çœäº†æ•ˆç‡ã€‚</p><blockquote><p>SRP Batcher æ˜¯å¦å‘ç”Ÿæ‰“æ–­åˆä¼ ç»Ÿæ–¹å¼æ˜¯ä¸åŒçš„ï¼šä¼ ç»Ÿæ–¹å¼å³ä½¿ä¸¤ä¸ªæè´¨ä½¿ç”¨äº† <strong> ç›¸åŒçš„ç€è‰²å™¨ </strong> ä¹Ÿä¼šäº§ç”Ÿ Set Pass Callï¼Œè€Œ SRP Batcher å´ä¸ä¼šï¼Œå®ƒåˆ¤æ–­æ‰“æ–­å¹¶ä¸æ˜¯æŒ‰æè´¨æ˜¯å¦å˜åŒ–ï¼ŒäºŒåç€è‰²å™¨å˜ç§æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œåªè¦å˜ç§ç›¸åŒå³ä½¿æ˜¯ç”¨äº†ä¸åŒçš„æè´¨ä¹Ÿèƒ½æœ‰æ•ˆ SRP Batcher</p></blockquote><h3 id="Constant-Buffer">Constant Buffer</h3><p>Unity æ²¡æœ‰ç›´æ¥æä¾› MVP çŸ©é˜µï¼Œè€Œæ˜¯æ‹†å¼€æˆä¸¤ä¸ªä¸¾è¯ M å’Œ VPï¼Œå› ä¸º VP çŸ©é˜µ <strong> åœ¨ä¸€å¸§ä¸­ä¸ä¼šæ”¹å˜</strong>ï¼Œå¯ä»¥é‡å¤åˆ©ç”¨ã€‚Unity å°† M çŸ©é˜µå’Œ VP çŸ©é˜µå­˜å…¥ Constant Buffer ä¸­ä»¥æé«˜è¿ç®—æ•ˆç‡ï¼ŒM çŸ©é˜µå­˜å…¥çš„ Buffer ä¸º<code>UnityPerDraw Buffer</code>ï¼Œä¹Ÿå°±æ˜¯é’ˆå¯¹æ¯ä¸ªç‰©ä½“çš„ç»˜åˆ¶ä¸ä¼šæ”¹å˜ã€‚VP çŸ©é˜µåˆ™å­˜å…¥çš„æ˜¯<code>UnityPerFrame Buffer</code>ï¼Œå³æ¯ä¸€å¸§ VP çŸ©é˜µå¹¶ä¸ä¼šæ”¹å˜ã€‚Constant Buffer å¹¶ä¸æ˜¯æ‰€æœ‰å¹³å°éƒ½æ”¯æŒï¼Œç›®å‰ OpenGL å°±ä¸æ”¯æŒ</p><p>ä½¿ç”¨ <code>cbuffer</code> å…³é”®å­—æ¥å¼•å…¥ Constant Bufferï¼ŒConstant Buffer ä¸­è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ•°æ®</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cbuffer UnityPerFrame {</span><br><span class="line">    float4x4 unity_MatirxVP;</span><br><span class="line">};</span><br><span class="line">cbuffer UnityPerDraw {</span><br><span class="line">    float4x4 unity_ObjectToWorld;</span><br><span class="line">};</span><br><span class="line">cbuffer UnityPerMaterial {</span><br><span class="line">        </span><br><span class="line">}</span><br></pre></td></tr></table></figure><h4 id="UnityPerMaterial"><code>UnityPerMaterial</code></h4><p>æ‰€æœ‰æè´¨ç›¸å…³æ•°æ®éƒ½åº”è¯¥åœ¨åä¸º <code>UnityPerMaterial</code> çš„å•ä¸ª CBUFFER ä¸­å£°æ˜</p><blockquote><p>ä»€ä¹ˆæ˜¯ ** Per Material**</p><p>é€šå¸¸æ˜¯åœ¨ç€è‰²å™¨å±æ€§éƒ¨åˆ†å£°æ˜çš„æ‰€æœ‰å˜é‡ï¼Œä¸èƒ½æŠŠè¿™äº›æ•°æ®æ¼å†™æˆ–è€…å†™é“åˆ«çš„ CBUFFER ä¸­</p></blockquote><h4 id="UnityPerDraw"><code>UnityPerDraw</code></h4><p>è¯¥ CBUFFER åº”è¯¥åŒ…å«æ‰€æœ‰ Unity çš„å†…ç½®å¼•æ“å˜é‡ã€‚<code>UnityPerDraw</code>çš„ CBUFFER å†…éƒ¨å˜é‡å£°æ˜é¡ºåºä¹Ÿå¾ˆé‡è¦ï¼Œæ‰€æœ‰å˜é‡éƒ½åº”è¯¥éµé¡¼åä¸º <strong>Block Feature</strong> çš„å¸ƒå±€â€”â€”å¦‚æœä¸éœ€è¦ï¼Œåˆ™ä¸å¿…å£°æ˜éƒ¨åˆ†å—åŠŸèƒ½ã€‚<code>UnityPerDraw</code>ä¸­çš„æ‰€æœ‰å†…ç½®å¼•æ“å˜é‡éƒ½åº”è¯¥ä¸º <code>float4</code> æˆ–<code>float4x4</code>ç±»å‹</p><blockquote><p>åœ¨ç§»åŠ¨å¹³å°ä¸Šï¼Œå¼€å‘è€…å¯èƒ½æƒ³ä½¿ç”¨ <code>real4</code> ç±»å‹ï¼Œä»¥èŠ‚çœéƒ¨åˆ† GPU å¸¦å®½ã€‚ä¸æ˜¯æ‰€æœ‰ <code>UnityPerDraw</code> å˜é‡éƒ½å¯ä»¥ä½¿ç”¨ <code>real4</code> ç±»å‹</p></blockquote><h4 id="SRP-Batcher- åŸç†">SRP Batcher åŸç†</h4><p>SRP Batcher ä¼šåœ¨ä¸»å­˜ä¸­å°†æ¨¡å‹çš„åæ ‡ä¿¡æ¯ã€æè´¨ä¿¡æ¯ã€ä¸»å…‰é˜´å½±å‚æ•°ã€éä¸»å…‰é˜´å½±å‚æ•°åˆ†åˆ«ä¿å­˜æˆä¸åŒçš„ <code>CBUFFER</code> ä¸­ï¼Œåªæœ‰ <code>CBUFFEER</code> äº§ç”Ÿå˜åŒ–æ‰ä¼šé‡æ–°æäº¤åˆ° GPU ä¸­ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå°†æ¨¡å‹ä¿¡æ¯ã€ä½ç½®ä¿¡æ¯ã€å˜æ¢ä¿¡æ¯ä¸æè´¨ä¿¡æ¯åˆ†å¼€ï¼Œæ¨¡å‹å¯èƒ½æ¯å¸§éƒ½ä¼šç§»åŠ¨åæ ‡ï¼Œä½†ä¸ä¼šæ¯å¸§éƒ½ä¿®æ”¹æè´¨å‚æ•°ä¿¡æ¯ï¼Œæè´¨ä¿¡æ¯æ¯æ¬¡å˜åŒ–åéƒ½é€šè¿‡ <code>CBUFFER</code> ä¼ åˆ° GPU ä¸­å¹¶ä¸”ä¿å­˜ï¼ˆåªè¦æ²¡æœ‰å˜åŒ–å°±ä¸éœ€è¦é‡æ–°æäº¤ï¼‰ï¼Œæœ€ç»ˆ Shader åœ¨æ˜¾å­˜ä¸­é€šè¿‡æ¯å¸§å˜åŒ–çš„åæ ‡ä¿¡æ¯å’Œä¸ä¸€å®šæ¯å¸§å˜åŒ–çš„æè´¨ä¿¡æ¯æ¸²æŸ“å‡ºæ¨¡å‹æ¥</p><center>    <img src="/2022/08/19/45/c-buffer.png"></center><ul><li><code>CBUFFER_START(UnityPerDraw)</code>ï¼šæ¯ä¸ªç‰©ä½“ç»˜åˆ¶å…±äº«çš„ <code>CBUFFER</code>ï¼ŒåŒ…æ‹¬æ¨¡å‹æ§ä»¶è½¬ä¸–ç•Œç©ºé—´çŸ©é˜µã€ä¸–ç•Œç©ºé—´è½¬æ¨¡å‹ç©ºé—´çŸ©é˜µã€LOD å‚æ•°ã€<strong> ä¸–ç•Œå˜æ¢å‚æ•°</strong>ã€ç¯å…‰å‚æ•°ã€ç¯å¢ƒè´´å›¾å‚æ•°ã€çƒ˜ç„™å‚æ•°ã€çƒè°å…‰ç…§ä¿¡æ¯</li><li><code>CBUFFER_START(UnityPerMaterial)</code>ï¼šåŒä¸€æè´¨åªèƒ½äº›ä¸€ä¸ª <code>CBUFFER_START(UnityPerMaterial)</code>ï¼Œå¦‚æœå†™å¤šä¸ªä¼šæŠ¥é”™ã€‚ç”±äºè¿™ä¸ª<code>CBUFFER</code> æ˜¯è‡ªå·±å†™çš„ï¼Œæ‰€ä»¥æ‰€ä»¥æ•°æ®çš„èµ‹å€¼åœ¨ Shader ä»£ç çš„å±æ€§æ¡†æ¶ä¸­ï¼Œåœ¨æè´¨é¢æ¿ä¸­å°±å¯ä»¥è®¾ç½®å‚æ•°äº†<ul><li>æ¯ä¸ªæè´¨çš„å†…å®¹æŒä¹…åŒ–åœ¨ GPU çš„å†…å­˜ä¸Š</li><li>ä¸€ä¸ªä¸“ç”¨çš„ä»£ç è·¯å¾„æ¥ç®¡ç†ä¸€ä¸ªå¤§çš„â€œPer Objectâ€çš„<code>CBUFFER</code></li></ul></li></ul><h4 id="ç€è‰²å™¨æ ‡è¯† -Shader-PropertyToID">ç€è‰²å™¨æ ‡è¯† <a href="https://docs.unity3d.com/cn/2022.1/ScriptReference/Shader.PropertyToID.html"><code>Shader.PropertyToID</code></a></h4><p>è·å–ç€è‰²å™¨ <strong> å±æ€§åç§° </strong> çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ä½¿ç”¨å±æ€§æ ‡è¯†ç¬¦æ¯”å°†å­—ç¬¦ä¸²ä¼ é€’åˆ°æ‰€æœ‰æè´¨å±æ€§å‡½æ•°æ›´æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¦å¤šæ¬¡è°ƒç”¨ <a href="https://docs.unity3d.com/cn/2022.1/ScriptReference/Material.SetColor.html"><code>Material.SetColor</code></a> æˆ–è€…ä½¿ç”¨ <a href="https://docs.unity3d.com/cn/2022.1/ScriptReference/MaterialPropertyBlock.html"><code>MaterialPropertyBlock</code></a>ï¼Œåˆ™æœ€å¥½åªè·å–ä¸€æ¬¡æ‰€éœ€å±æ€§çš„æ ‡è¯†ç¬¦ã€‚åœ¨ Unity ä¸­ï¼Œç€è‰²å™¨å±æ€§çš„æ¯ä¸ªåç§°ï¼ˆä¾‹å¦‚ <code>_MainTex</code> æˆ– <code>_Color</code>ï¼‰å‡åˆ†é…æœ‰å”¯ä¸€ æ•´æ•°ï¼Œåœ¨æ•´ä¸ªæ¸¸æˆä¸­ï¼Œè¯¥æ•´æ•°å‡ä¿æŒç›¸åŒã€‚åœ¨æ¸¸æˆçš„ä¸åŒæ¬¡è¿è¡Œä¹‹é—´æˆ–åœ¨ä¸åŒæœºå™¨ä¹‹é—´ï¼Œè¿™äº›æ•°å­—ä¸åŒï¼Œå› æ­¤ä¸è¦å­˜å‚¨æˆ–é€šè¿‡ç½‘ç»œå‘é€è¿™äº›æ•°å­—</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="é¢è¯•" scheme="https://silhouettesforyou.github.io/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
    <category term="unity" scheme="https://silhouettesforyou.github.io/tags/unity/"/>
    
    <category term="é¢è¯•" scheme="https://silhouettesforyou.github.io/tags/%E9%9D%A2%E8%AF%95/"/>
    
    <category term="2022" scheme="https://silhouettesforyou.github.io/tags/2022/"/>
    
  </entry>
  
  <entry>
    <title>Lua å°çŸ¥è¯†ï¼ˆè½¬è½½ï¼‰</title>
    <link href="https://silhouettesforyou.github.io/2022/08/15/44/"/>
    <id>https://silhouettesforyou.github.io/2022/08/15/44/</id>
    <published>2022-08-15T08:30:15.000Z</published>
    <updated>2023-12-10T07:38:09.384Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h3 id="æ•°ç»„å…ƒç´ çš„æ’å…¥ä¸åˆ é™¤">æ•°ç»„å…ƒç´ çš„æ’å…¥ä¸åˆ é™¤</h3><p><code>table.insert</code>ä¸ <code>table.remove</code> æ–¹æ³•å¯ä»¥ä»æ•°ç»„ä¸­é—´çš„ä½ç½®æ’å…¥æˆ–ç§»é™¤ä¸€ä¸ªå…ƒç´ ã€‚è¿›è¡Œæ­¤æ“ä½œæ—¶ï¼Œlua æ ¸å¿ƒä¼šå°†æ’å…¥ä½ç½®å¼€å§‹çš„æ‰€æœ‰å…ƒç´  <strong> é€ä¸€ </strong> å‘åç§»åŠ¨ä¸€ä½ï¼ˆç§»é™¤å…ƒç´ äº¦ç„¶ï¼‰ã€‚å› æ­¤ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> t = {}</span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">10000</span> <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">insert</span>(t, <span class="number">1</span>, i)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ä¼šç§»åŠ¨å…ƒç´  <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -1.552ex;" xmlns="http://www.w3.org/2000/svg" width="15.073ex" height="4.588ex" role="img" focusable="false" viewbox="0 -1342 6662.4 2028"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mstyle"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000,0)"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1500,0)"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(2000,0)"/></g><g data-mml-node="mo" transform="translate(2722.2,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"/></g><g data-mml-node="mn" transform="translate(3722.4,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000,0)"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1500,0)"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(2000,0)"/></g></g><g data-mml-node="mn" transform="translate(3081.2,-686)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><rect width="6422.4" height="60" x="120" y="220"/></g></g></g></g></svg></mjx-container> æ¬¡ã€‚</p><p>ä¸€èˆ¬çš„è§£å†³æ–¹æ³•ï¼š</p><ol><li><p>å¦‚æœä½ å¹¶ä¸è¦æ±‚è¿™æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆæ¯”å¦‚ä½ ä¸ä¼šå»éå†è¿™ä¸ªè¡¨ï¼‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥å°†å…ƒç´ ç½®ç©ºï¼Œæˆ–æ˜¯æ’å…¥åˆ°è¡¨çš„ç©ºä½ä¸­ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ é™¤å…ƒç´ </span></span><br><span class="line">t[<span class="number">100</span>] = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ’å…¥åˆ°è¡¨çš„ç©ºä½ä¸­</span></span><br><span class="line">t[#t+<span class="number">1</span>] = object</span><br><span class="line"><span class="comment">-- ä¸Šä¸‹ 2 ç§å†™æ³•ç­‰ä»·ï¼Œä½†æ˜¯ä¸Šé¢çš„å†™æ³•ç•¥å¾®é«˜æ•ˆä¸€äº›</span></span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">insert</span>(t, object)</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œæ’å…¥åˆ°è¡¨çš„ç©ºä½ä¸­çš„å†™æ³•ï¼Œlua è§„å®šåªæœ‰å½“æ•°ç»„æ˜¯ç´§å¯†çš„æ—¶å€™ï¼Œ <code>#t</code>æ‰èƒ½è¿”å›æ•°ç»„çš„é•¿åº¦ã€‚å½“æ•°ç»„ä¸ºç¨€ç–çš„æ—¶å€™ï¼Œ<code>#t</code>ä¼šè¿”å›ä»»æ„ä¸€ä¸ªè¾¹ç•Œï¼ˆ<code>#t</code>éç©ºï¼Œä½† <code>#t+1</code> ä¸ºç©ºï¼‰ï¼Œå› æ­¤ä½¿ç”¨ <code>#t+1</code> ä¸ä¼šè¦†ç›–å·²æœ‰æ•°æ®ã€‚</p></li><li><p>å¦‚æœä½ è¦æ±‚ä»–ä¸€å®šæ˜¯æ•°ç»„ï¼Œä½†æ˜¯ä¸è¦æ±‚ä¿æŒé¡ºåºï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ç§»é™¤æ—¶å°†å°¾éƒ¨çš„å…ƒç´ æŒªè¿‡æ¥å¡«è¡¥ç©ºä½ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ é™¤å…ƒç´ </span></span><br><span class="line">t[<span class="number">100</span>] = t[#t]</span><br><span class="line">t[#t]  = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–°çš„å…ƒç´ æ€»æ˜¯æ·»åŠ åˆ°æœ«å°¾</span></span><br><span class="line">t[#t+<span class="number">1</span>] = object</span><br><span class="line"><span class="comment">-- ä¸Šä¸‹ 2 ç§å†™æ³•ç­‰ä»·ï¼Œä½†æ˜¯ä¸Šé¢çš„å†™æ³•ç•¥å¾®é«˜æ•ˆä¸€äº›</span></span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">insert</span>(t, object)</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœä½ è¦æ±‚ä»–ä¸€å®šæ˜¯æ•°ç»„ï¼Œä½†æ˜¯ä¸è¦æ±‚ä¿æŒé¡ºåºï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ç§»é™¤æ—¶å°†å°¾éƒ¨çš„å…ƒç´ æŒªè¿‡æ¥å¡«è¡¥ç©ºä½ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ é™¤å…ƒç´ </span></span><br><span class="line">t[<span class="number">100</span>] = <span class="literal">false</span> <span class="comment">-- å¾€åŸæ¥çš„ä½ç½®æ”¾ç½®ä¸€ä¸ªå ä½ç¬¦ï¼Œéå†æ—¶è¿‡æ»¤æ‰æ­¤å ä½ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åœ¨é€‚å½“çš„æ—¶å€™ï¼Œæ¸…ç†æ‰æ•°ç»„ä¸­çš„æ‰€æœ‰å ä½ç¬¦</span></span><br><span class="line"><span class="keyword">local</span> count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, #t <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> t[i] == <span class="literal">false</span> <span class="keyword">then</span></span><br><span class="line">        t[i] = <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        count = count + <span class="number">1</span></span><br><span class="line">        t[count] = t[i]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="Try-Catch">Try-Catch</h3><p>ä½ å¯ä»¥ä½¿ç”¨ <code>pcall</code> ä¸ <code>xpcall</code> ä»¥ä¿æŠ¤æ¨¡å¼è¿è¡Œä¸€æ®µä»£ç ï¼Œå½“ä»£ç å‘ç”Ÿå¼‚å¸¸åä¼šå¸¦ç€é”™è¯¯æ¶ˆæ¯å›åˆ°æ­¤å‡½æ•°çš„è°ƒç”¨å¤„ï¼Œä¾‹å¦‚ï¼š</p>   <figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> suc, res = <span class="built_in">pcall</span>(<span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> n = <span class="literal">nil</span> + <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(n) <span class="comment">-- ä¸ä¼šæ‰§è¡Œåˆ°</span></span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"><span class="built_in">print</span>(suc, res) <span class="comment">-- false, error message</span></span><br></pre></td></tr></table></figure><p><code>xpcall</code> åˆ™å¯ä»¥å†ä¼ å…¥ä¸€ä¸ª <code>catch</code> ï¼Œä½¿å¾—ä½ å¯ä»¥åœ¨ç°åœºæ•è·é”™è¯¯å¹¶æŸ¥çœ‹å †æ ˆ</p>   <figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">xpcall</span>(<span class="function"><span class="keyword">function</span> <span class="params">()</span></span> </span><br><span class="line">    <span class="keyword">local</span> n = <span class="literal">nil</span> + <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(n) <span class="comment">-- ä¸ä¼šæ‰§è¡Œåˆ°</span></span><br><span class="line"><span class="keyword">end</span>, <span class="function"><span class="keyword">function</span> <span class="params">(error_message)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">debug</span>.<span class="built_in">traceback</span>(error_message))</span><br><span class="line"><span class="keyword">end</span>)</span><br></pre></td></tr></table></figure><blockquote><p>ä½ å¯ä»¥ç›´æ¥æŠŠ <code>debug.traceback</code> å½“åš <code>catch</code> ä¼ ç»™ <code>xpcall</code> ï¼Œå› ä¸º <code>debug.traceback</code> çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯æ¥æ”¶ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼Œç„¶åæŠŠå †æ ˆä¿¡æ¯æ‹¼åœ¨é”™è¯¯æ¶ˆæ¯åé¢è¿”å›å›æ¥ï¼›è€Œ <code>xpcall</code> ä¼šå°† <code>catch</code> çš„è¿”å›å€¼ä½œä¸ºæ–°çš„é”™è¯¯æ¶ˆæ¯è¿”å›å‡ºæ¥ï¼Œè¿™æ ·ä¸€æ¥å°±å¯ä»¥åœ¨è°ƒç”¨å¤„æŸ¥çœ‹é”™è¯¯å †æ ˆã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> suc, res = <span class="built_in">xpcall</span>(<span class="function"><span class="keyword">function</span> <span class="params">()</span></span> </span><br><span class="line">    <span class="keyword">local</span> n = <span class="literal">nil</span> + <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(n) <span class="comment">-- ä¸ä¼šæ‰§è¡Œåˆ°</span></span><br><span class="line"><span class="keyword">end</span>, <span class="built_in">debug</span>.<span class="built_in">traceback</span>)</span><br><span class="line"><span class="built_in">print</span>(suc, res) <span class="comment">-- false, error message with traceback</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="åˆ¤ç©º">åˆ¤ç©º</h3><p>åœ¨ Lua ä¸­åªæœ‰ <code>nil</code> ä¸ <code>false</code> ä¼šè¢«è®¤ä¸ºæ˜¯å‡å€¼ï¼Œè€Œæ‰€æœ‰å…¶ä»–å€¼éƒ½æ˜¯çœŸå€¼ï¼ŒåŒ…æ‹¬ <code>0</code> <code>''</code> <code>{}</code> ã€‚</p><p>å› æ­¤å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½ åªéœ€è¦ç®€å•çš„é€šè¿‡ <code>if x then</code> æ¥è¿›è¡Œåˆ¤ç©ºã€‚</p><p>ä½†æœ‰ä¸€ç§æƒ…å†µæ˜¯ä½ æœ‰ä¸ªéå¸¸é•¿çš„æ“ä½œé“¾ï¼Œä¾‹å¦‚ <code>local x = t.x.y.z()[1]</code>  è€Œ lua å¹¶ä¸æ”¯æŒå¯é€‰æ“ä½œç¬¦ï¼ˆæ¯”å¦‚ TS ä¸­å¯ä»¥è¿™ä¹ˆå†™ï¼š <code>let x = t?.x?.y?.z?.()?.[1]</code>)</p><p>å¸¸è§çš„å‡ ç§è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ol><li><p>ä¾æ¬¡åˆ¤ç©ºï¼Œæœ€æœ´ç´ çš„æ€è·¯ï¼ŒTS ä¸­çš„å¯é€‰æ“ä½œç¬¦æœ€ç»ˆä¹Ÿæ˜¯ç¼–è¯‘ä¸ºä¾æ¬¡åˆ¤ç©ºçš„</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> x</span><br><span class="line"><span class="keyword">if</span> t <span class="keyword">and</span> t.x <span class="keyword">and</span> t.x.y <span class="keyword">and</span> t.x.y.z <span class="keyword">then</span> <span class="comment">-- è¿™é‡Œéœ€è¦ç¡®å®šå–å­—æ®µæ²¡æœ‰å‰¯ä½œç”¨</span></span><br><span class="line">    <span class="keyword">local</span> _r = t.x.y.z() <span class="comment">-- å‡½æ•°è°ƒç”¨é€šå¸¸æœ‰å‰¯ä½œç”¨ï¼Œå› æ­¤éœ€è¦ç¼“å­˜ç»“æœ</span></span><br><span class="line">    <span class="keyword">if</span> _r <span class="keyword">then</span></span><br><span class="line">        x = _r[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        catchError(<span class="string">'z() is nil'</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    catchError(<span class="string">'x or y or z is nil'</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå†™æ³•ç®€å•æ˜“æ‡‚ï¼Œå‡ ä¹æ²¡æœ‰é¢å¤–å¼€é”€ï¼Œä½†æ˜¯æ˜¾ç„¶å†™èµ·æ¥å¾ˆå¤æ‚ï¼Œå¾ˆä¸ä¼˜ç¾</p></li><li><p>åˆ›å»ºé»˜è®¤å€¼ï¼Œè¿™æ˜¯æ¥è‡ªã€ŠLua ç¨‹åºè®¾è®¡ã€‹ä½œè€…çš„æ–¹æ¡ˆ</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> x = ((((t <span class="keyword">or</span> {}).x <span class="keyword">or</span> {}).z <span class="keyword">or</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span></span> <span class="keyword">end</span>)() <span class="keyword">or</span> {})[<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>æ ¹æ®æˆ‘ä»¬äººå·¥é¢„æµ‹ï¼Œæ¯æ­¥æ“ä½œå¤§æ¦‚ç‡ä¸ä¼šæ˜¯ç©ºå€¼ï¼Œæ ¹æ® Lua çš„çŸ­è·¯è§„åˆ™ä¸€èˆ¬ä¸ä¼šçœŸçš„åˆ›å»ºå‡ºå¾ˆå¤šå¯¹è±¡ï¼ŒåŸºæœ¬æ²¡æœ‰é¢å¤–å¼€é”€ã€‚è€Œå½“å‡ºç°ç©ºå€¼æ—¶ï¼Œä½œä¸ºå‡ºé”™æƒ…å†µåˆ›å»ºä¸€ç‚¹å¯¹è±¡ä¹Ÿä¸æ˜¯å¾ˆæœ‰æ‰€è°“ã€‚ä¸è¿‡ç¼ºç‚¹å°±æ˜¯æ‹¬å·å®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œå¾ˆéš¾çœ‹æ¸…æ˜¯å¦å†™å¯¹</p><p>å¦‚æœæƒ³æ•è·é”™è¯¯éœ€è¦å†åŠ ä¸ªæ•è·ï¼ˆå‡è®¾æ•è·å‡½æ•° <code>catchError</code> æ²¡æœ‰è¿”å›å€¼ï¼‰ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> x = ((((</span><br><span class="line">     t <span class="keyword">or</span> catchError(<span class="string">'t is nil'</span>)   <span class="keyword">or</span> {})</span><br><span class="line">    .x <span class="keyword">or</span> catchError(<span class="string">'x is nil'</span>)   <span class="keyword">or</span> {})</span><br><span class="line">    .z <span class="keyword">or</span> catchError(<span class="string">'z is nil'</span>)   <span class="keyword">or</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span></span> <span class="keyword">end</span>)</span><br><span class="line">    () <span class="keyword">or</span> catchError(<span class="string">'z() is nil'</span>) <span class="keyword">or</span> {})</span><br><span class="line">    [<span class="number">1</span>]</span><br></pre></td></tr></table></figure></li><li><p>å°è£…æˆå‡½æ•°</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">getValue</span><span class="params">(v, ...)</span></span></span><br><span class="line">    <span class="keyword">local</span> n = <span class="built_in">select</span>(<span class="string">'#'</span>, ...)</span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, n <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> k = <span class="built_in">select</span>(i, ...)</span><br><span class="line">        <span class="keyword">if</span> v[k] <span class="keyword">then</span></span><br><span class="line">            v = v[k]</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            catchError(k .. <span class="string">'is nil'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- ä»¥ä¸Šæ•´ä¸ªå‡½æ•°ç”± copilot ç”Ÿæˆï¼Œæˆ‘æ²¡ä»”ç»†çœ‹ï¼Œæœ‰é—®é¢˜å‘Šè¯‰æˆ‘</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> x = getValue(t, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•åªèƒ½æ”¯æŒå–å­—æ®µæ“ä½œï¼Œæ²¡æ³•å®ç°å‡½æ•°è°ƒç”¨ã€‚ä½†è€ƒè™‘åˆ°å®é™…å·¥ç¨‹ä¸­å¾ˆå°‘ä¼šæŠŠå‡½æ•°è°ƒç”¨æ”¾åˆ°é•¿æ“ä½œé“¾ä¸­ï¼Œè¿™ä¹Ÿæ˜¯ä¸ªä¸é”™çš„è§£å†³æ–¹æ¡ˆã€‚ç¼ºç‚¹æ˜¯è¯­ä¹‰ä¸å¤ªæ¸…æ™°ï¼Œè€Œä¸”æ— è®ºæ˜¯ä¸æ˜¯ç©ºéƒ½éœ€è¦ä»˜å‡ºå¾ˆå¤šé¢å¤–çš„å‡½æ•°è°ƒç”¨çš„å¼€é”€</p></li><li><p>æ‰€æœ‰çš„æ“ä½œéƒ½ try 1 try</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> x</span><br><span class="line"><span class="built_in">xpcall</span>(<span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br><span class="line">    x = t.x.y.z()[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">end</span>, catchError)</span><br></pre></td></tr></table></figure></li><li><p>é‡å†™ <code>nil</code> çš„æ“ä½œã€‚å®é™…å·¥ç¨‹ä¸­æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°éœ€è¦è¿ç»­å¤§æ®µçš„è¯»è¡¨ï¼Œç›´æ¥è®© Lua å¯¹ <code>nil</code> è¿›è¡Œè¯»å­—æ®µ / å‡½æ•°è°ƒç”¨ç­‰æ“ä½œ</p><p>Lua å¯ä»¥é€šè¿‡ <code>debug.setmetatable</code> ç»™åŸºç¡€ç±»å‹æ·»åŠ å…ƒè¡¨ï¼Œæ‰€æœ‰è¯¥ç±»å‹çš„å€¼ä¼šå…±äº«åŒä¸€ä¸ªå…ƒè¡¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç»™ <code>nil</code> æ·»åŠ ä¸€ä¸ªé‡è½½äº†æ‰€æœ‰è¿ç®—ç¬¦çš„å…ƒè¡¨ï¼Œå…·ä½“ä»£ç æ¯”è¾ƒé•¿å°±ä¸è´´å‡ºæ¥äº†ï¼Œå¯ä»¥åˆ°è¿™é‡Œçœ‹ï¼š<a class="link" href="https://github.com/sumneko/lua-without-check-nil/blob/master/without-check-nil.lua">https://github.com/sumneko/lua-without-check-nil/blob/master/without-check-nil.lua<i class="fas fa-external-link-alt"></i></a></p><blockquote><ul><li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æˆ‘ä»¬è¿›è¡Œå®Œé•¿é“¾æ“ä½œåéœ€è¦åŠæ—¶ç¦ç”¨æ‰æ­¤åŠŸèƒ½ï¼Œä»¥å…æŠŠä½ å…¶ä»–ä»£ç ä¸­çš„é”™è¯¯åƒæ‰</li><li>å¦å¤–ç”±äº Lua æ— æ³•é‡è½½ <code>asindex</code> ï¼Œå› æ­¤æ— æ³•å¤„ç† <code>t[nil] = 1</code> è¿™ç§æƒ…å†µ</li></ul></blockquote><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> nonil = <span class="built_in">require</span> <span class="string">'without-check-nil'</span></span><br><span class="line">nonil.watch = <span class="function"><span class="keyword">function</span> <span class="params">(ev, exp1, exp2)</span></span></span><br><span class="line">    catchError(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">'[%s] error, exp1 = %s, exp2 = %s'</span>, ev, exp1, exp2))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">nonil.enable()</span><br><span class="line"><span class="keyword">local</span> x = t.x.y.z()[<span class="number">1</span>]</span><br><span class="line">nonil.disable()</span><br></pre></td></tr></table></figure></li></ol><h4 id="æ€»ç»“">æ€»ç»“</h4><table><thead><tr><th>æ–¹æ¡ˆ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>å¼€é”€</th><th>é”™è¯¯æ•è·</th></tr></thead><tbody><tr><td>ä¾æ¬¡åˆ¤ç©º</td><td>ç®€å•</td><td>å†™èµ·æ¥éº»çƒ¦ çœ‹èµ·æ¥è´¹åŠ² 1 è¡Œå˜ 5 è¡Œ</td><td>æœ‰å°‘é‡é¢å¤–å¼€é”€</td><td>å¯ä»¥æ‰‹åŠ¨æ•è·é”™è¯¯ï¼Œä½†æ˜¯ä¼šè®©ä»£ç å†™èµ·æ¥æ›´éº»çƒ¦</td></tr><tr><td>åˆ›å»ºé»˜è®¤å€¼</td><td>ä¸ä¼šå¢åŠ è¡Œæ•°</td><td>æ“ä½œé“¾é•¿çš„è¯æ‹¬å·ä¼šå¾ˆå¤š</td><td>æœ‰å°‘é‡é¢å¤–å¼€é”€</td><td>å¯ä»¥æ‰‹åŠ¨æ•è·é”™è¯¯ï¼Œä½†æ˜¯ä¼šè®©ä»£ç å†™èµ·æ¥æ›´éº»çƒ¦</td></tr><tr><td>å°è£…æˆå‡½æ•°</td><td>ä¸ä¼šå¢åŠ è¡Œæ•° å†™èµ·æ¥æ¯”è¾ƒç®€å•</td><td>åªèƒ½è¿›è¡Œå–å€¼æ“ä½œ</td><td>æœ‰ä¸€äº›é¢å¤–å¼€é”€</td><td>å¯ä»¥åœ¨å°è£…å‡½æ•°ä¸­è‡ªåŠ¨æ•è·</td></tr><tr><td>Try 1 Try</td><td>å†™èµ·æ¥ç®€å• çœ‹èµ·æ¥ç›´è§‚</td><td>1 è¡Œå˜ 3 è¡Œ</td><td>æœ‰ä¸€äº›é¢å¤–å¼€é”€</td><td>ç­‰åŒäºæ‰‹åŠ¨æ•è·</td></tr><tr><td>é‡å†™ <code>nil</code> çš„æ“ä½œ</td><td>å‡ ä¹ä¸éœ€è¦ä¿®æ”¹ä»£ç </td><td>é‡å†™ <code>nil</code> æ“ä½œä¸ºå…¨å±€å¼€å…³ï¼Œéœ€è¦è®°å¾—å…³ å¦‚æœä¸šåŠ¡å’Œè¯»è¡¨æ··åœ¨ä¸€èµ·ï¼Œå¯èƒ½ä¼šåƒæ‰ä¸šåŠ¡é‡Œçš„é”™è¯¯ æ— æ³•å¤„ç†é”®ä¸ºç©ºçš„é”™è¯¯</td><td>æ²¡æœ‰é¢å¤–å¼€é”€</td><td>é€šè¿‡æ³¨å†Œ <code>watch</code> å‡½æ•°æ¥å…¨å±€æ•è·</td></tr></tbody></table><h3 id="æå‡æ€§èƒ½çš„å†™æ³•">æå‡æ€§èƒ½çš„å†™æ³•</h3><p>æœ‰æ—¶æˆ‘ä»¬å¿…é¡»ç”¨ Lua å†™ä¸€äº›è¿ç®—å¯†é›†çš„ä»£ç ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ä¸€äº›å†™æ³•ç•¥å¾®æå‡æ€§èƒ½ã€‚æ³¨æ„ï¼Œä¼˜åŒ–æ€§èƒ½æ—¶ä¼˜å…ˆçº§ç¬¬ä¸€æ˜¯æ‰¾ bugï¼Œç¬¬äºŒæ˜¯æ”¹è¿›ç®—æ³•è®¾è®¡ï¼Œä¹‹åæ‰è½®åˆ°æ›´é«˜æ•ˆçš„å†™æ³•ã€‚æ›´æ”¹å†™æ³•å¾ˆå¯èƒ½ä¼šé™ä½ä»£ç çš„å¯è¯»æ€§ï¼Œä½ éœ€è¦è‡ªå·±å¯»æ‰¾æ€§èƒ½ä¸å¯è¯»æ€§ä¹‹é—´çš„å¹³è¡¡ç‚¹ï¼Œé€‚å½“ç•™ä¸‹æ³¨é‡Šï¼Œå¹¶ä¸”åˆ‡è®° <strong> ä¸è¦è¿‡æ—©ä¼˜åŒ–</strong>ã€‚</p><ol><li><p>ä½¿ç”¨ <code>t[#t+1] = n</code> ä»£æ›¿ <code>table.insert(t, n)</code> ï¼›ä½¿ç”¨ <code>t[#t] = nil</code> ä»£æ›¿ <code>table.remove(t)</code> ã€‚è¿™æ˜¯å› ä¸º Lua è°ƒç”¨å‡½æ•°çš„å¼€é”€æ¯”è¿ç®—ç¬¦è¦é«˜ã€‚ä½†æ˜¯ä½¿ç”¨è¿™ç§å†™æ³•æ—¶è¯·æ³¨æ„ï¼Œå¦‚æœä½ çš„ <code>t</code> æ˜¯ä¸ªè¡¨è¾¾å¼ï¼Œé‚£ä¹ˆè¿™ä¸ªè¡¨è¾¾å¼ä¼šè¢«æ±‚ 2 æ¬¡</p></li><li><p>ä½¿ç”¨å±€éƒ¨å˜é‡ä»£æ›¿å…¨å±€å˜é‡ï¼Œå¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> tinsert = <span class="built_in">table</span>.<span class="built_in">insert</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> t = {}</span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">10000</span> <span class="keyword">do</span></span><br><span class="line">    tinsert(t, i)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>è¯¥å†™æ³•çš„æå‡å¾ˆå°ï¼Œåªæœ‰åœ¨éå¸¸å¯†é›†çš„å¾ªç¯è¿ç®—ä¸­æ‰æœ‰æ”¹å†™çš„ä»·å€¼</p></li><li><p>ä½¿ç”¨å±€éƒ¨å˜é‡ç¼“å­˜ç»“æœï¼Œå¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åŸæœ¬çš„ä»£ç ï¼š</span></span><br><span class="line">a.b.c.d[#a.b.c.d+<span class="number">1</span>] = n</span><br><span class="line">call(a.b.c.d)</span><br><span class="line">a.b.c.d[#a.b.c.d] = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¯ä»¥æ”¹å†™æˆï¼š</span></span><br><span class="line"><span class="keyword">local</span> t = a.b.c.d</span><br><span class="line">t[#t+<span class="number">1</span>] = n</span><br><span class="line">call(t)</span><br><span class="line">t[#t] = <span class="literal">nil</span></span><br></pre></td></tr></table></figure><p>Lua çš„å±€éƒ¨å˜é‡æ˜¯æ²¡æœ‰é¢å¤–å¼€é”€çš„ï¼Œå› ä¸º Lua æœ¬èº«å°±ä¼šé€šè¿‡éšè—çš„å±€éƒ¨å˜é‡ï¼ˆå¯„å­˜å™¨ï¼‰æ¥ä¿å­˜ä¸­é—´ç»“æœã€‚ä¾‹å¦‚ä¸Šé¢ä¾‹å­ä¸­åŸæœ¬çš„ä»£ç ï¼ŒLua ç”Ÿæˆçš„å­—èŠ‚ç ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> a1, a2, a3</span><br><span class="line">a1 = getglobal(<span class="string">'a'</span>)</span><br><span class="line">a1 = getfield(a1, <span class="string">'b'</span>)</span><br><span class="line">a1 = getfield(a1, <span class="string">'c'</span>)</span><br><span class="line">a1 = getfield(a1, <span class="string">'d'</span>)</span><br><span class="line">a2 = getglobal(<span class="string">'a'</span>)</span><br><span class="line">a2 = getfield(a2, <span class="string">'b'</span>)</span><br><span class="line">a2 = getfield(a2, <span class="string">'c'</span>)</span><br><span class="line">a2 = getfield(a2, <span class="string">'d'</span>)</span><br><span class="line">a2 = getlen(a2)</span><br><span class="line">a2 = binary(<span class="string">'+'</span>, a2, <span class="number">1</span>)</span><br><span class="line">a3 = getglobal(<span class="string">'n'</span>)</span><br><span class="line">setfield(a1, a2, a3)</span><br></pre></td></tr></table></figure></li><li><p>é¿å…åˆ›å»ºå¯¹è±¡ï¼Œä¸»è¦æ˜¯è¡¨</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">isSupported</span><span class="params">(t)</span></span></span><br><span class="line">    <span class="keyword">for</span> _, v <span class="keyword">in</span> <span class="built_in">ipairs</span> {<span class="string">'Windows'</span>, <span class="string">'macOS'</span>, <span class="string">'Linux'</span>} <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> t[v] <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ”¹å†™ä¸º</span></span><br><span class="line"><span class="keyword">local</span> supported = {<span class="string">'Windows'</span>, <span class="string">'macOS'</span>, <span class="string">'Linux'</span>}</span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">isSupported</span><span class="params">(t)</span></span></span><br><span class="line">    <span class="keyword">for</span> _, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(supported) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> t[v] <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å…¶å®è°ƒç”¨ ipairs ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é—­åŒ…ï¼Œå¦‚æœä½ éå¸¸åœ¨æ„ï¼Œå¯ä»¥å°±æ”¹å†™ä¸º</span></span><br><span class="line"><span class="keyword">local</span> supported = {<span class="string">'Windows'</span>, <span class="string">'macOS'</span>, <span class="string">'Linux'</span>}</span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">isSupported</span><span class="params">(t)</span></span></span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, #supported <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> v = supported[i]</span><br><span class="line">        <span class="keyword">if</span> t[v] <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¦‚æœä½ è¿å¾ªç¯éƒ½ä¸æƒ³è¦ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç»ˆææ‰‹æ®µ - æ‰‹åŠ¨å±•å¼€</span></span><br><span class="line"><span class="keyword">local</span> supported = {<span class="string">'Windows'</span>, <span class="string">'macOS'</span>, <span class="string">'Linux'</span>}</span><br><span class="line"><span class="keyword">local</span> codes = {<span class="string">'local t = ...'</span>}</span><br><span class="line"><span class="keyword">for</span> _, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(supported) <span class="keyword">do</span></span><br><span class="line">    codes[#codes+<span class="number">1</span>] = <span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">[[</span></span><br><span class="line"><span class="string">if t[%q] then</span></span><br><span class="line"><span class="string">    return true</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string">]]</span>, v)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">codes[#codes+<span class="number">1</span>] = <span class="string">'return false'</span></span><br><span class="line"><span class="keyword">local</span> code = <span class="built_in">table</span>.<span class="built_in">concat</span>(codes, <span class="string">'\n'</span>)</span><br><span class="line"><span class="keyword">local</span> isSupported = <span class="built_in">load</span>(code) <span class="comment">-- Lua 5.1 ç”¨ loadstring</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="ä¸€äº›å‘">ä¸€äº›å‘</h3><ol><li><p>Lua çš„æ•°ç»„ç´¢å¼•æ˜¯ä» 1 å¼€å§‹çš„</p></li><li><p>å¦‚æœæ•°ç»„æ„é€ çš„æœ€åä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œè¦æ³¨æ„è¿™ä¸ªå‡½æ•°è°ƒç”¨çš„æ‰€æœ‰è¿”å›å€¼éƒ½ä¿å­˜åˆ°è¡¨é‡Œï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> username = <span class="string">'sumneko'</span></span><br><span class="line"><span class="keyword">local</span> platform = <span class="string">'Windows11'</span></span><br><span class="line"><span class="keyword">local</span> t = {username, <span class="built_in">string</span>.<span class="built_in">gsub</span>(platform, <span class="string">'%d+'</span>, <span class="string">''</span>) }</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(t[<span class="number">1</span>]) <span class="comment">--"sumneko"</span></span><br><span class="line"><span class="built_in">print</span>(t[<span class="number">2</span>]) <span class="comment">--"Windows"</span></span><br><span class="line"><span class="built_in">print</span>(t[<span class="number">3</span>]) <span class="comment">-- 1           -- è¿™æ˜¯ string.gsub çš„ç¬¬äºŒä¸ªè¿”å›å€¼ï¼Œè¡¨ç¤ºæˆåŠŸæ›¿æ¢äº† 1 æ¬¡</span></span><br></pre></td></tr></table></figure><p>åŒç†å‡½æ•°è°ƒç”¨çš„æœ€åä¸€ä¸ªå‚æ•°ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="built_in">input</span> = <span class="string">'#ffcc00'</span></span><br><span class="line"><span class="keyword">local</span> n = <span class="built_in">tonumber</span>(<span class="built_in">string</span>.<span class="built_in">gsub</span>(<span class="built_in">input</span>, <span class="string">'#'</span>, <span class="string">'0x'</span>))</span><br><span class="line"><span class="comment">-- ä¸Šé¢è¿™è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸º string.gsub ä¼šè¿”å› 2 ä¸ªè¿”å›å€¼ "0xffcc00" ä¸ 1ï¼Œ</span></span><br><span class="line"><span class="comment">-- ä¹‹åç›¸å½“äºè°ƒç”¨äº† tonumber("0xffcc00", 1) ï¼Œè¡¨ç¤ºä»¥ 1 è¿›åˆ¶è½¬æ¢è¯¥å­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure><p>è§£å†³åŠæ³•ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. åˆ†æˆ 2 è¡Œå†™</span></span><br><span class="line"><span class="keyword">local</span> <span class="built_in">input</span> = <span class="string">'#ffcc00'</span></span><br><span class="line"><span class="keyword">local</span> int16 = <span class="built_in">string</span>.<span class="built_in">gsub</span>(<span class="built_in">input</span>, <span class="string">'#'</span>, <span class="string">'0x'</span>)</span><br><span class="line"><span class="keyword">local</span> n = <span class="built_in">tonumber</span>(int16)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. åŠ ä¸ªæ‹¬å·å¼ºåˆ¶ï¼Œå¼ºåˆ¶åªä¿ç•™ç¬¬ä¸€ä¸ªè¿”å›å€¼</span></span><br><span class="line"><span class="keyword">local</span> <span class="built_in">input</span> = <span class="string">'#ffcc00'</span></span><br><span class="line"><span class="keyword">local</span> n = <span class="built_in">tonumber</span>((<span class="built_in">string</span>.<span class="built_in">gsub</span>(<span class="built_in">input</span>, <span class="string">'#'</span>, <span class="string">'0x'</span>)))</span><br></pre></td></tr></table></figure></li><li><p><code>pairs</code> éå†å“ˆå¸Œè¡¨æ—¶ï¼Œé¡ºåºæœªå®šä¹‰</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> t = {</span><br><span class="line">    a = <span class="number">1</span>,</span><br><span class="line">    b = <span class="number">2</span>,</span><br><span class="line">    c = <span class="number">3</span>,</span><br><span class="line">    d = <span class="number">4</span>,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(k)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li><li><p><code>pairs</code> éå†å“ˆå¸Œè¡¨æ—¶ï¼Œä¸èƒ½å¾€è¿™å¼ è¡¨é‡Œä¿å­˜æ–°çš„å­—æ®µ</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">string</span>.<span class="built_in">sub</span>(k, <span class="number">1</span>, <span class="number">2</span>) == <span class="string">'m_'</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">local</span> realKey = <span class="built_in">string</span>.<span class="built_in">sub</span>(<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">100</span> <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">local</span> newKey = realKey .. <span class="built_in">tostring</span>(i)</span><br><span class="line">            t[newKey] = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¿™ç§å†™æ³•ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œé€šå¸¸è¡¨ç°ä¸ºåŒä¸€ä¸ª key è¢«éå†åˆ°å¤šæ¬¡ï¼Œç”šè‡³æ˜¯æ­»å¾ªç¯</span></span><br><span class="line"><span class="comment">-- è¿™ç§å†™æ³•å…¶å®æ¯”è¾ƒå®¹æ˜“çœ‹å‡ºéå†æ—¶ä¿å­˜äº†æ•°æ®ï¼Œéº»çƒ¦çš„æ˜¯ä¸‹é¢è¿™ç§ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> id, unit <span class="keyword">in</span> <span class="built_in">pairs</span>(AllUnitsMap) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> unit:isRemoved() <span class="keyword">then</span></span><br><span class="line">        allUnitsMap[id] = <span class="literal">nil</span> <span class="comment">-- éå†è¡¨çš„æ—¶å€™ä¿®æ”¹æˆ–ç§»é™¤å­˜åœ¨çš„å­—æ®µæ˜¯ OK çš„</span></span><br><span class="line">        eventDispatch(<span class="string">'å•ä½ - ç§»é™¤'</span>, unit)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¸Šé¢è¿™æ®µä»£ç åœ¨éå†ä¸­ç§»é™¤å…ƒç´ åå‘å¤–æŠ›å‡ºäº†ä¸€ä¸ªäº‹ä»¶ï¼Œ</span></span><br><span class="line"><span class="comment">-- è¿™æ˜¯éå¸¸å±é™©çš„ï¼Œå› ä¸ºäº‹ä»¶ä¸­å¯èƒ½ä¼šå¾€è¡¨ä¸­æ·»åŠ å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">-- åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰å¯èƒ½æ˜¯ç­–åˆ’å¸Œæœ›åœ¨æŸä¸ªå•ä½è¢«ç§»é™¤ååˆ›å»ºä¸€ä¸ªæ–°çš„å•ä½å‡ºæ¥ï¼Œ</span></span><br><span class="line"><span class="comment">-- è€Œæ–°å»ºçš„å•ä½ä¼šè¢«æ·»åŠ åˆ°æ­£åœ¨éå†çš„å…¨å±€è¡¨ä¸­ã€‚</span></span><br></pre></td></tr></table></figure></li><li><p>å±€éƒ¨å‡½æ•°çš„å£°æ˜æ–¹å¼</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> f = <span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br><span class="line">    f() <span class="comment">-- è¿™é‡Œçš„ f æ˜¯å…¨å±€å˜é‡ï¼Œå› æ­¤æ— æ³•é€’å½’å½“å‰å‡½æ•°</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line">    f() <span class="comment">-- è¿™é‡Œçš„ f æ˜¯å±€éƒ¨å˜é‡ï¼Œä¼šé€’å½’å½“å‰å‡½æ•°</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- ä¸Šä¸‹ 2 ä¸ªå†™æ³•æ˜¯ç­‰ä»·çš„ï¼Œä¸Šè€…æ˜¯ä¸‹è€…çš„è¯­æ³•ç³–</span></span><br><span class="line"><span class="keyword">local</span> f;f = <span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br><span class="line">    f() <span class="comment">-- è¿™é‡Œçš„ f æ˜¯å±€éƒ¨å˜é‡ï¼Œä¼šé€’å½’å½“å‰å‡½æ•°</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li><li><p><code>require</code> åªä¼šæ‰§è¡Œæ–‡ä»¶ä¸€æ¬¡ï¼Œä¸”åªæ¥å—ä¸€ä¸ªè¿”å›å€¼</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ–‡ä»¶ A.lua</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'loaded'</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–‡ä»¶ B.lua</span></span><br><span class="line"><span class="keyword">local</span> x1, y1, z1 = <span class="built_in">require</span> <span class="string">'A'</span></span><br><span class="line"><span class="built_in">print</span>(x1) <span class="comment">-- 1</span></span><br><span class="line"><span class="built_in">print</span>(y1) <span class="comment">-- "@A.lua" # ç¬¬ä¸€æ¬¡ require æ–‡ä»¶æ—¶ï¼Œä¼šè¿”å›æ–‡ä»¶è·¯å¾„ ï¼ˆä»… Lua 5.4ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(z1) <span class="comment">-- nil</span></span><br><span class="line"><span class="keyword">local</span> x2, y2, z2 = <span class="built_in">require</span> <span class="string">'A'</span></span><br><span class="line"><span class="built_in">print</span>(x1) <span class="comment">-- 1</span></span><br><span class="line"><span class="built_in">print</span>(y1) <span class="comment">-- nil</span></span><br><span class="line"><span class="built_in">print</span>(z1) <span class="comment">-- nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åªä¼šæ‰“å°ä¸€æ¬¡ 'loaded' ï¼Œå› ä¸ºæ–‡ä»¶ A åªè¢«æ‰§è¡Œäº†ä¸€æ¬¡</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå¦‚æœä½ ç”¨ä¸åŒçš„åå­—åŠ è½½åŒä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å°±ä¼šè¢«åŠ è½½å¤šæ¬¡ï¼Œè¿™æ˜¯ä¸€å®šè¦é¿å…çš„ï¼</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ–‡ä»¶ A/init.lua</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span> <span class="string">'A.init'</span> <span class="comment">-- é€šè¿‡ '?.lua' æœç´¢åˆ° 'A/init.lua'</span></span><br><span class="line"><span class="built_in">require</span> <span class="string">'A/init'</span> <span class="comment">-- é€šè¿‡ '?.lua' æœç´¢åˆ° 'A/init.lua'</span></span><br><span class="line"><span class="built_in">require</span> <span class="string">'A'</span>      <span class="comment">-- é€šè¿‡ '?/init.lua' æœç´¢åˆ° 'A/init.lua'</span></span><br><span class="line"><span class="built_in">require</span> <span class="string">'a'</span>      <span class="comment">-- é€šè¿‡ '?/init.lua' æœç´¢åˆ° 'a/init.lua'ï¼Œåœ¨ Windows å¹³å°ä¸‹ä¼šæ˜ å°„åˆ° 'A/init.lua'</span></span><br></pre></td></tr></table></figure><p>ä¾‹å­ä¸­çš„ 4 è¡Œä»£ç æœ€ç»ˆä½¿å¾—åŒä¸€ä¸ªæ–‡ä»¶è¢«æ‰§è¡Œäº† 4 æ¬¡</p></li><li><p><code>os.clock</code> åœ¨ä¸åŒçš„å¹³å°è¡Œä¸ºä¸ä¸€è‡´</p><p>å…¶å®è¿™ä¸ç®—æ˜¯ Lua çš„å‘ï¼Œè¿™æ˜¯ Windows çš„å†å²é—ç•™é—®é¢˜ã€‚ISO æ ‡å‡†ä¸­è§„å®šäº† <code>clock()</code> å‡½æ•°è¿”å›å½“å‰è¿›ç¨‹å ç”¨çš„ CPU æ—¶é—´ï¼Œä½†æ˜¯ Windows é”™è¯¯çš„å®ç°æˆäº†å½“å‰è¿›ç¨‹ä»å¯åŠ¨å¼€å§‹åˆ°ç°åœ¨ç»è¿‡çš„æ€»æ—¶é—´ã€‚å› æ­¤è¦æ³¨æ„ä¸èƒ½æ‹¿ä»–ç”¨äºè·å–ç°å®æ—¶é—´ï¼ˆé™¤éåªåœ¨ Windows è¿è¡Œï¼‰</p></li></ol><h3 id="æ‹¼æ¥å­—ç¬¦ä¸²">æ‹¼æ¥å­—ç¬¦ä¸²</h3><p>Lua çš„å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œå› æ­¤å¯¹å­—ç¬¦ä¸²è¿›è¡Œçš„æ“ä½œéœ€è¦åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> str = <span class="string">'a'</span> .. <span class="string">'b'</span> .. <span class="string">'c'</span> .. <span class="string">'d'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¿™æ®µä»£ç ä¼šåˆ›å»º 'ab' 'abc' 'abcd' 3 ä¸ªå­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä½ çš„å­—ç¬¦ä¸²æ¯”è¾ƒçŸ­æˆ–æ˜¯æ‹¼æ¥æ¬¡æ•°æ¯”è¾ƒå°‘ï¼Œé‚£ä¹ˆæ— éœ€åœ¨æ„ã€‚ä½†å¦‚æœéœ€è¦å†å¾ªç¯ä¸­è¿›è¡Œå¤§é‡æ‹¼æ¥ï¼Œé‚£ä¹ˆåº”å½“ä½¿ç”¨ <code>table.concat</code> æ¥å®ç°ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">(units)</span></span></span><br><span class="line">    <span class="keyword">local</span> str = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> _, u <span class="keyword">in</span> <span class="built_in">ipairs</span>(units) <span class="keyword">do</span></span><br><span class="line">        str = str .. u:getUUID() .. <span class="string">','</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- å‡è®¾ units çš„æ•°ç»„é•¿åº¦ä¸º 1000ï¼Œä¸”æ¯ä¸ª unit çš„ UUID é•¿åº¦ä¸º 16 ä¸ªå­—èŠ‚ï¼Œ</span></span><br><span class="line"><span class="comment">-- é‚£ä¹ˆä¸Šè¿°ä»£ç ä¸€å…±ä¼šåˆ›å»º 2000 ä¸ªå­—ç¬¦ä¸²ï¼Œå…±ç”³è¯· 17M çš„å†…å­˜ã€‚</span></span><br><span class="line"><span class="comment">-- å› æ­¤å°†å…¶æ”¹å†™ä¸ºï¼š</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">(units)</span></span></span><br><span class="line">    <span class="keyword">local</span> buf = {}</span><br><span class="line">    <span class="keyword">for</span> _, u <span class="keyword">in</span> <span class="built_in">ipairs</span>(units) <span class="keyword">do</span></span><br><span class="line">        buf[#buf+<span class="number">1</span>] = u:getUUID()</span><br><span class="line">        buf[#buf+<span class="number">1</span>] = <span class="string">','</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">table</span>.<span class="built_in">concat</span>(buf)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- å¦‚æ­¤ä¸€æ¥å°±åªä¼šåˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”³è¯· 17K çš„å†…å­˜</span></span><br></pre></td></tr></table></figure><h3 id="ç©ºï¼ˆnoneï¼‰ä¸ nil">ç©ºï¼ˆnoneï¼‰ä¸<code>nil</code></h3><p>åœ¨ Lua å±‚ï¼Œç”±äºè·å–ä¸€ä¸ªç©ºå€¼æ—¶ä¼šè¿”å› <code>nil</code>ï¼Œå› æ­¤å¾ˆéš¾å¯Ÿè§‰åˆ°ç©ºå€¼çš„å­˜åœ¨ã€‚è€Œåœ¨ C å±‚åˆ™æ˜¯æä¾›äº†<code>lua_isnil</code>/<code>lua_isnone</code>/<code>lua_isnoneornil</code> è¿™ 3 ä¸ª API è¿›è¡ŒåŒºåˆ†ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬ç¡®å®ä¸éœ€è¦å…³å¿ƒä»–ä»¬çš„åŒºåˆ«ï¼Œä½†è¿˜æ˜¯æœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦ç”¨åˆ°ã€‚</p><p>Lua é»˜è®¤æä¾›çš„å‡ ä¸ª API ä¼šæ ¹æ®å‚æ•°çš„æ•°é‡å†³å®šä¸åŒçš„è¡Œä¸ºï¼Œä¾‹å¦‚ <code>table.insert</code>ï¼š</p><ul><li><code>table.insert(t, v)</code> åœ¨ <code>t</code> çš„æœ«å°¾æ·»åŠ <code>v</code></li><li><code>table.insert(t, pos, v)</code> <code>t</code>ä¸­ä» <code>pos</code> å¼€å§‹çš„å…ƒç´ éƒ½å¾€åç§»åŠ¨ä¸€æ ¼ï¼Œç„¶åå°† <code>v</code> æ”¾åœ¨ <code>t[pos]</code> ä¸Š</li></ul><p>è¿™é‡Œå°±æ˜¯æ ¹æ®ä½ ä¼ å…¥çš„å‚æ•°æ•°é‡å†³å®šçš„ï¼Œå› æ­¤ä½ è°ƒç”¨ <code>table.insert(t, v, nil)</code> æ—¶å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ 3 å‚æ•°ç‰ˆæœ¬</p><p>è¿™æ—¶å€™ä½ å¯èƒ½ä¼šè¯´ï¼šä½ å½“æˆ‘çå˜›ï¼Œæˆ‘å½“ç„¶çŸ¥é“è¿™æ˜¯ 3 ä¸ªå‚æ•°ã€‚å®¢å®˜è«æ€¥ï¼Œçœ‹çœ‹è¿™ä¸¤ç§æƒ…å†µï¼š</p><ul><li><code>table.insert(t, ...)</code></li><li><code>table.insert(t, getValue())</code></li></ul><p>å‰ä¸€ç§ä¸å®šå‚ä¼šå¯¼è‡´ä½ çš„å‚æ•°æ•°é‡ç”±å½“å‰å‡½æ•°çš„è°ƒç”¨è€…å†³å®šï¼Œå› æ­¤ä½ éœ€è¦åšå¥½åˆ¤æ–­çš„å·¥ä½œã€‚åˆ¤æ–­ä¸å®šå‚çš„å‚æ•°æ•°é‡éœ€è¦ç”¨åˆ° <code>select</code> æ–¹æ³•ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">count</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">select</span>(<span class="string">'#'</span>, ...)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(count()) <span class="comment">--&gt; 0</span></span><br><span class="line"><span class="built_in">print</span>(count(<span class="number">1</span>, <span class="number">2</span>)) <span class="comment">--&gt; 2</span></span><br><span class="line"><span class="built_in">print</span>(count(<span class="number">1</span>, <span class="number">2</span>, <span class="literal">nil</span>, <span class="literal">nil</span>)) <span class="comment">--&gt; 4</span></span><br></pre></td></tr></table></figure><p>åä¸€ç§åˆ™æ˜¯è¦ä¿è¯å¥½ç›®æ ‡å‡½æ•°çš„è¿”å›å€¼æ•°é‡ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">getValue</span><span class="params">(n)</span></span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">elseif</span> n == <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">elseif</span> n == <span class="number">2</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">elseif</span> n == <span class="number">3</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">select</span>(<span class="string">'#'</span>, getValue(<span class="number">0</span>))) <span class="comment">--&gt; 0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">select</span>(<span class="string">'#'</span>, getValue(<span class="number">1</span>))) <span class="comment">--&gt; 1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">select</span>(<span class="string">'#'</span>, getValue(<span class="number">2</span>))) <span class="comment">--&gt; 2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">select</span>(<span class="string">'#'</span>, getValue(<span class="number">3</span>))) <span class="comment">--&gt; 3</span></span><br></pre></td></tr></table></figure><p>å‰æ–‡â€œä¸€äº›å‘â€ä¸­æœ‰æåˆ°è¿‡ï¼Œå°½é‡ä½¿ç”¨ä¸­é—´å˜é‡æ¥æ˜ç¡®å‡½æ•°è¿”å›å€¼çš„æ•°é‡</p><h3 id="ä¸å®šå‚">ä¸å®šå‚</h3><p>ä¸å®šå‚æ˜¯ä¸èƒ½è·¨è¶Šå‡½æ•°ï¼ˆä½œä¸ºé—­åŒ…çš„ä¸Šå€¼ï¼‰çš„ï¼Œä¹Ÿå°±æ˜¯ä½ æ— æ³•è¿™ä¹ˆå†™ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">factory</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br><span class="line">        <span class="keyword">return</span> ... <span class="comment">--&gt; è¯­æ³•é”™è¯¯</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><blockquote><p>æœ‰æ—¶ä½ ä¼šåœ¨ç½‘ä¸Šçš„æ•™ç¨‹ä¸­çœ‹åˆ°ä¸å®šå‚ä¼šè¢«å­˜åˆ°éšè—å‚æ•° argï¼ˆè¡¨ï¼‰ä¸­ï¼Œè¿™æ˜¯æ—§ç‰ˆ Lua çš„åŠŸèƒ½ï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘å·²è¢«åºŸå¼ƒï¼ˆå½“ç„¶ C ä»£ç ä¸­æœ‰å®å¯ä»¥å¯ç”¨è¿™ä¸ªåŠŸèƒ½ï¼‰</p></blockquote><p>å¦‚æœæœ‰è¿™ä¸ªéœ€æ±‚çš„è¯ï¼Œéœ€è¦å°†ä¸å®šå‚åŒ…è£…åˆ°ä¸€ä¸ªè¡¨ä¸­ï¼Œä¸€èˆ¬æ¥è¯´è¿™ä¹ˆå†™å°±è¶³å¤Ÿäº†</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">factory</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">local</span> vars = {...}</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">table</span>.<span class="built_in">unpack</span>(vars) <span class="comment">--&gt; Lua 5.1 ä¸º `unpack`</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ä½†æœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦ä¿è¯ä¸å®šå‚éœ€è¦è¢« <strong> åŸæ · </strong> è¿”å›å‡ºå»ï¼Œæ¯”å¦‚è½¬å‘ / ä»£ç†ä»»æ„æ¶ˆæ¯ã€‚å¦‚æœä¸å®šå‚çš„æœ«å°¾è·Ÿç€<code>nil</code>ï¼Œä¸Šé¢çš„å†™æ³•ä¼šå¯¼è‡´è¿”å›å‡ºå»çš„å€¼çš„æ•°é‡ä¸åŒï¼Œå› æ­¤éœ€è¦ä¿å­˜ä¸å®šå‚çš„æ•°é‡ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">factory</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">local</span> vars = {...}</span><br><span class="line">    <span class="keyword">local</span> num  = <span class="built_in">select</span>(<span class="string">'#'</span>, ...)</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">table</span>.<span class="built_in">unpack</span>(vars, <span class="number">1</span>, num)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>æ­¤å¤–ä¹Ÿå¯ä»¥ç”¨ <code>table.pack</code> å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">factory</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">local</span> vars = <span class="built_in">table</span>.pack(...) <span class="comment">--&gt; Lua 5.1 ä¸å¯ç”¨ï¼›LuaJIT å¯ç”¨</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">table</span>.<span class="built_in">unpack</span>(vars, <span class="number">1</span>, vars.n) <span class="comment">--&gt; ä¸å®šå‚é•¿åº¦ä¿å­˜åœ¨å­—æ®µ `n` ä¸­</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>è¿™ 2 ç§å†™æ³•æ ¹æ®ä½¿ç”¨åœºæ™¯ä¼šæœ‰ä¸€ç‚¹ç‚¹çš„æ€§èƒ½åŒºåˆ«ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">getSum1</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">local</span> sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, <span class="built_in">select</span>(<span class="string">'#'</span>, ...) <span class="keyword">do</span></span><br><span class="line">        sum = sum + (<span class="built_in">select</span>(<span class="string">'#'</span>, i) <span class="keyword">or</span> <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">getSum2</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">local</span> sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">local</span> vars = <span class="built_in">table</span>.pack(...)</span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, vars.n <span class="keyword">do</span></span><br><span class="line">        sum = sum + (vars[i] <span class="keyword">or</span> <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>è‚‰çœ¼å¯è§ï¼Œç¬¬ä¸€ç§å†™æ³•æ¯ä¸ªå‚æ•°éƒ½è¦è°ƒç”¨ä¸€æ¬¡å‡½æ•°ï¼Œç¬¬äºŒç§å†™æ³•åˆ™å›ºå®šè¦åˆ›å»ºä¸€å¼ è¡¨ï¼Œæ‰€ä»¥ä½ å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé¢„ä¼°ä¸€ä¸‹å‚æ•°æ•°é‡å†³å®šä½¿ç”¨å“ªç§å†™æ³•ã€‚ä¸è¿‡è¯´å®è¯å·®åˆ«å¾ˆå°ï¼Œä¸éœ€è¦ç‰¹åˆ«åœ¨æ„</p><h3 id="ç¯å¢ƒä¸æ²™ç›’">ç¯å¢ƒä¸æ²™ç›’</h3><p>Lua é€šè¿‡å…¨å±€è¡¨ä¸ç¯å¢ƒè¡¨æ¥å®ç°å…¨å±€å˜é‡ã€‚åœ¨ Lua 5.1 ä¸ LuaJIT ä¸­æ¯ä¸ªå‡½æ•°éƒ½ä¼šç»‘å®šä¸€ä¸ªç¯å¢ƒè¡¨ (envï¼Œé»˜è®¤å°±æ˜¯ <code>_G</code>)ï¼Œå½“ä½ è¯»å†™å…¨å±€å˜é‡æ—¶ï¼Œå…¶å®ä¿®æ”¹çš„æ˜¯ç¯å¢ƒè¡¨ä¸­çš„å¯¹è±¡ã€‚æ–°å»ºçš„å‡½æ•°ä¼šç»§æ‰¿çˆ¶å‡½æ•°çš„ç¯å¢ƒï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†å‡½æ•°<code>setfenv</code> æ¥ä¿®æ”¹å‡½æ•°çš„ç¯å¢ƒ</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">X = <span class="number">1</span> </span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line">    Y = X</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¸Šé¢çš„ä»£ç åœ¨ Lua 5.1 ä¸­ä¼šè¢«è¿™æ ·è§£é‡Šï¼ˆä¼ªä»£ç ï¼‰ï¼š</span></span><br><span class="line"><span class="built_in">setfenv</span>(<span class="number">1</span>, env) <span class="comment">-- `env` æ˜¯å½“å‰ç¯å¢ƒï¼Œé»˜è®¤ä¸º `_G`. `env` å¹¶ä¸å­˜åœ¨äºå˜é‡åˆ—è¡¨ä¸­ã€‚</span></span><br><span class="line"><span class="built_in">getfenv</span>(<span class="number">1</span>)[<span class="string">'X'</span>] = <span class="number">1</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">getfenv</span>(<span class="number">1</span>)[<span class="string">'Y'</span>] = <span class="built_in">getfenv</span>(<span class="number">1</span>)[<span class="string">'X'</span>]</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">setfenv</span>(f, <span class="built_in">getfenv</span>(<span class="number">1</span>))</span><br></pre></td></tr></table></figure><p>ç„¶è€Œè¿™ä¸ªè®¾è®¡å¼•å‘äº†å¾ˆå¤šå›°æƒ‘ï¼Œä½ æ— æ³•å‡†ç¡®çš„åˆ¤æ–­å‡ºå½“å‰å‡½æ•°çš„å†…çš„å…¨å±€å˜é‡åˆ°åº•æ˜¯ä»å“ªä¸ªç¯å¢ƒé‡Œè¯»å–çš„ï¼Œå› ä¸ºä»»ä½•äººéƒ½æœ‰æƒé™éšæ—¶ä¿®æ”¹ä½ çš„ç¯å¢ƒã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°è¿”å›äº†ä¸€ä¸ªé—­åŒ…ï¼Œåˆ›å»ºé—­åŒ…çš„æ—¶å€™é—­åŒ…ä¼šç»§æ‰¿çˆ¶å‡½æ•°çš„ç¯å¢ƒï¼Œä½†ä¹‹åä¿®æ”¹çˆ¶å‡½æ•°çš„ç¯å¢ƒå°†æ— æ³•å†å½±å“é—­åŒ…ã€‚ç›¸å¯¹ä¹‹ä¸‹ä¿®æ”¹ä¸Šå€¼ï¼ˆupvalueï¼‰æ˜¯å¯ä»¥ä½œç”¨äºé—­åŒ…çš„ï¼Œå› æ­¤è¿™åˆå¼•å‘äº†â€œå˜é‡ä½œç”¨åŸŸâ€è§„åˆ™çš„ä¸ä¸€è‡´æ€§ï¼Œå¼•å‘äº†å›°æ‰°</p><p>å› æ­¤ä» Lua 5.2 å¼€å§‹ï¼Œç¯å¢ƒæ”¹ä¸ºé€šè¿‡ä¸Šå€¼æ¥å®ç°ï¼Œä»è€Œç»Ÿä¸€äº†æ¦‚å¿µï¼Œå‡å°‘äº†ç‰¹ä¾‹</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¸Šé¢çš„ä»£ç åœ¨ Lua 5.2 ä¸­ä¼šè¢«è¿™æ ·è§£é‡Šï¼ˆä¼ªä»£ç ï¼‰ï¼š</span></span><br><span class="line"><span class="keyword">local</span> <span class="built_in">_ENV</span> = env <span class="comment">-- `env` æ˜¯å½“å‰ç¯å¢ƒï¼Œé»˜è®¤ä¸º `_G`.</span></span><br><span class="line"><span class="built_in">_ENV</span>[<span class="string">'x'</span>] = <span class="number">1</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">_ENV</span>[<span class="string">'Y'</span>] = <span class="built_in">_ENV</span>[<span class="string">'X'</span>]</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>_ENV</code> æ˜¯çœŸå®å­˜åœ¨äºå±€éƒ¨å˜é‡åˆ—è¡¨ä¸­çš„ï¼Œè¿™ä½¿å¾—ç¯å¢ƒçš„åŸºç¡€æ¦‚å¿µç”±æ¯ä¸ªå‡½æ•°å•ç‹¬ä¸€ä¸ªç¯å¢ƒå˜ä¸ºäº†åŒä¸€ä¸ªæ–‡ä»¶å…±äº«åŒä¸€ä¸ªç¯å¢ƒã€‚è¿™ä¸ªæ–¹æ¡ˆä½¿å¾—å‡½æ•°çš„ç¯å¢ƒç”±ä»£ç å†™æ³•å†³å®šï¼Œè€Œä¸æ˜¯ç”±è¿è¡Œæ—¶çš„çŠ¶æ€å†³å®šã€‚å½“ä½ ä¿®æ”¹ç¯å¢ƒæ—¶ï¼Œæ‰€æœ‰çš„å‡½æ•°ä¸é—­åŒ…çš„ç¯å¢ƒä¹Ÿä¼šè¢«ä¸€å¹¶ä¿®æ”¹</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="built_in">print</span> = <span class="built_in">print</span></span><br><span class="line"><span class="keyword">local</span> <span class="built_in">pairs</span> = <span class="built_in">pairs</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">_ENV</span> = <span class="literal">nil</span> <span class="comment">-- ç¦æ­¢ä¸‹é¢çš„ä»£ç ä½¿ç”¨å…¨å±€å˜é‡ï¼Œé¿å…æ‹¼å†™é”™è¯¯å¯¼è‡´çš„è¯¯ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pairs</span>)</span><br><span class="line"><span class="built_in">print</span>(paris) <span class="comment">-- è¿è¡Œæ—¶è¿™é‡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºè¢«è§£é‡Šä¸ºäº† `_ENV['paris']`ï¼Œè€Œæ­¤æ—¶çš„ `_ENV` ä¸º `nil`</span></span><br></pre></td></tr></table></figure><h3 id="åƒåœ¾å›æ”¶">åƒåœ¾å›æ”¶</h3><p>ç›®å‰ä¸»æµçš„åƒåœ¾å›æ”¶æœ‰ 2 ç§ï¼Œåˆ†åˆ«æ˜¯å¼•ç”¨è®¡æ•°ä¸æ ‡è®°æ¸…ç†ã€‚</p><p>å¼•ç”¨è®¡æ•°çš„åŸç†å¾ˆæœ´ç´ ï¼Œæ¯å½“å¯¹è±¡è¢«æŒæœ‰æ—¶è®¡æ•° +1ï¼Œå½“æŒæœ‰è¢«è§£é™¤å -1ï¼Œå½’ 0 å³é‡Šæ”¾ã€‚è¿™ç§æœ´ç´ çš„æ€æƒ³è‡ªç„¶ä¼šäº§ç”Ÿå¾ˆå¤šé—®é¢˜ï¼ŒåŒ…æ‹¬éš¾ä»¥è§£å†³å¾ªç¯å¼•ç”¨ä»¥åŠå¯¹äºåŠ¨æ€è¯­è¨€æ¥è¯´æµªè´¹æ€§èƒ½ç­‰ã€‚ä½† Lua æ²¡æœ‰ä½¿ç”¨è¿™ç§æ–¹å¼çš„ä¸»è¦åŸå› æ˜¯ Lua è®¾è®¡ä¸ºéœ€è¦é¢‘ç¹å’Œ C äº¤äº’ï¼Œè€Œå¼•ç”¨è®¡æ•°åŠ¿å¿…ä¼šä¾µå…¥ CAPI çš„éƒ¨åˆ†ï¼Œä¼šç»™ C çš„ä»£ç å¸¦æ¥é¢å¤–çš„å¿ƒæ™ºè´Ÿæ‹…ã€‚</p><p>æ ‡è®°æ¸…ç†åˆ™æ˜¯ä»ç›®çš„å‡ºå‘ï¼šæ—¢ç„¶åƒåœ¾å›æ”¶çš„ç›®çš„æ˜¯ä¸ºäº†æ¸…ç†æ‰æ— æ³•å†è®¿é—®åˆ°çš„å†…å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªè¦è¿›è¡Œä¸€æ¬¡å¯è¾¾æ€§æµ‹è¯•ï¼Œå³å¯æ‰¾å‡ºè¦æ”¶é›†çš„åƒåœ¾ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><center>    <img src="/2022/08/15/44/lua-garbage-collection.png"></center><p>æˆ‘ä»¬åªéœ€è¦ä»æ ¹é›†ï¼ˆæ³¨å†Œè¡¨ï¼‰å‡ºå‘ï¼Œé¡ºç€åº”ç”¨é“¾å¾€ä¸‹é€’å½’ï¼Œå°†è®¿é—®åˆ°çš„å¯¹è±¡å…¨éƒ¨æ ‡è®°ä¸ºé»‘è‰²ã€‚å½“é€’å½’ç»“æŸåï¼Œé‚£äº›æ²¡æœ‰è¢«æ ‡è®°åˆ°çš„å¯¹è±¡ä¾¿æˆä¸ºäº†åƒåœ¾å¯ä»¥é‡Šæ”¾æ‰äº†ã€‚è¿™ä¸ªæµç¨‹å®ç°èµ·æ¥å¾ˆç®€å•ï¼Œå› ä¸º Lua çš„ç»“æ„ç®€å•ï¼Œå¹¶ä¸”æä¾›äº†å®Œå–„çš„è°ƒè¯•ä¸åå°„åŠŸèƒ½ï¼Œç”šè‡³ä½¿ç”¨çº¯ Lua ä¹Ÿèƒ½å®ç°æ‰«æï¼Œå¯ä»¥ç”¨äºå†…å­˜åˆ†æç­‰åŠŸèƒ½</p><h4 id="å¢é‡å›æ”¶">å¢é‡å›æ”¶</h4><p>æ ‡è®°æ¸…ç†æœ‰ä¸ªæ˜¾è€Œæ˜“è§çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ç”±äºå•æ¬¡å›æ”¶éœ€è¦æ‰«ææ•´ä¸ªå†…å­˜ç©ºé—´ï¼Œä¼šäº§ç”Ÿä¸¥é‡çš„åœé¡¿ã€‚å› æ­¤éœ€è¦å°†è¿™ä¸ªå›æ”¶å°½é‡åˆ‡æˆå°ç‰‡ï¼Œå¹¶åˆ†æ•£åœ¨è¿è¡Œæ—¶çš„å„ä¸ªæ—¶æœºä¸­</p><p>æ ‡è®°è¿‡ç¨‹æ˜¾ç„¶æ˜¯ä¸€ä¸ªå¯ä»¥æ‹†åˆ†çš„æµç¨‹ï¼Œå› ä¸ºä»–çš„æœ¬è´¨æ˜¯é€’å½’ï¼Œå¯ä»¥å°†é€’å½’è§£ä¸ºä¸€ä¸ªå¾ªç¯ï¼Œè€Œå¾ªç¯åªè¦ä¿å­˜ä¸€ä¸‹é˜Ÿåˆ—ä¸å½“å‰çŠ¶æ€å³å¯éšæ—¶æš‚åœä¸æ¢å¤</p><p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªä¸­é—´é‡ç°è‰²ï¼Œè¡¨ç¤ºé‚£äº›æ”¾åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰«æçš„å¯¹è±¡ï¼ˆå³å·²ç»ç¡®å®šè¢«æ ¹é›†å¼•ç”¨åˆ°ï¼Œä½†è¿˜ä¸çŸ¥é“å®ƒå¼•ç”¨äº†å“ªäº›åˆ«çš„å¯¹è±¡ï¼‰ã€‚æ•´ä¸ªæµç¨‹å¤§æ¦‚å°±æ˜¯ï¼š</p><ol><li>å°†æ ¹é›†ï¼ˆæ³¨å†Œè¡¨ï¼‰æ ‡è®°ä¸ºé»‘è‰²ï¼Œå¹¶å°†é™„è¿‘çš„èŠ‚ç‚¹ï¼ˆå…¨å±€å˜é‡è¡¨ã€è¿è¡Œæ ˆç­‰ï¼‰æŸ“ä¸ºç°è‰²</li><li>éšä¾¿æŒ‘ä¸€ä¸ªç°è‰²ï¼Œå°†å…¶æ ‡è®°ä¸ºé»‘è‰²ï¼Œå¹¶å°†é™„è¿‘çš„ç™½è‰²èŠ‚ç‚¹æŸ“ä¸ºç°è‰²</li><li>é‡å¤ç¬¬ 2 æ­¥ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ç°è‰²èŠ‚ç‚¹ä¸ºæ­¢</li></ol><p>å› ä¸ºç¬¬ 2 æ­¥å¯ä»¥éšæ—¶æ‰“æ–­ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åˆ†æ•£åˆ°ä»£ç çš„å„ä¸ªè¿‡ç¨‹ä¸­ï¼ŒLua çš„é»˜è®¤è®¾ç½®ä¸ºä¼šä»¥å†…å­˜å¢é•¿é€Ÿåº¦çš„ 2 å€è¿›è¡Œæ‰«æï¼Œæ„æ€æ˜¯æ¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæˆ‘å°±ä¼šæ‰«æ 2 ä¸ªç°è‰²å¯¹è±¡ï¼ˆè¿™é‡Œå‡è®¾å¯¹è±¡å¤§å°éƒ½ä¸€æ ·ï¼‰</p><p>å¢é‡å›æ”¶çš„åŠ å…¥ä½¿å¾— Lua çš„åœ°ä½å‘ç”Ÿäº†æ ¹æœ¬æ€§çš„æ”¹å˜ï¼Œå›é¡¾å†å²ï¼ŒLua æ­£æ˜¯åœ¨æ­¤æ—¶ä»ä¸€ä¸ªçº¯ç²¹çš„èƒ¶æ°´è¯­è¨€å˜ä¸ºäº†ç¼–ç¨‹è¯­è¨€</p><p>ä¸€äº›ä½¿ç”¨è€ç‰ˆæœ¬ Unity çš„æ¸¸æˆé¡¹ç›®æœ‰æ—¶ä¼šå› ä¸ºä½¿ç”¨çš„ C# ç‰ˆæœ¬è¾ƒè€ä¸æ”¯æŒå¢é‡å›æ”¶ï¼Œä¸ºäº†é¿å…åƒåœ¾å›æ”¶å¸¦æ¥çš„åœé¡¿ï¼Œå°†å¯¹è±¡å…¨éƒ¨æ‰˜ç®¡åˆ°äº† Lua ä¸­</p><p>å¦å¤–è¿˜éœ€è¦è¯´æ˜ä¸€ç‚¹ï¼Œå¢é‡å›æ”¶å¤§å¤§å¢åŠ äº†åƒåœ¾å›æ”¶å®ç°çš„å¤æ‚åº¦ï¼Œå¹¶ä¸”äº§ç”Ÿäº†é¢å¤–çš„å¼€é”€ã€‚ä¸€èˆ¬æˆ‘ä»¬é€šè¿‡â€œååé‡â€æ¥æè¿°åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½ï¼Œè€Œå¢é‡å›æ”¶åŠ¿å¿…ä¼šè®©ååé‡ä¸‹é™ã€‚å› æ­¤ Lua æä¾›äº† <code>collectgarbage</code> æ¥å£å¯ä»¥é€šè¿‡å‚æ•°è°ƒæ•´ç­–ç•¥ï¼Œè‡ªå·±å¯»æ‰¾ä¸€ä¸ªååé‡ä¸æš‚åœæ—¶é—´çš„å¹³è¡¡ç‚¹</p><p>ç¨‹åºå¼€å‘ä¸­ä¸€ç›´æœ‰æ‰€è°“çš„â€œäºŒå…«åŸåˆ™â€ï¼Œåƒåœ¾å›æ”¶ä¹Ÿä¸ä¾‹å¤–ã€‚åˆ°ç›®å‰ä¸ºæ­¢æˆ‘æè¿°çš„éƒ½æ˜¯åƒåœ¾å›æ”¶ä¸­æœ€åŸºç¡€çš„æ€æƒ³å’Œæœ€ä¸»è¦çš„å®ç°ï¼Œå®ƒä»¬å æ®äº† 80% çš„æƒ…å†µï¼Œåªéœ€è¦ä»˜å‡º 20% çš„ç»å†ä¸ä»£ç é‡å³å¯å®Œæˆã€‚åœ¨è¿™ä¹‹åæˆ‘ä»¬ä¼šé‡åˆ° 20% çš„è¾¹ç•Œæƒ…å†µï¼Œä¸ºäº†å¯¹ä»˜ä»–ä»¬ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥å¤§é‡å¤æ‚çš„è®¾è®¡ï¼Œä»˜å‡º 80% çš„ç²¾åŠ›ä¸ä»£ç é‡</p><h4 id="å†™å±éšœ">å†™å±éšœ</h4><p>åœ¨ä¸Šé¢çš„å¢é‡å›æ”¶æµç¨‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªç†æƒ³çš„æ¨¡å‹ï¼šåœ¨çº¯ç™½çš„åœ°å›¾ä¸Šï¼Œä¸€ä¸ªé»‘è‰²å‡ºç°ï¼Œä¹‹åç°è‰²è¾¹ç•Œäº§ç”Ÿå¹¶æ…¢æ…¢æ‰©æ•£ï¼Œå¹¶ä¸”ç°è‰²æ…¢æ…¢è½¬æ¢ä¸ºé»‘è‰²ï¼Œæœ€ç»ˆå°†åœ°å›¾åˆ†å‰²ä¸ºéé»‘å³ç™½çš„ä¸–ç•Œã€‚å…¶ä¸­ç°è‰²ä½œä¸ºç¼“å†²å¸¦åˆ†å‰²äº†é»‘è‰²ä¸ç™½è‰²ï¼Œé»‘è‰²å¯¹è±¡ä¸ä¼šæŒ‡å‘ç™½è‰²å¯¹è±¡</p><p>ä½†å®é™…è¿è¡Œä¸­ï¼Œæˆ‘ä»¬å®Œå…¨æœ‰å¯èƒ½åœ¨åƒåœ¾å›æ”¶æš‚åœçš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡èµ‹å€¼æ“ä½œç›´æ¥å°†é»‘è‰²å¯¹è±¡æŒ‡å‘ç™½è‰²å¯¹è±¡ï¼Œä¾‹å¦‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">_G</span>[<span class="string">'X'</span>] = {} <span class="comment">-- _G è¡¨ä½œä¸ºæ ¹é›†ä¹‹ä¸€ï¼Œå¾ˆå¯èƒ½æ˜¯é»‘è‰²çš„ï¼›è€Œæ–°å»ºçš„ç©ºè¡¨ä¸€å®šæ˜¯ç™½è‰²çš„</span></span><br></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬éœ€è¦å¼•å…¥å†™å±éšœæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å†™å±éšœè¿™ä¸ªåå­—å¬ç€å¾ˆå‰å®³ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨èµ‹å€¼æ“ä½œé‡Œé¢åŠ äº†ä¸ªåˆ¤æ–­ï¼Œå‘ç°ç™½è‰²å¯¹è±¡è¢«èµ‹å€¼åˆ°äº†é»‘è‰²å¯¹è±¡çš„å¼•ç”¨ä¸­æ—¶ï¼Œå°†å…¶ä¸­ä¸€ä¸ªå¯¹è±¡æ”¹ä¸ºç°è‰²ã€‚åˆ°åº•æŠŠè°æ”¹ä¸ºç°è‰²ï¼Œè¿™ä¸ªä¸€èˆ¬æ˜¯æ ¹æ®æ¦‚ç‡ç»Ÿè®¡å‡ºæ¥çš„ç»éªŒï¼ˆåˆ†æ”¯é¢„æµ‹ï¼‰ï¼Œå› æ­¤è¿™é‡Œä¸å†å±•å¼€è¯´äº†ï¼Œç†è®ºä¸Šæ”¹è°éƒ½å¯ä»¥</p><h4 id="å†æ¬¡ç°è‰²">å†æ¬¡ç°è‰²</h4><p>å¦‚æœä¸€ä¸ªå¯¹è±¡è¢«åå¤æ”¹ä¸ºç°è‰²ï¼ˆæ¯æ¬¡ä»é»‘æ”¹ç°éƒ½æ„å‘³ç€éœ€è¦é‡æ–°æ‰«æè¿™ä¸ªå¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ä¼šè¢«æ ‡è®°ä¸ºä¸€ä¸ªç‰¹æ®Šçš„ç°è‰²ï¼Œä¹‹åå¢é‡é˜¶æ®µä¸å†æ‰«ææ­¤å¯¹è±¡ï¼ˆé¿å…åå¤æ‰«æè¿™ä¸ªå¯¹è±¡ï¼‰ï¼Œæ”¹ä¸ºå¢é‡é˜¶æ®µç»“æŸåä½¿ç”¨ä¸€ä¸ªåŸå­é˜¶æ®µä¸€æ¬¡æ€§æ‰«æ</p><h4 id="å¼±å¼•ç”¨">å¼±å¼•ç”¨</h4><p>Lua ä½¿ç”¨å¼±è¡¨å®ç°äº†å¼±å¼•ç”¨ï¼Œä½†å¼±è¡¨æœ¬èº«ä¹Ÿæ˜¯éœ€è¦æ‰«æçš„ï¼Œå› ä¸ºå­—ç¬¦ä¸²æœ¬èº«è™½ç„¶æ˜¯ä¸ªå¯å›æ”¶å¯¹è±¡ï¼Œä½†æ˜¯åœ¨ä½œä¸ºå¼±è¡¨çš„é”®å€¼æ—¶æ€»æ˜¯å¼ºå¼•ç”¨ã€‚æ­¤å¤–å¼±è¡¨è¿˜æœ‰ä¸ªç‰¹æ®Šçš„æƒ…å†µï¼Œè€ƒè™‘ä»¥ä¸‹æƒ…å†µï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> t = <span class="built_in">setmetatable</span>({}, { <span class="built_in">__mode</span> = <span class="string">'k'</span> }) <span class="comment">-- æ„é€ ä¸€ä¸ªå¼±é”®è¡¨</span></span><br><span class="line"></span><br><span class="line">t[X] = Y</span><br><span class="line">t[Y] = X</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¡¨çš„é”®ä¸ºå¼±å¼•ç”¨ï¼Œå€¼ä¸ºå¼ºå¼•ç”¨ã€‚å½“æ‰«ææ­¤è¡¨æ—¶ï¼Œå‘ç° <code>X</code> ä¸ <code>Y</code>éƒ½ä½œä¸ºå€¼ï¼Œè€Œè¯¥è¡¨çš„å€¼ä¸ºå¼ºå¼•ç”¨ï¼Œäºæ˜¯è®¤ä¸ºä»–ä»¬è¢«å¼•ç”¨ä½äº†ï¼Œå› æ­¤ä¸ä¼šå›æ”¶è¿™ 2 ä¸ªå¯¹è±¡ã€‚ä½†å®é™…ä¸Šè¿™æ˜¯ä¸€ä¸ªå¼±å¾ªç¯å¼•ç”¨ï¼Œåº”å½“è¢«å›æ”¶ã€‚</p><p>ä¸ºæ­¤ï¼ŒLua å¼•å…¥äº†ä¸€ä¸ªå«åšâ€œèœ‰è£è¡¨â€çš„æ¦‚å¿µï¼Œå¯ä»¥æ­£ç¡®å‘ç°å¹¶å›æ”¶è¿™ç§å¼±å¾ªç¯å¼•ç”¨ã€‚ä½ é—®æˆ‘è¿™ä¸ªâ€œèœ‰è£è¡¨â€çš„åŸç†ï¼Ÿè¯·è‡ªå·±å»å•ƒ <a class="link" href="http://www.inf.puc-rio.br/~roberto/docs/ry08-06.pdf">è®ºæ–‡<i class="fas fa-external-link-alt"></i></a> å§ï¼Œè¿™ç©æ„å„¿æ²¡äººç¿»è¯‘ï¼Œæˆ‘çœ‹äº†ä¸€çœ¼å°±ç¡ç€äº†</p><blockquote><p>å€¼å¾—æ³¨æ„çš„æ˜¯è®ºæ–‡ä¸­æåˆ°èœ‰è£è¡¨å­˜åœ¨ä¸€äº›â€œæœ€åæƒ…å†µâ€ï¼Œä¾‹å¦‚è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">collectgarbage</span> <span class="string">'stop'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> oo = {}</span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">5000</span> <span class="keyword">do</span></span><br><span class="line">    oo[i] = {}</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> t = <span class="built_in">setmetatable</span>({}, { <span class="built_in">__mode</span> = <span class="string">'k'</span> })</span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, #oo <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">local</span> k = oo[i]</span><br><span class="line">    <span class="keyword">local</span> v = oo[i+<span class="number">1</span>]</span><br><span class="line">    t[k] = v <span class="comment">-- t[o1] = o2, t[o2] = o3, t[o3] = o4 ...</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> ref = oo[<span class="number">1</span>] <span class="comment">-- ç¡®ä¿ o1 æœ‰ä¸ªå¼ºå¼•ç”¨</span></span><br><span class="line"></span><br><span class="line">oo = <span class="literal">nil</span> <span class="comment">-- ç¡®ä¿å…¶ä»–å¯¹è±¡éƒ½æ²¡æœ‰å¤–éƒ¨å¼•ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="built_in">clock</span> = <span class="built_in">os</span>.<span class="built_in">clock</span>()</span><br><span class="line"><span class="built_in">collectgarbage</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">os</span>.<span class="built_in">clock</span>() - <span class="built_in">clock</span>)</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘æ„é€ äº†ä¸€ä¸ªèœ‰è£è¡¨ï¼Œè¡¨ä¸­æ‰€æœ‰çš„æ‰€æœ‰çš„é”®å€¼å¯¹å½¢æˆä¸€ä¸ªé“¾ï¼Œå¹¶ç¡®ä¿åªæœ‰ç¬¬ä¸€ä¸ªå¯¹è±¡æœ‰å¤–éƒ¨çš„å¼ºå¼•ç”¨ã€‚åˆ†åˆ«å¯¹èœ‰è£è¡¨ä¸æ­£å¸¸è¡¨è¿›è¡Œäº†åƒåœ¾å›æ”¶æµ‹è¯•ï¼š</p><table><thead><tr><th>å¯¹è±¡æ•°é‡</th><th>æ­£å¸¸è¡¨è€—æ—¶</th><th>èœ‰è£è¡¨è€—æ—¶</th></tr></thead><tbody><tr><td>5000</td><td>0.001</td><td>0.064</td></tr><tr><td>10000</td><td>0.001</td><td>0.36</td></tr><tr><td>15000</td><td>0.001</td><td>0.607</td></tr><tr><td>20000</td><td>0.001</td><td>1.368</td></tr><tr><td>25000</td><td>0.001</td><td>1.764</td></tr><tr><td>30000</td><td>0.002</td><td>2.172</td></tr><tr><td>35000</td><td>0.002</td><td>4.369</td></tr><tr><td>40000</td><td>0.003</td><td>4.981</td></tr><tr><td>45000</td><td>0.003</td><td>5.868</td></tr><tr><td>50000</td><td>0.005</td><td>7.293</td></tr></tbody></table><p>èœ‰è£è¡¨æ˜¯åœ¨ Lua 5.2 ä¸­è¢«å¼•å…¥çš„ï¼ŒLua 5.1 ä¸­å¦‚æœæ²¡æœ‰å¤–éƒ¨å¼ºå¼•ç”¨çš„è¯ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼</p></blockquote><h4 id="æ¸…ç†å¼±è¡¨">æ¸…ç†å¼±è¡¨</h4><p>å¼±è¡¨è§„å®šäº†å½“é”®æˆ–å€¼è¢«å›æ”¶åï¼Œè¿™ä¸ªé”®å€¼å¯¹ä¼šä»å¼±è¡¨ä¸­ç§»é™¤ã€‚è€Œ Lua ä½œä¸ºå¼•ç”¨å®‰å…¨çš„è¯­è¨€ï¼Œä¸å…è®¸å¼•ç”¨æ‚¬ç©ºï¼Œå› æ­¤åœ¨å›æ”¶ä¸€ä¸ªå¯¹è±¡åå¿…é¡»å³æ—¶æŠŠä»–ä»¬ä»å¼±è¡¨ä¸­ç§»é™¤ã€‚åœ¨è¿™é‡Œ Lua ä½¿ç”¨äº†ä¸€ä¸ªåŸå­é˜¶æ®µï¼Œä¼šä¸€æ¬¡æ€§éå†è™šæ‹Ÿæœºä¸­æ‰€æœ‰çš„å¼±è¡¨ï¼Œæ¸…ç†æ‰å¤±æ•ˆçš„é”®å€¼å¯¹ã€‚å› æ­¤å¦‚æœä½ çš„ç¯å¢ƒä¸­å­˜åœ¨å¤§é‡å·¨å¤§çš„å¼±è¡¨ï¼Œè¿™ä¸ªæ¸…ç†é˜¶æ®µå¯èƒ½ä¼šé€ æˆé•¿æ—¶é—´çš„åœé¡¿ã€‚ï¼ˆå…¸å‹çš„ä¾‹å­æ˜¯ï¼Œä¸ºäº†è¿½è¸ªæ‰€æœ‰å¯¹è±¡çš„å­˜æ´»æƒ…å†µï¼Œä½¿ç”¨ä¸€ä¸ªå·¨å¤§çš„å¼±è¡¨ä¿å­˜äº†æ‰€æœ‰çš„å¯¹è±¡ï¼‰</p><h4 id="ç»ˆç»“å™¨ï¼ˆè§£æå™¨ï¼‰">ç»ˆç»“å™¨ï¼ˆè§£æå™¨ï¼‰</h4><p>Lua å…è®¸ä½ é€šè¿‡å…ƒæ–¹æ³• <code>__gc</code> ç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªç»ˆç»“å™¨ï¼Œå½“å¯¹è±¡è¢«å›æ”¶åå°±ä¼šè°ƒç”¨æ­¤ç»ˆç»“å™¨ï¼Œç”¨äºé‡Šæ”¾å¯¹è±¡èƒŒåå¼•ç”¨çš„èµ„æºï¼ˆæ¯”å¦‚åœ¨æ–‡ä»¶å¯¹è±¡é‡Šæ”¾åå…³é—­æ–‡ä»¶å¥æŸ„ï¼‰</p><p>ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œæ‰€æœ‰å¸¦æœ‰ç»ˆç»“å™¨çš„çš„å¯¹è±¡ä¼šåœ¨ä¸€ä¸ªåŸå­é˜¶æ®µä¾æ¬¡è°ƒç”¨ï¼ˆæŒ‰ç…§åˆ›å»ºé¡ºåºçš„ååºï¼‰ã€‚ç”±äºè°ƒç”¨ç»ˆç»“å™¨æ—¶éœ€è¦ä¼ å…¥è¢«å›æ”¶çš„å¯¹è±¡ï¼Œå› æ­¤ä¼šè®©è¿™ä¸ªå¯¹è±¡æ´»è¿‡è¿™è½®ã€‚åœ¨ä¸‹ä¸€è½®åƒåœ¾å›æ”¶æ—¶ï¼Œå¦‚æœå‘ç°è¯¥å¯¹è±¡ä¾ç„¶æ²¡æœ‰å¼•ç”¨å°±ä¼šæ­£å¼åˆ é™¤ï¼ˆå½“ç„¶ä¸ä¼šå†è°ƒç”¨ç»ˆç»“å™¨äº†ï¼‰ï¼Œä½†å¦‚æœå‘ç°è¯¥å¯¹è±¡é‡æ–°æœ‰äº†å¼•ç”¨ï¼ˆä½ åœ¨ç»ˆç»“å™¨ä¸­å°†å…¶é‡æ–°å¼•ç”¨ä½äº†ï¼Œä¾‹å¦‚å°†å…¶ä¿å­˜åˆ°äº†å…¨å±€å˜é‡ä¸­ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±ä¼šè¢«æ­£å¼å¤æ´»ï¼Œä»¥åå†è¢«å›æ”¶çš„è¯ä¼šé‡æ–°è§¦å‘ç»ˆç»“å™¨</p><p>ç”±äºè°ƒç”¨ç»ˆç»“å™¨æ˜¯åŸå­æ“ä½œï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è¦ä¿è¯ç»ˆç»“å™¨å†…çš„è¿è¡Œå°½é‡ç®€å•ä»¥å‡å°‘åœé¡¿ã€‚å¦å¤–ä¸ºäº†é¿å…åƒåœ¾å›æ”¶é‡å…¥ï¼Œæ­¤æ—¶çš„åƒåœ¾å›æ”¶æ˜¯æš‚åœçŠ¶æ€ï¼Œå› æ­¤ä¸è¦åˆ›å»ºå¤ªå¤šçš„ä¸´æ—¶å†…å­˜ã€‚è¯´åˆ°åº•è¿˜æ˜¯è¦è®©ç»ˆç»“å™¨å†…çš„æ“ä½œå°½é‡ç®€å•ï¼Œå¤æ‚çš„äº‹æƒ…è¦åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ä»¥åå†åš</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="æ—¥å¸¸" scheme="https://silhouettesforyou.github.io/categories/%E6%97%A5%E5%B8%B8/"/>
    
    
    <category term="lua" scheme="https://silhouettesforyou.github.io/tags/lua/"/>
    
  </entry>
  
  <entry>
    <title>æ¸¸æˆä½“ç³»</title>
    <link href="https://silhouettesforyou.github.io/2022/08/13/43/"/>
    <id>https://silhouettesforyou.github.io/2022/08/13/43/</id>
    <published>2022-08-13T06:51:22.000Z</published>
    <updated>2024-06-18T12:46:27.313Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>[x] è‹±æ–‡ç®€å† <br>[x] åŠ¨ç”»ç³»ç»Ÿ <br>[x] AI<br>[x] OpenGL<br>[x] RL<br>[x] å¯»è·¯ <br>[x] è‹±æ–‡ç®€å† <br>[x] 3D è¿ç®— <br>[x] å‘é‡è¿ç®—åŠå«ä¹‰ <br>[x] çŠ¶æ€æœº <br>[x] Behavior Tree</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="é¢è¯•" scheme="https://silhouettesforyou.github.io/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
    <category term="GamePlay" scheme="https://silhouettesforyou.github.io/tags/GamePlay/"/>
    
    <category term="æ¸¸æˆ" scheme="https://silhouettesforyou.github.io/tags/%E6%B8%B8%E6%88%8F/"/>
    
    <category term="TODO" scheme="https://silhouettesforyou.github.io/tags/TODO/"/>
    
  </entry>
  
  <entry>
    <title>Shader Variant</title>
    <link href="https://silhouettesforyou.github.io/2022/08/06/42/"/>
    <id>https://silhouettesforyou.github.io/2022/08/06/42/</id>
    <published>2022-08-06T09:36:34.000Z</published>
    <updated>2023-12-10T07:38:08.763Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h3 id="åŸºç¡€çŸ¥è¯†">åŸºç¡€çŸ¥è¯†</h3><h4 id="ä»€ä¹ˆæ˜¯ -Shader-Variant">ä»€ä¹ˆæ˜¯ Shader Variant</h4><p>åœ¨å†™ Shader æ—¶ï¼Œå¾€å¾€ä¼šåœ¨ Shader ä¸­å®šä¹‰å¤šä¸ªå®ï¼Œå¹¶åœ¨ Shader ä»£ç ä¸­æ§åˆ¶å¼€å¯å®æˆ–å…³é—­å®æ—¶ç‰©ä½“çš„æ¸²æŸ“è¿‡ç¨‹ã€‚æœ€ç»ˆç¼–è¯‘çš„æ—¶å€™ä¹Ÿæ˜¯æ ¹æ®è¿™äº›ä¸åŒçš„å®æ¥ç¼–è¯‘ç”Ÿæˆå¤šç§ç»„åˆå½¢å¼çš„ Shader æºç ã€‚å…¶ä¸­æ¯ä¸€ç§ç»„åˆå°±æ˜¯è¿™ä¸ª Shader çš„ä¸€ä¸ª <span class="hint--info hint--rounded hint--top" data-hint="Variant" ontouchstart> å˜ä½“</span></p><h4 id="Material-Shader-Keywords- ä¸ -Shader-Variant">Material Shader Keywords ä¸ Shader Variant</h4><p>Material æ‰€åŒ…å«çš„ Shader Keywords è¡¨ç¤ºå¯ç”¨ Shader ä¸­å¯¹åº”çš„å®ï¼ŒUnity ä¼šè°ƒç”¨å½“å‰å®ç»„åˆæ‰€å¯¹åº”çš„å˜ä½“æ¥ä¸º Material è¿›è¡Œæ¸²æŸ“</p><blockquote><ul><li>åœ¨ Editor ä¸‹ï¼Œå¯ä»¥é€šè¿‡å°† Material çš„ Inspector è°ƒæˆ Debug æ¨¡å¼æ¥æŸ¥çœ‹å½“å‰ Material å®šä¹‰çš„ Keywordsï¼Œä¹Ÿå¯ä»¥åœ¨æ­¤æ¨¡å¼ä¸‹ç›´æ¥å®šä¹‰ Keywordsï¼Œç”¨ç©ºæ ¼åˆ†éš” Keyword</li><li>åœ¨ä»£ç ä¸­ï¼Œå¯ç”¨ <code>Material.EnableKeyword()</code>ã€<code>Material.DisableKeyword()</code>ã€<code>Shader.EnableKeyword()</code>ã€<code>Shader.DisableKeyword()</code> æ¥å¯ç”¨ / ç¦ç”¨ç›¸åº”çš„å®</li><li><code>Enable</code>å‡½æ•°åº”ä¸ <code>Disable</code> å‡½æ•°ç›¸å¯¹åº”ã€‚è‹¥ä¸€ä¸ªå®ç”± <code>Material.EnableKeyword()</code> å¼€å¯ï¼Œåˆ™åº”ç”± <code>Material.DisableKeyword()</code> å…³é—­ï¼Œ<code>Shader.DisableKeyword()</code>æ— æ³•å…³é—­è¿™ä¸ªå®</li></ul></blockquote><h4 id="multi-compile ä¸ shader-feature"><code>multi_compile</code>ä¸<code>shader_feature</code></h4><h5 id="multi-compile çš„ç”¨æ³•è§£æ"><code>multi_compile</code>çš„ç”¨æ³•è§£æ</h5><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#paragma multi_compile OFF ON</span></span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºå®šä¹‰äº†ä¸¤ä¸ªå˜ä½“ï¼Œ<code>OFF</code>å’Œ <code>ON</code>ã€‚åœ¨è¿è¡Œæ—¶ï¼Œå…¶ä¸­çš„ä¸€ä¸ªå°†è¢«æ¿€æ´»ï¼Œæ ¹æ®æè´¨æˆ–è€…å…¨å±€ç€è‰²å™¨å…³é”®å­—ï¼ˆ<code>#ifdef OFF</code> ä¹‹ç±»çš„å®å‘½ä»¤ä¹Ÿå¯ä»¥ï¼‰æ¥ç¡®å®šæ¿€æ´»å“ªä¸ªã€‚è‹¥ä¸¤ä¸ªå…³é”®è¯éƒ½æ²¡æœ‰å¯ç”¨ï¼Œé‚£ä¹ˆå°†é»˜è®¤ä½¿ç”¨å‰ä¸€ä¸ªé€‰é¡¹ï¼Œä¹Ÿå°±æ˜¯<code>OFF</code>ã€‚</p><p>ä¹Ÿå¯ä»¥åŒæ—¶åˆ›å»ºå¤šä¸ªå˜ä½“ï¼š</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#paragma multi_compile A B C</span></span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ä½¿ç”¨å¤šè¡ŒæŒ‡ä»¤å¯¹å˜ä½“è¿›è¡Œç»„åˆï¼Œä½†æ˜¯è¿™æ ·åšçš„è¯ï¼Œä¼šå¯¼è‡´å˜ä½“æ•°é‡æˆå€çš„å¢é•¿ï¼Œå¦‚æœä½¿ç”¨ä¸‹é¢çš„ä»£ç ç”Ÿæˆå˜ä½“ï¼Œä¼šå¾—åˆ° <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="9.176ex" height="1.692ex" role="img" focusable="false" viewbox="0 -666 4056 748"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"/></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"/></g><g data-mml-node="mn" transform="translate(1722.4,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mo" transform="translate(2500.2,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mn" transform="translate(3556,0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"/></g></g></g></svg></mjx-container> ä¸­ä¸åŒçš„å˜ä½“ï¼š</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#paragma multi_compile A B C</span></span><br><span class="line"><span class="meta">#paragma multi_compile D E</span></span><br></pre></td></tr></table></figure><h5 id="shader-feature ç”¨æ³•ç®€æ"><code>shader_feature</code>ç”¨æ³•ç®€æ</h5><p><code>shader_feature</code>çš„ç”¨æ³•ä¸ <code>multi_compile</code> å¤§è‡´ç›¸åŒï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äº <code>shader_feature</code> ä¸ä¼šå°†ä¸ç”¨çš„ Shader å˜ä½“æ·»åŠ åˆ°ç¨‹åºä¸­å»ã€‚<code>shader_feature</code>æ›´é€‚ç”¨äºæè´¨çš„å…³é”®å­—ï¼Œè€Œ <code>multi_compile</code> æ›´é€‚ç”¨äºä»£ç çš„å…¨å±€å…³é”®å­—</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#paragma shader_feature A</span></span><br></pre></td></tr></table></figure><blockquote><p>å…¶å® <code>#paragma shader_feature A</code> æ˜¯<code>#paragma shader_feature _ A</code>çš„ç®€å†™ï¼Œä¸‹åˆ’çº¿è¡¨ç¤ºæœªå®šä¹‰å®ï¼ˆNoKeywordï¼‰ã€‚å› æ­¤æ­¤æ—¶ Shader å…¶å®å¯¹åº”äº†ä¸¤ä¸ªå˜ä½“ï¼Œä¸€ä¸ªæ˜¯ NoKeywordï¼Œä¸€ä¸ªæ˜¯å®šä¹‰äº†å® <code>A</code>ã€‚è€Œ<code>#paragma multi_compile A</code> å¹¶ä¸å­˜åœ¨ç®€å†™è¿™ä¸€è¯´ï¼Œæ‰€ä»¥ Shader æ­¤æ—¶åªå¯¹åº” <code>A</code> è¿™ä¸ªå˜ä½“ã€‚è‹¥è¦è¡¨ç¤ºæœªå®šä¹‰ä»»ä½•å˜ä½“ï¼Œåˆ™åº”å†™ä¸º<code>#paragma multi_compile _ A</code></p></blockquote><h3 id="å¦‚ä½•æ§åˆ¶é¡¹ç›®ä¸­ -Shader- å˜ä½“çš„ç”Ÿæˆ">å¦‚ä½•æ§åˆ¶é¡¹ç›®ä¸­ Shader å˜ä½“çš„ç”Ÿæˆ</h3><table><thead><tr><th>ç”Ÿæˆæ–¹å¼</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>Shader ä¸æè´¨æ‰“åœ¨ä¸€ä¸ªåŒ…ä¸­</td><td>å˜ä½“æ ¹æ®æè´¨ä¸­çš„ keywords è‡ªåŠ¨ç”Ÿæˆ</td><td><ol><li>å¤šä¸ªä¸åŒçš„æè´¨åŒ…ä¸­å¯èƒ½å­˜åœ¨ç›¸åŒçš„ Shader å˜ä½“ï¼Œé€ æˆèµ„æºå†—ä½™ </li><li> è‹¥åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€æ”¹å˜æè´¨çš„ keywordï¼Œä½¿ç”¨ <code>shader_feature</code> å®šä¹‰çš„å®ï¼Œå…¶å˜ä½“å¯èƒ½å¹¶æ²¡æœ‰è¢«ç”Ÿæˆ</li></ol></td></tr><tr><td>Shader å•ç‹¬æ‰“åŒ…ï¼Œä½¿ç”¨ <code>multi_compile</code> å®šä¹‰å…¨éƒ¨å®</td><td>å…¨éƒ¨å˜ä½“éƒ½è¢«ç”Ÿæˆï¼Œä¸ä¼šå‘ç”Ÿéœ€è¦çš„å˜ä½“æœªç”Ÿæˆçš„æƒ…å†µ</td><td><ol><li>ç”Ÿæˆçš„å˜ä½“æ•°é‡åºå¤§ï¼Œä¸¥é‡æµªè´¹èµ„æº</li></ol></td></tr><tr><td>Shader å•ç‹¬æ‰“åŒ…ï¼Œ<code>shader_feature</code>ï¼ˆéœ€è¦ä½¿ç”¨ ShaderVariantCollection ç”Ÿæˆå˜ä½“ï¼‰ä¸<code>multi_compile</code>ï¼ˆè¿˜æ˜¯ä¼šç”Ÿæˆæ‰€æœ‰å˜ä½“ï¼‰ç»“åˆä½¿ç”¨</td><td>èƒ½å¤Ÿæœ‰æ•ˆæ§åˆ¶ <code>shader_feature</code> å˜ä½“æ•°é‡</td><td><ol><li>å¦‚ä½•ç¡®å®šå“ªäº›å˜ä½“éœ€è¦ç”Ÿæˆ </li><li> å®¹æ˜“é—æ¼éœ€è¦ç”Ÿæˆçš„å˜ä½“ï¼Œç‰¹åˆ«æ˜¯éœ€è¦åŠ¨æ€æ›¿æ¢çš„å˜ä½“</li></ol></td></tr></tbody></table><h4 id="ä½¿ç”¨ shader-feature çš„è§£å†³æ–¹æ¡ˆï¼šShaderVariantCollection">ä½¿ç”¨ <code>shader_feature</code> çš„è§£å†³æ–¹æ¡ˆï¼šShaderVariantCollection</h4><h5 id="ShaderVariantCollection- ä»‹ç»">ShaderVariantCollection ä»‹ç»</h5><p>ShaderVariantCollection çš„å…¶ä¸­ä¸€ä¸ªä½œç”¨å°±æ˜¯ç”¨æ¥è®°å½• Shader ä¸­ä½¿ç”¨ <code>shader_feature</code> å®šä¹‰çš„å®äº§ç”Ÿçš„å˜ä½“ã€‚èƒ½å¤Ÿè®¾ç½®ç”Ÿæˆä»»ä½•å˜ä½“ï¼Œä»è€Œé¿å…ç”Ÿæˆä¸å¿…è¦çš„å˜ä½“ï¼›Shader ä¸å¿…å’Œæè´¨æ‰“åœ¨ä¸€ä¸ªåŒ…ä¸­ï¼Œé¿å…äº†å¤šä¸ªåŒ…ä¸­å­˜åœ¨ç›¸åŒçš„å˜ä½“èµ„æºï¼›æ˜ç¡®ç›´è§‚çš„æ˜¾ç¤ºäº†å“ªäº›å˜ä½“æ˜¯éœ€è¦ç”Ÿæˆçš„ã€‚</p><blockquote><p>åœ¨ Unity ä¸­å¯ä»¥é€šè¿‡ Create-&gt;Shader-&gt;Shader Variant Collectionï¼Œå°±å¯ä»¥æ–°å»ºä¸€ä¸ª ShaderVariantCollection æ–‡ä»¶</p></blockquote><h5 id="ShaderVariantCollection- ç”Ÿæˆé€šè¿‡ shader-feature å®šä¹‰çš„å˜ä½“è§„åˆ™">ShaderVariantCollection ç”Ÿæˆé€šè¿‡ <code>shader_feature</code> å®šä¹‰çš„å˜ä½“è§„åˆ™</h5><ul><li><p>å¿…å®šç”Ÿæˆé¦–ä¸ªå®å®šä¹‰å¼€å¯æ‰€å¯¹åº”çš„å˜ä½“</p><ul><li><code>pragma shader_feature A</code>ï¼šé™¤äº†ç”Ÿæˆ A çš„å˜ä½“ï¼Œnokeyword æ‰€å¯¹åº”çš„å˜ä½“ä¹Ÿä¼šè¢«ç”Ÿæˆ</li><li><code>pragma shader_feature A B C</code>ï¼šShaderVariantCollection ä¸­å³ä½¿æœªæ·»åŠ å˜ä½“ Aï¼Œè¿™ä¸ªå˜ä½“ä¹Ÿä¼šè¢«ç”Ÿæˆ</li></ul></li><li><p>Shader ä¸­åˆå¤šä¸ª Pass æ—¶å˜ä½“çš„ç”Ÿæˆè§„åˆ™</p><ol><li><p>è¯»å– ShaderVariantCollection ä¸­å·²å­˜åœ¨çš„å˜ä½“ï¼Œè·å–ä»–ä»¬çš„ keywords</p></li><li><p>å°†è¿™äº› keywords åˆ†åˆ«ä¸æ¯ä¸ª Pass çš„å¤šç»„ keywords åˆ—è¡¨æ±‚äº¤é›†ï¼Œå–äº¤é›†ä¸­ keywords æ•°é‡æœ€å¤šçš„é‚£ç»„</p></li><li><p>ç”¨å¾—åˆ°çš„ keywords ä¸å¯¹åº” PassType ç”Ÿæˆ Shader å˜ä½“ï¼Œå¹¶æ·»åŠ åˆ° ShaderVariantCollection ä¸­</p></li><li><p>è‹¥å¾—åˆ°çš„äº¤é›†ä¸­æœ‰æ–°çš„ keywordsï¼Œåˆ™å›åˆ° <strong>2</strong></p><blockquote><p>ä¾‹å¦‚ Shader ä¸­æœ‰ ForwardBaseã€ForwardAddã€Normal ä¸‰ç§ PassTypeï¼Œå®šä¹‰çš„å®å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:center">ForwardBase</th><th style="text-align:center">ForwardAdd</th><th style="text-align:center">Normal</th></tr></thead><tbody><tr><td style="text-align:center"><code>#pragma shader_feature A</code><br><code>#pragma shader_feature B</code><br><code>#pragma shader_feature C</code></td><td style="text-align:center"><code>#pragma shader_feature A</code><br><code>#pragma shader_feature E</code><br></td><td style="text-align:center"><code>#pragma shader_feature A</code><br><code>#pragma shader_feature B</code><br><code>#pragma shader_feature E</code><br></td></tr></tbody></table><p>æ­¤æ—¶è‹¥ ShaderVariantCollection ä¸­åŒ…å«çš„å˜ä½“æ˜¯ ForwardBase ABCï¼ŒForwardAdd AEã€‚åˆ™æ­¤æ—¶ç”Ÿæˆçš„å˜ä½“ä¸ºï¼šè¿™ä¸‰ç§ PassType çš„é»˜è®¤å®šä¹‰çš„å® (nokeyword) æ‰€å¯¹åº”çš„å˜ä½“ï¼ˆ3 ä¸ªï¼‰ä»¥åŠåŸå…ˆç›´æ¥åŒ…å«çš„ ForwardBase ABCã€ForwardAdd AEã€‚é™¤æ­¤ä¹‹å¤– Unity è¿˜ä¼šé¢å¤–ç”Ÿæˆ ForwardAdd Aã€ForwardBase Aã€Normal Aã€Normal ABã€ ForwardBase ABã€Normal AE è¿™ 6 ä¸ªå˜ä½“</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ABC âˆ© Add AE -&gt; Add A (A is NewKeyword)</span><br><span class="line">  A âˆ© Base ABC -&gt; Base A</span><br><span class="line">  A âˆ© Normal ABE -&gt; Normal A</span><br><span class="line">ABC âˆ© Normal ABE -&gt; Normal AB (AB is NewKeyword)</span><br><span class="line"> AB âˆ© Base ABC -&gt; Base AB</span><br><span class="line"> AE âˆ© Normal ABE -&gt; Normal AE</span><br></pre></td></tr></table></figure></blockquote></li></ol></li></ul><h5 id="å˜ä½“çš„è°ƒç”¨è§„åˆ™">å˜ä½“çš„è°ƒç”¨è§„åˆ™</h5><p>å½“ ShaderVariantCollection å°†å˜ä½“å‡†ç¡®ç”Ÿæˆåï¼Œä¾¿èƒ½åœ¨è¿è¡Œæ—¶é€šè¿‡ä¿®æ”¹æè´¨ä¸­çš„ keywords æ¥å®ç°å¯¹ä¸åŒå˜ä½“çš„è°ƒç”¨ã€‚å‡è®¾æŸ collection ç”Ÿæˆçš„å˜ä½“åªæœ‰ Forward ABCï¼ŒForward ABEï¼ŒForward nokeyword è¿™ä¸‰ç§ï¼Œåˆ™æ­¤æ—¶è°ƒç”¨å…³ç³»å¦‚ä¸‹ï¼š</p><table><thead><tr><th>Material ä¸­çš„ Keywords</th><th>è°ƒç”¨çš„å˜ä½“</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>A B C</td><td>Forward A B C</td><td>æ­£å¸¸åŒ¹é…</td></tr><tr><td>A B</td><td>Forward nokeyword</td><td>æ²¡æœ‰åŒ¹é…çš„å˜ä½“ï¼Œè°ƒç”¨é¦–ä¸ªè¢«å®šä¹‰çš„å® æ‰€å¯¹åº”çš„å˜ä½“</td></tr><tr><td>A B C D</td><td>Forward A B C</td><td>è°ƒç”¨äº¤é›†ä¸­ keyword æ•°é‡å¤šçš„å˜ä½“ ABCD âˆ© ABC = ABC ABCD âˆ© ABE = AB</td></tr><tr><td>A B C E</td><td>Forward A B C</td><td>äº¤é›†ä¸­ keyword æ•°é‡ç›¸åŒï¼Œåœ¨ collection ä¸­è°åœ¨å‰å°±è°ƒç”¨è°</td></tr><tr><td>A B E C</td><td>Forward A B C</td><td>ä¸åœ¨ material ä¸­çš„å®šä¹‰é¡ºåºæ— å…³</td></tr></tbody></table><h4 id="é¡¹ç›®ä¸­å˜ä½“çš„æ·»åŠ ">é¡¹ç›®ä¸­å˜ä½“çš„æ·»åŠ </h4><ul><li>éå†æ¯ä¸ªæè´¨ï¼Œæå–å…¶ Shader keywords</li><li>å°†è·å¾—çš„ keywords ä¸ Shader çš„æ¯ä¸ª PassType æ‰€åŒ…å«çš„å®å®šä¹‰åšäº¤é›†ï¼Œå¹¶å°†å…¶ç»“æœæ·»åŠ åˆ° ShaderVariantCollection ä¸­</li></ul><h4 id="å˜ä½“ä»£ç åœ¨ -Shader- ä¸­ç¼–å†™è§„èŒƒ">å˜ä½“ä»£ç åœ¨ Shader ä¸­ç¼–å†™è§„èŒƒ</h4><ul><li>å»ºè®®ä½¿ç”¨ <code>shader_feature</code> æ—¶å°†å®šä¹‰è¯­å¥å†™æˆå®Œæ•´æ¨¡å¼ï¼Œå¹¶ä¸”ä¸è¦åœ¨ä¸€ä¸ªè¯­å¥ä¸­å®šä¹‰å¤šä¸ªå®<ul><li><code>#pragma shader_feature _ A</code>ï¼Œä¸å»ºè®®å†™æˆ<code>#pragma shader_feature A</code></li></ul></li><li>è‹¥åœ¨ Shader ä¸­ä½¿ç”¨<code>shader_feature</code>ï¼Œè¯·ä¸ºè¿™ä¸ª Shader æŒ‡å®šä¸€ä¸ª CustomEditor</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="å›¾å½¢å­¦" scheme="https://silhouettesforyou.github.io/categories/%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
    
    <category term="Shader" scheme="https://silhouettesforyou.github.io/tags/Shader/"/>
    
    <category term="Variant" scheme="https://silhouettesforyou.github.io/tags/Variant/"/>
    
  </entry>
  
  <entry>
    <title>å°è¯• Visual Code è°ƒè¯• Lua</title>
    <link href="https://silhouettesforyou.github.io/2022/07/27/41/"/>
    <id>https://silhouettesforyou.github.io/2022/07/27/41/</id>
    <published>2022-07-27T06:52:31.000Z</published>
    <updated>2023-12-10T07:38:08.763Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">LuaTools</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">LuaDebugWithVsCode</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Debug</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            IMLua luaEngine = MInterfaceMgr.singleton.GetInterface&lt;IMLua&gt;(MCommonFunctions.GetHash(<span class="string">&quot;MLua&quot;</span>));</span><br><span class="line">            <span class="keyword">if</span> (luaEngine != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> str = <span class="built_in">string</span>.Format(<span class="string">@&quot;local func = function()</span></span><br><span class="line"><span class="string">                local path = &quot;&quot;C:/Users/mingzhewang/.vscode/extensions/tangzx.emmylua-0.5.5/debugger/emmy/windows/x64/emmy_core.dll&quot;&quot;</span></span><br><span class="line"><span class="string">                package.cpath = package.cpath..&quot;&quot;;&quot;&quot;..path</span></span><br><span class="line"><span class="string">                local dbg = require(&quot;&quot;emmy_core&quot;&quot;)</span></span><br><span class="line"><span class="string">                dbg.tcpConnect(&quot;&quot;localhost&quot;&quot;, 9966)</span></span><br><span class="line"><span class="string">                end</span></span><br><span class="line"><span class="string">            local handle = function()</span></span><br><span class="line"><span class="string">                logError(&quot;&quot;VS Code æ²¡æœ‰å¼€å¯è°ƒè¯• &quot;&quot;)</span></span><br><span class="line"><span class="string">            end</span></span><br><span class="line"><span class="string">            xpcall(func, handle)&quot;</span>);</span><br><span class="line">                luaEngine.DoString(str);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                EditorUtility.DisplayDialog(<span class="string">&quot;LuaFast Execute Failed!&quot;</span>, <span class="string">&quot; è·å– luaEngine å¤±è´¥ &quot;</span>, <span class="string">&quot;OK&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="æ—¥å¸¸" scheme="https://silhouettesforyou.github.io/categories/%E6%97%A5%E5%B8%B8/"/>
    
    
    <category term="è°ƒè¯• Lua" scheme="https://silhouettesforyou.github.io/tags/%E8%B0%83%E8%AF%95-Lua/"/>
    
    <category term="Visual Code" scheme="https://silhouettesforyou.github.io/tags/Visual-Code/"/>
    
  </entry>
  
  <entry>
    <title>ç ´è§£ GitKraken</title>
    <link href="https://silhouettesforyou.github.io/2022/03/08/40/"/>
    <id>https://silhouettesforyou.github.io/2022/03/08/40/</id>
    <published>2022-03-08T03:33:11.000Z</published>
    <updated>2023-12-10T07:38:08.748Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><center>    <img src="/2022/03/08/40/git-kraken.png"></center><span id="more"></span><h3 id="GitKraken- ç®€ä»‹">GitKraken ç®€ä»‹</h3><p><a class="link" href="https://www.gitkraken.com/">GitKraken<i class="fas fa-external-link-alt"></i></a> æ˜¯ä¸€æ¬¾ç•Œé¢ååˆ†ç¾è§‚çš„ Git å¯è§†åŒ–ç®¡ç†å·¥å…·ï¼Œæ¯”è¾ƒé—æ†¾çš„æ˜¯ GitKraken æ˜¯æ”¶è´¹è½¯ä»¶ï¼Œç±»ä¼¼çš„å…è´¹è½¯ä»¶æœ‰ <a class="link" href="https://www.sourcetreeapp.com/">Sourcetree<i class="fas fa-external-link-alt"></i></a> ï¼Œä¸è¿‡ä½¿ç”¨ä½“éªŒä¸å¦‚ GitKrakenã€‚</p><h4 id="GitKraken- è¿æ¥ -GitLab">GitKraken è¿æ¥ GitLab</h4><h5 id="Start-a-hosted-repo">Start a hosted repo</h5><center>    <img src="/2022/03/08/40/start-a-hosted-repo.png"></center><p>é€šè¿‡ ** File/Preferences <strong>è¿›å…¥åå¥½è®¾ç½®ç•Œé¢ï¼Œé€‰æ‹© </strong> Authentication <strong> ä¸­çš„</strong> GitLab Self-Managed ** é¡µé¢ï¼Œè¾“å…¥ GitLab åœ°å€å’Œ Token</p><h5 id="è·å¾— -Personal-Access-Token">è·å¾— Personal Access Token</h5><center>    <img src="/2022/03/08/40/personal-access-tokens.png"></center><ol><li>è¿›å…¥ ** User Settings**ï¼Œé€‰æ‹© ** Access Token**</li><li>è¾“å…¥ä¸€ä¸ª Token çš„åå­—</li><li>å‹¾é€‰ <code>api</code> å’Œ<code>read_user</code></li><li>ç”Ÿæˆ Token</li><li>å¤åˆ¶ Tokenï¼ˆè¿™ä¸ª Token ç¦»å¼€é¡µé¢åå°†ä¸è¢«ä¿å­˜ï¼‰</li></ol><h5 id="è¿æ¥æˆåŠŸ">è¿æ¥æˆåŠŸ</h5><center>    <img src="/2022/03/08/40/connected-gitlab.png"></center><h3 id="ç ´è§£">ç ´è§£</h3><h4 id="å®‰è£… yarn">å®‰è£…<code>yarn</code></h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i yarn -g</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œç ´è§£é¡¹ç›®">è¿è¡Œç ´è§£é¡¹ç›®</h4><p>ç ´è§£å‰å…ˆç¡®ä¿ GitKraken å·²å…³é—­é€€å‡ºï¼Œç ´è§£å·¥å…·åœ¨ Github ä¸Šæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›® <a class="link" href="https://github.com/5cr1pt/GitCracken">5cr1pt/GitCracken<i class="fas fa-external-link-alt"></i></a> ï¼Œå°†è¯¥é¡¹ç›® clone åˆ°æœ¬åœ°ï¼Œä½¿ç”¨æ–¹æ³•ä¹Ÿå¯å‚è€ƒé¡¹ç›®çš„ <a class="link" href="http://README.md">README.md<i class="fas fa-external-link-alt"></i></a> æ–‡ä»¶ï¼Œå¦å¤–ä¹Ÿåœ¨ Gitee ä¸Šä¹Ÿæœ‰ã€‚ä»“åº“æ‹·è´åˆ°æœ¬åœ°åï¼Œè¿›å…¥ä»“åº“çš„ <code>GitCracken/GitCracken</code> ç›®å½•ï¼Œä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤è¿è¡Œç ´è§£</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn install</span><br><span class="line">yarn build</span><br><span class="line">node dist/bin/gitcracken.js patcher</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œ <code>yarn install</code> å¯èƒ½ä¼šå‡ºç°è¿æ¥è¶…æ—¶çš„é”™è¯¯</p><center>    <img src="/2022/03/08/40/yarn-install-error.png"></center><p>ç›´æ¥å®‰è£…å¯¹åº”çš„ module å³å¯</p><center>    <img src="/2022/03/08/40/yarn-install-error-fix.png"></center></blockquote><p>æ‰§è¡ŒæˆåŠŸåå¯çœ‹åˆ°å¦‚ä¸‹ç•Œé¢</p><center>    <img src="/2022/03/08/40/git-kraken-install-success.png"></center><p>åœ¨ GitKraken ç•Œé¢å³ä¸‹è§’å¯ä»¥çœ‹åˆ°ç ´è§£åçš„çŠ¶æ€</p><center>    <img src="/2022/03/08/40/git-kraken-pro.png"></center>]]></content>
    
    
    <summary type="html">&lt;center&gt;
    &lt;img src=&quot;/2022/03/08/40/git-kraken.png&quot;&gt;
&lt;/center&gt;</summary>
    
    
    
    <category term="Tools" scheme="https://silhouettesforyou.github.io/categories/Tools/"/>
    
    
    <category term="crack" scheme="https://silhouettesforyou.github.io/tags/crack/"/>
    
    <category term="GitKraken" scheme="https://silhouettesforyou.github.io/tags/GitKraken/"/>
    
  </entry>
  
  <entry>
    <title>é¢†åŸŸé©±åŠ¨è®¾è®¡</title>
    <link href="https://silhouettesforyou.github.io/2022/03/07/39/"/>
    <id>https://silhouettesforyou.github.io/2022/03/07/39/</id>
    <published>2022-03-07T09:18:49.000Z</published>
    <updated>2024-06-13T15:33:27.952Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><center>    <img src="/2022/03/07/39/simple-DDD.png"></center><span id="more"></span><h2 id="Domain-Primitive-DP">Domain Primitive (DP)</h2>]]></content>
    
    
    <summary type="html">&lt;center&gt;
    &lt;img src=&quot;/2022/03/07/39/simple-DDD.png&quot;&gt;
&lt;/center&gt;</summary>
    
    
    
    <category term="è½¯ä»¶å·¥ç¨‹" scheme="https://silhouettesforyou.github.io/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/"/>
    
    
    <category term="DDD" scheme="https://silhouettesforyou.github.io/tags/DDD/"/>
    
    <category term="è®¾è®¡" scheme="https://silhouettesforyou.github.io/tags/%E8%AE%BE%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>C++17 æ–°ç‰¹æ€§</title>
    <link href="https://silhouettesforyou.github.io/2022/02/22/38/"/>
    <id>https://silhouettesforyou.github.io/2022/02/22/38/</id>
    <published>2022-02-22T13:12:59.000Z</published>
    <updated>2023-12-10T07:38:08.743Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><center>    <img src="/2022/02/22/38/teaser-image.png"></center><span id="more"></span><h3 id="æ„é€ å‡½æ•°æ¨¡æ¿æ¨å¯¼">æ„é€ å‡½æ•°æ¨¡æ¿æ¨å¯¼</h3><p>åœ¨ C++17 å‰æ„é€ ä¸€ä¸ªæ¨¡æ¿ç±»å¯¹è±¡éœ€è¦æŒ‡æ˜ç±»å‹ï¼ŒC++17 å°±ä¸éœ€è¦ç‰¹æ®ŠæŒ‡å®šï¼Œç›´æ¥å¯ä»¥æ¨å¯¼å‡ºç±»å‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">pair&lt;<span class="type">int</span>, <span class="type">double</span>&gt; <span class="title">p</span><span class="params">(<span class="number">1</span>, <span class="number">2.2</span>)</span></span>; <span class="comment">// before c++17</span></span><br><span class="line"></span><br><span class="line"><span class="function">pair <span class="title">p</span><span class="params">(<span class="number">1</span>, <span class="number">2.2</span>)</span></span>; <span class="comment">// c++17 è‡ªåŠ¨æ¨å¯¼</span></span><br><span class="line">vector v = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;; <span class="comment">// c++17</span></span><br></pre></td></tr></table></figure><h3 id="ç»“æ„åŒ–ç»‘å®š">ç»“æ„åŒ–ç»‘å®š</h3><h3 id="if-switch è¯­å¥åˆå§‹åŒ–"><code>if-switch</code>è¯­å¥åˆå§‹åŒ–</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if (init; condition)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="type">int</span> a = <span class="built_in">GetValue</span>()); a &lt; <span class="number">101</span>) &#123;</span><br><span class="line">    cout &lt;&lt; a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">string str = <span class="string">&quot;Hi World&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">auto</span> [pos, size] = <span class="built_in">pair</span>(str.<span class="built_in">find</span>(<span class="string">&quot;Hi&quot;</span>), str.<span class="built_in">size</span>()); pos != string::npos) &#123;</span><br><span class="line">    std::cout &lt;&lt; pos &lt;&lt; <span class="string">&quot; Hello, size is &quot;</span> &lt;&lt; size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…è”å˜é‡">å†…è”å˜é‡</h3><p>C++17 å‰åªæœ‰å†…è”å‡½æ•°ï¼Œç°åœ¨æœ‰äº†å†…è”å˜é‡ï¼ŒC++ ç±»çš„é™æ€æˆå‘˜å˜é‡åœ¨å¤´æ–‡ä»¶ä¸­æ˜¯ä¸èƒ½åˆå§‹åŒ–çš„ï¼Œä½†æ˜¯æœ‰äº†å†…è”å˜é‡ï¼Œå°±å¯ä»¥è¾¾åˆ°æ­¤ç›®çš„</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// header file</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> value;  </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">inline</span> <span class="type">int</span> <span class="type">const</span> A::value = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ========== æˆ–è€… ========</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">inline</span> <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> value = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŠ˜å è¡¨è¾¾å¼">æŠ˜å è¡¨è¾¾å¼</h3><p>C++17 å¼•å…¥äº†æŠ˜å è¡¨è¾¾å¼ä½¿å¯å˜å‚æ•°æ¨¡æ¿ç¼–ç¨‹æ›´æ–¹ä¾¿</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ... Ts&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">sum</span><span class="params">(Ts ... ts)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (ts + ...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> a &#123;<span class="built_in">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)&#125;; <span class="comment">// 15</span></span><br><span class="line">std::string a&#123;<span class="string">&quot;hello &quot;</span>&#125;;</span><br><span class="line">std::string b&#123;<span class="string">&quot;world&quot;</span>&#125;;</span><br><span class="line">cout &lt;&lt; <span class="built_in">sum</span>(a, b) &lt;&lt; endl; <span class="comment">// hello world</span></span><br></pre></td></tr></table></figure><h3 id="constexpr-lambda è¡¨è¾¾å¼"><code>constexpr lambda</code>è¡¨è¾¾å¼</h3><p>C++17 å‰ <code>lambda</code> è¡¨è¾¾å¼åªèƒ½åœ¨è¿è¡Œæ—¶ä½¿ç”¨ï¼ŒC++17 å¼•å…¥äº† <code>constexpr lambda</code> è¡¨è¾¾å¼ï¼Œå¯ä»¥ç”¨äºåœ¨ç¼–è¯‘æœŸè¿›è¡Œè®¡ç®—</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123; <span class="comment">// c++17 å¯ç¼–è¯‘</span></span><br><span class="line">    <span class="keyword">constexpr</span> <span class="keyword">auto</span> lamb = [] (<span class="type">int</span> n) &#123; <span class="keyword">return</span> n * n; &#125;;</span><br><span class="line">    <span class="built_in">static_assert</span>(<span class="built_in">lamb</span>(<span class="number">3</span>) == <span class="number">9</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="admonition warning"><p class="admonition-title">Warning</p><p>constexpr å‡½æ•°æœ‰å¦‚ä¸‹é™åˆ¶ï¼šå‡½æ•°ä½“ä¸èƒ½åŒ…å«æ±‡ç¼–è¯­å¥ã€goto è¯­å¥ã€labelã€try å—ã€é™æ€å˜é‡ã€çº¿ç¨‹å±€éƒ¨å­˜å‚¨ã€æ²¡æœ‰åˆå§‹åŒ–çš„æ™®é€šå˜é‡ï¼Œä¸èƒ½åŠ¨æ€åˆ†é…å†…å­˜ï¼Œä¸èƒ½æœ‰ new delete ç­‰ï¼Œä¸èƒ½æ˜¯è™šå‡½æ•°</p></div><h3 id="namespace åµŒå¥—"><code>namespace</code>åµŒå¥—</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> A &#123;</span><br><span class="line">    <span class="keyword">namespace</span> B &#123;</span><br><span class="line">        <span class="keyword">namespace</span> C &#123;</span><br><span class="line">            <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// c++17ï¼Œæ›´æ–¹ä¾¿æ›´èˆ’é€‚</span></span><br><span class="line"><span class="keyword">namespace</span> A::B::C &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span>;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="has-include é¢„å¤„ç†è¡¨è¾¾å¼"><code>__has_include</code>é¢„å¤„ç†è¡¨è¾¾å¼</h3><p>å¯ä»¥åˆ¤æ–­æ˜¯å¦æœ‰æŸä¸ªå¤´æ–‡ä»¶ï¼Œä»£ç å¯èƒ½ä¼šåœ¨ä¸åŒç¼–è¯‘å™¨ä¸‹å·¥ä½œï¼Œä¸åŒç¼–è¯‘å™¨çš„å¯ç”¨å¤´æ–‡ä»¶æœ‰å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æ­¤æ¥åˆ¤æ–­</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">if</span> defined __has_include</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> __has_include(<span class="string">&lt;charconv&gt;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> has_charconv 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;charconv&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::optional&lt;<span class="type">int</span>&gt; <span class="title">ConvertToInt</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> value&#123;&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> has_charconv</span></span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> last = str.<span class="built_in">data</span>() + str.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> res = std::<span class="built_in">from_chars</span>(str.<span class="built_in">data</span>(), last, value);</span><br><span class="line">    <span class="keyword">if</span> (res.ec == std::errc&#123;&#125; &amp;&amp; res.ptr == last) <span class="keyword">return</span> value;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="comment">// alternative implementation...</span></span><br><span class="line">    å…¶å®ƒæ–¹å¼å®ç°</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> std::<span class="literal">nullopt</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åœ¨ lambda è¡¨è¾¾å¼ç”¨ -this æ•è·å¯¹è±¡å‰¯æœ¬">åœ¨ <code>lambda</code> è¡¨è¾¾å¼ç”¨ <code>*this</code> æ•è·å¯¹è±¡å‰¯æœ¬</h3><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œ<code>lambda</code>è¡¨è¾¾å¼ä¸­è®¿é—®ç±»çš„å¯¹è±¡æˆå‘˜å˜é‡éœ€è¦æ•è· <code>this</code>ï¼Œä½†æ˜¯è¿™é‡Œæ•è·çš„æ˜¯<code>this</code> æŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼Œæ­£å¸¸æƒ…å†µä¸‹å¯èƒ½æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœå¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œå‡½æ•°çš„ä½œç”¨åŸŸè¶…è¿‡äº†å¯¹è±¡çš„ä½œç”¨åŸŸï¼Œå¯¹è±¡å·²ç»è¢«ææ„äº†ï¼Œè¿˜è®¿é—®äº†æˆå‘˜å˜é‡ï¼Œå°±ä¼šæœ‰é—®é¢˜</p><p>æ‰€ä»¥ C++17 å¢åŠ äº†æ–°ç‰¹æ€§ï¼Œæ•è· <code>*this</code>ï¼Œä¸æŒæœ‰<code>this</code> æŒ‡é’ˆï¼Œè€Œæ˜¯æŒæœ‰å¯¹è±¡çš„æ‹·è´</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> f = [*<span class="keyword">this</span>] &#123; <span class="comment">// è¿™é‡Œ</span></span><br><span class="line">            cout &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="built_in">f</span>();</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    A a;</span><br><span class="line">    a.<span class="built_in">func</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–°å¢ Attribute">æ–°å¢<code>Attribute</code></h3><p>åœ¨é¡¹ç›®ä¸­è§è¿‡ <code>declspec</code>ï¼Œ<code>__attribute</code>ï¼Œ<code>#pragma</code> æŒ‡ç¤ºç¬¦ï¼Œä½¿ç”¨å®ƒä»¬æ¥ç»™ç¼–è¯‘å™¨æä¾›ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œæ¥äº§ç”Ÿä¸€äº›ä¼˜åŒ–æˆ–ç‰¹å®šçš„ä»£ç ï¼Œä¹Ÿå¯ä»¥ç»™å…¶å®ƒå¼€å‘è€…ä¸€äº›æç¤ºä¿¡æ¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123; <span class="type">short</span> f[<span class="number">3</span>]; &#125; __attribute__((<span class="built_in">aligned</span>(<span class="number">8</span>)));</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fatal</span><span class="params">()</span> __<span class="title">attribute__</span><span class="params">((noreturn))</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨ C++11 å’Œ C++14 ä¸­æœ‰æ›´æ–¹ä¾¿çš„æ–¹æ³•</p><ul><li><code>[[carries_dependency]]</code>è®©ç¼–è¯‘æœŸè·³è¿‡ä¸å¿…è¦çš„å†…å­˜æ …æ æŒ‡ä»¤</li><li><code>[[noreturn]]</code>å‡½æ•°ä¸ä¼šè¿”å›</li><li><code>[[deprecated]]</code>å‡½æ•°å°†å¼ƒç”¨çš„è­¦å‘Š</li><li><code>[[noreturn]] void terminate() noexcept;</code></li><li><code>[[deprecated(&quot;use new func instead&quot;)]] void func() &#123;&#125;</code></li></ul><p>C++17 åˆæ–°å¢äº†ä¸‰ä¸ª</p><ul><li><p><code>[[fallthrough]]</code>ï¼šç”¨åœ¨ switch ä¸­æç¤ºå¯ä»¥ç›´æ¥è½ä¸‹å»ï¼Œä¸éœ€è¦ breakï¼Œè®©ç¼–è¯‘æœŸå¿½ç•¥è­¦å‘Š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (i) &#123;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        xxx; <span class="comment">// warning</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        xxx; </span><br><span class="line">        [[fallthrough]];      <span class="comment">// è­¦å‘Šæ¶ˆé™¤</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        xxx;</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿å¾—ç¼–è¯‘å™¨å’Œå…¶å®ƒå¼€å‘è€…éƒ½å¯ä»¥ç†è§£å¼€å‘è€…çš„æ„å›¾</p></li><li><p><code>[[nodiscard]]</code>ï¼šè¡¨ç¤ºä¿®é¥°çš„å†…å®¹ä¸èƒ½è¢«å¿½ç•¥ï¼Œå¯ç”¨äºä¿®é¥°å‡½æ•°ï¼Œæ ‡æ˜è¿”å›å€¼ä¸€å®šè¦è¢«å¤„ç†</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[[nodiscard]] <span class="function"><span class="type">int</span> <span class="title">func</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">func</span>(); <span class="comment">// warning æ²¡æœ‰å¤„ç†å‡½æ•°è¿”å›å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>[[maybe_unused]]</code>ï¼šæç¤ºç¼–è¯‘å™¨ä¿®é¥°çš„å†…å®¹å¯èƒ½æš‚æ—¶æ²¡æœ‰ä½¿ç”¨ï¼Œé¿å…äº§ç”Ÿè­¦å‘Š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">func1</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">[[maybe_unused]] <span class="function"><span class="type">void</span> <span class="title">func2</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// è­¦å‘Šæ¶ˆé™¤</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">1</span>;</span><br><span class="line">    [[maybe_unused]] <span class="type">int</span> y = <span class="number">2</span>; <span class="comment">// è­¦å‘Šæ¶ˆé™¤</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="å­—ç¬¦ä¸²è½¬æ¢">å­—ç¬¦ä¸²è½¬æ¢</h3><p>æ–°å¢ <code>from_chars</code> å‡½æ•°å’Œ <code>to_chars</code> å‡½æ•°</p>  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;charconv&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> std::string str&#123;<span class="string">&quot;123456098&quot;</span>&#125;;</span><br><span class="line">    <span class="type">int</span> value = <span class="number">0</span>;</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> res = std::<span class="built_in">from_chars</span>(str.<span class="built_in">data</span>(), str.<span class="built_in">data</span>() + <span class="number">4</span>, value);</span><br><span class="line">    <span class="keyword">if</span> (res.ec == std::<span class="built_in">errc</span>()) &#123;</span><br><span class="line">        cout &lt;&lt; value &lt;&lt; <span class="string">&quot;, distance &quot;</span> &lt;&lt; res.ptr - str.<span class="built_in">data</span>() &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (res.ec == std::errc::invalid_argument) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;invalid&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    str = std::<span class="built_in">string</span>(<span class="string">&quot;12.34);</span></span><br><span class="line"><span class="string">    double val = 0;</span></span><br><span class="line"><span class="string">    const auto format = std::chars_format::general;</span></span><br><span class="line"><span class="string">    res = std::from_chars(str.data(), str.data() + str.size(), value, format);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    str = std::string(&quot;</span>xxxxxxxx<span class="string">&quot;);</span></span><br><span class="line"><span class="string">    const int v = 1234;</span></span><br><span class="line"><span class="string">    res = std::to_chars(str.data(), str.data() + str.size(), v);</span></span><br><span class="line"><span class="string">    cout &lt;&lt; str &lt;&lt; &quot;</span>, filled <span class="string">&quot; &lt;&lt; res.ptr - str.data() &lt;&lt; &quot;</span> characters \n<span class="string">&quot;;</span></span><br><span class="line"><span class="string">    // 1234xxxx, filled 4 characters</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="std-variant"><code>std::variant</code></h3><p>C++17 å¢åŠ  <code>std::variant</code> å®ç°ç±»ä¼¼ <code>union</code> çš„åŠŸèƒ½ï¼Œä½†å´æ¯” <code>union</code> æ›´é«˜çº§ï¼Œä¸¾ä¸ªä¾‹å­ <code>union</code> é‡Œé¢ä¸èƒ½æœ‰ <code>string</code> è¿™ç§ç±»å‹ï¼Œä½† <code>std::variant</code> å´å¯ä»¥ï¼Œè¿˜å¯ä»¥æ”¯æŒæ›´å¤šå¤æ‚ç±»å‹ï¼Œå¦‚ <code>map</code> ç­‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123; <span class="comment">// c++17 å¯ç¼–è¯‘</span></span><br><span class="line">    <span class="function">std::variant&lt;<span class="type">int</span>, std::string&gt; <span class="title">var</span><span class="params">(<span class="string">&quot;hello&quot;</span>)</span></span>;</span><br><span class="line">    cout &lt;&lt; var.<span class="built_in">index</span>() &lt;&lt; endl;</span><br><span class="line">    var = <span class="number">123</span>;</span><br><span class="line">    cout &lt;&lt; var.<span class="built_in">index</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        var = <span class="string">&quot;world&quot;</span>;</span><br><span class="line">        std::string str = std::<span class="built_in">get</span>&lt;std::string&gt;(var); <span class="comment">// é€šè¿‡ç±»å‹è·å–å€¼</span></span><br><span class="line">        var = <span class="number">3</span>;</span><br><span class="line">        <span class="type">int</span> i = std::<span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(var); <span class="comment">// é€šè¿‡ index è·å–å¯¹åº”å€¼</span></span><br><span class="line">        cout &lt;&lt; str &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="built_in">catch</span>(...) &#123;</span><br><span class="line">        <span class="comment">// xxx;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="admonition warning"><p class="admonition-title">Warning</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ variant çš„ç¬¬ä¸€ä¸ªç±»å‹ä¸€èˆ¬è¦æœ‰å¯¹åº”çš„æ„é€ å‡½æ•°ï¼Œå¦åˆ™ç¼–è¯‘å¤±è´¥</p></div><blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="built_in">A</span>(<span class="type">int</span> i)&#123;&#125;  </span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::variant&lt;A, <span class="type">int</span>&gt; var; <span class="comment">// ç¼–è¯‘å¤±è´¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ <code>std::monostate</code> æ¥æ‰“ä¸ªæ¡©ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªç©ºçŠ¶æ€</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::variant&lt;std::monostate, A&gt; var; <span class="comment">// å¯ä»¥ç¼–è¯‘æˆåŠŸ</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="std-optional"><code>std::optional</code></h3><p>æœ‰æ—¶å€™å¯èƒ½ä¼šæœ‰éœ€æ±‚ï¼Œè®©å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;&#125;;</span><br><span class="line"><span class="function">A <span class="title">func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (flag) <span class="keyword">return</span> <span class="built_in">A</span>();</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¼‚å¸¸æƒ…å†µä¸‹ï¼Œæ€ä¹ˆè¿”å›å¼‚å¸¸å€¼å‘¢ï¼Œæƒ³è¿”å›ä¸ªç©ºå‘¢</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸€ç§åŠæ³•æ˜¯è¿”å›å¯¹è±¡æŒ‡é’ˆï¼Œå¼‚å¸¸æƒ…å†µä¸‹å°±å¯ä»¥è¿”å›<code>nullptr</code>ï¼Œä½†æ˜¯è¿™å°±æ¶‰åŠåˆ°äº†å†…å­˜ç®¡ç†ï¼Œä¹Ÿè®¸ä¼šä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼Œä½†è¿™é‡Œå…¶å®æœ‰æ›´æ–¹ä¾¿çš„åŠæ³•å°±æ˜¯<code>std::optional</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::optional&lt;<span class="type">int</span>&gt; <span class="title">StoI</span><span class="params">(<span class="type">const</span> std::string &amp;s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">stoi</span>(s);</span><br><span class="line">    &#125; <span class="built_in">catch</span>(...) &#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="literal">nullopt</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::string s&#123;<span class="string">&quot;123&quot;</span>&#125;;</span><br><span class="line">    std::optional&lt;<span class="type">int</span>&gt; o = <span class="built_in">StoI</span>(s);</span><br><span class="line">    <span class="keyword">if</span> (o) &#123;</span><br><span class="line">        cout &lt;&lt; *o &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;error&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="std-any"><code>std::any</code></h3><p>C++17 å¼•å…¥äº† <code>any</code> å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„å•ä¸ªå€¼</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123; <span class="comment">// c++17 å¯ç¼–è¯‘</span></span><br><span class="line">    std::any a = <span class="number">1</span>;</span><br><span class="line">    cout &lt;&lt; a.<span class="built_in">type</span>().<span class="built_in">name</span>() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; std::<span class="built_in">any_cast</span>&lt;<span class="type">int</span>&gt;(a) &lt;&lt; endl;</span><br><span class="line">    a = <span class="number">2.2f</span>;</span><br><span class="line">    cout &lt;&lt; a.<span class="built_in">type</span>().<span class="built_in">name</span>() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; std::<span class="built_in">any_cast</span>&lt;<span class="type">float</span>&gt;(a) &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">if</span> (a.<span class="built_in">has_value</span>()) &#123;</span><br><span class="line">        cout &lt;&lt; a.<span class="built_in">type</span>().<span class="built_in">name</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    a.<span class="built_in">reset</span>();</span><br><span class="line">    <span class="keyword">if</span> (a.<span class="built_in">has_value</span>()) &#123;</span><br><span class="line">        cout &lt;&lt; a.<span class="built_in">type</span>().<span class="built_in">name</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    a = std::<span class="built_in">string</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    cout &lt;&lt; a.<span class="built_in">type</span>().<span class="built_in">name</span>() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; std::<span class="built_in">any_cast</span>&lt;std::string&gt;(a) &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="std-apply"><code>std::apply</code></h3><p>ä½¿ç”¨ <code>std::apply</code> å¯ä»¥å°† <code>tuple</code> å±•å¼€ä½œä¸ºå‡½æ•°çš„å‚æ•°ä¼ å…¥</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> first, <span class="type">int</span> second)</span> </span>&#123; <span class="keyword">return</span> first + second; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> add_lambda = [](<span class="keyword">auto</span> first, <span class="keyword">auto</span> second) &#123; <span class="keyword">return</span> first + second; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; std::<span class="built_in">apply</span>(add, std::<span class="built_in">pair</span>(<span class="number">1</span>, <span class="number">2</span>)) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">add</span>(std::<span class="built_in">pair</span>(<span class="number">1</span>, <span class="number">2</span>)) &lt;&lt; <span class="string">&quot;\n&quot;</span>; <span class="comment">// error</span></span><br><span class="line">    std::cout &lt;&lt; std::<span class="built_in">apply</span>(add_lambda, std::<span class="built_in">tuple</span>(<span class="number">2.0f</span>, <span class="number">3.0f</span>)) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="std-make-from-tuple"><code>std::make_from_tuple</code></h3><p>ä½¿ç”¨ <code>make_from_tuple</code> å¯ä»¥å°† <code>tuple</code> å±•å¼€ä½œä¸ºæ„é€ å‡½æ•°å‚æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">    <span class="built_in">Foo</span>(<span class="type">int</span> first, <span class="type">float</span> second, <span class="type">int</span> third) &#123;</span><br><span class="line">        std::cout &lt;&lt; first &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; second &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; third &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">auto</span> tuple = std::<span class="built_in">make_tuple</span>(<span class="number">42</span>, <span class="number">3.14f</span>, <span class="number">0</span>);</span><br><span class="line">   std::<span class="built_in">make_from_tuple</span>&lt;Foo&gt;(std::<span class="built_in">move</span>(tuple));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="std-string-view"><code>std::string_view</code></h3><p>é€šå¸¸ä¼ é€’ä¸€ä¸ª <code>string</code> æ—¶ä¼šè§¦å‘å¯¹è±¡çš„æ‹·è´æ“ä½œï¼Œå¤§å­—ç¬¦ä¸²çš„æ‹·è´èµ‹å€¼æ“ä½œä¼šè§¦å‘å †å†…å­˜åˆ†é…ï¼Œå¾ˆå½±å“è¿è¡Œæ•ˆç‡ï¼Œæœ‰äº† <code>string_view</code> å°±å¯ä»¥é¿å…æ‹·è´æ“ä½œï¼Œå¹³æ—¶ä¼ é€’è¿‡ç¨‹ä¸­ä¼ é€’ <code>string_view</code> å³å¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(std::string_view stv)</span> </span>&#123; cout &lt;&lt; stv &lt;&lt; endl; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">    std::string str = <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; str &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string_view <span class="title">stv</span><span class="params">(str.c_str(), str.size())</span></span>;</span><br><span class="line">    cout &lt;&lt; stv &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">func</span>(stv);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="as-const"><code>as_const</code></h3><p>C++17 ä½¿ç”¨ <code>as_const</code> å¯ä»¥å°†å·¦å€¼è½¬æˆ <code>const</code> ç±»å‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::string str = <span class="string">&quot;str&quot;</span>;</span><br><span class="line"><span class="type">const</span> std::string&amp; constStr = std::<span class="built_in">as_const</span>(str);</span><br></pre></td></tr></table></figure><h3 id="file-system"><code>file_system</code></h3><p>C++17 æ­£å¼å°† <code>file_system</code> çº³å…¥æ ‡å‡†ä¸­ï¼Œæä¾›äº†å…³äºæ–‡ä»¶çš„å¤§å¤šæ•°åŠŸèƒ½</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> fs = std::filesystem;</span><br><span class="line">fs::<span class="built_in">create_directory</span>(dir_path);</span><br><span class="line">fs::<span class="built_in">copy_file</span>(src, dst, fs::copy_options::skip_existing);</span><br><span class="line">fs::<span class="built_in">exists</span>(filename);</span><br><span class="line">fs::<span class="built_in">current_path</span>(err_code);</span><br></pre></td></tr></table></figure><h3 id="std-shared-mutex"><code>std::shared_mutex</code></h3><p>C++17 å¼•å…¥äº†<code>shared_mutex</code>ï¼Œå¯ä»¥å®ç°è¯»å†™é”</p>]]></content>
    
    
    <summary type="html">&lt;center&gt;
    &lt;img src=&quot;/2022/02/22/38/teaser-image.png&quot;&gt;
&lt;/center&gt;</summary>
    
    
    
    <category term="C++" scheme="https://silhouettesforyou.github.io/categories/C/"/>
    
    
    <category term="c++" scheme="https://silhouettesforyou.github.io/tags/c/"/>
    
    <category term="c++17" scheme="https://silhouettesforyou.github.io/tags/c-17/"/>
    
  </entry>
  
  <entry>
    <title>è€ç…§ç‰‡</title>
    <link href="https://silhouettesforyou.github.io/2022/02/21/37/"/>
    <id>https://silhouettesforyou.github.io/2022/02/21/37/</id>
    <published>2022-02-21T02:04:52.000Z</published>
    <updated>2023-12-10T07:38:08.742Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css">]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text&amp;#x2F;css&quot; href=&quot;https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css&quot;&gt;&lt;link rel=&quot;st</summary>
      
    
    
    
    <category term="ç›¸å†Œ" scheme="https://silhouettesforyou.github.io/categories/%E7%9B%B8%E5%86%8C/"/>
    
    
    <category term="æ–°å¹´" scheme="https://silhouettesforyou.github.io/tags/%E6%96%B0%E5%B9%B4/"/>
    
    <category term="å®¶äºº" scheme="https://silhouettesforyou.github.io/tags/%E5%AE%B6%E4%BA%BA/"/>
    
  </entry>
  
</feed>
