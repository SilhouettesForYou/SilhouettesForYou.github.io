

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head><!-- hexo injector head_begin start -->
<link rel="stylesheet" href="/css/bilicard.css">
<link href="https://cdn.jsdelivr.net/npm/hexo-tag-common@0.0.5/css/index.css" rel="stylesheet"/><!-- hexo injector head_begin end -->
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/Hayao-Miyazaki/jiji.png">
  <link rel="icon" href="/img/Hayao-Miyazaki/jiji.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Xiaoming">
  <meta name="keywords" content="">
  
    <meta name="description" content="Basics ReviewArray Type Multidimensional array 多维数组 除了第一维其它维必须明确指出大小（explicit size） 不可以全部 decay Dynamic allocation malloc in C and new&#x2F;new [] in C++ new和 malloc 返回都是指针 释放      Function 函数返回类型不能是函数或者数组">
<meta property="og:type" content="article">
<meta property="og:title" content="现代 C++ 基础">
<meta property="og:url" content="https://silhouettesforyou.github.io/2024/06/03/56ae950785e9/index.html">
<meta property="og:site_name" content="Silhouettes For You">
<meta property="og:description" content="Basics ReviewArray Type Multidimensional array 多维数组 除了第一维其它维必须明确指出大小（explicit size） 不可以全部 decay Dynamic allocation malloc in C and new&#x2F;new [] in C++ new和 malloc 返回都是指针 释放      Function 函数返回类型不能是函数或者数组">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://silhouettesforyou.github.io/2024/06/03/56ae950785e9/algorithm-modifying-rotate.png">
<meta property="og:image" content="https://silhouettesforyou.github.io/2024/06/03/56ae950785e9/set-operations-inclues-1.png">
<meta property="og:image" content="https://silhouettesforyou.github.io/2024/06/03/56ae950785e9/set-operations-inclues-2.png">
<meta property="og:image" content="https://silhouettesforyou.github.io/2024/06/03/56ae950785e9/locale-imp.gif">
<meta property="article:published_time" content="2024-06-03T06:11:57.000Z">
<meta property="article:modified_time" content="2024-10-08T15:17:47.166Z">
<meta property="article:author" content="Xiaoming">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="现代 C++">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://silhouettesforyou.github.io/2024/06/03/56ae950785e9/algorithm-modifying-rotate.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>现代 C++ 基础 - Silhouettes For You</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_4625503_8j4kic2ox3k.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"silhouettesforyou.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"62be422732dc4e6f91e7fa199aa1f3f2","google":{"measurement_id":"G-B260B2ZWXQ"},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?62be422732dc4e6f91e7fa199aa1f3f2";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-B260B2ZWXQ", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'G-B260B2ZWXQ');
        });
      }
    </script>
  

  

  

  

  



  
<style type="text/css">
.spoiler {
  display: inline;
}
p.spoiler {
  display: flex;
}
.spoiler a {
  pointer-events: none;
}
.spoiler-blur, .spoiler-blur > * {
  transition: text-shadow .5s ease;
}
.spoiler .spoiler-blur, .spoiler .spoiler-blur > * {
  color: rgba(0, 0, 0, 0);
  background-color: rgba(0, 0, 0, 0);
  text-shadow: 0 0 10px grey;
  cursor: pointer;
}
.spoiler .spoiler-blur:hover, .spoiler .spoiler-blur:hover > * {
  text-shadow: 0 0 5px grey;
}
.spoiler-box, .spoiler-box > * {
  transition: color .5s ease,
  background-color .5s ease;
}
.spoiler .spoiler-box, .spoiler .spoiler-box > * {
  color: black;
  background-color: black;
  text-shadow: none;
}</style><meta name="generator" content="Hexo 5.4.2"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="Silhouettes For You" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Silhouettes For You</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/lover/" target="_self">
                <i class="iconfont icon-heart"></i>
                <span>Lover</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-buyecsstorage"></i>
                <span>Cloud Disk</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="https://onedrive-vercel-index-xi-liard.vercel.app/" target="_blank">
                    <i class="iconfont icon-onedrive"></i>
                    <span>OneDrive</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://fyddxwmx.cloud.sealos.io/" target="_blank">
                    <i class="iconfont icon-aliyun"></i>
                    <span>Aliyun</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://manual-maryl-silhouette-7fc7ff34.koyeb.app/" target="_blank">
                    <i class="iconfont icon-storage"></i>
                    <span>Other Storages</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-jupyter"></i>
                <span>Jupyter Notebooks</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/notebooks/pages/Pytorch-Tutorial.html" target="_self">
                    <i class="iconfont icon-pytorch"></i>
                    <span>Pytorch Tutorial</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/notebooks/pages/RL-Tutorial.html" target="_self">
                    <i class="iconfont icon-reinforcement-learning"></i>
                    <span>RL Tutorial</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/Hayao-Miyazaki/post.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="现代 C++ 基础"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-06-03 14:11" pubdate>
          June 3, 2024 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          14k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          116 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">现代 C++ 基础</h1>
            
              <p id="updated-time" class="note note-light" style="display: none">
                
                  
                    Last updated on 2024-10-08T23:17:47+08:00
                  
                  

                
              </p>
            
            
              <div class="markdown-body">
                
                <link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h3 id="Basics-Review"><a href="#Basics-Review" class="headerlink" title="Basics Review"></a>Basics Review</h3><h4 id="Array-Type"><a href="#Array-Type" class="headerlink" title="Array Type"></a>Array Type</h4><ul>
<li>Multidimensional array 多维数组<ul>
<li>除了第一维其它维必须明确指出大小（explicit size）</li>
<li>不可以全部 decay</li>
<li>Dynamic allocation<ul>
<li><code>malloc</code> in C and <code>new</code>/<code>new []</code> in C++</li>
<li><code>new</code>和 <code>malloc</code> 返回都是指针</li>
<li>释放</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h4><ul>
<li><p>函数返回类型不能是函数或者数组（但是可以是它们的引用）</p>
<ul>
<li>不应该返回局部变量的指针或者引用（超出了局部变量生命周期的范围）<ul>
<li>e.g. <code>int&amp; Test() { int a = 1; return &amp;a;}</code></li>
</ul>
</li>
<li>声明为 <code>static</code> 的局部变量具有全局性</li>
</ul>
</li>
<li><p>Function pointers 函数指针</p>
<ul>
<li><p><code>void(*)(int)</code></p>
</li>
<li><p>clockwise/spiral rule</p>
</li>
<li><p>Type alias 用 C++ 11 中的<code>using</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">using</span> MyFuncType1 = <span class="hljs-built_in">int</span>(*)(<span class="hljs-type">float</span>);<br><span class="hljs-keyword">using</span> MyFuncType2 = <span class="hljs-built_in">int</span>(*)(<span class="hljs-type">int</span>);<br><span class="hljs-keyword">using</span> MyFuncType3 = <span class="hljs-built_in">int</span>(*)(MyFuncType1);<br></code></pre></td></tr></table></figure></li>
<li><p>C 语言中可以用 <code>typedef</code>，但是没有<code>using</code> 强大</p>
</li>
</ul>
</li>
</ul>
<h4 id="Attribute"><a href="#Attribute" class="headerlink" title="Attribute"></a>Attribute</h4><ul>
<li><code>[[attribute]]</code> C++ 11，<code>[[attribute("reason")]]</code> C++ 20</li>
<li><code>[[deprecated]]</code>和<code>[[deprecated("reason")]]</code> C++ 14</li>
<li><code>[[noreturn]]</code> C++ 11</li>
<li><code>[[maybe_unused]]</code> C++ 17</li>
</ul>
<p>e.g.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs C++">[[nodiscard]] <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> </span>{<span class="hljs-keyword">return</span> a + b; }<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-built_in">Add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// int res = Add(1, 2);</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>}<br></code></pre></td></tr></table></figure>

<p>warning: 放弃具有 [[nodiscard]] 属性函数的返回值</p>
<h4 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h4><blockquote>
<p>一个被限制取值的类</p>
</blockquote>
<ul>
<li>比较像使用全局变量</li>
<li>同时进行整形运算也没有安全检查</li>
<li>C++ 11 引入了 scoped enumeration 提高安全性</li>
</ul>
<p>e.g.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// enum Day {Monday};</span><br><span class="hljs-keyword">enum class</span> <span class="hljs-title class_">Day</span> {Monday};<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// int a = Monday;</span><br>    Day a = Day::Monday<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></table></figure>

<ul>
<li>可以使用 <code>std::underlying_type&lt;Day&gt;::type</code> 或者<code>std::underlying_type_t&lt;Day&gt;</code> C++ 14 转成整数类型<ul>
<li>C++ 23 中也可以使用<code>std::to_underlying&lt;Day&gt;(day)</code></li>
</ul>
</li>
<li>可以使用 <code>Day day{1};</code> 初始化 C++ 17，但是不能直接赋值<code>Day day = 1;</code> 或<code>day = 1;</code></li>
<li>可以使用位操作符</li>
</ul>
<h4 id="Expression"><a href="#Expression" class="headerlink" title="Expression"></a>Expression</h4><ul>
<li>运算符和表达式三个重要概念<ul>
<li>Precedence 优先级</li>
<li>Associativity 结合性</li>
<li>Order 顺序</li>
</ul>
</li>
<li>From the view of compiler, an expression is in fact a tree, determined by associativity and precedence. e.g. <code>9 / 3 / 2 + 2 * 3</code><ul>
<li>Precedence is used to split terms first.</li>
<li>Associativity determines how the tree will grow.</li>
<li>Then, it’s order of expression evaluation that computes the whole tree. 但是顺序是不确定的<ul>
<li><code>f1() + f2() + f3()</code>，<code>f1()</code>，<code>f1()</code>，<code>f1()</code>哪一个先被 evaluated 是不确定的</li>
</ul>
</li>
</ul>
</li>
<li>There are some rules<ul>
<li>For <code>&amp;&amp;</code> and <code>||</code>, since they have short-circuit property, the first part will be fully evaluated.</li>
<li>For a function call, all parameters (including <code>a</code> for e.g. <code>a.Func()</code> or <code>a-&gt;Func()</code>) are fully evaluated before entering the function.</li>
<li>三目运算</li>
<li>逗号表达式</li>
<li>C++ 17<ul>
<li>Parameters in function are evaluated indeterminately, i.e. every sub-tree represented by te parameter is fully evaluated in a <strong>non-overlap</strong> way 不会以交叠的形式 evaluated</li>
<li>运算符重载，和 build-in 运算符的 evaluated 顺序一致，而不是被当作普通函数</li>
<li>More useful examples: chained call</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C++">std::string s = <span class="hljs-string">"I have it even works if you don't believe"</span>;<br>s.<span class="hljs-built_in">replace</span>(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>, <span class="hljs-string">""</span>).<span class="hljs-built_in">replace</span>(s.<span class="hljs-built_in">find</span>(<span class="hljs-string">"even"</span>), <span class="hljs-number">4</span>, <span class="hljs-string">"sometimes"</span>).<span class="hljs-built_in">replace</span>(s.<span class="hljs-built_in">find</span>(<span class="hljs-string">"you don't"</span>), <span class="hljs-number">9</span>, <span class="hljs-string">"I"</span>);<br></code></pre></td></tr></table></figure>

<h3 id="class"><a href="#class" class="headerlink" title="class"></a>class</h3><h4 id="Ctor-amp-Dtor"><a href="#Ctor-amp-Dtor" class="headerlink" title="Ctor & Dtor"></a>Ctor &amp; Dtor</h4><ul>
<li>拷贝构造函数</li>
<li>赋值构造函数</li>
<li>The recommended way is member initializer list:<ul>
<li><code>member1{...}, member2{...}, ... {/* function body */}</code></li>
<li><code>{}</code> is used since C++ 11</li>
</ul>
</li>
<li>默认构造函数建议使用<code>Class() = default;</code></li>
<li>如果成员变量有默认值，就不建议使用上面的构造函数的形式，而是直接用默认值初始化</li>
</ul>
<h4 id="Initialization-of-Object"><a href="#Initialization-of-Object" class="headerlink" title="Initialization of Object"></a>Initialization of Object</h4><ul>
<li>Since C++ 11, Uniform Initialization is introduced<ul>
<li>所有的初始化都可以用<code>{}</code></li>
<li>相比于 <code>()</code> 更安全 Narrowing Conversion 缩窄变换检查<ul>
<li>the converted type cannot represent all values<ul>
<li><code>uint32_t</code>类型用 <code>uint16_t</code> 初始化，编译器会报错</li>
</ul>
</li>
<li>the facilitates type safety</li>
</ul>
</li>
</ul>
</li>
<li>Value initialization: No parameter for initialization <code>T a()</code>， <code>T a{}</code>， <code>new T{}</code>， <code>new T()</code></li>
<li>Direct initialization: <code>T a(x, y, ...)</code>，<code>T(x, y, ...)</code>，<code>new T(x, y, ...)</code>，<code>T a{x, y, ...}</code></li>
<li>Copy initialization: <code>T a = xx;</code>，<code>T a[] = { xx, ...};</code><ul>
<li>Ctors that use <code>explicit</code> cannot use this way</li>
<li>Before C++ 17, this also requires available copy ctor.</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {<span class="hljs-keyword">public</span>: <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">A</span><span class="hljs-params">(<span class="hljs-type">int</span> a)</span> </span>{}};<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Func</span><span class="hljs-params">(A a)</span> </span>{}<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>    A a = <span class="hljs-number">1</span>;    <span class="hljs-comment">// error</span><br>    A a = <span class="hljs-built_in">A</span>(<span class="hljs-number">1</span>);<br>    <span class="hljs-built_in">Func</span>(<span class="hljs-number">1</span>);    <span class="hljs-comment">// error</span><br>    <span class="hljs-built_in">Func</span>(<span class="hljs-built_in">A</span>(<span class="hljs-number">1</span>)); <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>}<br></code></pre></td></tr></table></figure>

<ul>
<li>List initialization</li>
<li>Aggregate initialization</li>
</ul>
<h4 id="Member-Functions"><a href="#Member-Functions" class="headerlink" title="Member Functions"></a>Member Functions</h4><ul>
<li>所有的成员函数都隐式有一个 <code>this</code> 指针</li>
<li>如果期望函数不能更改成员变量，可以使用 <code>const</code> 关键字 make <code>this</code> to be <code>const</code></li>
<li>静态成员函数<ul>
<li>没有 <code>this</code> 指针</li>
</ul>
</li>
</ul>
<h4 id="Access-Control"><a href="#Access-Control" class="headerlink" title="Access Control"></a>Access Control</h4><ul>
<li><code>private</code>、<code>protected</code>、<code>public</code>，默认是<code>private</code></li>
<li><code>protected</code>用在继承中</li>
<li>友元</li>
</ul>
<h4 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h4><ul>
<li>子类 / 派生类、父类 / 基类</li>
<li>子类 / 派生类可以访问父类中所有 <code>public</code> 和<code>protected</code>成员</li>
<li>继承和组合</li>
<li>派生类可以隐式的转化成基类</li>
</ul>
<h5 id="Slicing-Problem"><a href="#Slicing-Problem" class="headerlink" title="Slicing Problem"></a>Slicing Problem</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>    Student student1{...}, student2{...};<br>    Person&amp; student1Ref = student1;<br>    student1Ref = student2;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></table></figure>

<ul>
<li>There exists implicit conversion in <code>student1Ref = student2</code> so actually it calls <code>Person::operator=(const Person&amp;)</code></li>
<li>Can decorating <code>operator=</code> with <code>virtual</code> help<ul>
<li><code>Person::operator=</code> needs <code>const Person&amp;</code> but <code>Student::operator=</code> accepts <code>const Student&amp;</code> 参数都不一样，虚函数都不生效</li>
</ul>
</li>
<li>This is called “slicing” because such operation will only affect the base slice but not the initial object as whole 只影响了一小片</li>
<li>Polymorphic base class should hide their copy &amp; move functions if it has data member, otherwise deleting them 对于具有多态属性的基类，应该隐藏它们的拷贝和移动函数</li>
<li>Make copy &amp; move functions <code>protected</code> so derived class can call them</li>
</ul>
<h5 id="Multiple-Inheritance"><a href="#Multiple-Inheritance" class="headerlink" title="Multiple Inheritance"></a>Multiple Inheritance</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Elephant</span> {};<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Seal</span> {};<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ElephantSeal</span> : <span class="hljs-keyword">public</span> Elephant, <span class="hljs-keyword">public</span> Seal {};<br></code></pre></td></tr></table></figure>

<ul>
<li>Dreaded diamond</li>
<li>C++ introduces virtual inheritance<ul>
<li>All virtual bases will be merged and seen as the same</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {<span class="hljs-keyword">public</span>: <span class="hljs-type">int</span> weight; };<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Elephant</span> : <span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> Animal {};<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Seal</span> : <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">public</span> Animal {}; <span class="hljs-comment">// virtual 和 public 顺序是不重要的</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ElephantSeat</span> : <span class="hljs-keyword">public</span> Elephant, <span class="hljs-keyword">public</span> Seal {};<br></code></pre></td></tr></table></figure>

<ul>
<li>That is, you define many ABCs, which tries to reduce data members and non-pure-virtual member functions as much as you can 定义很多抽象类，尽可能减少成员变量和非纯虚函数的数量，最好是没有</li>
<li>They usually denote “-able” functionality 这样展现出来的就是就有某种能力</li>
</ul>
<h4 id="Polymorphism- 多态"><a href="#Polymorphism- 多态" class="headerlink" title="Polymorphism 多态"></a>Polymorphism 多态</h4><ul>
<li>you can use the base class to load the derived object and call its own methods 使用基类的指针 / 引用，承载派生类的对象，从而调用派生类的方法</li>
<li>virtual pointer and virtual table</li>
<li>Every object whose class has a virtual method will have a virtual pointer, which points to virtual table of its class 每个类中都有一个指向虚表的指针，虚表内容就是声明为 <code>virtual</code> 函数的地址</li>
<li>In C++ 11, it’s recommended to use <code>override</code> 子类没有 <code>override</code> 编译器会报错</li>
<li><code>final</code> It means override, and the derived class cannot override again 继承链中的最后一个节点<ul>
<li><code>class A final {...};</code> 让类不能被继承</li>
<li>去虚化，编译优化</li>
</ul>
</li>
<li><code>abstract class</code> 抽象类<ul>
<li>抽象类不能被实例化</li>
<li>可以是使用抽象类的指针，指向的都是派生类的对象</li>
<li>C++ 通过纯虚函数实现抽象类 <code>virtual void PrintInfo() const = 0;</code></li>
<li>派生类继承自抽象类必须实现纯虚函数，否则仍然是抽象类</li>
<li>Don’t call <strong>any</strong> virtual function and any function that calls virtual function in ctor &amp; dtor 在构造函数和析构函数中不要调用任何虚函数，也不要掉调用任何可能调用虚函数的函数</li>
<li>You should usually make dtor of base class <code>virtual</code> 通常将析构函数声明为虚函数<ul>
<li>deleting <code>Base*</code> that cast from <code>Derived*</code> will lead to correct dtor 派生类指针赋给基类，当调用 <code>delete</code> 时，如果不基类不是虚析构函数，就会调用基类的析构函数</li>
</ul>
</li>
<li>构造函数不能是纯虚函数</li>
</ul>
</li>
</ul>
<h4 id="Some-Covert-Facts-in-Inheritance"><a href="#Some-Covert-Facts-in-Inheritance" class="headerlink" title="Some Covert Facts in Inheritance"></a>Some Covert Facts in Inheritance</h4><ul>
<li><code>override</code>不止表示复写虚函数的含义，对于非虚函数的复写也叫“override”</li>
<li><code>private</code> inheritance usually denotes the relation of <strong>has-a</strong></li>
<li>虚函数的返回类型可以有些许改变：you can use <code>Base*</code> to both accept <code>Base*</code> and <code>Derived*</code> 复写虚函数的返回值可以是指向基类的指针，也可以是指向派生类的指针<ul>
<li>智能指针不能有“协变”</li>
</ul>
</li>
<li>当虚方法有默认参数的时候，用什么类型的指针调用时，就会返回该类型内的默认值<ul>
<li>默认的参数在编译期间被识别，虚表是在运行时跳转的</li>
</ul>
</li>
</ul>
<p>e.g.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Parent::Go</span><span class="hljs-params">(<span class="hljs-type">int</span> i = <span class="hljs-number">2</span>)</span> </span>{std::cout &lt;&lt; <span class="hljs-string">"Base's go with i = "</span> &lt;&lt; i &lt;&lt; <span class="hljs-string">"\n"</span>; }<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Child::Go</span><span class="hljs-params">(<span class="hljs-type">int</span> i = <span class="hljs-number">4</span>)</span> </span>{std::cout &lt;&lt; <span class="hljs-string">"Derived's go with i ="</span> &lt;&lt; i &lt;&lt; <span class="hljs-string">"\n"</span>; }<br><br>Child child;<br>child.<span class="hljs-built_in">Go</span>(); <span class="hljs-comment">// Derived's go with i = 4</span><br>Parent&amp; childRef = child;<br>childRef.<span class="hljs-built_in">Go</span>();  <span class="hljs-comment">// Base's go with i = 2</span><br></code></pre></td></tr></table></figure>

<ul>
<li>可以更改虚方法的访问属性（但是不建议）</li>
</ul>
<h3 id="struct"><a href="#struct" class="headerlink" title="struct"></a><code>struct</code></h3><ul>
<li>和 <code>class</code> 基本上一样，除了 <code>struct</code> 默认的访问控制是<code>public</code><ul>
<li>不应该有成员函数，最多有 ctor、dtor 和运算符重载</li>
<li>With these constraints (except for ctor), <code>struct</code> will be an aggregate, which can use aggregate initialization<ul>
<li>Since C++ 20, aggregate can also use <strong>designated initialization</strong> 指定初始化</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>e.g.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Priority</span> {<span class="hljs-type">int</span> cal; }<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point</span><br>{<br>    <span class="hljs-type">int</span> x, y;<br>    Priority priority[<span class="hljs-number">2</span>];<br>}<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>    Point p{.x = <span class="hljs-number">1</span>, .y = <span class="hljs-number">2</span>, .priority = {{ .val = <span class="hljs-number">1</span>}, {.val = <span class="hljs-number">2</span> } } };<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></table></figure>

<h3 id="Function-Overloading- 函数重载"><a href="#Function-Overloading- 函数重载" class="headerlink" title="Function Overloading 函数重载"></a>Function Overloading 函数重载</h3><ul>
<li>C++ 中就是相同的函数名不同的参数<ul>
<li>C 中是禁止的</li>
</ul>
</li>
<li>This is done by compilers using a technique called <strong>name mangling</strong></li>
<li>Operator Overloading 运算符重载<ul>
<li><code>+</code>，<code>-</code>，<code>*</code>，<code>/</code>，<code>%</code>，<code>|</code>，<code>&amp;</code>，<code>^</code>，<code>&lt;&lt;</code>，<code>&gt;&gt;</code>：推荐使用在全局函数中</li>
<li><code>+=</code>，<code>-=</code>，<code>*=</code>，<code>/=</code>，<code>|=</code>，<code>&amp;=</code>，<code>^=</code>，<code>&lt;&lt;=</code>，<code>&gt;&gt;=</code>：必须是成员函数 since the first operand must be a “named” object; return reference (i.e. <code>*this</code>)</li>
<li>Prefix<code>++</code> &amp; Prefix<code>--</code>：必须是成员函数 return <code>*this</code></li>
<li>Postfix<code>++</code> &amp; Postfix<code>--</code> have an unused parameter int, which is used to distinguish the prefix and postfix</li>
<li><code>*</code>，<code>-&gt;</code>：usually used in e.g. some wrapper of pointers</li>
<li><code>&amp;&amp;</code>，<code>||</code>：short-circuit 特性会失效</li>
<li><code>&lt;=&gt;</code>：三路比较运算符</li>
<li><code>()</code></li>
<li><code>[]</code><ul>
<li>Since C++ 23, you can use multidimensional subscript in <code>operator[]</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Lambda-Expression"><a href="#Lambda-Expression" class="headerlink" title="Lambda Expression"></a>Lambda Expression</h3><ul>
<li>本质上是一个匿名的 <code>struct</code>，重载了<code>operator() const</code> 方法</li>
<li>Basic format: <code>auto func = [captures](params) -&gt; ReturnType {function body;};</code><ul>
<li>Captures are actually members of the <code>struct</code></li>
<li>ReturnType, params and function are for <code>operator()</code></li>
<li>Every lambda expression has its unique type</li>
<li>不传任何参数 <code>()</code> 可以省略掉</li>
</ul>
</li>
<li>建议将 Lambda 表达式中的捕获的东西明确写出来</li>
<li>static 和 global 变量是不需要被捕获的</li>
<li>捕获 <code>this</code> 指针<ul>
<li><code>this</code> by reference, since only copy pointer</li>
<li><code>*this</code> really copy all members</li>
<li>包括私有成员也可以捕获</li>
</ul>
</li>
<li>You may add specifiers after <code>()</code><ul>
<li><code>mutable</code>: since C++ 17, remove <code>const</code> in <code>operator()</code></li>
<li><code>static</code>: since C++ 23, same as <code>static operator()</code></li>
<li><code>constexpr</code>、<code>consteval</code>、<code>noexcept</code></li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">auto</span> m = [i] {i = <span class="hljs-number">1</span>; <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; }; <span class="hljs-comment">// 不允许修改 i = 1，因为重载的 operator() 是 const</span><br>    <span class="hljs-keyword">auto</span> m = [i]() <span class="hljs-keyword">mutable</span> {i = <span class="hljs-number">1</span>; <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; }; <span class="hljs-comment">// 修改的不是外面定义的变量，本质上修改的是 i 的拷贝</span><br>}<br></code></pre></td></tr></table></figure>

<ul>
<li>It’s also legal to add attributes between <code>[]</code> and <code>()</code></li>
<li>函数也可以写成 Lambda 表达式的形式 <code>auto Foo(params) -&gt; ReturnType {function body;}</code></li>
</ul>
<p>Code Block With Initializer</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">auto</span> it = table.<span class="hljs-built_in">find</span>(<span class="hljs-number">1</span>);<br><span class="hljs-keyword">if</span> (it == table.<span class="hljs-built_in">end</span>())<br>    <span class="hljs-comment">//</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-comment">//</span><br></code></pre></td></tr></table></figure>

<ul>
<li><code>it</code>会泄露出去，下面如果继续判断会再定义迭代器类型的变量</li>
<li>Since C++ 17, you mey code like</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">auto</span> it = table.<span class="hljs-built_in">find</span>(<span class="hljs-number">1</span>); it == table.<span class="hljs-built_in">end</span>())<br>    <span class="hljs-comment">//</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-comment">//</span><br></code></pre></td></tr></table></figure>

<ul>
<li>Since C++ 20, range-based for loop can also add an additional initializer, e.g. <code>for (auto vec = GetVec(); auto&amp; m : vec);</code></li>
<li>Since C++ 23, type alias declaration can also be initializer, e.g. <code>if (using T = xx; ...)</code></li>
</ul>
<h3 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h3><ul>
<li>Since C++ 17, CATD(class template argument deduction) is introduced, meaning that the argument of ctor can deduce the template parameter of class. e.g. <code>std::vector v{1, 2, 3, 4}</code></li>
<li>Lambda expression can also use template</li>
</ul>
<h2 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h2><ul>
<li><code>std::size_t</code>: the type of <code>sizeof()</code> 意味着对象的大小不能超过 <code>std::size_t</code> 所表示的范围<ul>
<li>也意味着数组的大小不能超过 <code>std::size_t</code> 所表示的范围</li>
<li>容器的大小也不能超过<code>std::size_t</code></li>
</ul>
</li>
<li><code>std::ptrdiff_t</code>：两个指针相减得到的类型</li>
</ul>
<h3 id="Iterators"><a href="#Iterators" class="headerlink" title="Iterators"></a>Iterators</h3><ul>
<li>Input/Output iterator<ul>
<li>For output <code>*it = val</code>, <code>it++</code>, <code>++it</code>, ‘it1 = it2’</li>
<li>For input <code>==</code>, <code>!=</code>, <code>-&gt;</code></li>
</ul>
</li>
<li>Forward iterator: e.g. linked list</li>
<li>Bidirectional iterator: <code>--it</code>, <code>it--</code> e.g. double linked list, map</li>
<li>Random access iterator: <code>+</code>, <code>-</code>, <code>+=</code>, <code>-=</code>, <code>[]</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>!=</code> e.g. deque</li>
<li>Contiguous iterator (since C++ 17): 保证地址空间是连续的</li>
<li><strong>IMPORTANT</strong>: Iterator are as unsafe as pointers 线程不安全的</li>
<li>All containers can get their iterators by:<ul>
<li><code>.begin()</code>, <code>.end()</code></li>
<li><code>.cbegin()</code>, <code>cend()</code> read-only access</li>
</ul>
</li>
<li>双向链表等还提供了倒序的遍历迭代器<ul>
<li><code>.rbegin()</code>, <code>.rend()</code>, <code>.crbegin()</code>, <code>crend()</code></li>
</ul>
</li>
<li>还可以使用全局的方法得到迭代器<ul>
<li><code>std::begin(vec)</code>, <code>std::end(vec)</code></li>
<li>C++ 20 建议使用<code>std::ranges::begin</code></li>
<li>只有类似 <code>int arr[5]</code> 传入到 <code>std::begin()</code> 或<code>std::end()</code>中才有效，指针传入进来是无效的</li>
</ul>
</li>
<li>There are also general methods of iterator operations, defined in <code>&lt;iterator&gt;</code><ul>
<li><code>std::advance(InputIt&amp; it, n)</code>: <code>it += n</code></li>
<li><code>std::next(InputIt it, n = 1)</code>: <code>return it + n</code></li>
<li><code>std::prev(InputIt it, n = 1)</code>: <code>return it - n</code></li>
<li><code>std::distance(InputIt it1, InputIt it2)</code>: <code>return it2 - it1</code> 不同的容器时间复杂度不一样</li>
</ul>
</li>
</ul>
<h4 id="Iterator-traits（显著的特点，特征）"><a href="#Iterator-traits（显著的特点，特征）" class="headerlink" title="Iterator traits（显著的特点，特征）"></a>Iterator traits（显著的特点，特征）</h4><ul>
<li>Iterators provide some types to show their information:<ul>
<li><code>value_type</code>: The type of elements referred to</li>
<li><code>difference_type</code>: The type that can be used to represent the distance between elements (usually <code>ptrdiff_t</code>) 迭代器之间的距离所表示的类型，一般就是<code>ptrdiff_t</code></li>
<li><code>iterator_category</code>: e.g. <code>input_iterator_tag</code>, <code>continuous_iterator_tag</code></li>
<li><code>pointer</code> &amp; <code>reference</code>: only available in container iterators 只有在容器中才会有的特性<ul>
<li>可以使用 <code>std::iterator_traits&lt;IteratorType&gt;::xxx</code> 获取</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Stream-iterator"><a href="#Stream-iterator" class="headerlink" title="Stream iterator"></a>Stream iterator</h4><ul>
<li><code>std::istream_iterator&lt;T&gt;</code> &amp; <code>std:ostream_iterator&lt;T&gt;</code></li>
<li>The default constructed <code>istream_iterator</code> is <code>end()</code> 默认的构造函数表示终止的迭代器</li>
</ul>
<h4 id="Iterator-adaptor"><a href="#Iterator-adaptor" class="headerlink" title="Iterator adaptor"></a>Iterator adaptor</h4><p>有两种类型的迭代器适配器</p>
<ul>
<li>One is created from iterators to preform different utilities:<ul>
<li>E.g. reversed iterators 反向迭代器，++ 的本质上是 –，所以可以用 <code>begin()</code> 初始化，即<code>std:::reverse_iterator r{p.begin() }</code></li>
<li>You can get the underlying iterator by <code>.base()</code>, which actually returns the iterator that points to the elements after the referred one 调用 <code>.base()</code> 实际上是指向当前指向位置的下一个元素<ul>
<li><code>rbegin().base() == end()</code></li>
</ul>
</li>
</ul>
</li>
<li>Another is created from containers to work more than “iterate”<ul>
<li><code>std::back_insert_iterator{container}</code>: <code>*it = val</code> will call <code>push_back(val)</code> to insert</li>
<li><code>std:front_insert_iterator{container}</code>: call <code>push_front(val)</code> to insert</li>
<li><code>std::insert_iterator{container, pos}</code>: call <code>insert(pos, val)</code> to insert</li>
</ul>
</li>
<li>Notice that inserting/assigning a range directly is usually better than inserting one by one for <code>vector</code> or <code>deque</code></li>
</ul>
<h3 id="Sequential-Container"><a href="#Sequential-Container" class="headerlink" title="Sequential Container"></a>Sequential Container</h3><h4 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h4><ul>
<li>E.g. <code>int a[5]</code> will decay to <code>int*</code> when passing to function, and the size information is dropped 以参数的方式传递到函数中会退化成指针，并且大小也被舍弃了</li>
<li><code>std::array&lt;T, size&gt;</code> the same as <code>T[size]</code>. It always preserves size, can copy from another array, and can do more things like bound check</li>
<li>It’s allocated on stack<ul>
<li>But if you <code>new std::array</code>, then it;s still allocated on heap</li>
</ul>
</li>
<li>特殊的构造函数需要额外的 <code>{}</code> e.g. <code>struct S {int i; int j;}</code> 初始化时是<code>std::array&lt;S, 2&gt; arr{{{1, 2}, {3, 4}}}</code><ul>
<li>第一个 <code>{}</code> 是<code>array</code>本身初始化的<code>{}</code></li>
<li>第二个 <code>{}</code> 是数组初始化的<code>{}</code></li>
</ul>
</li>
<li>For member accessing 成员访问<ul>
<li><code>operator[]</code></li>
<li><code>at()</code> will check the bound</li>
<li><code>front()</code>, <code>back()</code>: get the first/last element of vector 首先要保证非空</li>
<li>If you want to get the raw pointer of array content, you can use <code>.data()</code></li>
</ul>
</li>
<li>Additional methods<ul>
<li><code>.swap()</code></li>
<li><code>operator=</code>, <code>operator&lt;=&gt;</code> 三路比较运算符</li>
<li><code>.fill()</code> 将整个数组填充为某个特定值</li>
<li><code>std::to_array</code>(C-style array)</li>
</ul>
</li>
<li>Size operations<ul>
<li><code>.size()</code>: return <code>size_t</code></li>
<li><code>empty()</code></li>
<li><code>.max_size()</code>: get maximum possible size in this system(usually useless)</li>
</ul>
</li>
</ul>
<h4 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h4><ul>
<li>动态数组<ul>
<li>支持随机访问，占据连续空间</li>
<li>When inserting and removing elements at the end (i.e. pushing/poping back), the complexity is amortized（均摊） <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>If not at end, it’ll be <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
</li>
<li>在 cache 上的效果非常不错，对 cache 利用率非常显著</li>
<li>实现思路<ul>
<li>准备一部分空间，这样在 pushing 或者 poping 的时候时间复杂度才是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>当容量不够的时候在重新分配（reallocation），重分配的均摊复杂度也要求是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>The element number is called size; total space is called capacity</li>
<li>重分配的策略<ul>
<li>The easiest strategy is increasing space linearly<ul>
<li>E.g. 0 -&gt; 4 -&gt; 8 -&gt; 12 -&gt; 16 -&gt; …</li>
<li>Every <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewbox="0 -694 521 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g></g></svg></mjx-container> operations will trigger reallocation an copy <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="7.54ex" height="1.756ex" role="img" focusable="false" viewbox="0 -694 3332.6 776"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(877.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(1933.6,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mi" transform="translate(2454.6,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g></g></g></svg></mjx-container> elements<ul>
<li>So, the amortized complexity is <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.798ex;" xmlns="http://www.w3.org/2000/svg" width="26.843ex" height="3.38ex" role="img" focusable="false" viewbox="0 -1141.1 11864.5 1493.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mfrac" transform="translate(1167,0)"><g data-mml-node="mrow" transform="translate(220,582.8) scale(0.707)"><g data-mml-node="munderover"><g data-mml-node="mo"><path data-c="2211" d="M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z"/></g><g data-mml-node="mi" transform="translate(1089,477.1) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="TeXAtom" transform="translate(1089,-285.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mn" transform="translate(1123,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2453.3,0)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mi" transform="translate(521,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g></g><g data-mml-node="mrow" transform="translate(898.9,-345) scale(0.707)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mi" transform="translate(521,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g></g><rect width="2547.1" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(3954.1,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(4620.9,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(5676.7,0)"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(6454.7,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(6843.7,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(7721.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(8388.4,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(9444.2,0)"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(10222.2,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mfrac" transform="translate(10611.2,0)"><g data-mml-node="mi" transform="translate(220,394) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mi" transform="translate(247.9,-345) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><rect width="624.3" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(11475.5,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>Considering that <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewbox="0 -694 521 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g></g></svg></mjx-container> is an constant, this is still <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
</li>
</ul>
</li>
<li>So, what about exponentially（指数）?<ul>
<li>E.g. 1 -&gt; 2 -&gt; 4 -&gt; 8 -&gt; 16 -&gt; 32 -&gt; …</li>
<li>Every <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.152ex" height="1.932ex" role="img" focusable="false" viewbox="0 -853.7 951.4 853.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g></g></g></svg></mjx-container> operations will trigger reallocation an copy <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="6.527ex" height="2.117ex" role="img" focusable="false" viewbox="0 -853.7 2885 935.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(877.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msup" transform="translate(1933.6,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g></g></g></svg></mjx-container> elements<ul>
<li>So, the amortized complexity is <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.885ex;" xmlns="http://www.w3.org/2000/svg" width="17.432ex" height="3.752ex" role="img" focusable="false" viewbox="0 -1267.1 7705 1658.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mfrac" transform="translate(1167,0)"><g data-mml-node="mrow" transform="translate(220,582.8) scale(0.707)"><g data-mml-node="munderover"><g data-mml-node="mo"><path data-c="2211" d="M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z"/></g><g data-mml-node="mi" transform="translate(1089,477.1) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="TeXAtom" transform="translate(1089,-285.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mn" transform="translate(1123,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2453.3,0)"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g></g></g><g data-mml-node="msup" transform="translate(1043.4,-391.4) scale(0.707)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,289) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g><rect width="2519.5" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(3926.5,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(4593.3,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(5649,0)"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(6427,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(6816,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(7316,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
</li>
</ul>
</li>
<li>Finally, why is the exponent 2?<ul>
<li>可以证明任何大于 1 的指数最后的均摊复杂度都是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>This is a trade-off between space and time 空间和时间的权衡</li>
<li>In MS（微软）, it’s 1.5</li>
</ul>
</li>
</ul>
</li>
<li>vector 不会自动的进行缩容（shrink），但是会暴露出接口手动缩容</li>
<li>Insert 是从后向前的（move backwards）</li>
<li>Removal is similar, but move forwards from the end of deletion to the deletion point, and finally destruct the last several elements</li>
<li><code>std::initializer_list</code></li>
<li>For member accessing (same as array)<ul>
<li>operator[]<code>,</code>at()<code>: accessing by index;</code>at()<code>will check th bound, i.e. if the index is greater than size,</code>std::out_of_range` will be thrown</li>
<li><code>front()</code>, <code>back()</code>: get the first/last element of vector</li>
<li>If you want to get the raw pointer of array content, you can use <code>.data()</code></li>
</ul>
</li>
<li>For capacity operations (i.e. adjust memory)<ul>
<li><code>.capacity()</code>: get capacity (return <code>size_t</code>)</li>
<li><code>.reserve(n)</code>: 直接分配 <code>n</code> 大小的内存，如果比当前 capacity 小就什么都不做，size 是不会改变的<ul>
<li>作用是前提知道需要分配的数量，一次性分配，就不需要有扩容的操作了</li>
</ul>
</li>
<li><code>.shrink_to_fit</code>: request to shrink the capacity so that <code>capacity == size</code></li>
</ul>
</li>
<li>For size operations<ul>
<li><code>.size()</code></li>
<li><code>.empty()</code></li>
<li><code>.resize(n, obj = Object{})</code></li>
<li><code>.clear()</code>: remove all things; size will be 0 after this</li>
</ul>
</li>
<li><code>.push_back(obj)</code></li>
<li><code>.emplace_back(params)</code>: insert an element constructed by params at the end 就地根据 <code>params</code> 构造元素<ul>
<li>Since C++ 17, it returns reference of inserted element (before it’s <code>void</code>)</li>
</ul>
</li>
<li><code>.pop_back()</code></li>
<li><code>.insert(const_iterator pos, xxx)</code></li>
<li><code>.erase(const_iterator pos)</code>, <code>.erase(const_iterator first, const_iterator last)</code>: erase a single element/elements from <code>[first, last)</code><ul>
<li>insert/erase will return next valid iterator of inserted/erase elements</li>
</ul>
</li>
<li>Interact with another vector<ul>
<li><code>.assign</code></li>
<li><code>.swap(vec)</code></li>
</ul>
</li>
<li>Since C++ 23, ranges-related methods are added<ul>
<li><code>.assign_range(Range)</code></li>
<li><code>insert_range(const_iterator pos, Range)</code></li>
<li><code>append_range(Range)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Iterator-Invalidation"><a href="#Iterator-Invalidation" class="headerlink" title="Iterator Invalidation"></a>Iterator Invalidation</h4><ul>
<li><p>迭代器就是指针的包装，但是指针是不安全的</p>
</li>
<li><p>导致不安全的情况</p>
<ul>
<li>reallocation 重分配，造成原来保存的指针悬垂</li>
<li>Insertion &amp; removal 插入和删除</li>
</ul>
</li>
<li><p>For vector</p>
<ul>
<li><p>If the capacity changes, all iterators are invalid</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;vector&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>    std::vector{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>};<br>    <span class="hljs-keyword">auto</span> it = v.<span class="hljs-built_in">begin</span>();<br>    v.<span class="hljs-built_in">reserve</span>(<span class="hljs-number">10086</span>); <span class="hljs-comment">// 会导致上一行的 `it` 失效</span><br>    it = v.<span class="hljs-built_in">begin</span>(); <span class="hljs-comment">// 必须进行重新获取</span><br>}<br></code></pre></td></tr></table></figure></li>
<li><p>If the capacity doesn’t change, but some elements are moved, iterators after the changed points are invalid</p>
</li>
</ul>
</li>
</ul>
<h4 id="Span"><a href="#Span" class="headerlink" title="Span"></a>Span</h4><ul>
<li>视图 View means that it doesn’t actually hold the data; it observes the data</li>
<li>Span is a view for contiguous memory (e.g. vector, array, string, C-style array initializer list, etc.)</li>
<li>可以像 array 一样操控 span</li>
<li><code>.first(N)/.last(N)</code></li>
<li><code>.subspan(beginPos(, size))</code></li>
<li>span is just a pointer with a size</li>
</ul>
<h4 id="Dequeue-Double-Ended-Queue- 双端队列"><a href="#Dequeue-Double-Ended-Queue- 双端队列" class="headerlink" title="Dequeue Double-Ended Queue 双端队列"></a>Dequeue Double-Ended Queue 双端队列</h4><ul>
<li>最主要的特点就是<ul>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> on insertion &amp; removal of elements at the front or the back</li>
<li>Random access</li>
</ul>
</li>
<li>Other properties are just like vector<ul>
<li><code>push_front</code></li>
<li><code>emplace_front</code></li>
<li><code>pop_front</code></li>
<li><code>prepend_range</code> C++ 23</li>
</ul>
</li>
<li>Circular queue<ul>
<li>When enqueue, tail moves forward</li>
<li>When dequeue, head moves forward</li>
<li>If <code>tail == head</code> i.e. the queue is full, overwrite the element at head, both tail and head move forward</li>
</ul>
</li>
<li>Dequeue 相当于动态的循环队列，当队列满的时候需要进行扩容<ul>
<li>扩容是做到均摊复杂度是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>可以做到随机访问的原理是 e.g. <code>deque[i]</code> is just <code>vec[(head + i) % size]</code></li>
</ul>
</li>
<li>实现方式<ul>
<li>降低拷贝的代价</li>
<li>通常的实现方式是使用动态循环队列（called map），里面的元素是指针<ul>
<li>指针指向一个 block，block 中存储对象</li>
<li>block 的大小是固定的</li>
</ul>
</li>
<li>Dequeue 中的数据结构<ul>
<li>The map and its size</li>
<li>The block size</li>
<li>The global offset of the first element <code>off</code><ul>
<li>We can use <code>off / block_size</code> to know the position of head</li>
</ul>
</li>
<li>Element numbers</li>
</ul>
</li>
<li>重新分配的时候只需要拷贝指针</li>
<li>Map reallocation in dequeue<ul>
<li>假设新加的 block 的大小是<code>count</code></li>
<li>需要使得循环队列仍然是连续的<ul>
<li>First, copy all elements from <code>vec[head, vecEnd]</code> to <code>newVec[head, currEnd]</code></li>
<li>Then, if <code>head &lt;= count</code>, copy <code>[0, head)</code> to <code>[currEnd, ...)</code></li>
<li>Else, copy after <code>currEnd</code> as mush as possible, and the rest is arranged to the <code>newVecBegin</code></li>
<li>Finally, set all the rest to <code>nullptr</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Dequeue iterator invalidation<ul>
<li>All iterators are seen as invalid after insertion 插入之后所有的迭代器都是失效的，还包括<ul>
<li><code>resize</code></li>
<li><code>shrink_to_fit</code></li>
<li><code>clear</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><ul>
<li>Double linked list</li>
<li>Properties<ul>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> insertion and removal</li>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> splice 融合另一个 list 的一部分元素</li>
<li>不支持随机访问</li>
</ul>
</li>
<li>每个节点都已一个数据 <code>T data</code>、<code>prev</code>、<code>next</code>，并且第一个节点的<code>prev</code> 指向 <code>nullptr</code>，最后一个节点的<code>next</code> 指向<code>nullptr</code></li>
<li>微软用循环 list 实现的<ul>
<li>引入了哨兵节点 sentinel node，是 <code>prev</code> 指针的前一个节点，<code>next</code>指针的后一个节点</li>
<li>不需要特判 nullptr`</li>
</ul>
</li>
<li>There are two methods to move nodes from another list<ul>
<li>和 <code>insert(pos, it1, it2)</code> 有区别，<code>insert</code>只是拷贝，没有清除操作</li>
<li><code>.merge(list2)/.merge(list2, cmp)</code>，通常用在已排序的 list 中</li>
<li><code>.splice(pos, list2, ...)</code><ul>
<li><code>()</code>: insert the total <code>list2</code> to pos</li>
<li><code>(it2)</code>: insert <code>it2</code> to <code>pos</code> (and remove it from <code>list2</code>)</li>
<li><code>(first, last)</code>: insert <code>[first, last)</code> to <code>pos</code> (abd remove them from <code>list2</code>)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Froward-list"><a href="#Froward-list" class="headerlink" title="Froward list"></a>Froward list</h4><ul>
<li>Single linked list</li>
<li>Forward list 的目的是为了减少存储空间，所以不提供 <code>.size()</code> 函数</li>
<li>只存储头部节点</li>
</ul>
<h3 id="Container-adaptors"><a href="#Container-adaptors" class="headerlink" title="Container adaptors"></a>Container adaptors</h3><ul>
<li>容器适配器是对已经存在的容器进行包装，通常情况下不提供迭代器</li>
</ul>
<h4 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h4><ul>
<li>Stack is a LIFO data structure</li>
<li>The provide container show have <code>push_back</code>, <code>emplace_back</code>, <code>pop_back</code>, so vector, deque and list are all OK</li>
<li>APIs<ul>
<li><code>.pop()</code></li>
<li><code>.push(val)</code>, <code>.emplace(params)</code></li>
<li><code>.push_range(params)</code> C++ 23</li>
<li><code>.top()</code></li>
<li><code>.empty()</code>, <code>.size()</code></li>
<li><code>.swap(s2)</code></li>
<li><code>operator=</code></li>
<li><code>operator&lt;=&gt;</code></li>
</ul>
</li>
</ul>
<h3 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h3><ul>
<li>Queue is a FIFO data structure</li>
<li><code>.front()</code></li>
<li><code>.end()</code></li>
</ul>
<h4 id="Priority-queue"><a href="#Priority-queue" class="headerlink" title="Priority queue"></a>Priority queue</h4><ul>
<li>It’s defined in <code>&lt;queue&gt;</code></li>
<li>It’s in fact max heap<ul>
<li>插入或者弹出元素的时间复杂度是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.167ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 3610 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1152,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(2621,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(3221,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>建堆的时间复杂度是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>Percolation is the core algorithm<ul>
<li>插入的时候进行上滤 percolate up</li>
<li>删除的时候进行下滤 percolate down</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Flat-containers"><a href="#Flat-containers" class="headerlink" title="Flat containers"></a>Flat containers</h4><ul>
<li>The only defect of map/unordered_map/… is that they’re really cache-unfriendly</li>
<li>Flat containers 对缓存利用率更高<ul>
<li>The functionality is same as set/map</li>
<li>But it’s in fact an ordered “vector”<ul>
<li>没有冗余的数据，对 cache 更友好</li>
<li>本质上是两个 “vector”</li>
</ul>
</li>
</ul>
</li>
<li>The whole definition is <code>std::flat_map&lt;Key, Value, Compare = std::less&lt;Key&gt;, ContainerForKey = std::vector&lt;Key&gt;, ContainerForValue = std::vector&lt;Value&gt;&gt;</code></li>
<li>也可以使用 deque 作为容器</li>
<li>The complexity<ul>
<li>For lookup, <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.819ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 3898 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1152,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(2621,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(3509,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> 二分查找</li>
<li>For insertion/removal, <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>For <code>iterator++</code>, <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
</li>
</ul>
<h3 id="Associative-containers"><a href="#Associative-containers" class="headerlink" title="Associative containers"></a>Associative containers</h3><ul>
<li>They’re called associative because they associate key with value<ul>
<li>The value can also be omitted</li>
</ul>
</li>
<li>There exist ordered one and unordered one<ul>
<li>有序的需要比较函数 less than<ul>
<li>BBST (balanced binary search tree) 查找、插入、删除的时间复杂度都是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="7.538ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 3332 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"/></g><g data-mml-node="mo" transform="translate(485,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(874,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(2343,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(2943,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container><ul>
<li>RB tree</li>
<li>AVL</li>
</ul>
</li>
</ul>
</li>
<li>无序的需要提供哈希函数和判断是否相等的函数<ul>
<li>查找、插入、删除的时间复杂度都是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="3.989ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 1763 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"/></g><g data-mml-node="mo" transform="translate(485,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(874,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1374,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><ul>
<li>The key is unique; a single key cannot be mapped to multiple values</li>
<li><code>std::map&lt;Key, Value, CMPForKey = std::less&lt;Key&gt;&gt;</code><ul>
<li>默认是小于号</li>
<li><code>CMPForKey</code> should be able to accept <code>const key</code></li>
</ul>
</li>
<li>For member accessing<ul>
<li><code>operator[]</code>, <code>at()</code></li>
<li>Bidirectional iterators<ul>
<li>Notice that the worst complexity of <code>++/--</code> is <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.819ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 3898 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1152,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(2621,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(3509,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>对 BBST 进行中序遍历就能得到有序的序列<ul>
<li><code>.begin()</code> is just the leftmost node and <code>.rbegin()</code> is just the rightmost node</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Note<ul>
<li><code>operator[]</code> will insert a default-constructed value if the key doesn’t exits<ul>
<li>如果 key 不存在并且默认构造的值也不是真正需要的，用 <code>insert_xxx</code> 效率更高</li>
<li><code>const map</code>不能用<code>operator[]</code></li>
<li>如果 value 是不能被默认构造的（例如没有默认构造函数）也是不能用<code>operator[]</code></li>
</ul>
</li>
<li>Key-value pair is stored in RB tree, so iterator also points to the pair</li>
<li>You can use structured binding to facilitate iteration</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs C++">std::map&lt;string::string, <span class="hljs-type">int</span>&gt; scoreTable{<br>    {<span class="hljs-string">"Li"</span>, <span class="hljs-number">99</span> },<br>    {<span class="hljs-string">"God Liu"</span>, <span class="hljs-number">99</span> },<br>    {<span class="hljs-string">"Saint Liu"</span>, <span class="hljs-number">99</span> },<br>    {<span class="hljs-string">"Liang"</span>, <span class="hljs-number">99</span> },<br>};<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; [name, score] : scoreTable)<br>    std::cout &lt;&lt; name &lt;&lt; <span class="hljs-string">''</span> &lt;&lt; score &lt;&lt; <span class="hljs-string">'\n'</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>APIs</p>
<ul>
<li><p><code>.lower_bound(key)</code>: find <code>it</code> that <code>prev(it)-&gt;key &lt; key &lt;= it-&gt;key</code></p>
<ul>
<li>Use key as a lower bound to make <code>[it, end) &gt;= key</code></li>
</ul>
</li>
<li><p><code>.lower_bound(key)</code>: find <code>it</code> that <code>prev(it)-&gt;key &lt;= key &lt; it-&gt;key</code></p>
<ul>
<li>Use key as a lower bound to make <code>[begin, it) &lt;= key</code></li>
</ul>
</li>
<li><p><code>.equal_range(key)</code>: find <code>it</code> pair with the same key as <code>key</code> in range</p>
</li>
<li><p>Insertion</p>
<ul>
<li><p>因为键是唯一的，插入的时候如果 key 存在会失败；无论失败成功都返回<code>pair&lt;iterator, bool&gt;</code></p>
<ul>
<li>If succeed, <code>iterator</code> refers to inserted element and <code>bool</code> is <code>true</code></li>
<li>If fail, <code>iterator</code> refers to the element with the same key and <code>bool</code> is false`</li>
</ul>
</li>
<li><p>插入失败会有多个处理方式</p>
<ul>
<li>Leave it unchanged<ul>
<li><code>.insert({key, value})</code></li>
<li><code>.emplace(params)</code></li>
</ul>
</li>
<li>Overwrite it (C++ 17)<ul>
<li><code>.insert_or_assign(key, value)</code>: return <code>pair&lt;iterator, bool&gt;</code></li>
</ul>
</li>
<li>Leave it unchanged and even not construct the inserted value (C++ 17)<ul>
<li><code>.try_emplace(key, params)</code>: same as <code>emplace</code>, except that the params are used to construct value, and <code>emplace</code> is not forbidden to construct the pair in failure 构造 value 非常昂贵的时候使用</li>
</ul>
</li>
</ul>
</li>
<li><p>You can also provide a hint iterator for insertion</p>
<ul>
<li><p>hint iterator 在被插入元素后面的时候会有效率提升，在前面的话会使效率降低</p>
</li>
<li><p>Hint is often used in idiom blow</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">auto</span> pLoc = someMap.<span class="hljs-built_in">lower_bound</span>(someKey);<br><span class="hljs-keyword">if</span> (pLoc != someMap.<span class="hljs-built_in">end</span>() &amp;&amp; !(someMap.<span class="hljs-built_in">Key_comp</span>()(someKey, pLoc-&gt;first)))<br>    <span class="hljs-keyword">return</span> pLoc-&gt;second;<br><span class="hljs-keyword">else</span> {<br>    <span class="hljs-keyword">auto</span> newValue = <span class="hljs-built_in">expensiveCalculation</span>();<br>    someMap.<span class="hljs-built_in">insert</span>(pLoc, <span class="hljs-built_in">make_pair</span>(someKey, <span class="hljs-keyword">new</span> Value));<br>    <span class="hljs-keyword">return</span> newValue;<br>}<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>Erasure</p>
<ul>
<li><code>.erase(...)</code><ul>
<li><code>(key)</code></li>
<li><code>(iterator pos)</code></li>
<li><code>(iterator first, iterator last)</code></li>
</ul>
</li>
</ul>
</li>
<li><p><code>.extract(key)</code>, <code>extract(iterator pos)</code>: extract out the node from the map</p>
</li>
<li><p><code>.insert(node_type&amp;&amp;)</code>: insert the node to the map</p>
</li>
<li><p><code>.merge(another map/multimap)</code></p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Structured binding</strong></p>
<ul>
<li><p>Structured binding is just <code>auto&amp; [...]{xx}</code></p>
<ul>
<li><p><code>{xx}</code> can be <code>(xx)</code> or <code>=xx</code></p>
</li>
<li><p><code>auto&amp;</code> can be anything</p>
</li>
<li><p><code>xx</code> can be a pair; it can also be</p>
<ul>
<li>An object with all public data members, which will be bound on them</li>
<li>A C-style array or <code>std::array</code>, which will be bound on elements <code>arr[i]</code></li>
<li>A tuple-like thing, which will be bound on every element</li>
</ul>
</li>
<li><p>Note</p>
<ul>
<li><p>pair and <code>std::array</code> is also somewhat tuple-like thing and can use some tuple methods, e.g. <code>std::get</code> pair 和 <code>std::array</code> 也可以像 tuple 一样，访问的时候也可以使用访问 tuple 的方法</p>
</li>
<li><p>结构化绑定时一个新的声明，不能绑定已经存在的变量，如果想绑定已存在的变量可以使用<code>std::tie(name, score) = pair</code></p>
</li>
<li><p>结构化绑定的本质是匿名结构体，结构体中的变量是别名</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs C++">std::tuple&lt;<span class="hljs-type">int</span>, <span class="hljs-type">float</span>&gt; a{<span class="hljs-number">1</span>, <span class="hljs-number">1.0f</span> };<br><span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; [b, c] = a;<br><span class="hljs-keyword">decltype</span>(b) m = <span class="hljs-number">0</span>; <span class="hljs-comment">// const int m  = 0;</span><br></code></pre></td></tr></table></figure></li>
<li><p>Structured binding is usually more efficient than novice/careless programmers 建议使用结构化绑定</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Tuple</strong></p>
<ul>
<li><code>std::tuple&lt;int, float, double&gt; t{1, 2.0f, 3.0};</code></li>
<li>It can only be accessed by an index that can be determined in compile time 下标访问的下标只能在编译时确定<ul>
<li><code>std::get&lt;0&gt;(tuple)</code> to get the <code>int 1</code></li>
<li>C++ 14 可以使用类型获取相应的值，前提是类型不能重复 e.g. <code>std::get&lt;int&gt;(tuple)</code></li>
<li><code>std::tuple_cat</code></li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><ul>
<li>Set is just a map without value</li>
<li>The only difference with amp is that it doesn’t have <code>operator[]</code> and <code>.at()</code></li>
<li>The iterator points to only key instead of key-value pair</li>
</ul>
<h4 id="Multimap"><a href="#Multimap" class="headerlink" title="Multimap"></a>Multimap</h4><ul>
<li>把 key 的唯一性取消了</li>
<li>不能使用 <code>operator[]</code> 和<code>.at()</code></li>
<li>相等的值的顺序取决于插入时的顺序</li>
<li>插入永远都是成功的</li>
<li>Nodes of multimap and map can be exchanged 两个容器的节点是可以相互替换的</li>
</ul>
<h4 id="Multiset"><a href="#Multiset" class="headerlink" title="Multiset"></a>Multiset</h4><ul>
<li>Except for only key and no value, same as multimap</li>
<li>You can also exchange nodes of multiset and set</li>
</ul>
<h4 id="Unordered-map"><a href="#Unordered-map" class="headerlink" title="Unordered map"></a>Unordered map</h4><ul>
<li><code>std::unordered_map&lt;Key, Value, Hash = std::hash&lt;key&gt;, Equal = std::equal_to&lt;Key&gt;&gt;</code></li>
<li>Many types have <code>std::hash&lt;Type&gt;</code>, e.g. <code>std::string</code>, <code>float</code>, etc.</li>
<li>The hash value of different keys may be same, so we need <code>Equal</code> to judge which key is wanted</li>
<li>微软的实现在解决冲突的时候用双向链表，并且链接相邻的 Bucket 延申出来的双向链表，并添加一个哨兵节点</li>
<li>当插入数据太多的时候，每个 bucket 也会链接很多数据<ul>
<li>这样会增加查找的复杂度</li>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.798ex;" xmlns="http://www.w3.org/2000/svg" width="9.174ex" height="2.76ex" role="img" focusable="false" viewbox="0 -867.1 4054.7 1219.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mtext" transform="translate(1475.8,394) scale(0.707)"><path data-c="73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z"/><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z" transform="translate(394,0)"/><path data-c="7A" d="M42 263Q44 270 48 345T53 423V431H393Q399 425 399 415Q399 403 398 402L381 378Q364 355 331 309T265 220L134 41L182 40H206Q254 40 283 46T331 77Q352 105 359 185L361 201Q361 202 381 202H401V196Q401 195 393 103T384 6V0H209L34 1L31 3Q28 8 28 17Q28 30 29 31T160 210T294 394H236Q169 393 152 388Q127 382 113 367Q89 344 82 264V255H42V263Z" transform="translate(672,0)"/><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z" transform="translate(1116,0)"/></g><g data-mml-node="mtext" transform="translate(220,-345) scale(0.707)"><path data-c="62" d="M307 -11Q234 -11 168 55L158 37Q156 34 153 28T147 17T143 10L138 1L118 0H98V298Q98 599 97 603Q94 622 83 628T38 637H20V660Q20 683 22 683L32 684Q42 685 61 686T98 688Q115 689 135 690T165 693T176 694H179V543Q179 391 180 391L183 394Q186 397 192 401T207 411T228 421T254 431T286 439T323 442Q401 442 461 379T522 216Q522 115 458 52T307 -11ZM182 98Q182 97 187 90T196 79T206 67T218 55T233 44T250 35T271 29T295 26Q330 26 363 46T412 113Q424 148 424 212Q424 287 412 323Q385 405 300 405Q270 405 239 390T188 347L182 339V98Z"/><path data-c="75" d="M383 58Q327 -10 256 -10H249Q124 -10 105 89Q104 96 103 226Q102 335 102 348T96 369Q86 385 36 385H25V408Q25 431 27 431L38 432Q48 433 67 434T105 436Q122 437 142 438T172 441T184 442H187V261Q188 77 190 64Q193 49 204 40Q224 26 264 26Q290 26 311 35T343 58T363 90T375 120T379 144Q379 145 379 161T380 201T380 248V315Q380 361 370 372T320 385H302V431Q304 431 378 436T457 442H464V264Q464 84 465 81Q468 61 479 55T524 46H542V0Q540 0 467 -5T390 -11H383V58Z" transform="translate(556,0)"/><path data-c="63" d="M370 305T349 305T313 320T297 358Q297 381 312 396Q317 401 317 402T307 404Q281 408 258 408Q209 408 178 376Q131 329 131 219Q131 137 162 90Q203 29 272 29Q313 29 338 55T374 117Q376 125 379 127T395 129H409Q415 123 415 120Q415 116 411 104T395 71T366 33T318 2T249 -11Q163 -11 99 53T34 214Q34 318 99 383T250 448T370 421T404 357Q404 334 387 320Z" transform="translate(1112,0)"/><path data-c="6B" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T97 124T98 167T98 217T98 272T98 329Q98 366 98 407T98 482T98 542T97 586T97 603Q94 622 83 628T38 637H20V660Q20 683 22 683L32 684Q42 685 61 686T98 688Q115 689 135 690T165 693T176 694H179V463L180 233L240 287Q300 341 304 347Q310 356 310 364Q310 383 289 385H284V431H293Q308 428 412 428Q475 428 484 431H489V385H476Q407 380 360 341Q286 278 286 274Q286 273 349 181T420 79Q434 60 451 53T500 46H511V0H505Q496 3 418 3Q322 3 307 0H299V46H306Q330 48 330 65Q330 72 326 79Q323 84 276 153T228 222L176 176V120V84Q176 65 178 59T189 49Q210 46 238 46H254V0H246Q231 3 137 3T28 0H20V46H36Z" transform="translate(1556,0)"/><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z" transform="translate(2084,0)"/><path data-c="74" d="M27 422Q80 426 109 478T141 600V615H181V431H316V385H181V241Q182 116 182 100T189 68Q203 29 238 29Q282 29 292 100Q293 108 293 146V181H333V146V134Q333 57 291 17Q264 -10 221 -10Q187 -10 162 2T124 33T105 68T98 100Q97 107 97 248V385H18V422H27Z" transform="translate(2528,0)"/><path data-c="20" d=""transform="translate(2917,0)"/><path data-c="6E"d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"transform="translate(3167,0)"/><path data-c="75"d="M383 58Q327 -10 256 -10H249Q124 -10 105 89Q104 96 103 226Q102 335 102 348T96 369Q86 385 36 385H25V408Q25 431 27 431L38 432Q48 433 67 434T105 436Q122 437 142 438T172 441T184 442H187V261Q188 77 190 64Q193 49 204 40Q224 26 264 26Q290 26 311 35T343 58T363 90T375 120T379 144Q379 145 379 161T380 201T380 248V315Q380 361 370 372T320 385H302V431Q304 431 378 436T457 442H464V264Q464 84 465 81Q468 61 479 55T524 46H542V0Q540 0 467 -5T390 -11H383V58Z"transform="translate(3723,0)"/><path data-c="6D"d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"transform="translate(4279,0)"/></g><rect width="3814.7"height="60"x="120"y="220"/></g></g></g></svg></mjx-container> is called load factor 装载因子</li>
<li>装载因子过大时，需要对 bucket array 进行扩容</li>
<li>Rehash 重哈希</li>
</ul>
</li>
<li>APIs<ul>
<li><code>.bucket_count()</code>: size of bucket array</li>
<li><code>.load_factor()</code>: <code>size() / bucket_count()</code></li>
<li><code>.max_load_factor()</code>: when load factor exceeds this limit, refresh will happen</li>
<li><code>.rehash(n)</code>: make <code>bucket_count() = max(n, ceil(size() / max_load_factor()))</code> and rehash</li>
<li><code>.reserve(n)</code></li>
<li><code>.bucket(key)</code>: get the bucket index of the key</li>
<li><code>.begin(index)</code>, <code>.cbegin(index)</code>, <code>.end(index)</code>, <code>.cend(index)</code>: get the iterator of the bucket at index</li>
<li><code>.bucket_size(index)</code>: get the size of bucket at index</li>
</ul>
</li>
<li>You can also extract nodes and insert them</li>
</ul>
<h2 id="Ranges"><a href="#Ranges" class="headerlink" title="Ranges"></a>Ranges</h2><ul>
<li><p>Using ranges is very like functional programming</p>
</li>
<li><p>There are three important components in ranges:</p>
<ul>
<li>Range: A type provides a begin iterator and end sentinel, so that it can be iterated over</li>
<li>View: A range that can be moved in <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>, copied in <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> (or cannot be copied) and destructed in <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>Range adaptor</li>
</ul>
</li>
<li><p>Note</p>
<ul>
<li>Range 可以按照迭代器进行分类</li>
<li>计算是惰性计算</li>
</ul>
</li>
<li><p>They’re all defined in <code>&lt;range&gt;</code>; all views are defines as <code>std::ranges::xx_view</code>, and all range adaptors are defined as <code>std::views::xx</code></p>
<ul>
<li>一般用别名来简化定义 <code>namespace stdr = std::ranges</code> 和<code>namespace stdv = std::views</code></li>
<li><code>stdr::iota_view{lower, upper = INF}</code>, <code>stdv::iota(lower, upper = INF)</code>: 和 python 中的 <code>range(a, b)</code> 类似</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span> oddNum : stdv::<span class="hljs-built_in">iota</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<br>  | stdv::<span class="hljs-built_in">filter</span>([](<span class="hljs-type">int</span> num) {<span class="hljs-keyword">return</span> num % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>; })<br>  | stdv::<span class="hljs-built_in">take</span>(<span class="hljs-number">3</span>))<br>{<br>    std::cout &lt;&lt; oddNum &lt;&lt; <span class="hljs-string">'';</span><br><span class="hljs-string">}</span><br></code></pre></td></tr></table></figure></li>
<li><p>Writable</p>
<ul>
<li><code>stdv::filter(Pred)</code>: drop the element if the predicate function <code>Pred</code> returns <code>false</code></li>
<li><code>stdv::take(x)</code>: take first <code>x</code> elements (but not exceed <code>end</code>)</li>
<li><code>stdv::take_while(Pred)</code>: take elements until <code>Pred</code> return <code>false</code> (or <code>end</code>)</li>
<li><code>stdv::drop(x)</code>: drop first <code>x</code> elements</li>
<li><code>stdv::drop_while(Pred)</code>: drop elements until <code>Pred</code> returns <code>false</code></li>
<li><code>stdv::reverse</code></li>
<li><code>stdv::keys</code>: get the first element from a tuple-like thing</li>
<li><code>stdv::values</code></li>
<li><code>stdv::elements&lt;i&gt;</code>: get the <code>i</code>th element from a tuple-like thing</li>
<li><code>stdv::stride(k)</code>: use <code>k</code> as stride to iterate<ul>
<li>e.g. <code>stdv::iota(1, 0) | stdv::stride(2)</code> gets <code>{1, 3, 5, 7, 9}</code></li>
</ul>
</li>
<li><code>stdv::join</code>: flattens the ranges to a single range 需要用 <code>|</code> 连接</li>
<li><code>stdv::join_with(xx)</code>: fill the interval with <code>xx</code> 需要用 <code>|</code> 连接</li>
<li><code>stdv::zip(r1, r2, ...)</code>: zip values from ranges to a tuple</li>
<li><code>stdv::cartesian_product(r1, r2, ...)</code>: return a tuple of elements from the cartesian product of these ranges</li>
<li><code>stdv::enumerate</code>: return <code>std::tuple&lt;Integer, T&amp;&gt;</code>; Integer is index whose tpe is diff type of iterator</li>
<li><code>stdv::slide(width)</code>: slide the range in a sliding window of <code>width</code><ul>
<li>e.g. <code>std::vector v{1, 2, 3, 4, 5}; v | stdv::slide(3)</code> gets <code>{{1, 2, 3}, {2, 3, 4}, {3, 4, 5}}</code></li>
</ul>
</li>
<li><code>stdv::adjacent&lt;width&gt;</code>: same as <code>stdv::slide(width)</code></li>
<li><code>stdv::pairwise</code>: i.e. stdv::adjacent&lt;2&gt;</li>
<li><code>stdv::chunk(width)</code>: partition the range by <code>width</code></li>
<li><code>stdv::chunk_by(pred2)</code>: partition the range by <code>pred2</code>, i.e. a view sill stop when <code>pred2(*it, *next(it))</code> return <code>false</code></li>
<li><code>stdv::split(xx)</code></li>
<li><code>stdv::lazy_split(xx)</code></li>
</ul>
</li>
<li><p>Read-only</p>
<ul>
<li><p>Either make the view const, i.e. <code>std::as_const</code>; this will return <code>const T&amp;</code> or <code>tuple&lt;const T&amp;, ...&gt;</code></p>
</li>
<li><p>Or return value, i.e. transform-related, which will return <code>T</code> or <code>tuple&lt;T, ...&gt;</code></p>
<ul>
<li><p><code>stdv::zip_transform(TransformN, r1, r2, ...)</code>: return a view of <code>TransformN(ele1, ele2, ...)</code></p>
</li>
<li><p><code>stdv::adjacent_transform&lt;N&gt;(TransformN)</code>: return a view of <code>TransformN(...)</code>, where <code>...</code> is the elements of the sliding windows</p>
</li>
<li><p><code>stdv::transform(Transform)</code>: transform element to another element</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs C++">std::vector&lt;<span class="hljs-type">int</span>&gt; v{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span> };<br><span class="hljs-type">int</span> cnt = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">auto</span> r = v | stdv::<span class="hljs-built_in">transform</span>([&amp;cnt](<span class="hljs-type">const</span> <span class="hljs-type">int</span> ele) {<br>    std::cout &lt;&lt; std::format(<span class="hljs-string">"cnt={}, ele={}\n"</span>, cnt, ele);<br>    cnt++;<br>    <span class="hljs-keyword">return</span> cnt + ele;<br>}) | stdv::<span class="hljs-built_in">take_while</span>([](<span class="hljs-type">const</span> <span class="hljs-type">int</span> ele) {<span class="hljs-keyword">return</span> ele &lt; <span class="hljs-number">10</span>; });<br><span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; i : r);<br><span class="hljs-comment">// output:</span><br><span class="hljs-comment">// cnt=0, ele=1</span><br><span class="hljs-comment">// cnt=1, ele=1</span><br><span class="hljs-comment">// cnt=2, ele=2</span><br><span class="hljs-comment">// cnt=3, ele=2</span><br><span class="hljs-comment">// cnt=4, ele=3</span><br><span class="hljs-comment">// cnt=5, ele=3</span><br><span class="hljs-comment">// cnt=6, ele=4</span><br></code></pre></td></tr></table></figure>

<ul>
<li><code>++</code> will trigger transform since <code>take_while</code> needs the transformed value to advance the iterator (i.e. by <code>Pred(*it)</code>)</li>
<li><code>const auto&amp; ele = *it</code> will trigger it again</li>
<li>That’s because the result doesn’t reference some existing elements, but generate from temporary; every time you need it, lazy evaluation generate it again 太 lazy 了</li>
<li>Sometimes, you may want to convert a range to a e.g. container, which needs to eagerly evaluate all<ul>
<li><code>stdr::to</code>, e.g. <code>stdr::to&lt;std::vector&gt;()</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>There are also some naïve range factories</p>
<ul>
<li><code>stdv::single(obj)</code>: make a view that copies/moves an object, i.e. the view owns only a single element</li>
<li><code>stdv::empty&lt;T&gt;</code>: create an empty view</li>
<li><code>stdv::repeat(r, k = INF)</code>: repeat a range <code>r</code> for <code>k</code> times, i.e. like a range <code>[r, r, r, ...]</code></li>
<li><code>stdv::istream&lt;xxx&gt;(stream)</code>: similar to <code>istream_iterator</code>; it caches value</li>
<li><code>stdr::subrange(first, last)</code></li>
</ul>
</li>
</ul>
<h2 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">end</span>):<br>    begin = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> begin != end:<br>        <span class="hljs-keyword">yield</span> begin<br>        begin += <span class="hljs-number">1</span><br><br>generator = func(<span class="hljs-number">10</span>)<br><span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> generator:<br>    <span class="hljs-built_in">print</span>(num)<br></code></pre></td></tr></table></figure>

<p>When the function reaches <code>yield</code>, it will pause and <code>return</code> the number; when iterator moves forward, the function will resume and continue to execute until the next <code>yield</code> or real <code>return</code></p>
<ul>
<li>Since C++ 23, generator is also supported by <strong>coroutine</strong><ul>
<li>Coroutines <strong>cooperates</strong> with each other and yield their execution flow themselves 协程之间是相互配合的控制流<ul>
<li>By contrast, for threads, they usually compete with each other and are interrupted by OS to give other threads chances to execute 线程则是抢占式的</li>
</ul>
</li>
</ul>
</li>
<li>Generator is just the same; when you need the next value , you just yield your execution flow to the generator function; when the generator function completes its task, it will give back the right of execution</li>
<li>Generator is also an <code>input_range</code> and view; it provides <code>begin()</code> and <code>end()</code> to iterate, and <code>++</code> the iterator will resume the function<ul>
<li>NOTICE: Call <code>.begin()</code> will start the coroutine</li>
</ul>
</li>
</ul>
<p>e.g.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">std::generator&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-type">int</span> end)</span></span><br><span class="hljs-function"></span>{<br>    std::cout &lt;&lt; <span class="hljs-string">"Ahh..."</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> begin = <span class="hljs-number">0</span>; begin &lt; end; begin++)<br>        <span class="hljs-keyword">co_yield</span> begin;<br>    <span class="hljs-keyword">co_return</span>;<br>}<br><span class="hljs-keyword">auto</span> generator = <span class="hljs-built_in">func</span>(<span class="hljs-number">3</span>);<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> it = generator.<span class="hljs-built_in">begin</span>(); it != generator.<span class="hljs-built_in">end</span>(); it++)<br>    std::cout &lt;&lt; *it;<br><span class="hljs-comment">// or</span><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; num : generator)<br>    std::cout &lt;&lt; num;<br></code></pre></td></tr></table></figure>

<ul>
<li>Some notes<ul>
<li>One generator can only be used once 只能使用一次</li>
<li>Generator has <code>operator=</code></li>
<li><code>co_return</code> can be omitted</li>
<li>Saving contexts also needs memory, so an allocator can also be provided as the last template parameter</li>
</ul>
</li>
</ul>
<h2 id="Function- 函数"><a href="#Function- 函数" class="headerlink" title="Function 函数"></a>Function 函数</h2><h3 id="Pointer-to-member-functions"><a href="#Pointer-to-member-functions" class="headerlink" title="Pointer to member functions"></a>Pointer to member functions</h3><ul>
<li>Member functions can be static or non-static<ul>
<li>Static ones are just normal functions with some <code>Class::</code>, their pointers are same as normal ones</li>
<li>Non-static ones are always bound to some specific objects, i.e. there is a <code>this</code> pointer as a parameter</li>
</ul>
</li>
</ul>
<p>e.g.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span><br>{<br>    <span class="hljs-keyword">public</span>: <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">AddAge</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> n)</span> </span>{<br>        age += n;<br>    }<br>}<br><br><span class="hljs-keyword">using</span> FuncPtr = <span class="hljs-built_in">void</span> (Person::*)(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>);<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>    Person p{<span class="hljs-number">0</span> }, *pointer = &amp;p;<br>    FuncPtr ptr = &amp;Person::AddAge;<br>    (p.*ptr)(<span class="hljs-number">5</span>);<br>    (pointer-&gt;*ptr)(<span class="hljs-number">5</span>);<br><br>    <span class="hljs-comment">// C++ 17</span><br>    std::<span class="hljs-built_in">invoke</span>(ptr, p, <span class="hljs-number">5</span>);<br>    std::<span class="hljs-built_in">invoke</span>(ptr, pointer, <span class="hljs-number">5</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></table></figure>

<ul>
<li>Define a pointer to member function is <code>Ret (Class::*)(params)</code></li>
<li><code>std::invoke</code> define in <code>&lt;functional&gt;</code> since C++ 17</li>
<li>Since C++ 23, <code>std::invoke_r&lt;Result&gt;</code> is provided</li>
</ul>
<h3 id="Callable-parameter"><a href="#Callable-parameter" class="headerlink" title="Callable parameter"></a>Callable parameter</h3><h4 id="Function-as-parameter"><a href="#Function-as-parameter" class="headerlink" title="Function as parameter"></a>Function as parameter</h4><ul>
<li>函数指针也可以实现将函数视为参数来传递，但是有两个问题<ul>
<li>有时候函数指针的参数类型有严格的限制，例如 <code>int</code> can be converted to <code>double</code>, <code>func(double)</code> is also acceptable</li>
<li>In C++, usually what you need is just “something callable”, i.e. a functor is allowed 有时候只是想传入一个可调用的类型</li>
</ul>
</li>
<li>有两种方式解决<ul>
<li>Use a template parameter <code>&lt;algorithm&gt;</code>常用的方法采用模板参数接受可调用的参数</li>
<li>Use a <code>std::function</code> defined in <code>&lt;functional&gt;</code><ul>
<li><code>std::function&lt;RetType(Args...)&gt;</code> can adopt almost all callable that have the return type <strong>convertible</strong> to <code>RetType</code> and accept <code>Args</code></li>
<li>The member function even preserves polymorphism</li>
<li>After getting the <code>std::function</code>, you can just use <code>operator()</code> to call it</li>
<li>Even more powerful, you can bind some parameters to get new functors<ul>
<li>E.g. you can use <code>std::bind(any_callable, params)</code> to get a <code>std::function</code> <code>std::bind</code>已经没有用了，完全可以用 Lambda 表达式绑定</li>
</ul>
</li>
<li>There are two defects<ul>
<li>Performance: It roughly causes 10% - 20% performance loss compared with direct function call<ul>
<li>有可能会用 <code>new</code>/<code>delete</code> 自定义<code>ctor</code>/<code>dtor</code></li>
<li>解决方式是使用 SOO(small object optimization)，在栈上准备一块小的 buffer 用于分配函数空间</li>
<li>如果绑定的 Lambda 表达是太大可以使用 <code>auto lambda = xx;</code>，然后再通过<code>std::ref(lambda)</code> 传给 <code>std::function</code> 的构造函数（但是要注意声明周期），但是不可以使用<code>std::ref(&amp;&amp;xx)(){...}</code>，lambda 表达式会立马失效</li>
</ul>
</li>
<li>The second defect of <code>std::function</code> is that it cannot really accept all functors 并不是支持所有的可调用类型<ul>
<li>When the functor is not copiable (e.g. move-only, like <code>std::unique_ptr</code>) 仿函数不能拷贝的就不能接受<ul>
<li>Thus, since C++ 23, <code>std::move_only_function</code> is introduced</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Reference wrapper<ul>
<li><code>std::(c)ref()</code> in fact create <code>std::reference_wrapper&lt;(const) T&gt;</code>, which can be seen as an instantiated reference<ul>
<li>例如容器中不可能存储引用类型的，如果想储存引用类型可以使用<code>std::vector&lt;std::reference_wrapper&lt;T&gt;&gt;</code></li>
<li>It’s in fact a wrapper of pointer, but it cannot be null, just like reference</li>
<li>Different from reference, it can be bound to another object by <code>operator=</code>, just like pointer 引用是不可以换绑的，但是 <code>std::ref()</code> 可以</li>
</ul>
</li>
<li>It’s also used to denote “it should be a reference” explicitly in some methods in standard library, e.g. <code>std::bind_back</code> or <code>std::bind_front</code></li>
</ul>
</li>
</ul>
</li>
<li>There are also some predefined template functors in <code>&lt;functional&gt;</code><ul>
<li>Arithmetic functors: <code>plus</code>, <code>minus</code>, <code>multiplies</code>, <code>divides</code>, <code>modulus</code>, <code>negate</code></li>
<li>Comparison functors: <code>equal_to</code>, <code>not_equal_to</code>, <code>greater</code>, <code>less</code>, <code>greater_equal</code>, <code>less_equal</code>, <code>compare_three_way</code></li>
<li>Logical functors: <code>logical_and</code>, <code>logical_or</code>, <code>logical_not</code></li>
<li>Bitwise functors: <code>bit_and</code>, <code>bit_or</code>, <code>bit_xor</code>, <code>bit_not</code></li>
<li>These <code>Functor&lt;T&gt;</code> all have <code>auto operator()(const T&amp;, const T&amp;) const</code></li>
</ul>
</li>
</ul>
<h4 id="Lambda-expression"><a href="#Lambda-expression" class="headerlink" title="Lambda expression"></a>Lambda expression</h4><ul>
<li>We call lambda expression without capture <em>stateless lambda</em>; otherwise <em>stateful lambda</em></li>
<li>可以使用 <code>decltype(...)</code> 去推断 lambda 表达式的类型</li>
<li>理论上可以使用推断出来的仿函数的类型进行声明，但是只有再 C++ 20 之后才是合法的<ul>
<li>E.g. <code>auto l = [](int a, int b) {return a + b;}; using T = decltype(l); T l2{};</code></li>
<li>只适用 stateless lambda</li>
</ul>
</li>
</ul>
<h2 id="Algorithms"><a href="#Algorithms" class="headerlink" title="Algorithms"></a>Algorithms</h2><h3 id="Algorithms’-Consist"><a href="#Algorithms’-Consist" class="headerlink" title="Algorithms’ Consist"></a>Algorithms’ Consist</h3><ul>
<li>Iterator pairs 迭代器对，或者直接传入 ranges</li>
<li>Predicate function / transform function 判别函数或者变换函数，通常情况下变换都是<code>const&amp;</code>，或者对于比较小的类型传入拷贝</li>
<li>大部分算法都返回一个范围迭代器</li>
<li>从来都不会改变序列的大小</li>
<li>Callables of algorithm are of value type instead of reference type 判别函数或者变换函数都是传递值类型，不是引用类型</li>
</ul>
<h3 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h3><ul>
<li>两种搜索算法<ul>
<li>Linear search<ul>
<li>Find single value<ul>
<li><code>std::find</code></li>
<li><code>std::find_if</code></li>
</ul>
</li>
<li>Find one of values in a range<ul>
<li><code>std::find_first_of</code></li>
</ul>
</li>
<li>Find a sub-sequence in a sequence (Pattern matching)<ul>
<li><code>std::search</code></li>
<li><code>std::find_end</code></li>
</ul>
</li>
<li>Others<ul>
<li><code>std::adjacent_find(begin, end[, Pred2])</code>: 相邻元素相等的位置</li>
<li><code>std::search_n(begin, end, count, value, [, Pred2])</code></li>
</ul>
</li>
</ul>
</li>
<li>Binary search, which is applied on sorted sequence<ul>
<li><code>std::binary_search</code>: return bool, denoting whether <code>value</code> exists in <code>[begin, end)</code></li>
<li><code>std::lower_bound</code>: return <code>it</code> so that <code>value</code> is the lower bound of <code>[it, end)</code></li>
<li><code>std::upper_bound</code>: return <code>it</code> so that <code>value</code> is the lower upper of <code>[begin, end)</code></li>
<li><code>std::equal_range</code>: return an iterator pair <code>(it1, it2)</code> so that <code>value</code> is equal to <code>[it1, it2)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Comparison"><a href="#Comparison" class="headerlink" title="Comparison"></a>Comparison</h3><ul>
<li><code>std::equal(begin1, end1, ..., [, Pred2])</code>: return a bool</li>
<li><code>std::lexicographical_compare(begin1, end1, begin2, end2[, Pred2])</code>: return bool; Pred2<code>acts as</code>operator&lt;&gt;`<ul>
<li>Compare until <code>ele1 &lt; ele2 || ele2 &lt; ele1</code></li>
</ul>
</li>
<li><code>std::lexicographical_compare_three_way(begin1, end1, begin2, end2[, Pred2])</code>: return an ordering; <code>Pred2</code> acts as <code>operator&lt;=&gt;</code></li>
<li><code>std::mismatch(begin1, end1, ...[, Pred2])</code>:  return an iterator pair <code>(it1, it2)</code> denoting the first occurrence of mismatching</li>
<li>These algorithms are all <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
<h3 id="Counting"><a href="#Counting" class="headerlink" title="Counting"></a>Counting</h3><ul>
<li><code>std::all_of/any_of/none_of(begin, end, Pred)</code></li>
<li><code>std::count(begin, end, value)</code></li>
<li><code>std::count_if(begin, end, Pred)</code></li>
<li>These algorithms are all <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
<h3 id="Generating-and-Transforming"><a href="#Generating-and-Transforming" class="headerlink" title="Generating and Transforming"></a>Generating and Transforming</h3><ul>
<li><code>std::fill(begin, end, value)</code></li>
<li><code>std::fill_n(begin, count, value)</code></li>
<li><code>std::generate(begin, end, Gen)</code>: for each element in <code>[begin, end)</code>, <code>ele = Gen()</code></li>
<li><code>std::for_each(begin, end, Transform)</code>: for each element in <code>[begin, end)</code>, call <code>Transform(ele)</code></li>
<li><code>std::transform</code>: There are unary/binary transforms<ul>
<li><code>(begin, end, dstBegin, Transform)</code>: unary 一元</li>
<li><code>(begin, end, begin2, dstBeing, Transform)</code>: binary, the transformation is <code>Transform(*it1, *it2)</code></li>
</ul>
</li>
</ul>
<h3 id="Modifying"><a href="#Modifying" class="headerlink" title="Modifying"></a>Modifying</h3><ul>
<li><code>std::remove(begin, end, value)/std::remove_if(begin, end, Pred)</code>: return the iterator so that <code>[begin, it)</code> has no element that is equal to <code>value</code> or make <code>Pred</code> return <code>true</code><ul>
<li>不会真的擦除迭代器</li>
<li>Since C++ 20, they’re integrated as methods <code>std::erase/std::erase_if</code></li>
</ul>
</li>
<li><code>std::unique(begin, end[, Pred2])</code>: return the iterator so that <code>[begin, it)</code> has not adjacent equal element; <code>Pred2</code> acts as <code>operator==</code> 使得在 <code>[begin, it)</code> 区间内没有相邻且相等的元素</li>
<li>These algorithms are all <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>, by the technique of dual pointers 算法用双指针实现<ul>
<li>定义两个指针 <code>before</code> 和<code>after</code></li>
<li>两个指针一开始都指向<code>begin</code></li>
<li>先前进<code>after</code></li>
<li>判断 <code>*before == *after</code>；相等只前进<code>after</code>，不相等则前进<code>before</code>，并将<code>after</code> 指向的值和 <code>before</code> 交换，前进<code>after</code></li>
<li>直到<code>after == end</code></li>
<li>需要考虑 <code>begin == end</code> 和整个序列就是 unique 的情况</li>
</ul>
</li>
<li><code>std::replace(begin, end, oldValue, newValue)/std::replace_if(begin, end, Pred, newValue)</code></li>
<li><code>std::swap(x, y)</code></li>
<li><code>std::iter_swap(it1, it2)</code></li>
<li><code>std::swap_range(begin1, end1, begin2)</code></li>
<li><code>std::reverse(begin, end)</code></li>
<li><code>std::rotate(begin, mid, end)</code>: left rotate <code>[begin, mid)</code><ul>
<li>2, 3, 4, 4, 5 -&gt; 4, 5, 2, 3, 4 相当于左移</li>
<li>Rotate is also <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container><ul>
<li>brute-force method: swap each element ot its position (just like bubble sort). This will be <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="11.727ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 5183.4 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mo" transform="translate(1673,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(2062,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(2884.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mi" transform="translate(3884.4,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mo" transform="translate(4405.4,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(4794.4,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> 一个一个的交换，需要两层循环<ul>
<li>可以考虑将第一个元素拿出来，再确定序列中哪一个元素会再下一步出现在第一个位置，然后进行替换，以此类推完成旋转</li>
<li>但是这种方式对 cache 不友好</li>
</ul>
</li>
<li>swap all groups together<ul>
<li>The complexity is <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container><center>
    <img src="/2024/06/03/56ae950785e9/algorithm-modifying-rotate.png" srcset="/img/loading.gif" lazyload alt>
</center></li>
</ul>
</li>
<li>reverse<ul>
<li>In fact, reverse is the basis of many algorithms</li>
<li><code>[begin, mid - 1]``[mid, end - 1]</code></li>
<li>Reverse two sub-sequences, get <code>[mid - 1, being]``[end - 1, mid]</code></li>
<li>Reverse the total sequence, get <code>[mid, end - 1]``[begin, mid - 1]</code></li>
<li>The complexity is <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="23.931ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 10577.3 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1167,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mo" transform="translate(1688,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(2299.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(3299.4,0)"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(4077.4,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(4466.4,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(5288.7,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mi" transform="translate(6288.9,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mo" transform="translate(6809.9,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(7421.1,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(8421.3,0)"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(9199.3,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(9588.3,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(10188.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>std::shift_left/right(begin, end, n)</code>: the dropped elements are permanently dropped (invalid)</li>
</ul>
<h3 id="Copying"><a href="#Copying" class="headerlink" title="Copying"></a>Copying</h3><ul>
<li><code>std::copy(begin1, end1, dstBegin)</code></li>
<li><code>std::copy_if(begin1, end1, dstBegin[, Pred])</code></li>
<li><code>std::copy_n(begin1, n, dstBegin)</code></li>
<li><code>std::copy_backward(begin1, end1, dstBegin)</code></li>
</ul>
<h3 id="Partition-and-Sort"><a href="#Partition-and-Sort" class="headerlink" title="Partition and Sort"></a>Partition and Sort</h3><h4 id="Partition"><a href="#Partition" class="headerlink" title="Partition"></a>Partition</h4><p>Partition denotes that a range is divide into two parts; assuming predicate function <code>Pred</code>, then there exists an iterator <code>it</code> (i.e. partition point 轴点） so that all elements in <code>[begin, it)</code> make <code>Pred</code> return <code>true</code> while <code>[it, end)</code> make <code>Pred</code> return <code>false</code> 左边的都小于轴点（使得 <code>Pred</code> 函数返回 <code>true</code>），右边的都大于轴点（使得<code>Pred</code> 函数返回<code>false</code>）</p>
<ul>
<li><code>std::is_partitioned(begin, end, Pred)</code></li>
<li><code>std::partition(begin, end, Pred)</code></li>
<li><code>std::stable_partition(begin, end, Pred)</code>: each sub-partition preserves the original order 保证 partition 后的结果和原序列的顺序一致<ul>
<li>原序列 <code>{0, 1, 9, 4, 5, 2, 7, 8}</code>, <code>Pred</code>为 <code>[](const int ele) {return ele % 2;}</code> 左边是奇数右边是偶数</li>
<li><code>std::partition</code>: <code>{7, 1, 9, 5, 4, 2, 0, 8}</code></li>
<li><code>std::stable_partition</code>: <code>{1, 9, 5, 7, 0, 4, 2, 8}</code></li>
<li>Implementation:<ul>
<li>When the memory is enough （内存足够）, prepare a buffer; move the <code>false</code> range to the buffer and move the <code>true</code> range to be consecutive (just like preform <code>std::remove_if()</code>, with removed range saved in buffer). Then move the buffer elements back</li>
<li>When the memory is not enough （内存不够）, divide the sequence into two halves and stable partition each half<ul>
<li>This will from <code>[true, false], [true, false]</code> sequence 最终都会变成这样的序列</li>
<li>Rotate the middle <code>[false, true]</code> so that the final result is totally partitioned</li>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.781ex;" xmlns="http://www.w3.org/2000/svg" width="21.777ex" height="2.477ex" role="img" focusable="false" viewbox="0 -750 9625.3 1095"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mo" transform="translate(704,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1093,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1693,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(2359.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mn" transform="translate(3415.6,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(3915.6,0)"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mo" transform="translate(4619.6,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mfrac" transform="translate(5008.6,0)"><g data-mml-node="mi" transform="translate(220,394) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mn" transform="translate(255.4,-345) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><rect width="624.3" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(5872.8,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(6484,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(7484.3,0)"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(8247.3,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(8636.3,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(9236.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>, to it’s overall <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.896ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 3932 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"/></g><g data-mml-node="mo" transform="translate(485,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(874,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1474,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(2943,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(3543,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>std::partition_point(begin, end, Pred)</code>: assume the range is a partition 前提是序列已经是 partition</li>
</ul>
<h4 id="Sort"><a href="#Sort" class="headerlink" title="Sort"></a>Sort</h4><ul>
<li><code>std::is_sorted(begin, end[, Pred2])</code> <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li><code>std::is_sorted_until(begin, end[, Pred2])</code> <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li><code>std::sort(begin, end[, Pred2])</code> <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="10.828ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4786 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2040,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(3509,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(4397,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li><code>std::stable_sort(begin, end[, Pred2])</code><ul>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> space complexity, <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="10.828ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4786 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2040,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(3509,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(4397,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> time complexity</li>
<li>If space is insufficient, <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="13.576ex" height="2.452ex" role="img" focusable="false" viewbox="0 -833.9 6000.6 1083.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2429,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(3898,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="msup" transform="translate(4786,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mn" transform="translate(422,363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g></g><g data-mml-node="mo" transform="translate(5611.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> time complexity</li>
</ul>
</li>
<li>Since <code>std::sort</code> requires the complexity exactly <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="10.828ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4786 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2040,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(3509,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(4397,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>, quick sort is not enough 快排只是平均意义上的<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="10.828ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4786 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2040,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(3509,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(4397,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>，最坏的情况是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="6.606ex" height="2.452ex" role="img" focusable="false" viewbox="0 -833.9 2919.8 1083.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="msup" transform="translate(1152,0)"><g data-mml-node="mi"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mn" transform="translate(975.3,363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g></g><g data-mml-node="mo" transform="translate(2530.8,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>C++ 标准库广泛使用的排序算法是 Introspective Sort(IntroSort)<ul>
<li>It integrates insertion sort, heap sort and quick sort 结合了插入排序，堆排序和快排</li>
<li>When the element number is <strong>low enough</strong>, insertion sort is used</li>
<li>When the recursion is too deep, heap sort is used<ul>
<li>避免快排的最坏情况</li>
<li>堆排序是稳定<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="10.828ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 4786 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2040,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(3509,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(4397,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>堆排序速度不是很快，对 cache 也不是很友好</li>
</ul>
</li>
</ul>
</li>
<li><code>std::partial_sort(begin, mid, end)</code></li>
<li><code>std::nth_element(begin, mid, end)</code>: rearrange <code>[begin, end)</code> so that <code>*mid</code> is sorted (i.e. same as the <code>*mid</code> in the full sorted range) and the whole range is partitioned by it 在排好序的中第 n 个位置的元素</li>
<li><code>std::merge(begin1, end1, begin2, end2, dstBegin[, Pred2])</code></li>
<li><code>std::inplace_merge(begin, mid, end)</code></li>
</ul>
<h4 id="Heap"><a href="#Heap" class="headerlink" title="Heap"></a>Heap</h4><ul>
<li><code>std::is_heap(_until)(begin, end[, Pred2])</code></li>
<li><code>std::make_heap(begin, end[, Pred2])</code>: Floyd algorithm <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li><code>std::push_heap(begin, end[, Pred2])</code></li>
<li><code>std::pop_heap(begin, end[, Pred2])</code></li>
<li><code>std::sort_heap(begin, end[, Pred2])</code></li>
</ul>
<h4 id="Set-Operations"><a href="#Set-Operations" class="headerlink" title="Set Operations"></a>Set Operations</h4><p>Set operations are used on <strong>sorted</strong> range, including <code>set</code></p>
<ul>
<li><code>std::includes(begin1, end1, begin2, end2[, Pred2])</code>: check whether th second range is subset of the first range<center>
    <img src="/2024/06/03/56ae950785e9/set-operations-inclues-1.png" srcset="/img/loading.gif" lazyload alt>
    <img src="/2024/06/03/56ae950785e9/set-operations-inclues-2.png" srcset="/img/loading.gif" lazyload alt>
</center></li>
<li><code>std::set_intersection(begin1, end1, begin2, end2, dstBegin[, Pred2])</code>: <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="5.929ex" height="1.67ex" role="img" focusable="false" viewbox="0 -716 2620.4 738"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g><g data-mml-node="mo" transform="translate(972.2,0)"><path data-c="2229" d="M88 -21T75 -21T55 -7V200Q55 231 55 280Q56 414 60 428Q61 430 61 431Q77 500 152 549T332 598Q443 598 522 544T610 405Q611 399 611 194V-7Q604 -22 591 -22Q582 -22 572 -9L570 405Q563 433 556 449T529 485Q498 519 445 538T334 558Q251 558 179 518T96 401Q95 396 95 193V-7Q88 -21 75 -21Z"/></g><g data-mml-node="mi" transform="translate(1861.4,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g></g></g></svg></mjx-container></li>
<li><code>std::set_union(begin1, end1, begin2, end2, dstBegin[, Pred2])</code>: <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="5.929ex" height="1.67ex" role="img" focusable="false" viewbox="0 -716 2620.4 738"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g><g data-mml-node="mo" transform="translate(972.2,0)"><path data-c="222A" d="M591 598H592Q604 598 611 583V376Q611 345 611 296Q610 162 606 148Q605 146 605 145Q586 68 507 23T333 -22Q268 -22 209 -1T106 66T56 173Q55 180 55 384L56 585Q66 598 75 598Q85 598 95 585V378L96 172L98 162Q112 95 181 57T332 18Q415 18 487 58T570 175Q571 180 571 383V583Q579 598 591 598Z"/></g><g data-mml-node="mi" transform="translate(1861.4,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g></g></g></svg></mjx-container></li>
<li><code>std::set_symmetric_difference(begin1, end1, begin2, end2, dstBegin[, Pred2])</code>: <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="6.18ex" height="1.805ex" role="img" focusable="false" viewbox="0 -716 2731.4 798"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g><g data-mml-node="mo" transform="translate(972.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mi" transform="translate(1972.4,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g></g></g></svg></mjx-container></li>
<li><code>std::set_difference(begin1, end1, begin2, end2, dstBegin[, Pred2])</code>: <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="12.151ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 5370.9 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g><g data-mml-node="mo" transform="translate(972.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mo" transform="translate(1972.4,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(2361.4,0)"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g><g data-mml-node="mo" transform="translate(3333.7,0)"><path data-c="2229" d="M88 -21T75 -21T55 -7V200Q55 231 55 280Q56 414 60 428Q61 430 61 431Q77 500 152 549T332 598Q443 598 522 544T610 405Q611 399 611 194V-7Q604 -22 591 -22Q582 -22 572 -9L570 405Q563 433 556 449T529 485Q498 519 445 538T334 558Q251 558 179 518T96 401Q95 396 95 193V-7Q88 -21 75 -21Z"/></g><g data-mml-node="mi" transform="translate(4222.9,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="mo" transform="translate(4981.9,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
<h4 id="MinMax"><a href="#MinMax" class="headerlink" title="MinMax"></a>MinMax</h4><ul>
<li><code>std::min/max/minmax(a, b[, Pred2])</code>: return (pair of) reference of the smaller/bigger element</li>
<li><code>std::min_element/max_element/minmax_element(begin, end[, Pred2])</code>: return the iterator of the minimum/maximum value in the range</li>
<li><code>std::clamp(value, low, high)</code></li>
</ul>
<h4 id="Permutation"><a href="#Permutation" class="headerlink" title="Permutation"></a>Permutation</h4><p>Permutation means that two sequence are <strong>unorderly equal</strong></p>
<ul>
<li><code>std::is_permutation(begin, end1, begin2[, Pred2])</code><ul>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.832ex" height="2.452ex" role="img" focusable="false" viewbox="0 -833.9 2577.6 1083.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="msup" transform="translate(1152,0)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mn" transform="translate(633,363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g></g><g data-mml-node="mo" transform="translate(2188.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
</li>
<li><code>std::prev/next_permutation(begin, end[, Pred2])</code>: return the sequence to the previous/next permutation</li>
</ul>
<h4 id="Numeric-Algorithms"><a href="#Numeric-Algorithms" class="headerlink" title="Numeric Algorithms"></a>Numeric Algorithms</h4><p>They are all <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.495ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2429 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(2040,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></p>
<ul>
<li>For the most basic ones:<ul>
<li><code>std::iota(begin, end, beginVal)</code>: fill in <code>[begin, end)</code> with <code>{beginVal, ++beginVal, ...}</code></li>
<li><code>std::adjacent_difference(begin, end, dstBegin, Op = std::minus)</code>: as its name, output <code>{val[0], val[1] - val[0], val[2] - val[1], ...}</code></li>
<li><code>std::accumulate(begin, end, initVal, Op = std::plus)</code>: accumulate all values, return <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.975ex;" xmlns="http://www.w3.org/2000/svg" width="19.261ex" height="3.165ex" role="img" focusable="false" viewbox="0 -967.8 8513.5 1398.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtext"><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z"/><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"/><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z" transform="translate(834,0)"/><path data-c="74" d="M27 422Q80 426 109 478T141 600V615H181V431H316V385H181V241Q182 116 182 100T189 68Q203 29 238 29Q282 29 292 100Q293 108 293 146V181H333V146V134Q333 57 291 17Q264 -10 221 -10Q187 -10 162 2T124 33T105 68T98 100Q97 107 97 248V385H18V422H27Z" transform="translate(1112,0)"/><path data-c="56" d="M114 620Q113 621 110 624T107 627T103 630T98 632T91 634T80 635T67 636T48 637H19V683H28Q46 680 152 680Q273 680 294 683H305V637H284Q223 634 223 620Q223 618 313 372T404 126L490 358Q575 588 575 597Q575 616 554 626T508 637H503V683H512Q527 680 627 680Q718 680 724 683H730V637H723Q648 637 627 596Q627 595 515 291T401 -14Q396 -22 382 -22H374H367Q353 -22 348 -14Q346 -12 231 303Q114 617 114 620Z" transform="translate(1501,0)"/><path data-c="61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z" transform="translate(2251,0)"/><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z" transform="translate(2751,0)"/></g><g data-mml-node="mo" transform="translate(3251.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="munderover" transform="translate(4251.4,0)"><g data-mml-node="mo"><path data-c="2211" d="M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z"/></g><g data-mml-node="TeXAtom" transform="translate(1089,477.1) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z"/><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(444,0)"/><path data-c="64" d="M376 495Q376 511 376 535T377 568Q377 613 367 624T316 637H298V660Q298 683 300 683L310 684Q320 685 339 686T376 688Q393 689 413 690T443 693T454 694H457V390Q457 84 458 81Q461 61 472 55T517 46H535V0Q533 0 459 -5T380 -11H373V44L365 37Q307 -11 235 -11Q158 -11 96 50T34 215Q34 315 97 378T244 442Q319 442 376 393V495ZM373 342Q328 405 260 405Q211 405 173 369Q146 341 139 305T131 211Q131 155 138 120T173 59Q203 26 251 26Q322 26 373 103V342Z" transform="translate(1000,0)"/></g></g><g data-mml-node="TeXAtom" transform="translate(1089,-285.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><path data-c="62" d="M307 -11Q234 -11 168 55L158 37Q156 34 153 28T147 17T143 10L138 1L118 0H98V298Q98 599 97 603Q94 622 83 628T38 637H20V660Q20 683 22 683L32 684Q42 685 61 686T98 688Q115 689 135 690T165 693T176 694H179V543Q179 391 180 391L183 394Q186 397 192 401T207 411T228 421T254 431T286 439T323 442Q401 442 461 379T522 216Q522 115 458 52T307 -11ZM182 98Q182 97 187 90T196 79T206 67T218 55T233 44T250 35T271 29T295 26Q330 26 363 46T412 113Q424 148 424 212Q424 287 412 323Q385 405 300 405Q270 405 239 390T188 347L182 339V98Z"/><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z" transform="translate(556,0)"/><path data-c="67" d="M329 409Q373 453 429 453Q459 453 472 434T485 396Q485 382 476 371T449 360Q416 360 412 390Q410 404 415 411Q415 412 416 414V415Q388 412 363 393Q355 388 355 386Q355 385 359 381T368 369T379 351T388 325T392 292Q392 230 343 187T222 143Q172 143 123 171Q112 153 112 133Q112 98 138 81Q147 75 155 75T227 73Q311 72 335 67Q396 58 431 26Q470 -13 470 -72Q470 -139 392 -175Q332 -206 250 -206Q167 -206 107 -175Q29 -140 29 -75Q29 -39 50 -15T92 18L103 24Q67 55 67 108Q67 155 96 193Q52 237 52 292Q52 355 102 398T223 442Q274 442 318 416L329 409ZM299 343Q294 371 273 387T221 404Q192 404 171 388T145 343Q142 326 142 292Q142 248 149 227T179 192Q196 182 222 182Q244 182 260 189T283 207T294 227T299 242Q302 258 302 292T299 343ZM403 -75Q403 -50 389 -34T348 -11T299 -2T245 0H218Q151 0 138 -6Q118 -15 107 -34T95 -74Q95 -84 101 -97T122 -127T170 -155T250 -167Q319 -167 361 -139T403 -75Z" transform="translate(1000,0)"/><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z" transform="translate(1500,0)"/><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(1778,0)"/></g></g></g><g data-mml-node="mtext" transform="translate(7207.5,0)"><path data-c="76" d="M338 431Q344 429 422 429Q479 429 503 431H508V385H497Q439 381 423 345Q421 341 356 172T288 -2Q283 -11 263 -11Q244 -11 239 -2Q99 359 98 364Q93 378 82 381T43 385H19V431H25L33 430Q41 430 53 430T79 430T104 429T122 428Q217 428 232 431H240V385H226Q187 384 184 370Q184 366 235 234L286 102L377 341V349Q377 363 367 372T349 383T335 385H331V431H338Z"/><path data-c="61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z" transform="translate(528,0)"/><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z" transform="translate(1028,0)"/></g></g></g></svg></mjx-container></li>
<li><code>std::partial_sum(begin, end, dstBegin, Op = std::plus)</code>: output <code>{val[0], val[0] + val[1], val[0] + val[1] + val[2], ...}</code></li>
<li><code>std::inner_product(begin1, end1, begin2, initVal, Op1 = std::plus, Op2 = std::multiplies)</code>: finally get <code>initVal + a[0] * b[0] + a[1] * b[1] + ...</code></li>
<li><code>std::reduce(begin, end, initVal, Op = std::plus)</code>: same as accumulate</li>
<li><code>std::inclusive_scan(begin, end, dstBegin, Op = std::plus[, initVal])</code>: same as partial sum</li>
<li><code>std::transform_reduce(begin1, end1, begin2, initVal, ReduceOp = std::plus, BiTransformOp = std::multiplies)</code>: same as inner product</li>
<li><code>std::exclusive_scan(begin, end, dstBegin, initVal, Op = std::plus)</code>: similar to partial, but exclude the element itself, i.e. the sequence is <code>{initVal, initVal + val[0], ..., initVal + val[0] + ... + val[n - 2]}</code></li>
<li><code>std::transform_inclusive_scan(begin, end, dstBegin, Op, UnaryTransformOp[, initVal])</code></li>
<li><code>std::transform_exclusive_scan(begin, end, dstBegin, Op, UnaryTransformOp[, initVal])</code></li>
</ul>
</li>
<li><code>std::gcd(a, b)</code>: 最大公约数</li>
<li><code>std::lcm(a, b)</code>: 最小公倍数</li>
<li><code>std::midpoint(a, b)</code>: since C++ 20, return <code>a + (b - a) / 2</code></li>
</ul>
<h4 id="Parallel-Algorithm"><a href="#Parallel-Algorithm" class="headerlink" title="Parallel Algorithm"></a>Parallel Algorithm</h4><ul>
<li>There are two kinds of parallelism<ul>
<li>SIMD: single instruction multiple data 单指令多数据</li>
<li>SIMT: single instruction multiple threads</li>
</ul>
</li>
<li>Since C++ 17, parallel-version algorithms are added</li>
<li>Defined in <code>&lt;execution&gt;</code><ul>
<li>There are four execution policies defined in <code>std::execution</code><ul>
<li><code>seq</code>: sequenced policy 完全不并行</li>
<li><code>par</code>: parallel policy 并行</li>
<li><code>unseq</code>: unsequenced policy (since C++ 20) 算法可以适应 SIMD</li>
<li><code>par_unseq</code>: parallel and unsequenced policy</li>
</ul>
</li>
</ul>
</li>
<li>There are four kinds of data dependencies<ul>
<li>RAR: read after read 可以使用<code>par_unseq</code><ul>
<li>E.g. <code>std::adjacent_find</code></li>
</ul>
</li>
<li>RAW: read after write, e.g. <code>a[j] = a[j - 1] + 1</code></li>
<li>WAR: write after read, e.g. <code>a[j - 1] = a[j] + 1</code></li>
<li>WAW: write after write</li>
</ul>
</li>
<li>Parallel algorithms<ul>
<li><code>std::partition</code>, <code>std::nth_element</code></li>
<li><code>std::merge</code></li>
<li><code>std::inplace_merge</code></li>
</ul>
</li>
<li>There are also some algorithms that cannot be parallelized<ul>
<li>Those who only operate on several values, e.g. <code>std::min/max/minmax/clamp</code>, <code>std::swap/iter_swap</code></li>
<li>随机算法</li>
<li><code>std::search</code></li>
<li><code>std::push/pop/make/sort_heap</code></li>
<li>排列算法</li>
<li>二叉搜索算法</li>
<li>Ordered numeric algorithms, i.e. <code>std::iota/accumulate/inner_product/partial_sum</code></li>
</ul>
</li>
</ul>
<h4 id="Range-version-Algorithms"><a href="#Range-version-Algorithms" class="headerlink" title="Range-version Algorithms"></a>Range-version Algorithms</h4><p>算法中需要声明迭代器，当操作的是一整个容器时，就需要 <code>begin</code> 和<code>end</code>，所以可以使用<code>ranges</code>。range-version 算法也可以叫做 constrained algorithms，使得算法操作更加灵活</p>
<ul>
<li>You can additionally specify <strong>projection</strong> as the last parameter, i.e. transformation of elements before entering the real function 最后一个参数可以指定一个映射，例如使用 transform 在传入函数前进行变换<ul>
<li>This just changes criteria（标准；条件）, the element itself is unchanged</li>
<li>Multiple ranges may specify multiple projections</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++">std::vector vec{<span class="hljs-number">-1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">-3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">-5</span>, <span class="hljs-number">6</span> };<br><span class="hljs-keyword">auto</span> print = [](<span class="hljs-type">int</span> i) {<br>    std::cout &lt;&lt; i &lt;&lt; <span class="hljs-string">","</span>;<br>};<br>std::cout &lt;&lt; <span class="hljs-string">"with abs() projection: \n"</span>;<br>std::ranges::<span class="hljs-built_in">sort</span>(vec, {}, [](<span class="hljs-type">int</span> i) {<span class="hljs-keyword">return</span> std::<span class="hljs-built_in">abs</span>(i); });<br>std::range::for_each(vec, print);<br></code></pre></td></tr></table></figure>

<ul>
<li>Range-version algorithms also have these advantages<ul>
<li>使用了 C++20 中的 concept</li>
<li>The range doesn’t need to be comma (i.e. <code>begin/end</code> with the same type) <code>begin</code>和 <code>end</code> 不要求类型相同</li>
<li>更加安全</li>
<li>有些算法被加强了</li>
<li>新的方法加入进来</li>
<li>用模板方法更容易</li>
</ul>
</li>
<li>There are also some defects<ul>
<li>不能使用并行算法</li>
<li>一些算法被削弱了</li>
<li>返回值类型并不和 <code>std::</code> 相同，返回值改变有以下几种形式<ul>
<li><code>stdr::in_in_result&lt;I1, I2&gt;</code>: 本来返回两个迭代器，现在返回了一个结构体，里面的成员变量是两个迭代器</li>
<li><code>stdr::in_out_result&lt;I, O&gt;</code></li>
<li><code>stdr::in_in_out_result&lt;I1, I2, O&gt;</code><ul>
<li><code>stdr::set_union/intersection/symmetric_difference</code></li>
<li><code>stdr::merge</code></li>
<li>binary <code>stdr::transform</code></li>
</ul>
</li>
<li><code>stdr::in_out_out_result&lt;I1, I2, O&gt;</code><ul>
<li><code>stdr::partition_copy</code></li>
</ul>
</li>
<li><code>stdr::in_found_result&lt;T&gt;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Lifetime"><a href="#Lifetime" class="headerlink" title="Lifetime"></a>Lifetime</h2><h3 id="Storage-duration- 存储持续性"><a href="#Storage-duration- 存储持续性" class="headerlink" title="Storage duration 存储持续性"></a>Storage duration 存储持续性</h3><p>There are four kinds of storage duration</p>
<ul>
<li>Static storage duration: global variables, static variables in a function/class</li>
<li>Automatic storage duration: variables that belong to a block scope ro function arguments 定义的时候构造，退出的时候析构</li>
<li>Dynamic storage duration: you can create objects by using or some other allocation functions</li>
<li>Thread storage duration: 线程创建的时候构造，线程退出的时候析构</li>
</ul>
<p>The lifetime of an object begins when storage with proper alignment and size is allocated and the object is initialized 合适的对齐，合适的大小，以及初始化</p>
<p>The lifetime of an object ends when it’s destroy, or the dtor is called, or its storage is released or reused by non-nested object 析构函数被调用，存储被释放，被重用（<code>float</code>类型的变量通过某些手段被 <code>int</code> 类型变量占用）</p>
<p>Temporary objects are only alive until the statement ends (i.e. until <code>;</code>) 临时变量的声明周期只到语句结束之前，也就是 <code>;</code> 分号之后才结束</p>
<ul>
<li>函数中的参数传递 <code>const&amp;</code> 或<code>std::function_ref</code>是安全的</li>
<li>返回临时变量可以延长对象的生命周期，例如<code>const&amp;</code><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">A</span>{};<br><span class="hljs-function">A <span class="hljs-title">bar</span><span class="hljs-params">()</span> </span>{<span class="hljs-keyword">return</span> A{};};<br><span class="hljs-type">const</span> A&amp; a = <span class="hljs-built_in">bar</span>();<br></code></pre></td></tr></table></figure></li>
</ul>
<p>In modern C++, <strong>pointer is far beyond address</strong>; it has type <code>T*</code>, and you can hardly ever access some address by it when there are no underlying objects of type <code>T</code> alive 指针的功能远远超出寻址的语义，指针是带有类型的概念；如果指针指向的地址不符合指针具有的类型，如果再用指针访问相应的元素就会是无效的</p>
<h3 id="Placement-new"><a href="#Placement-new" class="headerlink" title="Placement new"></a>Placement new</h3><p>“就地初始化” <code>ConstructOnBuffet</code>, which won’t allocate memory, but only create the object at the place 不在重新分配内存，直接在现有已开辟的内存空间中创建对象</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-built_in">alignas</span>(T) <span class="hljs-type">unsigned</span> chat buf[<span class="hljs-built_in">sizeof</span>(T)];<br>T* tptr = <span class="hljs-built_in">new</span>(buf) T;<br>tptr-&gt;~<span class="hljs-built_in">T</span>();<br></code></pre></td></tr></table></figure>

<ul>
<li><code>new(buffet) Type Initializer</code>, where <code>Initializer</code> is optional</li>
<li>Of course, you need to make sure the alignment satisfies the requirement of the type, so you can use keyword <code>alignas</code>  为了保证类型对齐需要用到在 C++ 11 引入的关键字<code>alignas</code></li>
</ul>
<blockquote>
<ul>
<li><code>std::byte</code>: defined in <code>&lt;cstddef&gt;</code> since C++ 17; it’s just an enumeration class and explicitly represents a byte (before we may use <code>unsigned char</code>)</li>
<li>Trivial dtor<ul>
<li>It’s implicitly declared or declared with <code>=default</code> 隐式生成（编译器）的或者被定义为<code>default</code></li>
<li>It’s non-virtual and all non-static data members have trivial dtor 所有的非静态成员都有 trivial dtor，并且成员不能是虚的</li>
<li>For example<ul>
<li>✅<code>struct A{int a; float b;};</code></li>
<li>✅<code>class A{int a; public: float b; ~A() = default };</code></li>
<li>✅<code>class A{int a; public: float b; virtual ~A() = default };</code></li>
<li>❎<code>class B : public A{};</code></li>
<li>❎<code>class A{~A() {}};</code></li>
<li>❎<code>class A{std::unique_ptr&lt;int&gt; ptr;};</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="Corner-Cases"><a href="#Corner-Cases" class="headerlink" title="Corner Cases"></a>Corner Cases</h3><ul>
<li>Case1: if you construct an object that has the same type as the original object, and they occupies exactly same storage, then the original name, pointers and references are still valid 就像赋值符号一样</li>
<li>Case2: it’s best to reuse storage of plain types like <code>int</code> or classes that have trivial dtor 如果要重用内存尽量使用简单的类型，例如 <code>int</code> 或者带有 trivial dtor 的类，对于其他类型编译器会在退出当前 scope 时候会自动调用析构函数</li>
<li>Case3: it’s illegal to reuse memory of <code>const</code> objects that have determined their value in the compilation time</li>
<li>Case4: <code>unsigned char/std::byte</code> array is explicitly regulated to be able to provide storage 这两个类型的数组是明确地可以提供 storage 的</li>
<li>Case5: It’s legal to access the underlying object by pointers without the same type in these cases (type punning/aliasing 类型堆叠 / 类型别名） 在少数情况下可以使用不同类型的指针访问一些对象<ul>
<li>add/remove cv-qualification <code>int</code>类型的指针可以使用 <code>const int</code> 类型的指针访问</li>
<li>decayed array 用指针访问数组的元素</li>
<li>if the underlying type is integer, then using the pointer of its signed/unsigned variant to access it is OK</li>
<li>convert it to <code>(unsigned) char*/ std::byte*</code> 允许将对象视作字节数组 byte array</li>
</ul>
</li>
<li>Case6:If you have an old pointer where you’ve constructed a new object, but you want to use the old pointer to get the new pointer, you can use <code>std::launder</code>（洗涤；洗钱） defined in <code>&lt;new&gt;</code> since C++ 17<ul>
<li><code>std::launder(reinterpret_cast&lt;A*&gt;(buffer))</code> to get the actual valid pointer 用旧的指针获得指向新的对象的指针</li>
</ul>
</li>
</ul>
<h3 id="Strict-Aliasing-Rules"><a href="#Strict-Aliasing-Rules" class="headerlink" title="Strict Aliasing Rules"></a>Strict Aliasing Rules</h3><p>Strict aliasing rules, if pointers are not aliased or not contained as member, then compilers can freely assume that they’re different objects 本质上就是检查两个指针指向的区域有没有可能重叠</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">T</span><br>{<br>    <span class="hljs-type">uint8_t</span>* target;<br>    <span class="hljs-type">char</span>* source;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Unpack</span><span class="hljs-params">(<span class="hljs-type">int</span> size)</span></span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-keyword">while</span> (size &gt; <span class="hljs-number">0</span>)<br>        {<br>            <span class="hljs-type">uint64_t</span> t;<br>            std::<span class="hljs-built_in">memcpy</span>(&amp;t, source, <span class="hljs-built_in">sizeof</span>(t));<br>            target[<span class="hljs-number">0</span>] = t &amp; <span class="hljs-number">0x7</span>;<br>            target[<span class="hljs-number">1</span>] = (t &gt;&gt; <span class="hljs-number">3</span>) &amp; <span class="hljs-number">0x7</span>;<br>            target[<span class="hljs-number">2</span>] = (t &gt;&gt; <span class="hljs-number">6</span>) &amp; <span class="hljs-number">0x7</span>;<br>            target[<span class="hljs-number">3</span>] = (t &gt;&gt; <span class="hljs-number">9</span>) &amp; <span class="hljs-number">0x7</span>;<br>            source += <span class="hljs-number">6</span>, size -= <span class="hljs-number">6</span>, target += <span class="hljs-number">16</span>;<br>        }<br>    }<br>};<br></code></pre></td></tr></table></figure>

<ul>
<li>Compared with non-member version (i.e. <code>Unpack(uint8_t* target, char* src, int size)</code>), it’s 15% slower</li>
<li><code>target</code> is an alias of <code>this</code>. It will then always reload <code>target[i]</code> instead of caching a <code>qword</code> to prevent change of <code>target</code> 编译器认为 <code>target</code> 是<code>this</code>的别名</li>
</ul>
<h3 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h3><ul>
<li>Attention to lambda lifetime<ul>
<li>Lambda lifetime should always be shorter than reference captures</li>
<li>If you capture in the class, then this only captures members by <code>this</code>, which may be invalid after destruction 如果 <code>this</code> 被析构掉，就算是把 <code>this</code> 拷贝出来，还是失效的</li>
</ul>
</li>
<li>Attention to view lifetime<ul>
<li>Sometimes you mey return a view generated by range adaptor in a function (e.g. <code>v | std::reverse</code>)<ul>
<li>For lvalue, it’s same as the lvalue itself, i.e. <code>v</code> here</li>
<li>For rvalue, it’ll same as return a value, so that it’s always safe 临时值</li>
</ul>
</li>
<li>所有的 range adaptors 在调用之前都会调用 <code>stdv::all</code> 尝试将 range 转换成 view；但是对于 view 来说不做任何事情<ul>
<li>For lvalue range, it’ll create a <code>stdr::ref_view</code></li>
<li>For rvalue range, it’ll create a <code>stdr::owning_view</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Type-Safety"><a href="#Type-Safety" class="headerlink" title="Type Safety"></a>Type Safety</h2><h3 id="Implicit-Conversion"><a href="#Implicit-Conversion" class="headerlink" title="Implicit Conversion"></a>Implicit Conversion</h3><ul>
<li>Some implicit conversions are automatic (standard conversions), and others are user-defined 很多隐式的转型都是自动的<ul>
<li>E.g. <code>operator float()</code>. If you declare it as <code>explicit</code>, then implicit conversion will be disabled</li>
</ul>
</li>
<li>Standard conversions<ul>
<li>Lvalue-to rvalue conversion, array-to-pointer conversion, function-to-pointer conversion<ul>
<li>Decay actually means<ul>
<li>Array/Function -&gt; pointer</li>
<li>Or for other types, remove remove references first, remove cv-qualifiers(const &amp; volatile) next</li>
<li>You can use <code>std::decay_t&lt;T&gt;</code> to get the decayed type</li>
<li><code>auto a = xx;</code> will also decay the deduced type, while <code>auto&amp;</code> will not<ul>
<li>But structured binding <code>auto [a, b] = xx;</code> “seems” not decay decay 看似没发生，其实是发生在结构化绑定的实现上，相当于 <code>auto anonymous = xx;</code>，<code>a</code> 和<code>b</code>是成员变量的别名，decay 发生在 <code>anonymous</code> 中</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Numeric promotions and conversions<ul>
<li>Promotion: promotion has higher precedence and will not lose precision<ul>
<li><code>b + c</code> where <code>b</code> and <code>c</code> are <code>unsigned short</code> will in fact silently promote them to <code>int</code> and then do <code>+</code> 先提升到 <code>int</code> 然后再做加法</li>
<li>至少提升到<code>int</code></li>
<li><code>float</code> can be promoted to <code>double</code></li>
</ul>
</li>
<li>Signed value has negative values while unsigned ones don’t, but conversion may happen</li>
<li><code>float</code> cannot represent all <code>int/...</code> but <code>int</code> can be converted to <code>float</code> implicitly</li>
<li>Any scalar types can be converted to <code>bool</code></li>
<li>Pointers can be converted to <code>void*</code> to base class, and <code>nullptr</code> can be converted to pointer directly</li>
<li>Pointer to member of derived class can also be converted to pointer to member of base class, i.e. <code>Derived::int*</code> -&gt; <code>Base::int*</code></li>
<li>There are also some numeric conversions that need explicit cast 数值上的转换需要显示的转换<ul>
<li>Narrow integer conversion will mod <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.279ex" height="1.528ex" role="img" focusable="false" viewbox="0 -675.5 1007.3 675.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g></g></g></g></svg></mjx-container> 例如 <code>int</code> -&gt; <code>short</code>，<code>long long</code> -&gt; <code>int</code> 会把高位的位数截断</li>
<li>Narrow floating conversion will be rounded</li>
<li>Floating to integer will truncate the digits after dot; UB if truncated integer is not representable by converted type</li>
</ul>
</li>
</ul>
</li>
<li>(Exception-specified) function pointer conversion<ul>
<li>可以把 <code>noexcept</code> 的函数指针转换成没有 <code>noexcept</code> 的函数指针</li>
</ul>
</li>
<li>Qualification conversions<ul>
<li>You can convert a non-const/non-volatile to const/volatile one</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Static-Cast"><a href="#Static-Cast" class="headerlink" title="Static Cast"></a>Static Cast</h3><p><code>static_cast</code> is the most powerful one, which can process almost all of normal conversion,defined as <code>static_cast&lt;TargetType&gt;(Exp)</code></p>
<blockquote>
<p><strong>Standard-layout</strong></p>
<ul>
<li>所有的成员都有相同的访问属性</li>
<li>没有虚函数</li>
<li>The base class is not the type of the first member data 基类对象不能是子类第一个成员变量</li>
<li>整个继承结构，只能有其中一个类是有非静态的变量</li>
</ul>
</blockquote>
<ul>
<li>All implicit conversions can be explicitly denoted by <code>static_cast</code> 可以做任何一种隐式的转换，也会允许逆操作 e.g. <code>int</code> -&gt; <code>short</code>, <code>double</code> -&gt; <code>float</code></li>
<li>Scoped enumeration can be converted to/from integer or floating point, which is same as the underlying integer type</li>
<li>Inheritance-related conversions<ul>
<li>upcast 向基类转换；更安全的</li>
<li>downcast 向派生类转换；有点危险</li>
</ul>
</li>
<li>For <code>static_cast</code>, besides inheritance-related pointer conversion, it also processes <code>void*</code><ul>
<li>You can convert any object pointer to <code>void*</code> (this is also implicit conversion)</li>
<li>You can also convert explicitly <code>void*</code> to any object pointer 前提是对象潜在的类型 <code>U</code> 和指针的类型 <code>T</code> 有某种特殊的关系——pointer-interconvertible<ul>
<li><code>T == U</code></li>
<li><code>U</code> is a union type, while <code>T</code> is type of its member</li>
<li><code>U</code> is standard-layout, while <code>T</code> is type of its first member or its base class</li>
<li>Or all vice versa/transitivity</li>
</ul>
</li>
</ul>
</li>
<li>并不保证地址是相同的</li>
<li>Convert to <code>void</code>: just discard value, nothing happens</li>
<li>Construct new object: if the object ctor can accept a single parameter, which is convertible from the expression, then it in fact constructs a new object. E.g. <code>static_cast&lt;A&gt;(a)</code> for <code>A(int)</code></li>
<li>Transform value category</li>
<li><code>static_cast</code> can be used to specify which overload of functions is used by function-to-pointer conversion</li>
</ul>
<h3 id="Dynamic-Cast-and-RTTI"><a href="#Dynamic-Cast-and-RTTI" class="headerlink" title="Dynamic Cast and RTTI"></a>Dynamic Cast and RTTI</h3><h4 id="Dynamic-Cast"><a href="#Dynamic-Cast" class="headerlink" title="Dynamic Cast"></a>Dynamic Cast</h4><p><code>static_cast</code>在继承链中检查是非常弱的（可以说是不做检查），即便转换的对象不是派生类的类型仍然会做转换，只是会带来 undefined behavior。<code>dynamic_cast</code>尝试解决这个问题，如果转换不合适会失败</p>
<ul>
<li>引用上转换失败会抛出异常<code>throw std::bad_cast</code></li>
<li>指针上转换失败会返回<code>nullptr</code></li>
<li>比 UB 更强，更容易定位 bug</li>
</ul>
<p>为了做了运行时检查，C++ 编译器会在文件中保留运行时的类型识别（RTTI, Run-Time Type Information/Identification），<code>dynamic_cast</code>只能用在多态的类型转换中，因为 RTTI 依赖于虚指针等特性。但是 <code>dynamic_cast</code> 性能上要比 <code>static_cast</code> 慢 10 倍甚至百倍</p>
<ul>
<li>You can do downcast in polymorphic types<ul>
<li>被转换的对象，潜在的对象类型必须和基类的类型相同，否则不能转换成功</li>
<li><code>dynamic_cast</code>不能用在当前类构造函数和析构函数中，因为当前类的虚指针不是完整的</li>
</ul>
</li>
<li>You can also do sidecast in polymorphic types with multiple inheritance</li>
</ul>
<h4 id="RTTI"><a href="#RTTI" class="headerlink" title="RTTI"></a>RTTI</h4><p>C++ 提供了一种方式可以直接得到类型的信息，定义在 <code>&lt;typeinfo&gt;</code>，同样要限制使用，会造成性能上的问题。可以使用<code>typeid(xxx)</code> 得到 <code>const std::type_info</code>，类似于<code>sizeof</code> 操作符。<code>type_info</code>是只读的，不能通过拷贝或者构造，只能通过 <code>typeid</code> 获得或者引用。可以使用 <code>.name()</code> 进行 debug</p>
<ul>
<li><code>.name()</code></li>
<li><code>.hash_code()</code></li>
<li><code>.before()</code></li>
</ul>
<p>RTTI is unfriendly to shared library 对动态链接库不是友好的</p>
<ul>
<li>Since GCC 3.0, symbols are compared equality by address instead fo names. So to preserve only one symbol across many <code>.obj</code> file, it  merges them when linking (like in static library) 符号使用地址比较相等性，而不是通过名字比较相等性；即使两个符号的名字是相等的，地址不相等，当出现在不同的 <code>.obj</code> 文件中的时候，会将名字相等的符号进行地址合并</li>
<li>So to load shared library quickly, many procedures are omitted, which includes resolving different RTTI symbols 为了快速链接动态链接库，很多步骤都要被省略，其中也包括 RTTI 符号的合并</li>
</ul>
<h4 id="Const-Cast"><a href="#Const-Cast" class="headerlink" title="Const Cast"></a>Const Cast</h4><ul>
<li>It tries to drop the cv-qualifiers<ul>
<li>明确的知道了原来的对象就是非 read-only，然后接收到的对象是 <code>const</code> 类型的</li>
<li>The author forgets the <code>const</code> in parameter, but it in fact doesn’t write it</li>
</ul>
</li>
<li><code>volatile</code> is similar 把 <code>volatile</code> 去掉会有 cache 的风险，<code>volatile</code>要求每次使用都要到内存中重新去读</li>
<li>一般情况下用不到</li>
</ul>
<h4 id="Reinterpret-Cast"><a href="#Reinterpret-Cast" class="headerlink" title="Reinterpret Cast"></a>Reinterpret Cast</h4><p><code>reinterpret_cast</code> is used to process pointers of different types, which is dangerous because of life time</p>
<ul>
<li>Converting from an object pointer to another type, i.e. <code>reinterpret_cast&lt;T*&gt;(xxx)</code><ul>
<li>This is same as <code>static_cast&lt;T*&gt;)(static_cast&lt;(cv) void*&gt;(xxx))</code></li>
<li><code>std::launder</code></li>
</ul>
</li>
<li>Converting from a pointer to function to another type of pointer to function; or pointer to member to another one</li>
<li>Converting pointer to integer or vice versa （反之亦然）<ul>
<li>A pointer can be converted to integer by <code>reinterpret_cast</code> if the integer is large enough (<code>std::uintptr_t</code>)</li>
<li>This integer can be converted back to get the original pointer</li>
<li><code>reinterpret_cast</code> from <code>0/NULL</code> is UB</li>
<li>Reference is also convertible 引用和指针一样</li>
</ul>
</li>
</ul>
<h4 id="Type-safe-union-and-void"><a href="#Type-safe-union-and-void" class="headerlink" title="Type-safe union and void*"></a>Type-safe <code>union</code> and <code>void*</code></h4><ul>
<li><p>Since C++ 17, <code>&lt;variant&gt;</code> and <code>&lt;any&gt;</code> are introduced to guarantee the safety</p>
<ul>
<li><p><code>std::variant</code> can be seen as a <code>union</code> with a <code>size_t</code> index, which will inspect whether the member is  in its lifetime when getting</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++">std::variant&lt;<span class="hljs-type">int</span>, <span class="hljs-type">float</span>, <span class="hljs-type">int</span>, std::vector&lt;<span class="hljs-type">int</span>&gt;&gt; v{<span class="hljs-number">1.0f</span> };<br><span class="hljs-comment">// 类似于</span><br><span class="hljs-keyword">union</span> <span class="hljs-title class_">Union</span> {<br>    <span class="hljs-type">int</span> _1;<br>    <span class="hljs-type">float</span> _2;<br>    <span class="hljs-type">int</span> _3;<br>    std::vector&lt;<span class="hljs-type">int</span>&gt; _4;<br>};<br></code></pre></td></tr></table></figure>

<ul>
<li>For construction<ul>
<li>By default, the first alternative is value-initialized 默认第一个位置被初始化</li>
<li>You can also assign a value with the same type of some alternative, then this’s the active alternative</li>
<li>You can also construct the member in place,i.e. by <code>(std::in_place_type&lt;T&gt;, args...)</code></li>
<li>You can construct by index, i.e. <code>(std::in_place_index&lt;Index&gt;, args...)</code></li>
</ul>
</li>
<li>To access or check the existence of alternative<ul>
<li><code>.index()</code>: return the index of active alternative</li>
<li>These methods need the examined type <strong>unique</strong> in type params<ul>
<li><code>std::hold_alternative&lt;T&gt;(v)</code>: return Boolean that denotes whether the active alternative is of type <code>T</code></li>
<li><code>std::get&lt;T&gt;(v)</code>: return the active alternative of type <code>T</code> 传入引用</li>
<li><code>std::get_if&lt;T&gt;(v)</code>: return the pointer to the active alternative of type <code>T</code> 传入指针</li>
</ul>
</li>
<li>If not unique, you can also use index-based access: <code>std::get&lt;I&gt;(v)</code>, <code>std::get_if&lt;I&gt;(v)</code></li>
</ul>
</li>
<li>Besides type safety, the most important extension of <code>std::variant</code> than <code>union</code> is that it implements <strong>visitor pattern</strong></li>
</ul>
</li>
<li><p><code>std::any</code> can be seen as a <code>void*</code> with the original type “stored” magically, so that you’ll fail to grasp（理解；领会） the inner object with the wrong type 可以加载任意的对象</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++">std::any a{<span class="hljs-number">1</span> };<br>a = <span class="hljs-number">2.0f</span>;<br>a = <span class="hljs-string">"test"</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>承载的对象必须有构造函数，类型会 decay</li>
<li>You can also default-construct it or call <code>.reset()</code>, then it holds nothing</li>
<li><code>.has_value()</code></li>
<li><code>(std::in_place_t&lt;T&gt;, args...)</code></li>
<li>When you need to get the underlying object, you need to use <code>std::any_cast&lt;T&gt;(a)</code> or <code>(&amp;a)</code></li>
<li><code>std::any</code> can have SBO (small buffer optimization) like <code>std::function</code> 标准库会给 <code>std::any</code> 在栈上分配比较小的 buffer，存储一些非常小的对象，而不是在堆上分配内存</li>
<li><code>.swap/std::swap/.emplace</code></li>
<li><code>.type()</code></li>
<li><code>std::make_any</code>, same as constructing <code>std::any</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Programming-in-Multiple-Files"><a href="#Programming-in-Multiple-Files" class="headerlink" title="Programming in Multiple Files"></a>Programming in Multiple Files</h2><p>Remember the compilation procedures of C</p>
<ul>
<li>Preprocess, where comments are stripped and <strong>macros are processed</strong> (so that your <code>#include</code> can get the file correctly)</li>
<li>Compile, where each source file is compiled independently 编译</li>
<li>Assemble; this is not something we care since it just translate assembly to object file 汇编</li>
<li>Link, to locate symbols that are referred in other TUs(Translation unit) 链接</li>
</ul>
<h3 id="Preprocessor- 预处理器"><a href="#Preprocessor- 预处理器" class="headerlink" title="Preprocessor 预处理器"></a>Preprocessor 预处理器</h3><p>To be specific, preprocessing can be divided into 6 phases</p>
<ul>
<li>Read files and map them to translation character set, which guarantees UTF-7 to be supported 读文件 映射</li>
<li>Backslashes as the end of line are processed to concatenate two physical lines into a single logical line 处理反斜杠<code>\</code></li>
<li>Comments and macros are extracted, and the whole file is parsed</li>
<li>Preprocessor runs to process all macros</li>
<li>String literals are encoded as specified by the prefix 处理字符串常量，按照指定的前缀进行编码</li>
<li>Adjacent string literals are concatenated ；邻近的字符串拼接</li>
</ul>
<p>A preprocessing directive begins with <code>#</code>. There are four kinds of directives</p>
<ul>
<li><p><code>#include ...</code>, which copies all file content into the current file</p>
<ul>
<li><code>#include &lt;...&gt;</code></li>
<li><code>#include "..."</code></li>
</ul>
</li>
<li><p><code>#define</code> i.e. macros, which does pure text replacement</p>
<ul>
<li><p><code>#define FUNC(a, b) a + b</code></p>
</li>
<li><p>Parameters of macros can be blank</p>
</li>
<li><p>Parameters of macros are directly parsed by commas when no paratheses surrounded, e.g. <code>FUNC(SomeFunc&lt;int, double&gt;())</code> -&gt; <code>SomeFunc&lt;int + double&gt;()</code> 用 <code>,</code> 直接进行分词，遇到 <code>,</code> 就会替换</p>
<ul>
<li><p>You need to add an additional pair of paratheses to help parse, e.g. <code>FUNC((SomeFunc&lt;int, double&gt;()), 3)</code></p>
</li>
<li><p>You can use <code>...</code> for parameters of any number, and reference them by <code>__VA_ARGS__</code> 变长参数的替换</p>
</li>
<li><p>Since C++ 20, you can use <code>__VA_OPT__(content)</code>, which will be enabled only when <code>__VA_ARGS__</code> is not empty</p>
</li>
<li><p><code>#</code> can be used to turn parameters to strings, and  <code>##</code> can be used to concatenate parameters to make them a whole token</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">define</span> NameToStr(a, b) #a #b</span><br><span class="hljs-keyword">auto</span> str = <span class="hljs-built_in">NameToStr</span>(<span class="hljs-number">1</span>, aa)<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ConcatName(a, id) a ## id</span><br><span class="hljs-type">int</span> <span class="hljs-built_in">ConcatName</span>(a, <span class="hljs-number">1</span>) = <span class="hljs-number">0</span>;<br>std::cout &lt;&lt; a1;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>You need <code>#undef</code> to drop the definition of the macro 取消宏定义</p>
</li>
</ul>
</li>
<li><p>Conditional choice of code</p>
<ul>
<li><code>#ifdef</code>, (<code>#elifdef</code> since C++ 23), <code>#else</code></li>
<li><code>#ifndef</code>, (<code>#elifndef</code> since C++ 23), <code>#else</code></li>
<li><code>#if defined xx</code> is equivalent to <code>#ifdef xx</code></li>
<li><code>#endif</code></li>
<li><code>#if</code>, <code>#elif</code>, <code>#else</code></li>
</ul>
</li>
<li><p><code>#pragma</code> is in fact a macro for implementation-defined usage 需要查看编译器文档或者其他相关文档才能知道具体的用途</p>
<ul>
<li><code>#pragma once</code>, <code>#pragma pack</code></li>
</ul>
</li>
<li><p><code>#line</code>: specify the line number manually</p>
</li>
</ul>
<h3 id="Compile"><a href="#Compile" class="headerlink" title="Compile"></a>Compile</h3><h4 id="Declaration-amp-Definition"><a href="#Declaration-amp-Definition" class="headerlink" title="Declaration & Definition"></a>Declaration &amp; Definition</h4><ul>
<li>Translation unit (TU)<ul>
<li>每一个源文件都是单独进行编译，最后通过连接器去链接未知的符号，每个源文件通过预处理将其他符号加到当前文件中，这一整个处理结果就是 TU</li>
<li>C++ 要求先声明再使用，所以每个 TU 首先要看到所使用的声明</li>
<li>C/C++ has One-Definition Rule (ODR), meaning that each entity should have only one definition in a TU or even in a program 一个实体只能定义一次</li>
</ul>
</li>
<li>典型的声明和定义<ul>
<li>Function prototype &amp; one with function body 函数签名和具有函数体的函数，也包括类的成员函数</li>
<li><code>class A;</code>, <code>class A{...}</code>, <code>struct</code> 类的声明和定义</li>
<li><code>enum class A (: Type)</code></li>
</ul>
</li>
<li>类的声明是一个比较特殊的实体，对于函数来说只需要暴露函数的签名就可以使用，但是对于类来说声明是远远不能够使用类</li>
<li>It only requires the class to be defined only once in a TU</li>
<li>Besides, class definition requires to fully see all definitions of its members &amp; base classes 类的定义必须要求有完整的定义，包括类的成员和基类<ul>
<li>You cannot <code>class Vector3; class A {Vector3 v;};</code></li>
<li>This is because compilers need to determine the layout of the class; if definition of some members are unknown, its <code>sizeof</code> is unclear 编译器必须知道类的大小</li>
</ul>
</li>
<li>We can use mere class declarations in these cases 只需要使用类的声明的情况<ul>
<li>As an argument of prototype; its members and layout are not used 做为函数的参数</li>
<li>When you only needs a pointer or reference as members 用指针或者引用指向类</li>
</ul>
</li>
<li>Notes<ul>
<li>It’s allowed to put definition of methods into class definition</li>
<li>Return types and parameter types of declarations and definitions of methods should be the same</li>
<li><code>friend</code> will implicitly declares the class or function</li>
<li>Class members in class definition is in fact definition instead of just simple declaration, so we don’t need to define it again in .cpp</li>
<li>Default parameters of functions should be put into declaration, and shouldn’t be put into definition</li>
<li>Type alias (like <code>using</code>) and <code>static_assert</code> are also declarations</li>
<li><strong>header guard</strong> 解决定义出现两次的问题 <code>#pragma once</code></li>
</ul>
</li>
<li>Template 的声明和定义<ul>
<li>Template will not preserve its information to object file</li>
<li>在头文件中写声明和定义</li>
<li>Function template in class should also be put into header</li>
</ul>
</li>
</ul>
<h4 id="Namespace"><a href="#Namespace" class="headerlink" title="Namespace"></a>Namespace</h4><ul>
<li><p>When code base is large, name conflicts usually happen 解决命名冲突，C 语言中解决方式是加大量的前缀</p>
</li>
<li><p><code>using namespace xx</code> is like <code>from xx import *</code></p>
</li>
<li><p><code>using yy::xx</code> is like <code>from yy import xx</code></p>
</li>
<li><p>You should <strong>never</strong> put <code>using namespace xxx</code> or <code>using xx</code> into header files</p>
</li>
<li><p>Inline namespace has nothing to do with <code>inline</code>. It’ll expose contents into the parent namespace, as if there is a <code>using namespace xx</code> 和关键字 <code>inline</code> 毫无关系，目的是把所包含的内容暴露到上层命名空间中</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">namespace</span> Test6<br>{<br>    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">namespace</span> Implv1<br>    {<br>        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Func</span><span class="hljs-params">()</span></span>;<br>    }<br>}<br><span class="hljs-keyword">namespace</span> Test6::Implv1<br>{<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Func</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>{<br>        std::cout &lt;&lt; <span class="hljs-string">"This is v1.\n"</span>;<br>    }<br>}<br><span class="hljs-comment">// 调用的时候完全可以将 `Implv1` 忽略掉</span><br>Test6::<span class="hljs-built_in">Func</span>();<br></code></pre></td></tr></table></figure>

<blockquote>
<p>老代码需要兼容，新代码可以平滑过渡</p>
</blockquote>
</li>
</ul>
<h4 id="Inline"><a href="#Inline" class="headerlink" title="Inline"></a>Inline</h4><ul>
<li>Recall procedures of function calls<ul>
<li>Caller saves registers on the stack</li>
<li>Jump to the calling position 跳转到函数所在的地址</li>
<li>Callee saves registers, execute code, and restores registers 对于函数本身来说也会保存寄存器，并执行代码，在把寄存器中的内存恢复</li>
<li>Jumping back by popping up the return address</li>
<li>Caller restores registers on the stack</li>
</ul>
</li>
<li>If we can fuse function body into the caller and optimize together, then register saving / restoring and jumping will be almost eliminated 直接将内联函数插入到调用的地方，寄存器的保存和恢复，以及跳转的开销会被消除以达到优化的目的</li>
<li>Inline function should be put into header files 因为每个源文件都需要知道内联的函数体</li>
<li><code>inline</code>也会造成其他问题<ul>
<li>The code size may bloat（膨胀）, since the function body is inserted everywhere</li>
<li>Utility of instruction cache may be lower, since the same function has different addresses 对 i-cache 的利用率降低，相同的代码具有完全不一样的地址</li>
<li>Inline function won’t create their function address, so you cannot “jump to the next” when debugging 进行 debug 时把整个函数跳过去了</li>
</ul>
</li>
<li><code>inline</code> is just an suggestion to compiler, and compiler may choose to not inline the body<ul>
<li>递归调用</li>
<li>函数本身逻辑比较复杂</li>
<li>不知道什么时候使用 <code>inline</code> 合适</li>
</ul>
</li>
<li>Since C++ 17, inline variables are introduced 内联变量，可以直接把内联变量放到头文件中<ul>
<li>This mainly facilitates header-only libraries, since they hope to use some global variables without source files</li>
<li>Inline variables can also be in class definitions, so that <code>static</code> variable can be unnecessary to split definition and declaration 静态变量就不需要分开声明和定义了</li>
</ul>
</li>
<li>Inline functions/variables may cause double symbols in shared libraries 内联函数 / 变量会在动态链接是造成双定义<ul>
<li>静态链接库是需要完全的符号合并</li>
<li>但是动态链接库的符号是未必进行合并的 RTTI</li>
<li>在链接库的内外会存在两个版本的变量</li>
</ul>
</li>
</ul>
<h3 id="Linkage"><a href="#Linkage" class="headerlink" title="Linkage"></a>Linkage</h3><p>External linkage: Linker can always find the symbol in other TUs 链接器在大多数情况下都能在其他的 TU 中找到相关符号，这种的叫做外部链接，几乎所有的实体在不加关键字的情况下，都是 external linkage</p>
<ul>
<li>Class members</li>
<li>Functions</li>
<li>Functions declared by <code>friend</code></li>
<li>Enumerations</li>
<li>Templates</li>
<li>Non-const variables, volatile variables and inline variables</li>
</ul>
<p>Internal linkage: 但是有的时候不想暴露实体，使用外部链接会让其他 TU 窃取实现的私密性</p>
<ul>
<li><code>static</code> in introduced to force internal linkage 用 <code>static</code> 关键字声明内部链接性实体<ul>
<li>Unlike static member functions, <code>static</code> that denotes linkage is necessary in definition 在函数定义时需要带上<code>static</code>，成员函数则不需要</li>
<li>外部链接性和模板实例化不会冲突，完全是两个不相干的概念</li>
</ul>
</li>
<li>Another way is to define things in an anonymous namespace 需要定义大量的内部链接性实体时候可以使用</li>
<li>There are some special cases where entities are born with internal linkage<ul>
<li><code>const</code> global variables</li>
<li>Anonymous unions</li>
</ul>
</li>
</ul>
<h4 id="Singleton"><a href="#Singleton" class="headerlink" title="Singleton"></a>Singleton</h4><ul>
<li>Reason<ul>
<li>The sequence of initializing global variables across TU isn’t determined 全局变量初始化的顺序在同一个 TU 中可以保证，但是在不同的 TU 中不能保证</li>
<li>Side effects caused by global variables may not be executed</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// singleton.h</span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span><br>{<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">static</span> Singleton&amp; <span class="hljs-title">GetInstance</span><span class="hljs-params">()</span></span>;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-built_in">Singleton</span>() = <span class="hljs-keyword">default</span>;<br>}<br><span class="hljs-comment">// singleton.cpp</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"singleton.h"</span></span><br><br><span class="hljs-function">Singleton&amp; <span class="hljs-title">Singleton::GetInstance</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-type">static</span> Singleton* instance = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Singleton</span>();<br>    <span class="hljs-keyword">return</span> *instance;<br>}<br></code></pre></td></tr></table></figure>

<ul>
<li>No linkage 无链性<ul>
<li>This happens for static local variables (i.e. <code>static</code> variables in functions) and normal local variables</li>
<li>You can even define a class inside the block scope, which also has no linkage</li>
</ul>
</li>
</ul>
<h2 id="XMake"><a href="#XMake" class="headerlink" title="XMake"></a>XMake</h2><p>XMake acts as both a build tool and a package manager</p>
<ul>
<li><p>(Optional) Project name, project version and required xmake version</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lua">set_project(<span class="hljs-string">"Programming in Multiple Files"</span>)<br>set_xmakever(<span class="hljs-string">"2.8.1"</span>)<br>set_version(<span class="hljs-string">"0.0.0"</span><br></code></pre></td></tr></table></figure></li>
<li><p>Modes and language version</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua">add_rules(<span class="hljs-string">"mode.debug"</span>, <span class="hljs-string">"mode.release"</span>)<br>set_languages(<span class="hljs-string">"cxx20"</span>)<br></code></pre></td></tr></table></figure></li>
<li><p>Some other options</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua">set_policy(<span class="hljs-string">"build.warning"</span>, <span class="hljs-literal">true</span>)<br>set_warning(<span class="hljs-string">"all"</span>)<br></code></pre></td></tr></table></figure>

<ul>
<li><code>set_policy("build.warning", true)</code> means that report warning even if compile success</li>
</ul>
</li>
<li><p>Add required packages <code>add_requires("ctre 3.8.1", "catch2")</code></p>
</li>
<li><p>Specify the building target</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lua">target(<span class="hljs-string">"example"</span>)<br>    set_kind(<span class="hljs-string">"binary"</span>)<br>    add_headerfiles(<span class="hljs-string">"example1/*.h"</span>)<br>    add_files(<span class="hljs-string">"example1/*.cpp"</span>)<br></code></pre></td></tr></table></figure>

<ul>
<li><code>target(name)</code></li>
<li><code>set_kind(...)</code><ul>
<li><code>binary</code> will compile the executable</li>
<li><code>static</code> static library</li>
<li><code>shared</code> stared library/dynamic-linked library</li>
<li><code>phony</code> empty, just used to combine targets like libraries</li>
<li><code>header_only</code> for projects that only have header files</li>
</ul>
</li>
<li><code>add_files(...)</code></li>
<li><code>add_headerfiles(...)</code></li>
</ul>
</li>
<li><p><code>xmake</code> to compile all targets</p>
<ul>
<li><code>xmake -b xx</code> to compile specific targets</li>
<li><code>xmake run xx</code> to run specific executable</li>
</ul>
</li>
</ul>
<h2 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h2><ul>
<li><p>There are several problems in headers</p>
<ul>
<li>Non-inline functions cannot be defined to keep ODR</li>
<li><code>#include</code> always requires the preprocessor to copy all contents, which makes the real file huge and drags the compilation stage</li>
<li>If marcos aren’t undef, they will be leaked</li>
</ul>
</li>
<li><p>Every module has only one primary interface unit</p>
<ul>
<li><p>Begin with <code>export module Name</code> 在文件开始时声明</p>
</li>
<li><p>It regulates that entities are visible to other modules by <code>export</code> 文件中的其他实体都可以加 <code>export</code> 关键字</p>
</li>
<li><p>Module interface files have no determined suffix</p>
<ul>
<li>msvc - ixx</li>
<li>clang - cppm</li>
<li>gcc - don’t care</li>
<li>It can also be mmp, mmx</li>
</ul>
</li>
<li><p><code>export import</code> 字面意义</p>
</li>
<li><p>Modules 也允许声明和定义分离，原理是 module implementation unit</p>
<ul>
<li>It begins with <code>module Name;</code> and shouldn’t have any <code>export</code></li>
<li>A module can have multiple implementation files, as long as they all begin with <code>module Name;</code> 一个模块可以有多个源文件去实现</li>
<li>You can directly <code>import "xxx.h"</code>; they’re called <strong>header unit</strong></li>
<li>C++ uses <strong>global module fragment</strong><ul>
<li>It begins before <code>export module Name;</code> or <code>module Name;</code></li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">module</span>; <span class="hljs-comment">// global module fragment</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> NEED_PARAM</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"Old.h"</span></span><br><br><span class="hljs-keyword">module</span> Person; <span class="hljs-comment">//</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>You can partition either interface or implementation 如果模块太大也可以进行拆分</p>
<ul>
<li>Interface partition unit: begin with <code>export module Name:SubName;</code></li>
<li>Implementation partition unit: begin with <code>module Name:SubName2;</code></li>
<li>分区时模块内部的概念，对其他模块是透明的<ul>
<li>Inside the module, it can use <code>import :SubName</code> to import the partition</li>
<li>But in other modules, they cannot use <code>import Name:SubName</code></li>
</ul>
</li>
<li>Unlike module implementation, implementation partition is not implementation of interface partition 模块的实现分区和模块的接口分区并不是实现的对应关系，不能在出现同名的分区了<ul>
<li>If there exists <code>module A:B</code>; there shouldn’t exist <code>export module A:B</code></li>
</ul>
</li>
<li>Partitions cannot have partitions (depth == 1) 分区不能再进行分区</li>
</ul>
</li>
</ul>
<h2 id="Error-Handling"><a href="#Error-Handling" class="headerlink" title="Error Handling"></a>Error Handling</h2><h3 id="Error-code-extension"><a href="#Error-code-extension" class="headerlink" title="Error code extension"></a>Error code extension</h3><h4 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h4><ul>
<li><p>It uses an additional <code>bool</code> to denote “exist or not” 用 <code>bool</code> 值来表示是否存在</p>
<ul>
<li><p>Empty value then introduced as <code>std::nullopt</code>, which essentially makes the underlying <code>bool</code> to be the <code>false</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Key, <span class="hljs-keyword">typename</span> Val&gt;</span><br><span class="hljs-function">std::optional&lt;Val&gt; <span class="hljs-title">Get</span><span class="hljs-params">(<span class="hljs-type">const</span> std::map&lt;Key, Val&gt;&amp; map, <span class="hljs-type">const</span> Key&amp; key)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">auto</span> it = map.<span class="hljs-built_in">find</span>(key); it != map.<span class="hljs-built_in">end</span>()<br>        <span class="hljs-keyword">return</span> it-&gt;second;<br>    <span class="hljs-keyword">return</span> std::<span class="hljs-literal">nullopt</span>;<br>}<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Ctor, <code>operator=</code>, <code>swap</code>, <code>emplace</code>, <code>std::swap</code>, <code>std::make_optional</code></p>
<ul>
<li>Ctor can also accept <code>(std::in_place, Args to construct T)</code></li>
</ul>
</li>
<li><p><code>operator&lt;=&gt;</code></p>
</li>
<li><p><code>std::hash</code>; unlike <code>std::variant</code>, it’s guaranteed for <code>std::optional</code> to have the same hash as <code>std::hash&lt;T&gt;</code> if it’s not <code>std::nullopt</code></p>
</li>
<li><p>You can just use <code>std::optional</code> as a nullable pointer</p>
<ul>
<li><code>operator-&gt;/operator*/operator bool</code>, as if a T*<ul>
<li>The behavior is undefined for <code>-&gt;/*</code> if it’s in fact <code>std::nullopt</code></li>
</ul>
</li>
<li><code>.has_value()</code>, <code>.value()</code> (which will throw <code>std::bad_optional_access</code> instead of <code>std::nullopt</code>)</li>
<li><code>.value_or(xx)</code> can provide a default value</li>
</ul>
</li>
<li><p>Note</p>
<ul>
<li>Most of types in Java and C# are nullable, which makes them “optional” automatically 像是 Java 和 C# 语言大部分的变量类型都是自动的”optional”，但是也会有效率上的问题</li>
<li><code>std::optional</code>, <code>std::expected</code>, <code>std::any</code> and <code>std::variant</code> are sometimes called “vocabulary type” 它们都不能用作引用类型去实例化模板 <code>std::optional&lt;int&amp;&gt;</code></li>
<li>Though <code>std::optional</code> only store an additional <code>bool</code>, this alignment and padding will make it in fact larger</li>
</ul>
</li>
</ul>
<h4 id="Expected"><a href="#Expected" class="headerlink" title="Expected"></a>Expected</h4><ul>
<li>It uses an Error type (i.e. <code>std::expected&lt;T, E&gt;</code>) instead of <code>null</code> to denote absent value 用第二个模板参数来表达错误类型，更被建议用作错误处理</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">std::expected&lt;<span class="hljs-type">double</span>, std::errc&gt; <span class="hljs-title">parse_number</span><span class="hljs-params">(std::string_view&amp; str)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-type">double</span> result;<br>    <span class="hljs-keyword">auto</span> begin = str.<span class="hljs-built_in">data</span>();<br>    <span class="hljs-keyword">auto</span> [end, ec] = std::<span class="hljs-built_in">from_chars</span>(begin, begin + str.<span class="hljs-built_in">size</span>(), result);<br><br>    <span class="hljs-keyword">if</span> (ec != std::errc{})<br>        <span class="hljs-keyword">return</span> std::unexpected{ec};<br>    <span class="hljs-keyword">if</span> (std::<span class="hljs-built_in">isinf</span>(result))<br>        <span class="hljs-keyword">return</span> std::unexpected{std::errc::result_out_of_range};<br>    str.<span class="hljs-built_in">remove_prefix</span>(end - begin);<br>    <span class="hljs-keyword">return</span> result;<br>}<br></code></pre></td></tr></table></figure>

<h4 id="Monad"><a href="#Monad" class="headerlink" title="Monad"></a>Monad</h4><ul>
<li><code>&lt;T1, E1&gt;.and_then(T1)</code> needs to return <code>&lt;T2, E1&gt;</code><ul>
<li>For <code>std::optional</code>, it’s obligated to return <code>std::optional&lt;T2&gt;</code></li>
</ul>
</li>
<li><code>&lt;T1, E1&gt;.transform(T1)</code> needs to return <code>T2</code>, which will construct <code>&lt;T2, E1&gt;</code> automatically<ul>
<li>For <code>std::optional</code>, it’s obligated return <code>T2</code>, which will construct <code>&lt;T2&gt;</code></li>
</ul>
</li>
<li><code>&lt;T1, E1&gt;.or_else(T1)</code> needs to return <code>&lt;T1, E2&gt;</code><ul>
<li>For <code>std::optional</code>, it’s obligated return <code>std::optional&lt;T1&gt;</code></li>
</ul>
</li>
<li><code>&lt;T1, E1&gt;.transform_error(E1)</code> needs to return <code>E2</code>, which will construct <code>&lt;T1, E2&gt;</code> automatically</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">auto</span> process = [](std::string_view str)<br>{<br>    std::<span class="hljs-built_in">print</span>(<span class="hljs-string">"str: {:?},"</span>, str);<br>    <span class="hljs-built_in">parse_number</span>(str).<span class="hljs-built_in">transform</span>([](<span class="hljs-type">double</span> val)<br>    {<br>        std::<span class="hljs-built_in">println</span>(<span class="hljs-string">"value: {}"</span>, val);<br>        <span class="hljs-keyword">return</span> val;<br>    }).<span class="hljs-built_in">transform_error</span>([](std::errc err)<br>    {<br>        <span class="hljs-keyword">if</span> (err == std::errc::invalid_argument)<br>            std::<span class="hljs-built_in">println</span>(<span class="hljs-string">"error: invalid input"</span>);<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (err == std::errc::result_out_of_range)<br>            std::<span class="hljs-built_in">println</span>(<span class="hljs-string">"error: overflow"</span>);<br>        <span class="hljs-keyword">return</span> err;<br>    });<br>}<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> src : {<span class="hljs-string">"42"</span>, <span class="hljs-string">"32abc"</span>, <span class="hljs-string">"meow"</span>, <span class="hljs-string">"inf"</span> })<br>    <span class="hljs-built_in">process</span>(src);<br></code></pre></td></tr></table></figure>

<h3 id="Exception"><a href="#Exception" class="headerlink" title="Exception"></a>Exception</h3><ul>
<li>Exception is a technique that will automatically propagate to the caller if it’s omitted 异常可以将调用者忽略的错误自动地传递给更上层的调用者<ul>
<li>For example, function chain A -&gt; B -&gt; C -&gt; D, if D throws an exception, and D doesn’t catch it, then C needs to do so; if C doesn’t, B needs to do so; etc.</li>
</ul>
</li>
<li><code>try - catch</code> block to catch an exception</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">try</span><br>{<br>    <span class="hljs-built_in">Test</span>();<br>}<br><span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::out_of_range&amp; error)<br>{<br>    std::cout &lt;&lt; <span class="hljs-string">"Encountering error:"</span>;<br>    std::cout &lt;&lt; error.<span class="hljs-built_in">what</span>() &lt;&lt; <span class="hljs-string">"\n"</span>;<br>}<br><span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::invalid_argument&amp; error)<br>{<br>    <span class="hljs-comment">// ...</span><br>}<br><span class="hljs-built_in">catch</span> (...) {<span class="hljs-comment">/* ... */</span>}<br></code></pre></td></tr></table></figure>

<blockquote>
<p><code>.what()</code> is a virtual method of <code>std::exception</code></p>
</blockquote>
<ul>
<li>Note<ul>
<li>You only need to catch exception when this method can handle it</li>
<li>Though you can throw any type, it’s recommended to throw a type inherited from <code>std::exception</code><ul>
<li>Reason: base class can also match derived class exception to catch it, so you can always <code>catch(const std::exception&amp;)</code> and print <code>.what()</code> to know information</li>
</ul>
</li>
<li>Catch block is matched one by one catch 块是线性的进行的</li>
<li>Though it’s allowed to catch with or without <code>const/&amp;</code>, exception should definitely be caught by <code>const Type&amp;</code></li>
<li>If you’re in a <code>catch</code> block and find that the caught exception still cannot be handled, you can use a single <code>throw;</code> to throw this exception again 不能处理异常可以继续往上抛出，最好不抛出异常对象</li>
<li>If another exception is thrown during internal exception handling (e.g. dtor throw an exception during stack unwinding), <code>std::terminate</code> will also be called 在处理异常的时候由出现了异常会直接终结，不可能在异常中再重新抛出异常了</li>
</ul>
</li>
</ul>
<h3 id="Exception-Safety"><a href="#Exception-Safety" class="headerlink" title="Exception Safety"></a>Exception Safety</h3><ul>
<li><p>Exception safety means that when an exception is thrown and caught, program is still in a valid state and can correctly run 当异常被抛出并且被捕获后，程序依然处于有效状态并且正确运行</p>
<ul>
<li><p>No guarantee 没有异常安全性</p>
<ul>
<li>资源或内存泄漏</li>
<li>不变量被破坏</li>
<li>内存发生了损毁，一片内存写了一部分就发生了损坏并退出了程序</li>
</ul>
</li>
<li><p>Basic guarantee: at least program can run normally, no resources leak, invariants are maintained, etc</p>
<ul>
<li><p>RAII is a really important technique for basic guarantee</p>
</li>
<li><p>解决方案是使用析构函数 use destructor</p>
</li>
<li><p>RAII (Resource acquirement is initialization): acquire resources in ctor and release them in dtor 在构造函数里申请资源，在析构函数里释放资源，这就是 RAII</p>
<ul>
<li><code>std::unique_ptr</code> to manage heap memory instead of <code>new/delete</code></li>
<li><code>std::lock_guard</code> to manage mutex instead of <code>lock/unlock</code></li>
<li><code>std::fstream</code> to manage file instead of <code>FILE* fopen/fclose</code></li>
<li>自己编写的类也要符合 RAII 的原则</li>
</ul>
</li>
<li><p>To sum up, all members that have been fully constructed will be destruct, but dtor of itself won’t be called 只有在构造函数中完全初始化（没有异常）析构函数才会执行</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-built_in">MyData</span>(<span class="hljs-type">int</span> id) : ptr1{<span class="hljs-literal">nullptr</span> }, someData{<span class="hljs-literal">nullptr</span> } {<br>    <span class="hljs-keyword">auto</span> init_ptr1 = std::unique_ptr&lt;<span class="hljs-type">int</span>&gt;{<span class="hljs-keyword">new</span> <span class="hljs-type">int</span> {id} };<br>    <span class="hljs-keyword">auto</span> init_someData = std::unique_ptr&lt;<span class="hljs-type">int</span>&gt;{<span class="hljs-keyword">new</span> <span class="hljs-type">int</span> {id} };<br>    <span class="hljs-comment">// will never throw below</span><br>    ptr1 = init_ptr1.<span class="hljs-built_in">release</span>(); <span class="hljs-comment">// release ownership, so dtor of</span><br>    someData = init_someData.<span class="hljs-built_in">release</span>(); <span class="hljs-comment">// unique_ptr does nothing</span><br>}<br><br>~<span class="hljs-built_in">MyData</span>() { <span class="hljs-keyword">delete</span> ptr1; <span class="hljs-keyword">delete</span> someData; }<br></code></pre></td></tr></table></figure>

<ul>
<li>指针抛出的异常是<code>std::bad_alloc</code></li>
<li><code>new(std::nothrow)</code> will return <code>nullptr</code> instead of throwing exception. e.g. <code>new(std::throw) int{id}</code> 但是仍然需要判断<code>nullptr</code></li>
</ul>
</li>
</ul>
</li>
<li><p>Strong exception guarantee 强异常保证，当函数抛出异常后，程序能够回滚到原来的状态</p>
<ul>
<li><p>Most of methods in STL obey strong exception guarantee</p>
<ul>
<li><code>std::vector::push_back()</code>, <code>std::vector</code> has same elements as before even if exception is thrown 当插入元素失败的时候，原来 <code>vector</code> 中的元素还存在</li>
</ul>
</li>
<li><p>A technique to maintain strong exception guarantee in assignment operator is copy-and-swap idiom 拷贝交换惯用法</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vector</span><br>{<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Vector</span>(std::<span class="hljs-type">size_t</span> num, <span class="hljs-type">const</span> T&amp; val)<br>    {<br>        std::unique_ptr&lt;T[]&gt; arr{ <span class="hljs-keyword">new</span> T[num] };<br>        std::ranges::<span class="hljs-built_in">fill</span>(arr.<span class="hljs-built_in">get</span>(), arr.<span class="hljs-built_in">get</span>() + num, val);<br>        first_ = arr.<span class="hljs-built_in">release</span>();<br>        last_ = end_ = first_ + num;<br>    }<br><br>    <span class="hljs-function">std::<span class="hljs-type">size_t</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{<span class="hljs-keyword">return</span> last_ - first_; }<br>    <span class="hljs-keyword">auto</span>&amp; <span class="hljs-keyword">operator</span>[](std::<span class="hljs-type">size_t</span> idx) <span class="hljs-keyword">noexcept</span> {<span class="hljs-keyword">return</span> first_[idx]; }<br>    <span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; <span class="hljs-keyword">operator</span>[](std::<span class="hljs-type">size_t</span> idx) <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> {<span class="hljs-keyword">return</span> first_[idx]; }<br><br>    <span class="hljs-built_in">Vector</span>(<span class="hljs-type">const</span> Vector&amp; another)<br>    {<br>        <span class="hljs-keyword">auto</span> size = another.<span class="hljs-built_in">size</span>();<br>        std::unique_ptr&lt;T[]&gt; arr{ <span class="hljs-keyword">new</span> T[size] };<br>        std::ranges::<span class="hljs-built_in">copy</span>(another.first_, another.last_, arr.<span class="hljs-built_in">get</span>());<br>        first_ = arr.<span class="hljs-built_in">release</span>();<br>        last_ = end_ = first_ + size;<br>    }<br><span class="hljs-keyword">private</span>:<br>    T* first_, *last_, *end_;<br>};<br></code></pre></td></tr></table></figure>

<p>如何实现<code>operator=</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++">Vector&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Vector&amp; another)<br>{<br>    <span class="hljs-keyword">delete</span>[] first_; <span class="hljs-comment">// 只是放指针所指向的内存</span><br>    <span class="hljs-keyword">auto</span> size = another.<span class="hljs-built_in">size</span>();<br>    std::unique_ptr&lt;T[]&gt; arr{ <span class="hljs-keyword">new</span> T[size] };<br>    first_ = arr.<span class="hljs-built_in">release</span>();<br>    std::ranges::<span class="hljs-built_in">copy</span>(another.first_, another.last_, first_);<br>    last_ = end_ = first_ + size;<br>    <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>}<br></code></pre></td></tr></table></figure>

<p>如果 <code>new</code> 抛出异常，尽管内存已经释放掉了，但是 <code>first_</code> 和<code>end_</code>仍然不变，所以 <code>.size()</code> 依然不变</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++">Vector&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Vector&amp; another)<br>{<br>    <span class="hljs-keyword">delete</span>[] first_;<br>    first_ = last_ = end_ = <span class="hljs-literal">nullptr</span>; <span class="hljs-comment">// 将指针也释放掉</span><br>    <span class="hljs-keyword">auto</span> size = another.<span class="hljs-built_in">size</span>();<br>    std::unique_ptr&lt;T[]&gt; arr{ <span class="hljs-keyword">new</span> T[size] };<br>    first_ = arr.<span class="hljs-built_in">release</span>();<br>    std::ranges::<span class="hljs-built_in">copy</span>(another.first_, another.last_, first_);<br>    last_ = end_ = first_ + size;<br>    <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>}<br></code></pre></td></tr></table></figure>

<p>如果 <code>std::ranges::copy</code> 出现了异常，那么 <code>first_ ，</code>last_<code>，</code>end_<code> 状态又是不一致的，</code>first_` 被先赋值的</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++">Vector&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Vector&amp; another)<br>{<br>    <span class="hljs-keyword">delete</span>[] first_;<br>    first_ = last_ = end_ = <span class="hljs-literal">nullptr</span>; <span class="hljs-comment">// 将指针也释放掉</span><br>    <span class="hljs-keyword">auto</span> size = another.<span class="hljs-built_in">size</span>();<br>    std::unique_ptr&lt;T[]&gt; arr{ <span class="hljs-keyword">new</span> T[size] };<br>    std::ranges::<span class="hljs-built_in">copy</span>(another.first_, another.last_, first_);<br>    <span class="hljs-comment">// only release when all exceptions are possibly thrown!</span><br>    first_ = arr.<span class="hljs-built_in">release</span>();<br>    last_ = end_ = first_ + size;<br>    <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>}<br></code></pre></td></tr></table></figure>

<p>满足了基本异常安全的保证，但是不满足强异常安全性的保证，必须保证释放资源是在所有可能抛出异常语句的后面</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++">Vector&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Vector&amp; another)<br>{<br>    <span class="hljs-keyword">auto</span> size = another.<span class="hljs-built_in">size</span>();<br>    std::unique_ptr&lt;T[]&gt; arr{ <span class="hljs-keyword">new</span> T[size] };<br>    std::ranges::<span class="hljs-built_in">copy</span>(another.first_, another.last_, first_);<br>    <span class="hljs-keyword">delete</span>[] first_;<br>    first_ = arr.<span class="hljs-built_in">release</span>();<br>    last_ = end_ = first_ + size;<br>    <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>}<br></code></pre></td></tr></table></figure>

<p>除了 <code>delete[]</code> 其他的和构造函数几乎一样，可以换一种方式实现</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">friend</span> <span class="hljs-type">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(Vector&amp; vec1, Vector&amp; vec2)</span> <span class="hljs-keyword">noexcept</span></span><br><span class="hljs-function"></span>{<br>    std::range::<span class="hljs-built_in">swap</span>(vec1.first_, vec2.first_);<br>    std::range::<span class="hljs-built_in">swap</span>(vec1.last_, vec2.last_);<br>    std::range::<span class="hljs-built_in">swap</span>(vec1.end_, vec2.end_);<br>}<br>Vector&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Vector&amp; another)<br>{<br>    Vector vec{another};<br>    <span class="hljs-built_in">swap</span>(vec, *<span class="hljs-keyword">this</span>);<br>    <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>}<br></code></pre></td></tr></table></figure>

<ul>
<li>Allocating memory before releasing, which increases peak memory</li>
<li>Swap cost it slightly higher than direct assignment</li>
<li>May be not optimal for performance</li>
</ul>
</li>
<li><p>Exception safety of containers</p>
<ul>
<li>All read-only &amp; <code>.swap()</code> don’t throw at all 所有只读方法和 <code>.swap()</code> 都不抛出异常，除了故意抛出异常的函数</li>
<li>For <code>std::vector</code>, <code>.push_back()</code>, <code>emplace_back()</code>, or <code>.insert/emplace/insert_range/append_range()</code> only one element at back provide strong exception guarantee</li>
<li>For <code>std::list/forward_list</code>, all strong exception guarantee 因为内存不是连续的，所有的方法都会保证强异常安全性</li>
<li>For <code>std::deque</code>, it’s similar to <code>std::vector</code>, adding push at front</li>
<li>For associative containers, <code>.insert/...</code> a node only a single element has strong exception guarantee</li>
</ul>
</li>
</ul>
</li>
<li><p>Strongest exception safety 最强异常安全性：一个方法永远都不会抛出异常可以加上 <code>noexcept</code> 标识符</p>
<ul>
<li>If your function is labeled as <code>noexcept</code> but it throws exception, then <code>std::terminate</code> will be called</li>
<li><code>noexcept</code> is also an operator 也是一个运算符，用 evaluate 函数是否标记了 <code>noexcept</code> 标识符</li>
<li><strong>IMPORT</strong>: destructor &amp; deallocation is always assumed to be <code>noexcept</code> by standard library 标准库永远假设析构函数和释放行为不会抛出异常<ul>
<li>Dtor is the only function by default <code>noexcept</code> without any explicit specifier if all dtors of members are <code>noexcept</code></li>
<li>编译器自动生成的构造函数或赋值函数也是<code>noexcept</code></li>
</ul>
</li>
<li>Since C++ 17, noexcept function pointer is also supported C++ 17 支持了函数指针用 <code>noexcept</code> 标识 e.g. <code>using Ptr = void(*)(int) noexcept; Ptr ptr = square;</code> 不能指向可以抛出异常的函数</li>
<li>General rule: for normal methods, only when the operation obviously doesn’t throw should you add <code>noexcept</code><ul>
<li>Merely read-only methods in containers (like <code>.size()</code>) are marked as <code>noexcept</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="When-to-use-exception"><a href="#When-to-use-exception" class="headerlink" title="When to use exception"></a>When to use exception</h3><ul>
<li>Exception is relatively costly compared with other error handling mechanisms, like it relies on heap allocation 相对于其他错误处理机制代价更高，需要保证抛出异常发生情况是极少数的情况；只有在抛出和捕获的时候才有开销</li>
<li>Besides, in current typical implementations, stack unwinding of exception needs a global lock, which is really unfriendly to multi-threading programs 对多线程不友好</li>
<li>Also, exception is highly dependent on platform (just like RTTI)</li>
</ul>
<h3 id="Assertion"><a href="#Assertion" class="headerlink" title="Assertion"></a>Assertion</h3><p>Assertion is a technique to <strong>check expected behaviors</strong> of functions or code segments <strong>when debugging</strong></p>
<ul>
<li>When the parameter is evaluated to <code>false</code>, program will be aborted<ul>
<li><code>std::abort()</code> is the default behavior of <code>std::terminate()</code>, but latter can change its behavior by <code>std::set_terminate_handler(...)</code></li>
<li>It’s a macro defined in <code>&lt;cassert&gt;</code></li>
</ul>
</li>
<li><code>assert</code>用作没有副作用行为的条件检查</li>
<li><code>assert</code> is done in runtime; if you want to determine in compile time, you can use keyword <code>static_asset(xx, msg)</code>, <code>msg</code> can be omitted since C++ 17</li>
<li>通常用于内部的方法，检查已应过滤掉，但是仍然会出现的非法的情况，用于在 <strong>debug</strong> 中定位问题</li>
<li>Assertion 在安全检查方面是非常有限的</li>
<li><code>Contract</code> C++ 26 is likely to add <code>contract</code>, which will enrich it a lot</li>
</ul>
<h3 id="Debug-Helpers"><a href="#Debug-Helpers" class="headerlink" title="Debug Helpers"></a>Debug Helpers</h3><ul>
<li><p>Source Location</p>
<ul>
<li><p>Before C++ 20, we may use maros <code>__FILE__</code> and <code>__LINE__</code>, which will be substituted to source file name and line number</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">CheckError</span><span class="hljs-params">(cudaError_t error, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* file, <span class="hljs-type">int</span> line)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-keyword">if</span> (error == cudaSuccess)<br>        <span class="hljs-keyword">return</span>;<br>    std::cerr &lt;&lt; <span class="hljs-string">"Cuda Error at file"</span> &lt;&lt; file &lt;&lt; <span class="hljs-string">"line :"</span> line &lt;&lt; <span class="hljs-string">":"</span> &lt;&lt; <span class="hljs-built_in">cudaGetErrorString</span>(error);<br>    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>}<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CHECK_ERROR(<span class="hljs-keyword">error</span>) (CheckError((<span class="hljs-keyword">error</span>), __FILE__, __LINE__))</span><br></code></pre></td></tr></table></figure>

<p><code>__FILE__</code>和 <code>__LINE__</code> 是不能用在 <code>CheckError</code> 的默认参数中的，因为这两个宏是在预处理的时候确定的，而不是在调用的时候确定的</p>
</li>
<li><p>Since C++ 20, <code>&lt;source_location&gt;</code> is added to solve it</p>
<ul>
<li><code>void logError(std::string_view errorInfo, std::ostream&amp; logFile = std::cerr, const std::source_location&amp; location =  std::source_location::current());</code></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">logError</span><span class="hljs-params">(std::string_view errorInfo, std::ostream &amp;logFile = std::cerr, <span class="hljs-type">const</span> std::source_location &amp;location = std::source_location::current())</span></span><br><span class="hljs-function"></span>{<br>    logFile &lt;&lt; std::format(<span class="hljs-string">"In file {} function {} - line {}, Error :\n{}\n"</span>,<br>        location.<span class="hljs-built_in">file_name</span>(), location.<span class="hljs-built_in">function_name</span>(), location.<span class="hljs-built_in">line</span>(), errorInfo);<br>    <span class="hljs-keyword">return</span>;<br>}<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>stacktrace</p>
<ul>
<li>Since C++ 23, in <code>&lt;stacktrace&gt;</code></li>
<li>Similar to <code>source_location</code>, you need <code>std::stacktrace::current</code> to get it; but you may print it directly</li>
</ul>
</li>
<li><p>debugging, Since C++ 26, in <code>&lt;debugging&gt;</code></p>
</li>
</ul>
<h3 id="Unit-Test"><a href="#Unit-Test" class="headerlink" title="Unit Test"></a>Unit Test</h3><h4 id="Catch2"><a href="#Catch2" class="headerlink" title="Catch2"></a>Catch2</h4><p>A C++ unit test framework - <font color="#3FC1C9"><strong>Catch2</strong></font></p>
<ul>
<li>Catch2 uses macro, so still remember to add paratheses for comma</li>
<li>Catch2 overloads <code>operator&amp;&amp;</code> and <code>operator||</code>, so using them <strong>won’t be short-circuit</strong><ul>
<li>Thus, you may need to split it to multiple <code>REQUIRE</code></li>
</ul>
</li>
<li><code>SECTION</code> can be generated dynamically; you just need to ensure they have different names</li>
</ul>
<h2 id="String-and-String-View"><a href="#String-and-String-View" class="headerlink" title="String and String View"></a>String and String View</h2><ul>
<li>常量字符串类型 <code>const char[]</code> 赋值给 <code>auto</code> 类型会退化为 <code>const char*</code>，C++ 中不能将<code>const char[]</code> 赋值给<code>char*</code>，除非使用<code>const_cast</code></li>
<li>可以使用空格或换行来连接两个字符串常量 e.g. <code>"123" "456"</code>和 <code>"123456"</code> 一样，编译器编译的时候会进行拼接</li>
<li>Raw strings: 任意字符都不会被转义 escaped<ul>
<li><code>\\\n\"</code>在普通字符串解释为 <code>\\n"</code>，但是用裸字符串表示<code>R"(\\\n\")"</code> 就是 6 个字符</li>
<li>例如 Windows 系统中的文件路径</li>
<li>裸字符解析主要是通过匹配 <code>"(</code> 和<code>')"'</code>，但是可以在 <code>"</code> 和<code>(</code>或 <code>)</code> 之间加入任意其他通配符配合将中间的字符部分解析为裸字符串 e.g. <code>R"+(I want a)"!)+"</code></li>
</ul>
</li>
</ul>
<h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><ul>
<li><code>std::string</code>是 <code>std::vector&lt;char&gt;</code> 的加强版</li>
<li>很多方法和 <code>std::vector</code> 一模一样</li>
<li>提供了 <code>.length()</code> 函数，和 <code>.size()</code> 一样，只是 length 是更常见命名习惯</li>
<li><code>.append</code>, <code>.append_range</code>和 <code>insert(str.end(), ...)</code> 一样，但是不能插入一个字符串，返回值是对 string 的引用</li>
<li><code>.assign</code>, <code>.insert</code>, <code>.erase</code>, <code>.append</code>都提供了下标的版本</li>
<li><code>.starts_with</code>, <code>ends_with</code> (C++ 20); <code>contains</code> (C++ 23)</li>
<li><code>.substr(index(, count))</code>: 从 <code>index</code> 开始到 <code>count</code> 结束，<code>count</code>默认是<code>std::string::npos</code>，会创建新的对象</li>
<li><code>.replace</code>: replace part of the string with a new string same as sub-string</li>
<li><code>.data()</code>, <code>.c_str()</code>: get the underlying pointer<ul>
<li>C++ 17 之后 <code>.data()</code> 返回的是<code>char*</code>，而不是<code>const char*</code></li>
<li><code>.c_str()</code>返回的是<code>const char *</code></li>
</ul>
</li>
<li>Search<ul>
<li>如果找不到则返回 <code>std::string::npos</code>，也就是<code>static_cast&lt;size_t&gt;(-1)</code> 一个很大的数</li>
<li><code>.find()</code>,<code>rfind()</code>: 正向查找或逆向查找</li>
<li><code>find_first_of()</code>, <code>find_first_not_of()</code>, <code>find_last_of()</code>, <code>find_last_not_of()</code></li>
</ul>
</li>
<li>Notes<ul>
<li><code>find()</code>时，使用不等号来判断是否找到，而不是用<code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code></li>
<li><code>std::string</code> guarantees the underlying string is null-terminated<ul>
<li><code>std::string</code>可以存储<code>'\0'</code></li>
</ul>
</li>
<li><code>std::string</code> has <strong>SSO</strong> (small string optimization) 段字符串优化<ul>
<li>当 string 非常小的时候可以放到栈上而不是放到堆上，降低内存分配</li>
<li>具体 string 在栈上可以容纳多少字符是由标准库实现的；在 x64 libstdc++/VC 上是 15，在 libc++ 上是 22</li>
</ul>
</li>
<li>C++ 23 introduces another optimization for resizing<ul>
<li>Resize 通常需要用固定的字符（例如 <code>'\0'</code>）去填充，通常需要<code>reserve</code> 和<code>insert</code>两个步骤，性能上会有损耗</li>
<li><code>.resize_and_overwrite(newSize, Op)</code>意义更明确，并且是覆盖</li>
</ul>
</li>
<li>和数字进行相互转换<ul>
<li><code>std::stoi/sto(u)l/sto(u)ll(string, std::size_t* end = nullptr, int base = 10)</code><ul>
<li>It will stop at the end of the first parsed number, and try to write the stop index to <code>*end</code> 在结束之前解析好，解析失败会抛出异常<code>std::invalid_argument</code></li>
</ul>
</li>
<li>Base（进制） can be 2 - 36 按照字母表的顺序添加；<code>base=0</code>时会根据字符串前缀自动解析进制大小<ul>
<li>前缀时 <code>0</code> 是八进制</li>
<li>前缀是 <code>0x</code> 是十六进制</li>
</ul>
</li>
<li><code>std::stof/stod/stold(string, std::size_t* end = nullptr)</code></li>
<li><code>std::to_string()</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="String-View"><a href="#String-View" class="headerlink" title="String View"></a>String View</h3><p>如果在函数中仅仅是读取一个 string，就会用 <code>const std::string&amp;</code> 作为参数，如果传入的是 C-string 类型，就会构造一个临时的 string 对象，这种情况可以使用<code>std::string_view</code>（C++ 17）。可以理解为本身就存储了一个<code>const char*</code></p>
<ul>
<li><code>.substr</code>返回的仍然是 <code>std::string_view</code> 而不是<code>std::string</code></li>
<li>不支持<code>operator+</code></li>
<li><code>std::string_view</code> is not required to be null-terminated 都是通过 length 识别长度的</li>
<li>The pointer it contains can be <code>nullptr</code><ul>
<li>C++ 23 开始不能使用 <code>nullptr</code> 进行构造</li>
</ul>
</li>
<li>当 <code>std::string_view</code> 做为返回值时，注意指针悬垂的问题<ul>
<li>返回 <code>std::string</code> 是安全的</li>
</ul>
</li>
<li>作为模板参数时也要注意声明周期</li>
</ul>
<h3 id="User-defined-literals- 用户定义自变量"><a href="#User-defined-literals- 用户定义自变量" class="headerlink" title="User-defined literals 用户定义自变量"></a>User-defined literals 用户定义自变量</h3><ul>
<li>类似数值类型 <code>1ull</code> 表示数字 <code>1</code> 是<code>unsigned long long</code> 类型的，字符串对象也可以使用用户自定义变量</li>
<li><code>std::string</code>: <code>"PKU"s</code></li>
<li><code>std::string_view</code>: <code>"PKU"sv</code></li>
<li><code>1s</code> for seconds, <code>1.1ms</code> for milliseconds, <code>1d</code> for a day</li>
<li><code>1i</code> for pure imaginary number 复数，<code>1.2if</code>, <code>2.5id</code></li>
<li>Remember <code>using namespace std::literals;</code> in your local scope</li>
<li>也可以自己定义用户定义自变量<ul>
<li><code>constexpr unsigned int operator"" _KB(unsigned long long m) {return static_cast&lt;unsigned int&gt;(m) * 1024; }</code></li>
<li>The parameter type is limited 参数类型的限制<ul>
<li>对整数来说只支持<code>unsigned long long</code>，最大的整数类型</li>
<li>对浮点数只支持<code>long double</code></li>
<li>对字符<code>char</code></li>
<li>对 C-strings<code>const CHAR*, std::size_t</code></li>
<li>最后兜底（fallback）类型是<code>const char*</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="charconv"><a href="#charconv" class="headerlink" title="charconv"></a>charconv</h3><ul>
<li><p><code>stoi/to_string</code> will create new <code>std::string</code>; we may want to provide storage ourselves</p>
<ul>
<li>E.g. <code>stoi(std::string{view})</code> is costly, since we only read the string 耗费资源</li>
<li>Also, they may throw exceptions, which are expensive sometimes 抛出异常也很耗费资源</li>
</ul>
</li>
<li><p>You can use <code>std::from_chars</code> and <code>std::to_chars</code> in <code>&lt;charconv&gt;</code></p>
<ul>
<li><code>std::from_chars(const char* begin, const char* end, val)</code> will try to save the result into <code>val</code> (an integer or a floating point)</li>
<li>It returns <code>std::from_chars_result</code>, which includes <code>.ptr</code> as stopping point and <code>.ec</code> as error code</li>
<li>When <code>ec == std::errc{}</code>, success; it’s also possible that <code>ec == std::errc::invalid_argument</code>, or <code>std::errc::result_out_of_range</code></li>
<li>You can use structured binding, e.g. <code>if(auto [ptr, ec] = xx; ec != std::errc{})</code>.</li>
</ul>
</li>
<li><p><code>std::from_chars(const char* begin, const char* end, val)</code> will try to save the result into <code>val</code> 必须以数字开头</p>
<ul>
<li><code>base/std::chars_format</code> 进制或格式</li>
</ul>
</li>
<li><p><code>std::to_chars(const char* begin, const char* end, val)</code> will try to write <code>val</code> (an integer or a floating point) into <code>[begin, end)</code></p>
<ul>
<li><code>base/std::chars_format</code></li>
</ul>
</li>
</ul>
<h2 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h2><ul>
<li>UTF-32: make each character occupy 32 bits; it’s direct but useful, since at most 4 billion characters can be used<ul>
<li>But it may occupy too much space, e.g. <code>abc</code> needs only 4 bytes before, but currently 16 bytes!</li>
<li>It also needs BOM</li>
</ul>
</li>
<li>UTF-8: to solve space waste, UTF-8 uses code with varying length<ul>
<li>Different character length has different coding prefix (like Huffman tree that we’ve learnt) to ensure no ambiguity</li>
<li>This makes it waste some code space, so some characters may need more than 4 bytes</li>
<li>For example, ASCII characters, including null-termination ‘\0’, still occupy 1 byte in UTF-8 (the coding is same too) 兼容之前的 ASCII 字符的</li>
<li>UTF-8 is the most commonly used character set in modern systems</li>
</ul>
</li>
</ul>
<div class="note note-warning">
            <p>Notice that UTF8 doesn’t need BOM, but Windows identifies Unicode by BOM long long before (UCS-2 needs that), and it has been part of Windows and hard to change, so Windows may require you to give UTF8 a BOM<br>UTF-8 是单字节并不需要 BOM，但是 Windows 需要 BOM 去识别是不是 Unicode</p>
          </div>

<ul>
<li>Unicode has these basic elements:<ul>
<li>Byte, i.e. computer representation</li>
<li>Code unit, i.e. (byte count ÷ minimal bytes) used to represent a character (1 for UTF-8, 2 for UTF-16, 4 for UTF-32) 一个 code unit 并不一定是合法的字符</li>
<li>Code point, i.e. each Unicode character</li>
<li>Text element, i.e. what humans really see on the screen</li>
</ul>
</li>
</ul>
<h3 id="Unicode-Support-in-C"><a href="#Unicode-Support-in-C" class="headerlink" title="Unicode Support in C++"></a>Unicode Support in C++</h3><ul>
<li>There are <code>char8_t/char16_t/char32_t</code> for UTF-8/16/32, but it’s used as one code unit, instead of one code point<ul>
<li>They’re at least 8/16/32 bits to hold one code unit 表示 code unit 比较合适</li>
<li>You can use <code>u8/u/U</code> as prefix separately</li>
</ul>
</li>
</ul>
<div class="note note-info">
            <p>But one code point may (and usually) have more than one code unit, so some weird things may happen</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-type">char8_t</span> ch1 = <span class="hljs-string">u8'A'</span>; <span class="hljs-comment">// correct</span><br><span class="hljs-type">char8_t</span> ch2 = <span class="hljs-string">u8'刘'</span>; <span class="hljs-comment">// cannot be represented in 1 byte, compile error</span><br><span class="hljs-type">const</span> <span class="hljs-type">char8_t</span> str1 = <span class="hljs-string">u8"刘"</span>; <span class="hljs-comment">// correct, but sizeof(str1) = 3, 2 for 刘 and 1 for null-termination</span><br></code></pre></td></tr></table></figure><p>There are also types like <code>std::u8string</code>, but they are all in code units</p><ul><li>This makes traversal really hard, e.g. <code>for(auto ch : std::u8string{u8"刘"})</code> will not get <code>刘</code>, but several code units 遍历实际上得到的也是 code unit</li><li><code>.size()</code>, <code>.find_first_of()</code> … are also for code unit</li></ul>
          </div>

<ul>
<li>So in fact, e.g. <code>std::string</code>, <code>std::string_view</code> are just instantiation of template <code>std::string</code>和 <code>std::string_view</code> 实际上是模板的实例化<ul>
<li>More specifically, i.e. <code>std::basic_string&lt;char&gt;</code> and <code>std::basic_string_view&lt;char&gt;</code></li>
<li>So, e.g. <code>std::u8string</code>, <code>std::u8string_view</code> are just <code>std::basic_string&lt;char8_t&gt;</code> and <code>std::basic_string_view&lt;char8_t&gt;</code></li>
<li>Since <code>char8_t</code> itself is code unit, the string represents vector of code units too</li>
<li>It also accepts <code>Traits = std::char_traits&lt;charT&gt;</code> as the second template parameter, which regulates operations used by basic_string like comparison of characters. So theoretically (but usually not used) you can define you own character type as long as it’s standard-layout and trivial, then give a <code>YourString</code> with the <code>NewTraits&lt;NewCharType&gt;</code></li>
<li>You can also provide an allocator, just like STL</li>
</ul>
</li>
<li>Weak Unicode support is mostly due to its complexity C++ 本身提供 Unicode 的支持不是很好，所以需要 Unicode 官方的标准库，或者使用其他的标准库<ul>
<li>C++ core guideline recommends you to use ICU (International Components for Unicode), Boost.Locale, etc. for complete Unicode support</li>
<li>You may also use utf8cpp, which operates UTF-8 by code point, since ICU is too large for small project</li>
</ul>
</li>
<li>Besides, input/output Unicode is troublesome in C++ 在 C++ 中 Unicode 的输入输出比较麻烦</li>
<li>There is also a wide character <code>wchar_t</code> in C/C++ 宽字符类型（C++ 11 之前）<ul>
<li>It’s platform dependent, only regulated that “it has the same property with one of integer types” 内部的表示由平台决定，用正数类型表示其大小</li>
<li>It’s UTF-16 on Windows, while UTF-32 on Linux</li>
<li>Prefix for wide character/string literals is <code>L</code>, e.g. <code>L"爱情可以慷慨又自私"</code></li>
<li>And, you can also use <code>std::wcout/wcin/wstring(_view)</code></li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DecomposeToByte</span><span class="hljs-params">(<span class="hljs-type">const</span> T&amp; str)</span> </span>{<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; str.<span class="hljs-built_in">size</span>(); i++) {<br>        <span class="hljs-keyword">auto</span> ch = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>&gt;(str[i]);<br>        <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> mask = (<span class="hljs-number">1</span> &lt;&lt; CHAR_BIT) - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-built_in">sizeof</span>(str[<span class="hljs-number">0</span>]); j++) {<br>            std::cout &lt;&lt; std::format(<span class="hljs-string">"{:02x}"</span>, (mask &amp; ch));<br>            ch &gt;&gt; <span class="hljs-number">8</span>;<br>        }<br>        std::cout &lt;&lt; <span class="hljs-string">"=&gt;"</span>;<br>    }<br>    std::cout &lt;&lt; <span class="hljs-string">"\n"</span>;<br>    <span class="hljs-keyword">return</span>;<br>}<br><br>std::wstring s1 = <span class="hljs-string">L"\U0001F449"</span>;<br>std::u8string s2 = <span class="hljs-string">u8"\U0001F449"</span>;<br>std::u16string s3 = <span class="hljs-string">u"\U0001F449"</span>;<br>std::u32string s4 = <span class="hljs-string">U"\U0001F449"</span>;<br></code></pre></td></tr></table></figure>

<div class="note note-warning">
            <p>In fact, C-string or <code>std::string</code> is more like <strong>a byte array</strong> instead of an ASCII string 事实上 C-string 或者 <code>std::string</code> 本质上是字节数组而不是 ASCII</p>
          </div>

<h3 id="Locale"><a href="#Locale" class="headerlink" title="Locale"></a>Locale</h3><ul>
<li>Locale is used for localization<ul>
<li>Each <code>std::locale</code> contains information for a set of <span class="hint--info hint--rounded hint--top" data-hint="culture 是什么？可以理解为不同国家的本地化表达方式" ontouchstart>culture</span>-dependent features by <code>std::facet</code> objects</li>
<li>Standard facets are divided into six categories:<ul>
<li>Collate: i.e. how characters are compared, transformed or hashed 字符如何进行比较，变换或哈希</li>
<li>Numeric: <code>num_get</code>, <code>num_put</code>, <code>numpunct</code><ul>
<li><code>num_get</code> will affect how <code>std::cin</code> works, <code>num_put</code> -&gt; <code>std::cout</code>, <code>numpunct</code> only affect punctuation 标点符号</li>
<li>For example, in German, <code>1.234,56</code> means <code>1234.56</code>; if you use Germany locale, then inputting <code>1.234,56</code> will correctly get it instead of <code>1.234</code></li>
</ul>
</li>
<li>Time: <code>time_get/time_put</code></li>
<li>Monetary: <code>money_get/money_put/moneypunct</code> 财政的；货币的</li>
<li>Message: transform some error message to another language</li>
<li>Ctype: <code>ctype/codecvt</code>, how characters are classified and converted, e.g. is upper 字符如何进行分类，其他字符集如何向其进行转化</li>
</ul>
</li>
<li>Locale 会影响输入输出流、字符识别和匹配</li>
</ul>
</li>
</ul>
<center>
    <img src="/2024/06/03/56ae950785e9/locale-imp.gif" srcset="/img/loading.gif" lazyload alt>
</center>

<div class="note note-success">
            <ul><li>每个 locale 创建出来都会指向一个实现 </li><li> 复制的时候只是复制指针 </li><li> 每个实现的数据结构都是 <code>vector&lt;facet*&gt;</code></li><li><code>facet</code> 可以复用</li></ul>
          </div>

<ul>
<li><p>Locale is cheap to copy; it uses reference count when copied and points to same set of facets 拷贝的代价很小</p>
</li>
<li><p>Facets use the address of a static member <code>id</code> to group; e.g. if you want a new facet, you need to inherit from <code>std::locale::facet</code> and have static <code>std::locale::id id</code> 不同的类的实现会</p>
</li>
<li><p>Facet will be deleted when it’s never referenced, so <code>new</code> is correct. It also uses reference count <code>facet</code>不需要担心内存泄漏的问题，通过引用计数来管理的</p>
</li>
<li><p>Create a new group of facet 如何创建新的 facet</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Umlaut</span> : <span class="hljs-keyword">public</span> std::locale::facet {<span class="hljs-comment">//1</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-type">static</span> std::locale::id id;                               <span class="hljs-comment">//2</span><br>    <span class="hljs-built_in">Umlaut</span>(std::<span class="hljs-type">size_t</span> refs=<span class="hljs-number">0</span>): std::locale::<span class="hljs-built_in">facet</span>(refs) {}  <span class="hljs-comment">//3</span><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">is_umlaut</span><span class="hljs-params">(<span class="hljs-type">char</span> c)</span> <span class="hljs-type">const</span> </span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">do_isumlaut</span>(c);}    <span class="hljs-comment">//4</span><br><span class="hljs-keyword">protected</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">bool</span> <span class="hljs-title">do_isumlaut</span><span class="hljs-params">(<span class="hljs-type">char</span>)</span> <span class="hljs-type">const</span></span>;                    <span class="hljs-comment">//5</span><br>};<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="Format"><a href="#Format" class="headerlink" title="Format"></a>Format</h3><ul>
<li><code>printf</code> is faster than <code>std::cout</code> dramatically</li>
<li><code>printf</code> is not type-safe, i.e. type cannot be identified to match <code>%d</code> <i class="fa-solid fa-bomb" style="color: #e78f81;"></i></li>
<li><code>printf</code> cannot be customized, but stream can overload <code>operator &lt;&lt;</code></li>
<li>You can use <code>std::cout &lt;&lt; std::format(“a={},b={},c={}\n”,a,b,c)</code><ul>
<li>To print <code>{</code> or <code>}</code>, you need to use <code>{{` or `}}</code></li>
<li>You can alos specify order explicitly, e.g. like <code>std::format("c={1}, a={0}, c={1}\n", a, c)</code></li>
</ul>
</li>
<li>C++ 23 introduces <code>std::print</code>, which also utilizes format</li>
<li><code>std::format</code> is even faster than <code>snprintf()</code></li>
<li>You can write format specifiers after <code>:</code>, e.g. <code>c={:xx}</code> or <code>a={0:xx}</code> (<code>0</code> is order)</li>
<li>The format is like <strong>fill</strong> – <strong>align</strong> – <strong>sign</strong> - <strong>#</strong> - <strong>0</strong> – <strong>width</strong> - <strong>.precision</strong> – <strong>L</strong> – <strong>type</strong>, and all parts are optional<ul>
<li><strong>fill</strong>, <strong>align</strong>, <strong>width</strong> are used to fill into additional characters to keep a fixed length<ul>
<li><strong>width</strong> means the total character numbers (including element itself)</li>
<li><strong>fill</strong> means the character to fill in (by default whitespace)</li>
<li><strong>align</strong> can be left(&lt;), right(&gt;) or middle(^) (by default left, except for integers and floating points to be right)</li>
<li>For example: <code>std::format(“{:0^8}”, 1)</code> will get <code>00010000</code>, <code>std::format(“{:08}”, 1)</code> will get <code>00000001</code></li>
<li><i class="fa-solid fa-comment" style="color: #FFD43B;"></i> if element itself is longer than width (e.g. here we pass <code>10000000</code>), then these specifiers will do nothing</li>
<li><i class="fa-solid fa-comment" style="color: #FFD43B;"></i> if only a number is given, then it’s seen as width instead of fill</li>
<li><i class="fa-solid fa-comment" style="color: #FFD43B;"></i> for most of East Asian characters and many emojis, width is seen as 2 instead of 1</li>
</ul>
</li>
<li><strong>sign</strong>: can be – (default, i.e. only show sign when the number is negative, including -0.0), + (always show sign), and whitespace (only show negative sign, but non-negative number will fill into a whitespace)<ul>
<li>For example, <code>std::format("{:0^+8}", 1)</code> will get <code>000+1000</code>, <code>std::format("{:+8}", 1)</code> will get <code>  +1  </code>, <code>std::format("{:}", 1)</code> will get <code> 1</code></li>
</ul>
</li>
<li><strong>type</strong>: how to show the element in many forms<ul>
<li>Integer: <code>b/B/d/o/x/X</code>; by default d(ecimal). Prefix is not output</li>
<li>Particularly, <code>bool</code> has an additional <code>s</code> (default), which will get <code>true/false</code></li>
<li><code>char/wchar_t</code> has an additional <code>c</code> (default), which will get the character; and an additional <code>?</code> since C++ 23, which will output raw character (e.g. <code>\n</code> instead of a new line)</li>
<li>Floating point: <code>e/f/g/a/E/F/G/A</code>; by default g(eneral)</li>
<li>Same as <code>std::chars_format::scientific/fixed/general/hex</code>, while default parameter to precision of<code> e/f/g/E/F/G</code> is 6</li>
<li>String (including C-string, std::string, etc.): <code>s</code>; by default s<ul>
<li>C++ 23 adds a <code>?</code>, which outputs escaped string (surrounding <code>""</code> will be output too)</li>
</ul>
</li>
<li>pointer: <code>p</code>; by default p. Same as <code>reinterpret_cast&lt;std::uintptr_t&gt;(ptr)</code><ul>
<li>It will additionally output a <code>0x</code></li>
<li>C++ 26 adds a <code>P</code>, which will force hexadecimal letters to be uppercase</li>
</ul>
</li>
<li>For example, <code>std::format(“{:m^+8x}”, 32)</code> will get <code>mm+20mmm</code>; <code>std::format(“{:e}”, 32.F)</code> will get <code>3.200000e+01</code></li>
</ul>
</li>
</ul>
</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/C/" class="category-chain-item">C++</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/C/" class="print-no-link">#C++</a>
      
        <a href="/tags/%E7%8E%B0%E4%BB%A3-C/" class="print-no-link">#现代 C++</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>现代 C++ 基础</div>
      <div>https://silhouettesforyou.github.io/2024/06/03/56ae950785e9/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Xiaoming</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>June 3, 2024</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/06/04/77811b82e50c/" title="ProtoBuf 的基本原理">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ProtoBuf 的基本原理</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/05/31/ee6e87e384c9/" title="DIY 摆放">
                        <span class="hidden-mobile">DIY 摆放</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
      <div class="col-lg-7 mx-auto nopadding-x-md">
        <div class="container custom mx-auto">
          <link rel="stylesheet" href="//at.alicdn.com/t/c/font_4625503_8j4kic2ox3k.css"> <script src="https://kit.fontawesome.com/8e800a3a44.js" crossorigin="anonymous"></script> <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.3/jquery-ui.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.8/umd/popper.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" crossorigin="anonymous" referrerpolicy="no-referrer">
        </div>
      </div>
    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
      <i class="iconfont icon-love"></i>
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  var relativeDate = function() {
    var updatedTime = document.getElementById('updated-time');
    if (updatedTime) {
      var text = updatedTime.textContent;
      var reg = /\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|[+-]\d{2}:\d{2})/;
      var matchs = text.match(reg);
      if (matchs) {
        var relativeTime = moment(matchs[0]).fromNow();
        updatedTime.textContent = text.replace(reg, relativeTime);
      }
      updatedTime.style.display = '';
    }
  };
  Fluid.utils.createScript('https://lib.baomitu.com/moment.js/2.29.4/moment.min.js', function() {
    if (!'en'.startsWith('en')) {
      Fluid.utils.createScript('https://lib.baomitu.com/moment.js/2.29.4/locale/en.min.js', function() {
        relativeDate();
      });
    } else {
      relativeDate();
    }
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="/js/tool-tips.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
<!-- hexo injector body_end start --><script src="https://cdn.jsdelivr.net/npm/hexo-tag-common@0.0.5/js/index.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"react":{"opacity":0.7}});</script></body>
</html>
