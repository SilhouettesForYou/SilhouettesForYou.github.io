<!DOCTYPE html>
<html lang="zh-Hans">
<head><!-- hexo injector head_begin start -->
<link rel="stylesheet" href="/css/bilicard.css">
<link href="https://cdn.jsdelivr.net/npm/hexo-tag-common@0.0.5/css/index.css" rel="stylesheet"/><!-- hexo injector head_begin end -->
    <!-- // 通过jsDelivr的CDN引入echarts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@4.8.0/dist/echarts.min.js"></script>
    <!-- // 使用GL里的各种组件时需要添加，否则可不需要 -->
    <script src="https://cdn.jsdelivr.net/npm/echarts-gl@1.1.1/dist/echarts-gl.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <!-- <script type="text/javascript" src="/js/texture.js"></script>
    <script type="text/javascript" src="/js/rose.js"></script> -->

    <meta charset="utf-8">
    <meta name="baidu-site-verification" content="code-WK4Q1HDzQk" />
    <meta name="google-site-verification" content="WV6BOVs7NRg-qgcovrSAgXFDsh8DNfm-siq4aTBYSb0" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="xiao ming">
    
    <title>
        
            现代 C++ 基础 |
        
        Silhouettes For You
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/breaking-bad-logo.png">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"silhouettesforyou.github.io","root":"/","language":"zh-Hans","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.jpg","favicon":"/images/breaking-bad-logo.png","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":false,"background_img":"/images/bg.svg","description":null},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":false},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
    
<style type="text/css">
.spoiler {
  display: inline;
}
p.spoiler {
  display: flex;
}
.spoiler a {
  pointer-events: none;
}
.spoiler-blur, .spoiler-blur > * {
  transition: text-shadow .5s ease;
}
.spoiler .spoiler-blur, .spoiler .spoiler-blur > * {
  color: rgba(0, 0, 0, 0);
  background-color: rgba(0, 0, 0, 0);
  text-shadow: 0 0 10px grey;
  cursor: pointer;
}
.spoiler .spoiler-blur:hover, .spoiler .spoiler-blur:hover > * {
  text-shadow: 0 0 5px grey;
}
.spoiler-box, .spoiler-box > * {
  transition: color .5s ease,
  background-color .5s ease;
}
.spoiler .spoiler-box, .spoiler .spoiler-box > * {
  color: black;
  background-color: black;
  text-shadow: none;
}</style><meta name="generator" content="Hexo 5.4.2"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="Silhouettes For You" type="application/atom+xml">
</head>



<!--动态线条背景-->
<script type="text/javascript" color="220,220,220" opacity='0.7' zIndex="0.5" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        
        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Silhouettes For You
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                TAGS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/lover"
                            >
                                LOVER
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">TAGS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/lover">LOVER</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">现代 C++ 基础</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">xiao ming</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2024-06-03 14:11:57
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/C/">C++</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/C/">C++</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E7%8E%B0%E4%BB%A3-C/">现代 C++</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>7.7k Words</span>
        </span>
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h3 id="Basics-Review"><a href="#Basics-Review" class="headerlink" title="Basics Review"></a>Basics Review</h3><h4 id="Array-Type"><a href="#Array-Type" class="headerlink" title="Array Type"></a>Array Type</h4><ul>
<li>Multidimensional array 多维数组<ul>
<li>除了第一维其它维必须明确指出大小（explicit size）</li>
<li>不可以全部 decay</li>
<li>Dynamic allocation<ul>
<li><code>malloc</code> in C and <code>new</code>/<code>new []</code> in C++</li>
<li><code>new</code>和 <code>malloc</code> 返回都是指针</li>
<li>释放</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h4><ul>
<li><p>函数返回类型不能是函数或者数组（但是可以是它们的引用）</p>
<ul>
<li>不应该返回局部变量的指针或者引用（超出了局部变量生命周期的范围）<ul>
<li>e.g. <code>int&amp; Test() { int a = 1; return &amp;a;}</code></li>
</ul>
</li>
<li>声明为 <code>static</code> 的局部变量具有全局性</li>
</ul>
</li>
<li><p>Function pointers 函数指针</p>
<ul>
<li><p><code>void(*)(int)</code></p>
</li>
<li><p>clockwise/spiral rule</p>
</li>
<li><p>Type alias 用 C++ 11 中的<code>using</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> MyFuncType1 = <span class="built_in">int</span>(*)(<span class="type">float</span>);</span><br><span class="line"><span class="keyword">using</span> MyFuncType2 = <span class="built_in">int</span>(*)(<span class="type">int</span>);</span><br><span class="line"><span class="keyword">using</span> MyFuncType3 = <span class="built_in">int</span>(*)(MyFuncType1);</span><br></pre></td></tr></table></figure></li>
<li><p>C 语言中可以用 <code>typedef</code>，但是没有<code>using</code> 强大</p>
</li>
</ul>
</li>
</ul>
<h4 id="Attribute"><a href="#Attribute" class="headerlink" title="Attribute"></a>Attribute</h4><ul>
<li><code>[[attribute]]</code> C++ 11，<code>[[attribute("reason")]]</code> C++ 20</li>
<li><code>[[deprecated]]</code>和<code>[[deprecated("reason")]]</code> C++ 14</li>
<li><code>[[noreturn]]</code> C++ 11</li>
<li><code>[[maybe_unused]]</code> C++ 17</li>
</ul>
<p>e.g.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[[nodiscard]] <span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>{<span class="keyword">return</span> a + b; }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">Add</span>(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// int res = Add(1, 2);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>warning: 放弃具有 [[nodiscard]] 属性函数的返回值</p>
<h4 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h4><blockquote>
<p>一个被限制取值的类</p>
</blockquote>
<ul>
<li>比较像使用全局变量</li>
<li>同时进行整形运算也没有安全检查</li>
<li>C++ 11 引入了 scoped enumeration 提高安全性</li>
</ul>
<p>e.g.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// enum Day {Monday};</span></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Day</span> {Monday};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// int a = Monday;</span></span><br><span class="line">    Day a = Day::Monday</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>可以使用 <code>std::underlying_type&lt;Day&gt;::type</code> 或者<code>std::underlying_type_t&lt;Day&gt;</code> C++ 14 转成整数类型<ul>
<li>C++ 23 中也可以使用<code>std::to_underlying&lt;Day&gt;(day)</code></li>
</ul>
</li>
<li>可以使用 <code>Day day{1};</code> 初始化 C++ 17，但是不能直接赋值<code>Day day = 1;</code> 或<code>day = 1;</code></li>
<li>可以使用位操作符</li>
</ul>
<h4 id="Expression"><a href="#Expression" class="headerlink" title="Expression"></a>Expression</h4><ul>
<li>运算符和表达式三个重要概念<ul>
<li>Precedence 优先级</li>
<li>Associativity 结合性</li>
<li>Order 顺序</li>
</ul>
</li>
<li>From the view of compiler, an expressiong is in fact a tree, determined by associativity and precedence. e.g. <code>9 / 3 / 2 + 2 * 3</code><ul>
<li>Precedence is used to split terms first.</li>
<li>Associativity determines how the tree will grow.</li>
<li>Then, it’s order of expression evaluation that computes the whole tree. 但是顺序是不确定的<ul>
<li><code>f1() + f2() + f3()</code>，<code>f1()</code>，<code>f1()</code>，<code>f1()</code>哪一个先被 evaluated 是不确定的</li>
</ul>
</li>
</ul>
</li>
<li>There are some rules<ul>
<li>For <code>&amp;&amp;</code> and <code>||</code>, since they have short-circuit property, the first part will be fully evaluated.</li>
<li>For a function call, all parameters (including <code>a</code> for e.g. <code>a.Func()</code> or <code>a-&gt;Func()</code>) are fully evaluated before entering the function.</li>
<li>三目运算</li>
<li>逗号表达式</li>
<li>C++ 17<ul>
<li>Parameters in function are evaluated indeterminately, i.e. every sub-tree represneted by te parameter is fully evaluated in a <strong>non-overlap</strong> way 不会以交叠的形式 evaluated</li>
<li>运算符重载，和 build-in 运算符的 evaluated 顺序一致，而不是被当作普通函数</li>
<li>More useful examples: chained call</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::string s = <span class="string">"I have it even works if you don't believe"</span>;</span><br><span class="line">s.<span class="built_in">replace</span>(<span class="number">0</span>, <span class="number">8</span>, <span class="string">""</span>).<span class="built_in">replace</span>(s.<span class="built_in">find</span>(<span class="string">"even"</span>), <span class="number">4</span>, <span class="string">"sometimes"</span>).<span class="built_in">replace</span>(s.<span class="built_in">find</span>(<span class="string">"you don't"</span>), <span class="number">9</span>, <span class="string">"I"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="class"><a href="#class" class="headerlink" title="class"></a>class</h3><h4 id="Ctor-amp-Dtor"><a href="#Ctor-amp-Dtor" class="headerlink" title="Ctor & Dtor"></a>Ctor &amp; Dtor</h4><ul>
<li>拷贝构造函数</li>
<li>赋值构造函数</li>
<li>The recommended way is member initializer list:<ul>
<li><code>member1{...}, member2{...}, ... {/* function body */}</code></li>
<li><code>{}</code> is used since C++ 11</li>
</ul>
</li>
<li>默认构造函数建议使用<code>Class() = default;</code></li>
<li>如果成员变量有默认值，就不建议使用上面的构造函数的形式，而是直接用默认值初始化</li>
</ul>
<h4 id="Initialization-of-Object"><a href="#Initialization-of-Object" class="headerlink" title="Initialization of Object"></a>Initialization of Object</h4><ul>
<li>Since C++ 11, Uniform Initialization is introduced<ul>
<li>所有的初始化都可以用<code>{}</code></li>
<li>相比于 <code>()</code> 更安全 Narrowing Conversion 缩窄变换检查<ul>
<li>the converted type cannot represent all values<ul>
<li><code>uint32_t</code>类型用 <code>uint16_t</code> 初始化，编译器会报错</li>
</ul>
</li>
<li>the facilitaties type safety</li>
</ul>
</li>
</ul>
</li>
<li>Value initialization: No parameter for initialization <code>T a()</code>， <code>T a{}</code>， <code>new T{}</code>， <code>new T()</code></li>
<li>Direct initialization: <code>T a(x, y, ...)</code>，<code>T(x, y, ...)</code>，<code>new T(x, y, ...)</code>，<code>T a{x, y, ...}</code></li>
<li>Copy initialization: <code>T a = xx;</code>，<code>T a[] = { xx, ...};</code><ul>
<li>Ctors that use <code>explicit</code> cannot use this way</li>
<li>Before C++ 17, this also requires available copy ctor.</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> {<span class="keyword">public</span>: <span class="function"><span class="keyword">explicit</span> <span class="title">A</span><span class="params">(<span class="type">int</span> a)</span> </span>{}};</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Func</span><span class="params">(A a)</span> </span>{}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    A a = <span class="number">1</span>;    <span class="comment">// error</span></span><br><span class="line">    A a = <span class="built_in">A</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">Func</span>(<span class="number">1</span>);    <span class="comment">// error</span></span><br><span class="line">    <span class="built_in">Func</span>(<span class="built_in">A</span>(<span class="number">1</span>)); </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>List initialization</li>
<li>Agregate initialization</li>
</ul>
<h4 id="Member-Functions"><a href="#Member-Functions" class="headerlink" title="Member Functions"></a>Member Functions</h4><ul>
<li>所有的成员函数都隐式有一个 <code>this</code> 指针</li>
<li>如果期望函数不能更改成员变量，可以使用 <code>const</code> 关键字 make <code>this</code> to be <code>const</code></li>
<li>静态成员函数<ul>
<li>没有 <code>this</code> 指针</li>
</ul>
</li>
</ul>
<h4 id="Access-Control"><a href="#Access-Control" class="headerlink" title="Access Control"></a>Access Control</h4><ul>
<li><code>private</code>、<code>protected</code>、<code>public</code>，默认是<code>private</code></li>
<li><code>protected</code>用在继承中</li>
<li>友元</li>
</ul>
<h4 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h4><ul>
<li>子类 / 派生类、父类 / 基类</li>
<li>子类 / 派生类可以访问父类中所有 <code>public</code> 和<code>protected</code>成员</li>
<li>继承和组合</li>
<li>派生类可以隐式的转化成基类</li>
</ul>
<h4 id="Polmorphism- 多态"><a href="#Polmorphism- 多态" class="headerlink" title="Polmorphism 多态"></a>Polmorphism 多态</h4><ul>
<li>you can use the base class to load the derived object and call tis own methods 使用基类的指针 / 引用，承载派生类的对象，从而调用派生类的方法</li>
<li>virtual pointer and virtual table</li>
<li>Every object whose class has a virtal method will have a virtual pointer, which points to virtual table of its class 每个类中都有一个指向虚表的指针，虚表内容就是声明为 <code>virtual</code> 函数的地址</li>
<li>In C++ 11, it’s recommended to use <code>override</code> 子类没有 <code>override</code> 编译器会报错</li>
<li><code>final</code> It means override, and the derived class cannot override again 继承链中的最后一个节点<ul>
<li><code>class A final {...};</code> 让类不能被继承</li>
<li>去虚化，编译优化</li>
</ul>
</li>
<li><code>abstract class</code> 抽象类<ul>
<li>抽象类不能被实例化</li>
<li>可以是使用抽象类的指针，指向的都是派生类的对象</li>
<li>C++ 通过纯虚函数实现抽象类 <code>virtual void PrintInfo() const = 0;</code></li>
<li>派生类继承自抽象类必须实现纯虚函数，否则仍然是抽象类</li>
<li>Don’t call <strong>any</strong> virtual function and any functoin that calls virtual function in ctor &amp; dtor 在构造函数和析构函数中不要调用任何虚函数，也不要掉调用任何可能调用虚函数的函数</li>
<li>You should usually make dtor of base class <code>virtual</code> 通常将析构函数声明为虚函数<ul>
<li>deleting <code>Base*</code> that cast from <code>Derived*</code> will lead to correct dtor 派生类指针赋给基类，当调用 <code>delete</code> 时，如果不基类不是虚析构函数，就会调用基类的析构函数</li>
</ul>
</li>
<li>构造函数不能是纯虚函数</li>
</ul>
</li>
</ul>
<h4 id="Some-Covert-Facts-in-Inheritance"><a href="#Some-Covert-Facts-in-Inheritance" class="headerlink" title="Some Covert Facts in Inheritance"></a>Some Covert Facts in Inheritance</h4><ul>
<li><code>override</code>不止表示复写虚函数的含义，对于非虚函数的复写也叫“override”</li>
<li><code>private</code> inheritance usually denotes the relation of <strong>has-a</strong></li>
<li>虚函数的返回类型可以有些许改变：you can use <code>Base*</code> to both accept <code>Base*</code> and <code>Derived*</code> 复写虚函数的返回值可以是指向基类的指针，也可以是指向派生类的指针<ul>
<li>智能指针不能有“协变”</li>
</ul>
</li>
<li>当虚方法有默认参数的时候，用什么类型的指针调用时，就会返回该类型内的默认值<ul>
<li>默认的参数在编译期间被识别，虚表是在运行时跳转的</li>
</ul>
</li>
</ul>
<p>e.g.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Parent::Go</span><span class="params">(<span class="type">int</span> i = <span class="number">2</span>)</span> </span>{std::cout &lt;&lt; <span class="string">"Base's go with i = "</span> &lt;&lt; i &lt;&lt; <span class="string">"\n"</span>; }</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Child::Go</span><span class="params">(<span class="type">int</span> i = <span class="number">4</span>)</span> </span>{std::cout &lt;&lt; <span class="string">"Derived's go with i ="</span> &lt;&lt; i &lt;&lt; <span class="string">"\n"</span>; }</span><br><span class="line"></span><br><span class="line">Child child;</span><br><span class="line">child.<span class="built_in">Go</span>(); <span class="comment">// Derived's go with i = 4</span></span><br><span class="line">Parent&amp; childRef = child;</span><br><span class="line">childRef.<span class="built_in">Go</span>();  <span class="comment">// Base's go with i = 2</span></span><br></pre></td></tr></table></figure>

<ul>
<li>可以更改虚方法的访问属性（但是不建议）</li>
</ul>
<h3 id="struct"><a href="#struct" class="headerlink" title="struct"></a><code>struct</code></h3><ul>
<li>和 <code>class</code> 基本上一样，除了 <code>struct</code> 默认的访问控制是<code>public</code><ul>
<li>不应该有成员函数，最多有 ctor、dtor 和运算符重载</li>
<li>With these constraints (except for ctor), <code>struct</code> will be an aggregate, which can use aggregate initialization<ul>
<li>Since C++ 20, aggregate can also use <strong>designated initialization</strong> 指定初始化</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>e.g.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Priority</span> {<span class="type">int</span> cal; }</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> x, y;</span><br><span class="line">    Priority priority[<span class="number">2</span>];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    Point p{.x = <span class="number">1</span>, .y = <span class="number">2</span>, .priority = {{ .val = <span class="number">1</span>}, {.val = <span class="number">2</span> } } };</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="Function-Overloading- 函数重载"><a href="#Function-Overloading- 函数重载" class="headerlink" title="Function Overloading 函数重载"></a>Function Overloading 函数重载</h3><ul>
<li>C++ 中就是相同的函数名不同的参数<ul>
<li>C 中是禁止的</li>
</ul>
</li>
<li>This is done by compilers using a technique called <strong>name mangling</strong></li>
<li>Operator Overloading 运算符重载<ul>
<li><code>+</code>，<code>-</code>，<code>*</code>，<code>/</code>，<code>%</code>，<code>|</code>，<code>&amp;</code>，<code>^</code>，<code>&lt;&lt;</code>，<code>&gt;&gt;</code>：推荐使用在全局函数中</li>
<li><code>+=</code>，<code>-=</code>，<code>*=</code>，<code>/=</code>，<code>|=</code>，<code>&amp;=</code>，<code>^=</code>，<code>&lt;&lt;=</code>，<code>&gt;&gt;=</code>：必须是成员函数 since the first operand must be a “named” object; return reerence (i.e. <code>*this</code>)</li>
<li>Prefix<code>++</code> &amp; Prefix<code>--</code>：必须是成员函数 return <code>*this</code></li>
<li>Postfix<code>++</code> &amp; Postfix<code>--</code> have an unused parameter int, which is used to distinguish the prefix and postfix</li>
<li><code>*</code>，<code>-&gt;</code>：usually used in e.g. some wrapper of pointers</li>
<li><code>&amp;&amp;</code>，<code>||</code>：short-circuit 特性会失效</li>
<li><code>&lt;=&gt;</code>：三路比较运算符</li>
<li><code>()</code></li>
<li><code>[]</code><ul>
<li>Since C++ 23, you can use multidimensional subscript in <code>operator[]</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Lambda-Expression"><a href="#Lambda-Expression" class="headerlink" title="Lambda Expression"></a>Lambda Expression</h3><ul>
<li>本质上是一个匿名的 <code>struct</code>，重载了<code>operator() const</code> 方法</li>
<li>Basic format: <code>auto func = [captures](params) -&gt; ReturnType {function body;};</code><ul>
<li>Captures are actually members of the <code>struct</code></li>
<li>ReturnType, params and function are for <code>operator()</code></li>
<li>Every lambda expression has its unique type</li>
<li>不传任何参数 <code>()</code> 可以省略掉</li>
</ul>
</li>
<li>建议将 Lambda 表达式中的捕获的东西明确写出来</li>
<li>static 和 global 变量是不需要被捕获的</li>
<li>捕获 <code>this</code> 指针<ul>
<li><code>this</code> by reference, since only copy pointer</li>
<li><code>*this</code> really copy all members</li>
<li>包括私有成员也可以捕获</li>
</ul>
</li>
<li>You may add specifiers after <code>()</code><ul>
<li><code>mutable</code>: since C++ 17, remove <code>const</code> in <code>operator()</code></li>
<li><code>static</code>: since C++ 23, same as <code>static operator()</code></li>
<li><code>constexpr</code>、<code>consteval</code>、<code>noexcept</code></li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">auto</span> m = [i] {i = <span class="number">1</span>; <span class="keyword">return</span> <span class="number">0</span>; }; <span class="comment">// 不允许修改 i = 1，因为重载的 operator() 是 const</span></span><br><span class="line">    <span class="keyword">auto</span> m = [i]() <span class="keyword">mutable</span> {i = <span class="number">1</span>; <span class="keyword">return</span> <span class="number">0</span>; }; <span class="comment">// 修改的不是外面定义的变量，本质上修改的是 i 的拷贝</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>It’s also legal to add attributes between <code>[]</code> and <code>()</code></li>
<li>函数也可以写成 Lambda 表达式的形式 <code>auto Foo(params) -&gt; ReturnType {function body;}</code></li>
</ul>
<p>Code Block With Initializer</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> it = table.<span class="built_in">find</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> (it == table.<span class="built_in">end</span>())</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="comment">//</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>it</code>会泄露出去，下面如果继续判断会再定义迭代器类型的变量</li>
<li>Since C++ 17, you mey code like</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">auto</span> it = table.<span class="built_in">find</span>(<span class="number">1</span>); it == table.<span class="built_in">end</span>())</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="comment">//</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Since C++ 20, range-based for loop can also add an additional initializer, e.g. <code>for (auto vec = GetVec(); auto&amp; m : vec);</code></li>
<li>Since C++ 23, type alias declaration can also be initializer, e.g. <code>if (using T = xx; ...)</code></li>
</ul>
<h3 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h3><ul>
<li>Since C++ 17, CATD(class template argument deduction) is introduced, meaning that the argument of ctor can deduce the template parameter of class. e.g. <code>std::vector v{1, 2, 3, 4}</code></li>
<li>Lambda expressiong can also use template</li>
</ul>
<h2 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h2><ul>
<li><code>std::size_t</code>: the type of <code>sizeof()</code> 意味着对象的大小不能超过 <code>std::size_t</code> 所表示的范围<ul>
<li>也意味着数组的大小不能超过 <code>std::size_t</code> 所表示的范围</li>
<li>容器的大小也不能超过<code>std::size_t</code></li>
</ul>
</li>
<li><code>std::ptrdiff_t</code>：两个指针相减得到的类型</li>
</ul>
<h3 id="Iterators"><a href="#Iterators" class="headerlink" title="Iterators"></a>Iterators</h3><ul>
<li>Input/Output iterator<ul>
<li>For output <code>*it = val</code>, <code>it++</code>, <code>++it</code>, ‘it1 = it2’</li>
<li>For input <code>==</code>, <code>!=</code>, <code>-&gt;</code></li>
</ul>
</li>
<li>Forward iterator: e.g. linked list</li>
<li>Bidirectional iterator: <code>--it</code>, <code>it--</code> e.g. double linked list, map</li>
<li>Random access iterator: <code>+</code>, <code>-</code>, <code>+=</code>, <code>-=</code>, <code>[]</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>!=</code> e.g. deque</li>
<li>Contiguous iterator (since C++ 17): 保证地址空间是连续的</li>
<li><strong>IMPOERTANT</strong>: Iterator are as unsage us pointers 线程不安全的</li>
<li>All containers can get their iterators by:<ul>
<li><code>.begin()</code>, <code>.end()</code></li>
<li><code>.cbegin()</code>, <code>cend()</code> read-only access</li>
</ul>
</li>
<li>双向链表等还提供了倒序的遍历迭代器<ul>
<li><code>.rbegin()</code>, <code>.rend()</code>, <code>.crbegin()</code>, <code>crend()</code></li>
</ul>
</li>
<li>还可以使用全局的方法得到迭代器<ul>
<li><code>std::begin(vec)</code>, <code>std::end(vec)</code></li>
<li>C++ 20 建议使用<code>std::ranges::begin</code></li>
<li>只有类似 <code>int arr[5]</code> 传入到 <code>std::begin()</code> 或<code>std::end()</code>中才有效，指针传入进来是无效的</li>
</ul>
</li>
<li>There are also general methods of iterator operations, defined in <code>&lt;iterator&gt;</code><ul>
<li><code>std::advance(InputIt&amp; it, n)</code>: <code>it += n</code></li>
<li><code>std::next(InputIt it, n = 1)</code>: <code>return it + n</code></li>
<li><code>std::prev(InputIt it, n = 1)</code>: <code>return it - n</code></li>
<li><code>std::distance(InputIt it1, InputIt it2)</code>: <code>retur it2 - it1</code> 不同的容器时间复杂度不一样</li>
</ul>
</li>
</ul>
<h4 id="Iterator-traits（显著的特点，特征）"><a href="#Iterator-traits（显著的特点，特征）" class="headerlink" title="Iterator traits（显著的特点，特征）"></a>Iterator traits（显著的特点，特征）</h4><ul>
<li>Iteratos provide some types to show their information:<ul>
<li><code>value_type</code>: The type of elements referred to</li>
<li><code>difference_type</code>: The type that can be used to represent the distance between elements (usually <code>ptrdiff_t</code>) 迭代器之间的距离所表示的类型，一般就是<code>ptrdiff_t</code></li>
<li><code>iterator_category</code>: e.g. <code>input_iterator_tag</code>, <code>continuous_iterator_tag</code></li>
<li><code>pointer</code> &amp; <code>reference</code>: only availiable in container iterators 只有在容器中才会有的特性<ul>
<li>可以使用 <code>std::iterator_traits&lt;IteratorType&gt;::xxx</code> 获取</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Stream-iterator"><a href="#Stream-iterator" class="headerlink" title="Stream iterator"></a>Stream iterator</h4><ul>
<li><code>std::istream_iterator&lt;T&gt;</code> &amp; <code>std:ostream_iterator&lt;T&gt;</code></li>
<li>The dafault construsted <code>istream_iterator</code> is <code>end()</code> 默认的构造函数表示终止的迭代器</li>
</ul>
<h4 id="Iterator-adaptor"><a href="#Iterator-adaptor" class="headerlink" title="Iterator adaptor"></a>Iterator adaptor</h4><p>有两种类型的迭代器适配器</p>
<ul>
<li>One is created from iterators to preform different utilities:<ul>
<li>E.g. reversed iterators 反向迭代器，++ 的本质上是 –，所以可以用 <code>begin()</code> 初始化，即<code>std:::reverse_iterator r{p.begin() }</code></li>
<li>You can get the underlying iterator by <code>.base()</code>, which actually returns the iterator that points to the elements after the referred one 调用 <code>.base()</code> 实际上是指向当前指向位置的下一个元素<ul>
<li><code>rbegin().base() == end()</code></li>
</ul>
</li>
</ul>
</li>
<li>Another is created from containers to work more than “iterate”<ul>
<li><code>std::back_insert_iterator{container}</code>: <code>*it = val</code> will call <code>push_back(val)</code> to insert</li>
<li><code>std:front_insert_iterator{container}</code>: call <code>push_front(val)</code> to insert</li>
<li><code>std::insert_iterator{container, pos}</code>: call <code>insert(pos, val)</code> to insert</li>
</ul>
</li>
<li>Notice that inserting/assigning a range directly is usually better than inserting one by one for <code>vector</code> or <code>deque</code></li>
</ul>
<h3 id="Sequential-Container"><a href="#Sequential-Container" class="headerlink" title="Sequential Container"></a>Sequential Container</h3><h4 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h4><ul>
<li>E.g. <code>int a[5]</code> will decay to <code>int*</code> when passing to function, and the size information is dropped 以参数的方式传递到函数中会退化成指针，并且大小也被舍弃了</li>
<li><code>std::array&lt;T, size&gt;</code> the same as <code>T[size]</code>. It always preserves size, can copy from another array, and can do more things like bound check</li>
<li>It’s allocated on stack<ul>
<li>But if you <code>new std::array</code>, then it;s still allocated on heap</li>
</ul>
</li>
<li>特殊的构造函数需要额外的 <code>{}</code> e.g. <code>struct S {int i; int j;}</code> 初始化时是<code>std::array&lt;S, 2&gt; arr{{{1, 2}, {3, 4}}}</code><ul>
<li>第一个 <code>{}</code> 是<code>array</code>本身初始化的<code>{}</code></li>
<li>第二个 <code>{}</code> 是数组初始化的<code>{}</code></li>
</ul>
</li>
<li>For member accessing 成员访问<ul>
<li><code>operator[]</code></li>
<li><code>at()</code> will check the bound</li>
<li><code>front()</code>, <code>back()</code>: get the first/last element of vector 首先要保证非空</li>
<li>If you want to get the raw pointer of array content, you can use <code>.data()</code></li>
</ul>
</li>
<li>Additonal methods<ul>
<li><code>.swap()</code></li>
<li><code>operator=</code>, <code>operator&lt;=&gt;</code> 三路比较运算符</li>
<li><code>.fill()</code> 将整个数组填充为某个特定值</li>
<li><code>std::to_array</code>(C-style array)</li>
</ul>
</li>
<li>Size operations<ul>
<li><code>.size()</code>: return <code>size_t</code></li>
<li><code>empty()</code></li>
<li><code>.max_size()</code>: get maximum possible size in this system(usually useless)</li>
</ul>
</li>
</ul>
<h4 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h4><ul>
<li>动态数组<ul>
<li>支持随机访问，占据连续空间</li>
<li>When insering and removing elements at the end (i.e. pushing/poping back), the complexity is amoritized（均摊） <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>If not at end, it’ll be <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
</li>
<li>在 cache 上的效果非常不错，对 cache 利用率非常显著</li>
<li>实现思路<ul>
<li>准备一部分空间，这样在 pushing 或者 poping 的时候时间复杂度才是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>当容量不够的时候在重新分配（reallocation），重分配的均摊复杂度也要求是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>The element number is called size; total space is called capacity</li>
<li>重分配的策略<ul>
<li>The easiest strategy is increasing space linearly<ul>
<li>E.g. 0 -&gt; 4 -&gt; 8 -&gt; 12 -&gt; 16 -&gt; …</li>
<li>Every <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewbox="0 -694 521 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g></g></svg></mjx-container> operations will trigger reallocation an copy <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="7.54ex" height="1.756ex" role="img" focusable="false" viewbox="0 -694 3332.6 776"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(877.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(1933.6,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mi" transform="translate(2454.6,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g></g></g></svg></mjx-container> elements<ul>
<li>So, the amortized complexity is <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.798ex;" xmlns="http://www.w3.org/2000/svg" width="26.843ex" height="3.38ex" role="img" focusable="false" viewbox="0 -1141.1 11864.5 1493.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mfrac" transform="translate(1167,0)"><g data-mml-node="mrow" transform="translate(220,582.8) scale(0.707)"><g data-mml-node="munderover"><g data-mml-node="mo"><path data-c="2211" d="M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z"/></g><g data-mml-node="mi" transform="translate(1089,477.1) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="TeXAtom" transform="translate(1089,-285.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mn" transform="translate(1123,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2453.3,0)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mi" transform="translate(521,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g></g><g data-mml-node="mrow" transform="translate(898.9,-345) scale(0.707)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mi" transform="translate(521,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g></g><rect width="2547.1" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(3954.1,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(4620.9,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(5676.7,0)"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(6454.7,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(6843.7,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(7721.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(8388.4,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(9444.2,0)"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(10222.2,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mfrac" transform="translate(10611.2,0)"><g data-mml-node="mi" transform="translate(220,394) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mi" transform="translate(247.9,-345) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><rect width="624.3" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(11475.5,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>Considering that <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewbox="0 -694 521 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g></g></svg></mjx-container> is an constant, this is still <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
</li>
</ul>
</li>
<li>So, what about exponentially（指数）?<ul>
<li>E.g. 1 -&gt; 2 -&gt; 4 -&gt; 8 -&gt; 16 -&gt; 32 -&gt; …</li>
<li>Every <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.152ex" height="1.932ex" role="img" focusable="false" viewbox="0 -853.7 951.4 853.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g></g></g></svg></mjx-container> operations will trigger reallocation an copy <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="6.527ex" height="2.117ex" role="img" focusable="false" viewbox="0 -853.7 2885 935.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(877.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msup" transform="translate(1933.6,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g></g></g></svg></mjx-container> elements<ul>
<li>So, the amortized complexity is <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.885ex;" xmlns="http://www.w3.org/2000/svg" width="17.432ex" height="3.752ex" role="img" focusable="false" viewbox="0 -1267.1 7705 1658.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mfrac" transform="translate(1167,0)"><g data-mml-node="mrow" transform="translate(220,582.8) scale(0.707)"><g data-mml-node="munderover"><g data-mml-node="mo"><path data-c="2211" d="M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z"/></g><g data-mml-node="mi" transform="translate(1089,477.1) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="TeXAtom" transform="translate(1089,-285.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mn" transform="translate(1123,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2453.3,0)"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g></g></g><g data-mml-node="msup" transform="translate(1043.4,-391.4) scale(0.707)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,289) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g><rect width="2519.5" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(3926.5,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(4593.3,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(5649,0)"><path data-c="398" d="M56 340Q56 423 86 494T164 610T270 680T388 705Q521 705 621 601T722 341Q722 260 693 191T617 75T510 4T388 -22T267 3T160 74T85 189T56 340ZM610 339Q610 428 590 495T535 598T463 651T384 668Q332 668 289 638T221 566Q168 485 168 339Q168 274 176 235Q189 158 228 105T324 28Q356 16 388 16Q415 16 442 24T501 54T555 111T594 205T610 339ZM223 263V422H263V388H514V422H554V263H514V297H263V263H223Z"/></g><g data-mml-node="mo" transform="translate(6427,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(6816,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(7316,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
</li>
</ul>
</li>
<li>Finally, why is the exponent 2?<ul>
<li>可以证明任何大于 1 的指数最后的均摊复杂度都是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>This is a trade-off between space and time 空间和时间的权衡</li>
<li>In MS（微软）, it’s 1.5</li>
</ul>
</li>
</ul>
</li>
<li>vector 不会自动的进行缩容（shrink），但是会暴露出接口手动缩容</li>
<li>Insert 是从后向前的（move backwards）</li>
<li>Removal is similar, but move forwards from the end of deletion to the deletion point, and finally destruct the last several elements</li>
<li><code>std::initializer_list</code></li>
<li>For member accessing (same as array)<ul>
<li>operator[]<code>, </code>at()<code>: accesing by index; </code>at()<code>will check th bound, i.e. if the index is greater than size,</code>std::out_of_range` will be thrown</li>
<li><code>front()</code>, <code>back()</code>: get the first/last element of vector</li>
<li>If you want to get the raw pointer of array content, you can use <code>.data()</code></li>
</ul>
</li>
<li>For capacity operations (i.e. adjust memory)<ul>
<li><code>.capacity()</code>: get capacity (return <code>size_t</code>)</li>
<li><code>.reserve(n)</code>: 直接分配 <code>n</code> 大小的内存，如果比当前 capacity 小就什么都不做，size 是不会改变的<ul>
<li>作用是前提知道需要分配的数量，一次性分配，就不需要有扩容的操作了</li>
</ul>
</li>
<li><code>.shrink_to_fit</code>: request to shrink the capacity so that <code>capacity == size</code></li>
</ul>
</li>
<li>For size operations<ul>
<li><code>.size()</code></li>
<li><code>.empty()</code></li>
<li><code>.resize(n, obj = Object{})</code></li>
<li><code>.clear()</code>: remove all things; size will be 0 after this</li>
</ul>
</li>
<li><code>.push_back(obj)</code></li>
<li><code>.emplace_back(params)</code>: insert an element constructed by params at the end 就地根据 <code>params</code> 构造元素<ul>
<li>Since C++ 17, it returns reference of inserted element (before it’s <code>void</code>)</li>
</ul>
</li>
<li><code>.pop_back()</code></li>
<li><code>.insert(const_iterator pos, xxx)</code></li>
<li><code>.erase(const_iteraor pos)</code>, <code>.erase(const_iterator first, const_iterator last)</code>: erase a single element/elements from <code>[first, last)</code><ul>
<li>insert/erase will return next calid iterator of inserted/erase elements</li>
</ul>
</li>
<li>Interact with another vector<ul>
<li><code>.assign</code></li>
<li><code>.swap(vec)</code></li>
</ul>
</li>
<li>Since C++ 23, ranges-related methods are added<ul>
<li><code>.assign_range(Range)</code></li>
<li><code>insert_range(const_iterator pos, Range)</code></li>
<li><code>append_range(Range)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Iterator-Invalidation"><a href="#Iterator-Invalidation" class="headerlink" title="Iterator Invalidation"></a>Iterator Invalidation</h4><ul>
<li><p>迭代器就是指针的包装，但是指针是不安全的</p>
</li>
<li><p>导致不安全的情况</p>
<ul>
<li>reallocation 重分配，造成原来保存的指针悬垂</li>
<li>Insertion &amp; removal 插入和删除</li>
</ul>
</li>
<li><p>For vector</p>
<ul>
<li><p>If the capacity changes, all iterators are invalid</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    std::vctorv{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>};</span><br><span class="line">    <span class="keyword">auto</span> it = v.<span class="built_in">begin</span>();</span><br><span class="line">    v.<span class="built_in">reserve</span>(<span class="number">10086</span>); <span class="comment">// 会导致上一行的 `it` 失效</span></span><br><span class="line">    it = v.<span class="built_in">begin</span>(); <span class="comment">// 必须进行重新获取</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure></li>
<li><p>If the capacity doesn’t change, but some elements are moved, iterators after the changed points are invalid</p>
</li>
</ul>
</li>
</ul>
<h4 id="Span"><a href="#Span" class="headerlink" title="Span"></a>Span</h4><ul>
<li>视图 View means that it doesn’t catually hold the data; it observes the data</li>
<li>Span is a view for contiguous memory (e.g. vector, array, string, C-sytle array initializer list, etc.)</li>
<li>可以像 array 一样操控 span</li>
<li><code>.first(N)/.last(N)</code></li>
<li><code>.subspan(beginPos(, size))</code></li>
<li>span is just a pointer with a size</li>
</ul>
<h4 id="Dequeue-Double-Ended-Queue- 双端队列"><a href="#Dequeue-Double-Ended-Queue- 双端队列" class="headerlink" title="Dequeue Double-Ended Queue 双端队列"></a>Dequeue Double-Ended Queue 双端队列</h4><ul>
<li>最主要的特点就是<ul>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> on insertion &amp; removal of elements at the front or the back</li>
<li>Random access</li>
</ul>
</li>
<li>Other properties are just like vector<ul>
<li><code>push_front</code></li>
<li><code>emplace_front</code></li>
<li><code>pop_front</code></li>
<li><code>prepend_range</code> C++ 23</li>
</ul>
</li>
<li>Circular queue<ul>
<li>When enqueue, tail moves forward</li>
<li>When dequeue, head moves forward</li>
<li>If <code>tail == head</code> i.e. the queue is full, overwrite the element at head, both tail and head move forward</li>
</ul>
</li>
<li>Dequeue 相当于动态的循环队列，当队列满的时候需要进行扩容<ul>
<li>扩容是做到均摊复杂度是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>可以做到随机访问的原理是 e.g. <code>deque[i]</code> is just <code>vec[(head + i) % size]</code></li>
</ul>
</li>
<li>实现方式<ul>
<li>降低拷贝的代价</li>
<li>通常的实现方式是使用动态循环队列（called map），里面的元素是指针<ul>
<li>指针指向一个 block，block 中存储对象</li>
<li>block 的大小是固定的</li>
</ul>
</li>
<li>Dequeue 中的数据结构<ul>
<li>The map and its size</li>
<li>The block size</li>
<li>The global offset of the first element <code>off</code><ul>
<li>We can use <code>off / block_size</code> to know the position of head</li>
</ul>
</li>
<li>Element nunmbers</li>
</ul>
</li>
<li>重新分配的时候只需要拷贝指针</li>
<li>Map reallocation in dequeue<ul>
<li>假设新加的 block 的大小是<code>count</code></li>
<li>需要使得循环队列仍然是连续的<ul>
<li>First, copy all elements from <code>vec[head, vecEnd]</code> to <code>newVec[head, currEnd]</code></li>
<li>Then, if <code>head &lt;= count</code>, copy <code>[0, head)</code> to <code>[currEnd, ...)</code></li>
<li>Else, copy after <code>currEnd</code> as mush as posisble, and the rest is arranged to the <code>newVecBegin</code></li>
<li>Finally, set all the rest to <code>nullptr</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Dequeue iterator incalidation<ul>
<li>All iterators are seen as invalid after insertion 插入之后所有的迭代器都是失效的，还包括<ul>
<li><code>resize</code></li>
<li><code>shrink_to_fit</code></li>
<li><code>clear</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><ul>
<li>Double linked list</li>
<li>Properties<ul>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> insertion and removal</li>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> splice 融合另一个 list 的一部分元素</li>
<li>不支持随机访问</li>
</ul>
</li>
<li>每个节点都已一个数据 <code>T data</code>、<code>prev</code>、<code>next</code>，并且第一个节点的<code>prev</code> 指向 <code>nullptr</code>，最后一个节点的<code>next</code> 指向<code>nullptr</code></li>
<li>微软用循环 list 实现的<ul>
<li>引入了哨兵节点 sentinel node，是 <code>prev</code> 指针的前一个节点，<code>next</code>指针的后一个节点</li>
<li>不需要特判 nullptr`</li>
</ul>
</li>
<li>There are two mehods to move nodes from another list<ul>
<li>和 <code>insert(pos, it1, it2)</code> 有区别，<code>insert</code>只是拷贝，没有清除操作</li>
<li><code>.merge(list2)/.mearge(list2, cmp)</code>，通常用在已排序的 list 中</li>
<li><code>.splice(pos, list2, ...)</code><ul>
<li><code>()</code>: insert the total <code>list2</code> to pos</li>
<li><code>(it2)</code>: insert <code>it2</code> to <code>pos</code> (and remove it from <code>list2</code>)</li>
<li><code>(first, last)</code>: insert <code>[first, last)</code> to <code>pos</code> (abd remove them from <code>list2</code>)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Froward-list"><a href="#Froward-list" class="headerlink" title="Froward list"></a>Froward list</h4><ul>
<li>Single linked list</li>
<li>Foward list 的目的是为了减少存储空间，所以不提供 <code>.size()</code> 函数</li>
<li>只存储头部节点</li>
</ul>
<h3 id="Container-adaptors"><a href="#Container-adaptors" class="headerlink" title="Container adaptors"></a>Container adaptors</h3><ul>
<li>容器适配器是对已经存在的容器进行包装，通常情况下不提供迭代器</li>
</ul>
<h4 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h4><ul>
<li>Stack is a LIFO data structure</li>
<li>The provide container show have <code>push_back</code>, <code>emplace_back</code>, <code>pop_back</code>, so vector, deque and list are all OK</li>
<li>APIs<ul>
<li><code>.pop()</code></li>
<li><code>.push(val)</code>, <code>.emplace(params)</code></li>
<li><code>.push_range(params)</code> C++ 23</li>
<li><code>.top()</code></li>
<li><code>.empty()</code>, <code>.size()</code></li>
<li><code>.swap(s2)</code></li>
<li><code>operator=</code></li>
<li><code>operator&lt;=&gt;</code></li>
</ul>
</li>
</ul>
<h3 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h3><ul>
<li>Queue is a FIFO data structure</li>
<li><code>.front()</code></li>
<li><code>.end()</code></li>
</ul>
<h4 id="Priority-queue"><a href="#Priority-queue" class="headerlink" title="Priority queue"></a>Priority queue</h4><ul>
<li>It’s defined in <code>&lt;queue&gt;</code></li>
<li>It’s in fact max heap<ul>
<li>插入或者弹出元素的时间复杂度是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.167ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 3610 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1152,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(2621,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(3221,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>建堆的时间复杂度是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>Percolation is the core algorithm<ul>
<li>插入的时候进行上滤 precolate up</li>
<li>删除的时候进行下滤 precolate down</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Flat-containers"><a href="#Flat-containers" class="headerlink" title="Flat containers"></a>Flat containers</h4><ul>
<li>The only defect of map/unordered_map/… is that they’re rellay cache-unfriendly</li>
<li>Flat containers 对缓存利用率更高<ul>
<li>The functionality is same as set/map</li>
<li>But it’s in fact an ordered “vector”<ul>
<li>没有冗余的数据，对 cache 更友好</li>
<li>本质上是两个 “vector”</li>
</ul>
</li>
</ul>
</li>
<li>The whole definition is <code>std::flat_map&lt;Key, Value, Compare = std::less&lt;Key&gt;, ContainerForKey = std::vector&lt;Key&gt;, ContainerForValue = std::vector&lt;Value&gt;&gt;</code></li>
<li>也可以使用 deque 作为容器</li>
<li>The complexity<ul>
<li>For lookup, <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.819ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 3898 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1152,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(2621,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(3509,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> 二分查找</li>
<li>For insertion/removal, <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2141 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(1152,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(1752,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>For <code>iterator++</code>, <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
</li>
</ul>
<h3 id="Associative-containers"><a href="#Associative-containers" class="headerlink" title="Associative containers"></a>Associative containers</h3><ul>
<li>They’re called associative because they associate key with value<ul>
<li>The value can also be omitted</li>
</ul>
</li>
<li>There exist ordered one and unordered one<ul>
<li>有序的需要比较函数 less than<ul>
<li>BBST (balanced binary serch tree) 查找、插入、删除的时间复杂度都是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="7.538ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 3332 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"/></g><g data-mml-node="mo" transform="translate(485,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(874,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(2343,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(2943,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container><ul>
<li>RB tree</li>
<li>AVL</li>
</ul>
</li>
</ul>
</li>
<li>无序的需要提供哈希函数和判断是否相等的函数<ul>
<li>查找、插入、删除的时间复杂度都是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="3.989ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 1763 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"/></g><g data-mml-node="mo" transform="translate(485,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(874,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1374,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><ul>
<li>The key is unique; a signle key cannot be mapped to multiple values</li>
<li><code>std::map&lt;Key, Value, CMPForKey = std::less&lt;Key&gt;&gt;</code><ul>
<li>默认是小于号</li>
<li><code>CMPForKey</code> should be able to accept <code>const key</code></li>
</ul>
</li>
<li>For member accessing<ul>
<li><code>operator[]</code>, <code>at()</code></li>
<li>Bidirectional iterators<ul>
<li>Notice that the worst complexity of <code>++/--</code> is <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.819ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 3898 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1152,0)"><g data-mml-node="mi"><path data-c="1D425" d="M43 686L134 690Q225 694 226 694H232V62H301V0H292Q274 3 170 3Q67 3 49 0H40V62H109V332Q109 387 109 453T110 534Q110 593 108 605T94 620Q80 624 53 624H40V686H43Z"/><path data-c="1D428" d="M287 -5Q228 -5 182 10T109 48T63 102T39 161T32 219Q32 272 50 314T94 382T154 423T214 446T265 452H279Q319 452 326 451Q428 439 485 376T542 221Q542 156 514 108T442 33Q384 -5 287 -5ZM399 230V250Q399 280 398 298T391 338T372 372T338 392T282 401Q241 401 212 380Q190 363 183 334T175 230Q175 202 175 189T177 153T183 118T195 91T215 68T245 56T287 50Q348 50 374 84Q388 101 393 132T399 230Z" transform="translate(319,0)"/><path data-c="1D420" d="M50 300Q50 368 105 409T255 450Q328 450 376 426L388 420Q435 455 489 455Q517 455 533 441T554 414T558 389Q558 367 544 353T508 339Q484 339 471 354T458 387Q458 397 462 400Q464 401 461 400Q459 400 454 399Q429 392 427 390Q454 353 459 328Q461 315 461 300Q461 240 419 202Q364 149 248 149Q185 149 136 172Q129 158 129 148Q129 105 170 93Q176 91 263 91Q273 91 298 91T334 91T366 89T400 85T432 77T466 64Q544 22 544 -69Q544 -114 506 -145Q438 -201 287 -201Q149 -201 90 -161T30 -70Q30 -58 33 -47T42 -27T54 -13T69 -1T82 6T94 12T101 15Q66 57 66 106Q66 151 90 187L97 197L89 204Q50 243 50 300ZM485 403H492Q491 404 488 404L485 403V403ZM255 200Q279 200 295 206T319 219T331 242T335 268T336 300Q336 337 333 352T317 380Q298 399 255 399Q228 399 211 392T187 371T178 345T176 312V300V289Q176 235 194 219Q215 200 255 200ZM287 -150Q357 -150 400 -128T443 -71Q443 -65 442 -61T436 -50T420 -37T389 -27T339 -21L308 -20Q276 -20 253 -20Q190 -20 180 -20T156 -26Q130 -38 130 -69Q130 -105 173 -127T287 -150Z" transform="translate(894,0)"/></g></g><g data-mml-node="mi" transform="translate(2621,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(3509,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>对 BBST 进行中序遍历就能得到有序的序列<ul>
<li><code>.begin()</code> is just the leftmost node and <code>.rbegin()</code> is just the rightmost node</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Note<ul>
<li><code>operator[]</code> will insert a default-constructed value if the key doesn’t exits<ul>
<li>如果 key 不存在并且默认构造的值也不是真正需要的，用 <code>insert_xxx</code> 效率更高</li>
<li><code>const map</code>不能用<code>operator[]</code></li>
<li>如果 value 是不能被默认构造的（例如没有默认构造函数）也是不能用<code>operator[]</code></li>
</ul>
</li>
<li>Key-value pair is stored in RB tree, so iterator also points to the pair</li>
<li>You can use structured binding to facilitate iteration</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">std::map&lt;string::string, <span class="type">int</span>&gt; scoreTable{</span><br><span class="line">    {<span class="string">"Li"</span>, <span class="number">99</span> },</span><br><span class="line">    {<span class="string">"God Liu"</span>, <span class="number">99</span> },</span><br><span class="line">    {<span class="string">"Saint Liu"</span>, <span class="number">99</span> },</span><br><span class="line">    {<span class="string">"Liang"</span>, <span class="number">99</span> },</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; [name, score] : scoreTable)</span><br><span class="line">    std::cout &lt;&lt; name &lt;&lt; <span class="string">''</span> &lt;&lt; score &lt;&lt; <span class="string">'\n'</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>APIs</p>
<ul>
<li><p><code>.lower_bound(key)</code>: find <code>it</code> that <code>prev(it)-&gt;key &lt; key &lt;= it-&gt;key</code></p>
<ul>
<li>Use key as a lower bound to make <code>[it, end) &gt;= key</code></li>
</ul>
</li>
<li><p><code>.lower_bound(key)</code>: find <code>it</code> that <code>prev(it)-&gt;key &lt;= key &lt; it-&gt;key</code></p>
<ul>
<li>Use key as a lower bound to make <code>[begin, it) &lt;= key</code></li>
</ul>
</li>
<li><p><code>.equal_range(key)</code>: find <code>it</code> pair with the same key as <code>key</code> in range</p>
</li>
<li><p>Insertion</p>
<ul>
<li>因为键是唯一的，插入的时候如果 key 存在会失败；无论失败成功都返回<code>pair&lt;iterator, bool&gt;</code><ul>
<li>If succeed, <code>iterator</code> refers to inserted element and <code>bool</code> is <code>true</code></li>
<li>If fail, <code>iterator</code> refers to the element with the same key and <code>bool</code> is false`</li>
</ul>
</li>
<li>插入失败会有多个处理方式<ul>
<li>Leave it unchanged<ul>
<li><code>.insert({key, value})</code></li>
<li><code>.emplace(params)</code></li>
</ul>
</li>
<li>Overwrite it (C++ 17)<ul>
<li><code>.insert_or_assign(key, value)</code>: return <code>pair&lt;iterator, bool&gt;</code></li>
</ul>
</li>
<li>Leave it unchanged and even not contruct the inserted value (C++ 17)<ul>
<li><code>.try_emplace(key, params)</code>: same as <code>empalce</code>, except that the params are used to construct value, and <code>emplace</code> is not forbidden to construct the pair in failure 构造 value 非常昂贵的时候使用</li>
</ul>
</li>
</ul>
</li>
<li>You can also provide a hint iterator for insertion<ul>
<li>hint iteraotr 在被插入元素后面的时候会有效率提升，在前面的话会使效率降低</li>
<li>Hint is often used in idiom blow<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> pLoc = someMap.<span class="built_in">lower_bound</span>(someKey);</span><br><span class="line"><span class="keyword">if</span> (pLoc != someMap.<span class="built_in">end</span>() &amp;&amp; !(someMap.<span class="built_in">Key_comp</span>()(someKey, pLoc-&gt;first)))</span><br><span class="line">    <span class="keyword">return</span> pLoc-&gt;second;</span><br><span class="line"><span class="keyword">else</span> {</span><br><span class="line">    <span class="keyword">auto</span> newValue = <span class="built_in">expensiveCalculation</span>();</span><br><span class="line">    someMap.<span class="built_in">insert</span>(pLoc, <span class="built_in">make_pair</span>(someKey, <span class="keyword">new</span> Value));</span><br><span class="line">    <span class="keyword">return</span> newValue;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>Erasure</p>
<ul>
<li><code>.erase(...)</code><ul>
<li><code>(key)</code></li>
<li><code>(iterator pos)</code></li>
<li><code>(iterator first, iterator last)</code></li>
</ul>
</li>
</ul>
</li>
<li><p><code>.extract(key)</code>, <code>extract(iterator pos)</code>: extract out the node from the map</p>
</li>
<li><p><code>.insert(node_type&amp;&amp;)</code>: insert the node to the map</p>
</li>
<li><p><code>.merge(another map/multimap)</code></p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Structured binding</strong></p>
<ul>
<li><p>Structured binding is just <code>auto&amp; [...]{xx}</code></p>
<ul>
<li><p><code>{xx}</code> can be <code>(xx)</code> or <code>=xx</code></p>
</li>
<li><p><code>auto&amp;</code> can be anything</p>
</li>
<li><p><code>xx</code> can be a pair; it can also be</p>
<ul>
<li>An object with all public data members, which will be bound on them</li>
<li>A C-style array or <code>std::array</code>, which will be bound on elements <code>arr[i]</code></li>
<li>A tuple-like thing, which will be bound on every element</li>
</ul>
</li>
<li><p>Note</p>
<ul>
<li><p>pair and <code>std::array</code> is also somewhat tuple-like thing and can use some tuple methods, e.g. <code>std::get</code> pair 和 <code>std::array</code> 也可以像 tuple 一样，访问的时候也可以使用访问 tuple 的方法</p>
</li>
<li><p>结构化绑定时一个新的声明，不能绑定已经存在的变量，如果想绑定已存在的变量可以使用<code>std::tie(name, score) = pair</code></p>
</li>
<li><p>结构化绑定的本质是匿名结构体，结构体中的变量是别名</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::tuple&lt;<span class="type">int</span>, <span class="type">float</span>&gt; a{<span class="number">1</span>, <span class="number">1.0f</span> };</span><br><span class="line"><span class="type">const</span> <span class="keyword">auto</span>&amp; [b, c] = a;</span><br><span class="line"><span class="keyword">decltype</span>(b) m = <span class="number">0</span>; <span class="comment">// const int m  = 0;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Structured binding is usually more efficient than novice/careless programmers 建议使用结构化绑定</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Tuple</strong></p>
<ul>
<li><code>std::tuple&lt;int, float, double&gt; t{1, 2.0f, 3.0};</code></li>
<li>It can only be accessed by an index that can be determined in compile time 下标访问的下标只能在编译时确定<ul>
<li><code>std::get&lt;0&gt;(tuple)</code> to get the <code>int 1</code></li>
<li>C++ 14 可以使用类型获取相应的值，前提是类型不能重复 e.g. <code>std::get&lt;int&gt;(tuple)</code></li>
<li><code>std::tuple_cat</code></li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><ul>
<li>Set is just a map without value</li>
<li>The only difference with amp is that it doesn’t have <code>operator[]</code> and <code>.at()</code></li>
<li>The iterator points to only key instead of key-value pair</li>
</ul>
<h4 id="Multimap"><a href="#Multimap" class="headerlink" title="Multimap"></a>Multimap</h4><ul>
<li>把 key 的唯一性取消了</li>
<li>不能使用 <code>operator[]</code> 和<code>.at()</code></li>
<li>相等的值的顺序取决于插入时的顺序</li>
<li>插入永远都是成功的</li>
<li>Nodes of multimap and map can be exchanged 两个容器的节点是可以相互替换的</li>
</ul>
<h4 id="Multiset"><a href="#Multiset" class="headerlink" title="Multiset"></a>Multiset</h4><ul>
<li>Except for only key and no value, same as multimap</li>
<li>You can also exchange nodes of multiset and set</li>
</ul>
<h4 id="Unordered-map"><a href="#Unordered-map" class="headerlink" title="Unordered map"></a>Unordered map</h4><ul>
<li><code>std::unordered_map&lt;Key, Value, Hash = std::hash&lt;key&gt;, Equal = std::equal_to&lt;Key&gt;&gt;</code></li>
<li>Many types have <code>std::hash&lt;Type&gt;</code>, e.g. <code>std::string</code>, <code>float</code>, etc.</li>
<li>The hash value of different keys may be same, so we need <code>Equal</code> to judge which key is wanted</li>
<li>微软的实现在解决冲突的时候用双向链表，并且链接相邻的 Bucket 延申出来的双向链表，并添加一个哨兵节点</li>
<li>当插入数据太多的时候，每个 bucket 也会链接很多数据<ul>
<li>这样会增加查找的复杂度</li>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.798ex;" xmlns="http://www.w3.org/2000/svg" width="9.174ex" height="2.76ex" role="img" focusable="false" viewbox="0 -867.1 4054.7 1219.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mtext" transform="translate(1475.8,394) scale(0.707)"><path data-c="73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z"/><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z" transform="translate(394,0)"/><path data-c="7A" d="M42 263Q44 270 48 345T53 423V431H393Q399 425 399 415Q399 403 398 402L381 378Q364 355 331 309T265 220L134 41L182 40H206Q254 40 283 46T331 77Q352 105 359 185L361 201Q361 202 381 202H401V196Q401 195 393 103T384 6V0H209L34 1L31 3Q28 8 28 17Q28 30 29 31T160 210T294 394H236Q169 393 152 388Q127 382 113 367Q89 344 82 264V255H42V263Z" transform="translate(672,0)"/><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z" transform="translate(1116,0)"/></g><g data-mml-node="mtext" transform="translate(220,-345) scale(0.707)"><path data-c="62" d="M307 -11Q234 -11 168 55L158 37Q156 34 153 28T147 17T143 10L138 1L118 0H98V298Q98 599 97 603Q94 622 83 628T38 637H20V660Q20 683 22 683L32 684Q42 685 61 686T98 688Q115 689 135 690T165 693T176 694H179V543Q179 391 180 391L183 394Q186 397 192 401T207 411T228 421T254 431T286 439T323 442Q401 442 461 379T522 216Q522 115 458 52T307 -11ZM182 98Q182 97 187 90T196 79T206 67T218 55T233 44T250 35T271 29T295 26Q330 26 363 46T412 113Q424 148 424 212Q424 287 412 323Q385 405 300 405Q270 405 239 390T188 347L182 339V98Z"/><path data-c="75" d="M383 58Q327 -10 256 -10H249Q124 -10 105 89Q104 96 103 226Q102 335 102 348T96 369Q86 385 36 385H25V408Q25 431 27 431L38 432Q48 433 67 434T105 436Q122 437 142 438T172 441T184 442H187V261Q188 77 190 64Q193 49 204 40Q224 26 264 26Q290 26 311 35T343 58T363 90T375 120T379 144Q379 145 379 161T380 201T380 248V315Q380 361 370 372T320 385H302V431Q304 431 378 436T457 442H464V264Q464 84 465 81Q468 61 479 55T524 46H542V0Q540 0 467 -5T390 -11H383V58Z" transform="translate(556,0)"/><path data-c="63" d="M370 305T349 305T313 320T297 358Q297 381 312 396Q317 401 317 402T307 404Q281 408 258 408Q209 408 178 376Q131 329 131 219Q131 137 162 90Q203 29 272 29Q313 29 338 55T374 117Q376 125 379 127T395 129H409Q415 123 415 120Q415 116 411 104T395 71T366 33T318 2T249 -11Q163 -11 99 53T34 214Q34 318 99 383T250 448T370 421T404 357Q404 334 387 320Z" transform="translate(1112,0)"/><path data-c="6B" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T97 124T98 167T98 217T98 272T98 329Q98 366 98 407T98 482T98 542T97 586T97 603Q94 622 83 628T38 637H20V660Q20 683 22 683L32 684Q42 685 61 686T98 688Q115 689 135 690T165 693T176 694H179V463L180 233L240 287Q300 341 304 347Q310 356 310 364Q310 383 289 385H284V431H293Q308 428 412 428Q475 428 484 431H489V385H476Q407 380 360 341Q286 278 286 274Q286 273 349 181T420 79Q434 60 451 53T500 46H511V0H505Q496 3 418 3Q322 3 307 0H299V46H306Q330 48 330 65Q330 72 326 79Q323 84 276 153T228 222L176 176V120V84Q176 65 178 59T189 49Q210 46 238 46H254V0H246Q231 3 137 3T28 0H20V46H36Z" transform="translate(1556,0)"/><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z" transform="translate(2084,0)"/><path data-c="74" d="M27 422Q80 426 109 478T141 600V615H181V431H316V385H181V241Q182 116 182 100T189 68Q203 29 238 29Q282 29 292 100Q293 108 293 146V181H333V146V134Q333 57 291 17Q264 -10 221 -10Q187 -10 162 2T124 33T105 68T98 100Q97 107 97 248V385H18V422H27Z" transform="translate(2528,0)"/><path data-c="20" d=""transform="translate(2917,0)"/><path data-c="6E"d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"transform="translate(3167,0)"/><path data-c="75"d="M383 58Q327 -10 256 -10H249Q124 -10 105 89Q104 96 103 226Q102 335 102 348T96 369Q86 385 36 385H25V408Q25 431 27 431L38 432Q48 433 67 434T105 436Q122 437 142 438T172 441T184 442H187V261Q188 77 190 64Q193 49 204 40Q224 26 264 26Q290 26 311 35T343 58T363 90T375 120T379 144Q379 145 379 161T380 201T380 248V315Q380 361 370 372T320 385H302V431Q304 431 378 436T457 442H464V264Q464 84 465 81Q468 61 479 55T524 46H542V0Q540 0 467 -5T390 -11H383V58Z"transform="translate(3723,0)"/><path data-c="6D"d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"transform="translate(4279,0)"/></g><rect width="3814.7"height="60"x="120"y="220"/></g></g></g></svg></mjx-container> is called load factor 装载因子</li>
<li>装载因子过大时，需要对 bucket array 进行扩容</li>
<li>Rehash 重哈希</li>
</ul>
</li>
<li>APIs<ul>
<li><code>.bucket_count()</code>: size of bucket array</li>
<li><code>.load_factor()</code>: <code>size() / bucket_count()</code></li>
<li><code>.max_load_factor()</code>: when load factor exceeds this limit, refresh will happen</li>
<li><code>.rehash(n)</code>: make <code>bucket_count() = max(n, ceil(size() / max_load_factor()))</code> and rehash</li>
<li><code>.reserve(n)</code></li>
<li><code>.bucket(key)</code>: get the bucket index of the key</li>
<li><code>.begin(index)</code>, <code>.cbegin(index)</code>, <code>.end(index)</code>, <code>.cend(index)</code>: get the iterator of the bucket at index</li>
<li><code>.bucket_size(index)</code>: get the size of bucket at index</li>
</ul>
</li>
<li>You can also extract nodes and insert them</li>
</ul>
<h2 id="Ranges"><a href="#Ranges" class="headerlink" title="Ranges"></a>Ranges</h2><ul>
<li><p>Using ranges is very like functional programming</p>
</li>
<li><p>There are three important components in ranges:</p>
<ul>
<li>Range: A type provides a begin iterator and end sentinel, so that it can be iterated over</li>
<li>View: A range that can be moved in <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container>, copied in <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container> (or cannot be copied) and destructed in <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 2041 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mo" transform="translate(763,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(1152,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(1652,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></li>
<li>Range adaptor</li>
</ul>
</li>
<li><p>Note</p>
<ul>
<li>Range 可以按照迭代器进行分类</li>
<li>计算是惰性计算</li>
</ul>
</li>
<li><p>They’re all defined in <code>&lt;range&gt;</code>; all views are defines as <code>std::ranges::xx_view</code>, and all range adaptors are defined as <code>std::views::xx</code></p>
<ul>
<li>一般用别名来简化定义 <code>namespace stdr = std::ranges</code> 和<code>namespace stdv = std::views</code></li>
<li><code>stdr::iota_view{lower, upper = INF}</code>, <code>stdv::iota(lower, upper = INF)</code>: 和 python 中的 <code>range(a, b)</code> 类似</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> oddNum : stdv::<span class="built_in">iota</span>(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">  | stdv::<span class="built_in">filter</span>([](<span class="type">int</span> num) {<span class="keyword">return</span> num % <span class="number">2</span> == <span class="number">1</span>; })</span><br><span class="line">  | stdv::<span class="built_in">take</span>(<span class="number">3</span>))</span><br><span class="line">{</span><br><span class="line">    std::cout &lt;&lt; oddNum &lt;&lt; <span class="string">'';</span></span><br><span class="line"><span class="string">}</span></span><br></pre></td></tr></table></figure></li>
<li><p>Writable</p>
<ul>
<li><code>stdv::filter(Pred)</code>: drop the element if the predicate function <code>Pred</code> returns <code>false</code></li>
<li><code>stdv::take(x)</code>: take first <code>x</code> elements (but not exceed <code>end</code>)</li>
<li><code>stdv::take_while(Pred)</code>: take elements until <code>Pred</code> return <code>false</code> (or <code>end</code>)</li>
<li><code>stdv::drop(x)</code>: drop first <code>x</code> elements</li>
<li><code>stdv::drop_while(Pred)</code>: drop elements unitl <code>Pred</code> returns <code>false</code></li>
<li><code>stdv::reverse</code></li>
<li><code>stdv::keys</code>: get the first element from a tuple-like thing</li>
<li><code>stdv::values</code></li>
<li><code>stdv::elements&lt;i&gt;</code>: get the <code>i</code>th elemnt from a tuple-like thing</li>
<li><code>stdv::stride(k)</code>: use <code>k</code> as stride to iterate<ul>
<li>e.g. <code>stdv::iota(1, 0) | stdv::stride(2)</code> gets <code>{1, 3, 5, 7, 9}</code></li>
</ul>
</li>
<li><code>stdv::join</code>: flattens the ranges to a single range 需要用 <code>|</code> 连接</li>
<li><code>stdv::join_with(xx)</code>: fill the interval with <code>xx</code> 需要用 <code>|</code> 连接</li>
<li><code>stdv::zip(r1, r2, ...)</code>: zip values from ranges to a tuple</li>
<li><code>stdv::cartesian_product(r1, r2, ...)</code>: return a tuple of elements from the cartesian product of these ranges</li>
<li><code>stdv::enumerate</code>: return <code>std::tuple&lt;Integer, T&amp;&gt;</code>; Integer is index whose tpe is diff typr of iterator</li>
<li><code>stdv::slide(width)</code>: slide the range in a sliding window of <code>width</code><ul>
<li>e.g. <code>std::vector v{1, 2, 3, 4, 5}; v | stdv::slide(3)</code> gets <code>{{1, 2, 3}, {2, 3, 4}, {3, 4, 5}}</code></li>
</ul>
</li>
<li><code>stdv::adjacent&lt;width&gt;</code>: same as <code>stdv::slide(width)</code></li>
<li><code>stdv::pairwise</code>: i.e. stdv::adjacent&lt;2&gt;</li>
<li><code>stdv::chunk(width)</code>: partition the range by <code>width</code></li>
<li><code>stdv::chunj_by(pred2)</code>: partition the range by <code>pred2</code>, i.e. a view sill stop when <code>pred2(*it, *next(it))</code> return <code>false</code></li>
<li><code>stdv::split(xx)</code></li>
<li><code>stdv::lazy_split(xx)</code></li>
</ul>
</li>
<li><p>Read-only</p>
<ul>
<li><p>Either make the view const, i.e. <code>std::as_const</code>; this will return <code>const T&amp;</code> or <code>tuple&lt;const T&amp;, ...&gt;</code></p>
</li>
<li><p>Or return value, i.e. transform-related, which will return <code>T</code> or <code>tuple&lt;T, ...&gt;</code></p>
<ul>
<li><p><code>stdv::zip_transform(TransformN, r1, r2, ...)</code>: return a view of <code>TransformN(ele1, ele2, ...)</code></p>
</li>
<li><p><code>stdv::adjacent_transform&lt;N&gt;(TransformN)</code>: return a view of <code>TransformN(...)</code>, where <code>...</code> is the elements of the sliding windows</p>
</li>
<li><p><code>stdv::transform(Transform)</code>: transform element to another element</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> };</span><br><span class="line"><span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">auto</span> r = v | stdv::<span class="built_in">transform</span>([&amp;cnt](<span class="type">const</span> <span class="type">int</span> ele) {</span><br><span class="line">    std::cout &lt;&lt; std::format(<span class="string">"cnt={}, ele={}\n"</span>, cnt, ele);</span><br><span class="line">    cnt++;</span><br><span class="line">    <span class="keyword">return</span> cnt + ele;</span><br><span class="line">}) | stdv::<span class="built_in">take_while</span>([](<span class="type">const</span> <span class="type">int</span> ele) {<span class="keyword">return</span> ele &lt; <span class="number">10</span>; });</span><br><span class="line"><span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; i : r);</span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line"><span class="comment">// cnt=0, ele=1</span></span><br><span class="line"><span class="comment">// cnt=1, ele=1</span></span><br><span class="line"><span class="comment">// cnt=2, ele=2</span></span><br><span class="line"><span class="comment">// cnt=3, ele=2</span></span><br><span class="line"><span class="comment">// cnt=4, ele=3</span></span><br><span class="line"><span class="comment">// cnt=5, ele=3</span></span><br><span class="line"><span class="comment">// cnt=6, ele=4</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>++</code> will trigger transfrom since <code>take_while</code> needs the transformed value to advance the iterator (i.e. by <code>Pred(*it)</code>)</li>
<li><code>const auto&amp; ele = *it</code> will trigger it again</li>
<li>That’s because the result doesn’t reference some existing elements, but generate from temporary; every time you need it, lazy evaluation generate it again 太 lazy 了</li>
<li>Sometimes, you may want to convert a range to a e.g. container, which needs to eagerly evaluate all<ul>
<li><code>stdr::to</code>, e.g. <code>stdr::to&lt;std::vector&gt;()</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>There are also some naïve range factories</p>
<ul>
<li><code>stdv::single(obj)</code>: make a view that copies/moves an object, i.e. the view owns only a single element</li>
<li><code>stdv::empty&lt;T&gt;</code>: create an empty view</li>
<li><code>stdv::repeat(r, k = INF)</code>: repeat a range <code>r</code> for <code>k</code> times, i.e. like a range <code>[r, r, r, ...]</code></li>
<li><code>stdv::istream&lt;xxx&gt;(stream)</code>: similar to <code>istream_iterator</code>; it caches value</li>
<li><code>stdr::subrange(first, last)</code></li>
</ul>
</li>
</ul>
<h2 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">end</span>):</span><br><span class="line">    begin = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> begin != end:</span><br><span class="line">        <span class="keyword">yield</span> begin</span><br><span class="line">        begin += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">generator = func(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> generator:</span><br><span class="line">    <span class="built_in">print</span>(num)</span><br></pre></td></tr></table></figure>

<p>When the function reaches <code>yield</code>, it will pause and <code>return</code> the number; when iterator moves forward, the function will resume and continue to execute until the next <code>yield</code> or real <code>return</code></p>
<ul>
<li>Since C++ 23, generator is also supported by <strong>corutine</strong><ul>
<li>Coroutines <strong>cooperates</strong> with each other and yield their excution flow themselves 协程之间是相互配合的控制流<ul>
<li>By contrast, for threads, they usually compete with each other and are interrupted by OS to give other threads chances to execute 线程则是抢占式的</li>
</ul>
</li>
</ul>
</li>
<li>Generator is just the same; when you need the next value , you just yield your execution flow to the generator function; when the generator function completes its task, it will give back the right of execution</li>
<li>Generator is also an <code>input_range</code> and view; it provides <code>begin()</code> and <code>end()</code> to iterate, and <code>++</code> the iterator will resume the function<ul>
<li>NOTICE: Call <code>.begin()</code> will start the coroutine</li>
</ul>
</li>
</ul>
<p>e.g.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::generator&lt;<span class="type">int</span>&gt; <span class="title">func</span><span class="params">(<span class="type">int</span> end)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    std::cout &lt;&lt; <span class="string">"Ahh..."</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> begin = <span class="number">0</span>; begin &lt; end; begin++)</span><br><span class="line">        <span class="keyword">co_yield</span> begin;</span><br><span class="line">    <span class="keyword">co_return</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">auto</span> generator = <span class="built_in">func</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it = generator.<span class="built_in">begin</span>(); it != generator.<span class="built_in">end</span>(); it++)</span><br><span class="line">    std::cout &lt;&lt; *it;</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; num : generator)</span><br><span class="line">    std::cout &lt;&lt; num;</span><br></pre></td></tr></table></figure>

<ul>
<li>Some notes<ul>
<li>One generator can only be used once 只能使用一次</li>
<li>Generator has <code>operator=</code></li>
<li><code>co_return</code> can be omitted</li>
<li>Saving contexts also needs memory, so an allocator can also be provided as the last template parameter</li>
</ul>
</li>
</ul>
<h2 id="Function-1"><a href="#Function-1" class="headerlink" title="Function"></a>Function</h2><h3 id="Pointer-to-member-functions"><a href="#Pointer-to-member-functions" class="headerlink" title="Pointer to member functions"></a>Pointer to member functions</h3><ul>
<li>Memeber fuctions can be static or non-static<ul>
<li>Static ones are just normal functions with some <code>Class::</code>, their pointers are same as normal ones</li>
<li>Non-static ones are always bound to some specific objects, i.e. there is a <code>this</code> pointer as a parameter</li>
</ul>
</li>
</ul>
<p>e.g.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span>: <span class="type">unsigned</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">AddAge</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> n)</span> </span>{</span><br><span class="line">        age += n;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> FuncPtr = <span class="built_in">void</span> (Person::*)(<span class="type">unsigned</span> <span class="type">int</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    Person p{<span class="number">0</span> }, *pointer = &amp;p;</span><br><span class="line">    FuncPtr ptr = &amp;Person::AddAge;</span><br><span class="line">    (p.*ptr)(<span class="number">5</span>);</span><br><span class="line">    (pointer-&gt;*ptr)(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// C++ 17</span></span><br><span class="line">    std::<span class="built_in">invoke</span>(ptr, p, <span class="number">5</span>);</span><br><span class="line">    std::<span class="built_in">invoke</span>(ptr, pointer, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>Define a pointer to member function is <code>Ret (Class::*)(params)</code></li>
<li><code>std::invoke</code> define in <code>&lt;functional&gt;</code> since C++ 17</li>
<li>Since C++ 23, <code>std::invoke_r&lt;Result&gt;</code> is provided</li>
</ul>
<h3 id="Callable-parameter"><a href="#Callable-parameter" class="headerlink" title="Callable parameter"></a>Callable parameter</h3><h4 id="Function-as-parameter"><a href="#Function-as-parameter" class="headerlink" title="Function as parameter"></a>Function as parameter</h4><ul>
<li>函数指针也可以实现将函数视为参数来传递，但是有两个问题<ul>
<li>有时候函数指针的参数类型有严格的限制，例如 <code>int</code> can be converted to <code>double</code>, <code>func(double)</code> is also acceptable</li>
<li>In C++, usually what you need is just “something callable”, i.e. a functor is allowed 有时候只是想传入一个可调用的类型</li>
</ul>
</li>
<li>有两种方式解决<ul>
<li>Use a template parameter <code>&lt;algorithm&gt;</code>常用的方法采用模板参数接受可调用的参数</li>
<li>Use a <code>std::function</code> defined in <code>&lt;functional&gt;</code><ul>
<li><code>std::function&lt;RetType(Args...)&gt;</code> can adopt almost all callable that have the return type <strong>convertible</strong> to <code>RetType</code> and accept <code>Args</code></li>
<li>The member function even preserves polymorphism</li>
<li>After getting the <code>std::function</code>, you can just use <code>operator()</code> to call it</li>
<li>Even more powerful, you can bind some parameters to get new functors<ul>
<li>E.g. you can use <code>std::bind(any_callable, params)</code> to get a <code>std::function</code> <code>std::bind</code>已经没有用了，完全可以用 Lambda 表达式绑定</li>
</ul>
</li>
<li>There are two defects<ul>
<li>Performance: It roughly causes 10% - 20% performance loss compared with direct function call<ul>
<li>有可能会用 <code>new</code>/<code>delete</code> 自定义<code>ctor</code>/<code>dtor</code></li>
<li>解决方式是使用 SOO(small object optimization)，在栈上准备一块小的 buffer 用于分配函数空间</li>
<li>如果绑定的 Lambda 表达是太大可以使用 <code>auto lambda = xx;</code>，然后再通过<code>std::ref(lambda)</code> 传给 <code>std::function</code> 的构造函数（但是要注意声明周期），但是不可以使用<code>std::ref(&amp;&amp;xx)(){...}</code>，lambda 表达式会立马失效</li>
</ul>
</li>
<li>The second defect of <code>std::function</code> is that it cannot really accept all functors 并不是支持所有的可调用类型<ul>
<li>When the functor is not copiable (e.g. move-only, like <code>std::unique_ptr</code>) 仿函数不能拷贝的就不能接受<ul>
<li>Thus, since C++ 23, <code>std::move_only_function</code> is introduced</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Reference wrapper<ul>
<li><code>std::(c)ref()</code> in fact create <code>std::reference_wrapper&lt;(const) T&gt;</code>, which can be seen as an instantiated reference<ul>
<li>例如容器中不可能存储引用类型的，如果想储存引用类型可以使用<code>std::vector&lt;std::reference_wrapper&lt;T&gt;&gt;</code></li>
<li>It’s in fact a wrapper of pointer, but it cannot be null, just like reference</li>
<li>Different from reference, it can be bound to another object by <code>operator=</code>, just like pointer 引用是不可以换绑的，但是 <code>std::ref()</code> 可以</li>
</ul>
</li>
<li>It’s also used to denote “it should be a reference” exlicitly in some methods in standard library, e.g. <code>std::bind_back</code> or <code>std::bind_front</code></li>
</ul>
</li>
</ul>
</li>
<li>There are also some predefined template functors in <code>&lt;functional&gt;</code><ul>
<li>Arithmetic functors: <code>plus</code>, <code>minus</code>, <code>multiplies</code>, <code>divides</code>, <code>modulus</code>, <code>negate</code></li>
<li>Comparison functors: <code>equal_to</code>, <code>not_equal_to</code>, <code>greater</code>, <code>less</code>, <code>greater_equal</code>, <code>less_equal</code>, <code>compare_three_way</code></li>
<li>Logical functors: <code>logical_and</code>, <code>logical_or</code>, <code>logical_not</code></li>
<li>Bitwise functors: <code>bit_and</code>, <code>bit_or</code>, <code>bit_xor</code>, <code>bit_not</code></li>
<li>These <code>Functor&lt;T&gt;</code> all have <code>auto operator()(const T&amp;, const T&amp;) const</code></li>
</ul>
</li>
</ul>
<h4 id="Lambda-expression"><a href="#Lambda-expression" class="headerlink" title="Lambda expression"></a>Lambda expression</h4><ul>
<li>We call lambda expression without capture <em>stateless lambda</em>; otherwise <em>stateful lambda</em></li>
<li>可以使用 <code>decltype(...)</code> 去推断 lambda 表达式的类型</li>
<li>理论上可以使用推断出来的仿函数的类型进行声明，但是只有再 C++ 20 之后才是合法的<ul>
<li>E.g. <code>auto l = [](int a, int b) {return a + b;}; using T = decltype(l); T l2{};</code></li>
<li>只适用 stateless lambda</li>
</ul>
</li>
</ul>

        </div>

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2024/06/04/54/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">ProtoBuf 的基本原理</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2024/05/31/52/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">DIY 摆放</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;Comments</i>
    </div>
    

        
            
    <div id="gitalk-container"></div>
    <script 
            src="//cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>
    <script >

        function loadGitalk() {
            let __gitalk__pathname = decodeURI(location.pathname);
            const __gitalk__pathnameLength = __gitalk__pathname.length;
            const __gitalk__pathnameMaxLength = 50;
            if (__gitalk__pathnameLength > __gitalk__pathnameMaxLength) {
                __gitalk__pathname = __gitalk__pathname.substring(0, __gitalk__pathnameMaxLength - 3) + '...';
            }

            try {
                Gitalk && new Gitalk({
                    clientID: '0c74e477328e28bacf97',
                    clientSecret: '62fd1a94cf185360ac2d2947665725e2eabf5e8d',
                    repo: 'SilhouettesForYou.github.io',
                    owner: 'SilhouettesForYou',
                    admin: ['SilhouettesForYou'],
                    id: __gitalk__pathname,
                    language: 'zh-Hans'
                }).render('gitalk-container');

            } catch (e) {
                window.Gitalk = null;
            }
        }

        if ('false') {
            const loadGitalkTimeout = setTimeout(() => {
                loadGitalk();
                clearTimeout(loadGitalkTimeout);
            }, 1000);
        } else {
            window.addEventListener('DOMContentLoaded', loadGitalk);
        }
    </script>



        
    
</div>

            </div>
        
    </div>
</div>

                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2024&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">xiao ming</a>
        </div>
        
        
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        

        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>

</div>

    </div>

    
        <aside class="page-aside">
            
    <div class="post-toc-wrap">
        <div class="post-toc">
            <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Basics-Review"><span class="nav-number">1.</span> <span class="nav-text">Basics Review</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Array-Type"><span class="nav-number">1.1.</span> <span class="nav-text">Array Type</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Function"><span class="nav-number">1.2.</span> <span class="nav-text">Function</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Attribute"><span class="nav-number">1.3.</span> <span class="nav-text">Attribute</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Enumeration"><span class="nav-number">1.4.</span> <span class="nav-text">Enumeration</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Expression"><span class="nav-number">1.5.</span> <span class="nav-text">Expression</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#class"><span class="nav-number">2.</span> <span class="nav-text">class</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Ctor-amp-Dtor"><span class="nav-number">2.1.</span> <span class="nav-text">Ctor &amp; Dtor</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Initialization-of-Object"><span class="nav-number">2.2.</span> <span class="nav-text">Initialization of Object</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Member-Functions"><span class="nav-number">2.3.</span> <span class="nav-text">Member Functions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Access-Control"><span class="nav-number">2.4.</span> <span class="nav-text">Access Control</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Inheritance"><span class="nav-number">2.5.</span> <span class="nav-text">Inheritance</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Polmorphism-%20%E5%A4%9A%E6%80%81"><span class="nav-number">2.6.</span> <span class="nav-text">Polmorphism 多态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Some-Covert-Facts-in-Inheritance"><span class="nav-number">2.7.</span> <span class="nav-text">Some Covert Facts in Inheritance</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#struct"><span class="nav-number">3.</span> <span class="nav-text">struct</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Function-Overloading-%20%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD"><span class="nav-number">4.</span> <span class="nav-text">Function Overloading 函数重载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lambda-Expression"><span class="nav-number">5.</span> <span class="nav-text">Lambda Expression</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Template"><span class="nav-number">6.</span> <span class="nav-text">Template</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Container"><span class="nav-number"></span> <span class="nav-text">Container</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Iterators"><span class="nav-number">1.</span> <span class="nav-text">Iterators</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Iterator-traits%EF%BC%88%E6%98%BE%E8%91%97%E7%9A%84%E7%89%B9%E7%82%B9%EF%BC%8C%E7%89%B9%E5%BE%81%EF%BC%89"><span class="nav-number">1.1.</span> <span class="nav-text">Iterator traits（显著的特点，特征）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Stream-iterator"><span class="nav-number">1.2.</span> <span class="nav-text">Stream iterator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Iterator-adaptor"><span class="nav-number">1.3.</span> <span class="nav-text">Iterator adaptor</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sequential-Container"><span class="nav-number">2.</span> <span class="nav-text">Sequential Container</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Array"><span class="nav-number">2.1.</span> <span class="nav-text">Array</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#vector"><span class="nav-number">2.2.</span> <span class="nav-text">vector</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Iterator-Invalidation"><span class="nav-number">2.3.</span> <span class="nav-text">Iterator Invalidation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Span"><span class="nav-number">2.4.</span> <span class="nav-text">Span</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dequeue-Double-Ended-Queue-%20%E5%8F%8C%E7%AB%AF%E9%98%9F%E5%88%97"><span class="nav-number">2.5.</span> <span class="nav-text">Dequeue Double-Ended Queue 双端队列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#List"><span class="nav-number">2.6.</span> <span class="nav-text">List</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Froward-list"><span class="nav-number">2.7.</span> <span class="nav-text">Froward list</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Container-adaptors"><span class="nav-number">3.</span> <span class="nav-text">Container adaptors</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Stack"><span class="nav-number">3.1.</span> <span class="nav-text">Stack</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Queue"><span class="nav-number">4.</span> <span class="nav-text">Queue</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Priority-queue"><span class="nav-number">4.1.</span> <span class="nav-text">Priority queue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Flat-containers"><span class="nav-number">4.2.</span> <span class="nav-text">Flat containers</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Associative-containers"><span class="nav-number">5.</span> <span class="nav-text">Associative containers</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Map"><span class="nav-number">5.1.</span> <span class="nav-text">Map</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Set"><span class="nav-number">5.2.</span> <span class="nav-text">Set</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Multimap"><span class="nav-number">5.3.</span> <span class="nav-text">Multimap</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Multiset"><span class="nav-number">5.4.</span> <span class="nav-text">Multiset</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Unordered-map"><span class="nav-number">5.5.</span> <span class="nav-text">Unordered map</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ranges"><span class="nav-number"></span> <span class="nav-text">Ranges</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Generator"><span class="nav-number"></span> <span class="nav-text">Generator</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Function-1"><span class="nav-number"></span> <span class="nav-text">Function</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Pointer-to-member-functions"><span class="nav-number">1.</span> <span class="nav-text">Pointer to member functions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Callable-parameter"><span class="nav-number">2.</span> <span class="nav-text">Callable parameter</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Function-as-parameter"><span class="nav-number">2.1.</span> <span class="nav-text">Function as parameter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Lambda-expression"><span class="nav-number">2.2.</span> <span class="nav-text">Lambda expression</span></a></li></ol></li></ol>
        </div>
    </div>


        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/code-copy.js"></script>




<div class="post-scripts">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/toc.js"></script>
    
</div>



<!-- hexo injector body_end start --><script src="https://cdn.jsdelivr.net/npm/hexo-tag-common@0.0.5/js/index.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>
</html>
